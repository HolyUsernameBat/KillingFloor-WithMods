<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>UnCodeX - Source: ROEngine.ROPawn</title>
	<meta name="Generator" content="UnCodeX 241" />
	<link rel="stylesheet" href="../DocStyle2.css" type="text/css" title="Original Purple" />
	<link rel="alternative stylesheet" href="../DocStyle2-blue.css" type="text/css" title="Blue" />
	<link rel="alternative stylesheet" href="../DocStyle2-red.css" type="text/css" title="Red" />
	<!--[if IE]>
	<link rel="stylesheet" href="../DocStyle2-msie.css" type="text/css" />
	<![endif]-->
	<script src="../styleswitcher.js" type="text/javascript"></script>
</head>
<body>

<div class="header">
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../roengine/roengine-overview.html">Package</a></td>
	<td class="header"><a href="../roengine/ropawn.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#ROPawn">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_roengine/roobjectivemsg.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_roengine/ropawnsoundgroup.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html#Source_roengine/ropawn.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>
</div>
<div class="spacer"></div>

<h1><a href="../roengine/roengine-overview.html">ROEngine</a>.<a href="../roengine/ropawn.html">ROPawn</a></h1>
<br />
<div class="source"><table class="source"><tr><td class="source_lineno"><span class="source_lineno">00001<br />00002<br />00003<br />00004<br />00005<br />00006<br />00007<br />00008<br />00009<br />00010<br />00011<br />00012<br />00013<br />00014<br />00015<br />00016<br />00017<br />00018<br />00019<br />00020<br />
00021<br />00022<br />00023<br />00024<br />00025<br />00026<br />00027<br />00028<br />00029<br />00030<br />00031<br />00032<br />00033<br />00034<br />00035<br />00036<br />00037<br />00038<br />00039<br />00040<br />
00041<br />00042<br />00043<br />00044<br />00045<br />00046<br />00047<br />00048<br />00049<br />00050<br />00051<br />00052<br />00053<br />00054<br />00055<br />00056<br />00057<br />00058<br />00059<br />00060<br />
00061<br />00062<br />00063<br />00064<br />00065<br />00066<br />00067<br />00068<br />00069<br />00070<br />00071<br />00072<br />00073<br />00074<br />00075<br />00076<br />00077<br />00078<br />00079<br />00080<br />
00081<br />00082<br />00083<br />00084<br />00085<br />00086<br />00087<br />00088<br />00089<br />00090<br />00091<br />00092<br />00093<br />00094<br />00095<br />00096<br />00097<br />00098<br />00099<br />00100<br />
00101<br />00102<br />00103<br />00104<br />00105<br />00106<br />00107<br />00108<br />00109<br />00110<br />00111<br />00112<br />00113<br />00114<br />00115<br />00116<br />00117<br />00118<br />00119<br />00120<br />
00121<br />00122<br />00123<br />00124<br />00125<br />00126<br />00127<br />00128<br />00129<br />00130<br />00131<br />00132<br />00133<br />00134<br />00135<br />00136<br />00137<br />00138<br />00139<br />00140<br />
00141<br />00142<br />00143<br />00144<br />00145<br />00146<br />00147<br />00148<br />00149<br />00150<br />00151<br />00152<br />00153<br />00154<br />00155<br />00156<br />00157<br />00158<br />00159<br />00160<br />
00161<br />00162<br />00163<br />00164<br />00165<br />00166<br />00167<br />00168<br />00169<br />00170<br />00171<br />00172<br />00173<br />00174<br />00175<br />00176<br />00177<br />00178<br />00179<br />00180<br />
00181<br />00182<br />00183<br />00184<br />00185<br />00186<br />00187<br />00188<br />00189<br />00190<br />00191<br />00192<br />00193<br />00194<br />00195<br />00196<br />00197<br />00198<br />00199<br />00200<br />
00201<br />00202<br />00203<br />00204<br />00205<br />00206<br />00207<br />00208<br />00209<br />00210<br />00211<br />00212<br />00213<br />00214<br />00215<br />00216<br />00217<br />00218<br />00219<br />00220<br />
00221<br />00222<br />00223<br />00224<br />00225<br />00226<br />00227<br />00228<br />00229<br />00230<br />00231<br />00232<br />00233<br />00234<br />00235<br />00236<br />00237<br />00238<br />00239<br />00240<br />
00241<br />00242<br />00243<br />00244<br />00245<br />00246<br />00247<br />00248<br />00249<br />00250<br />00251<br />00252<br />00253<br />00254<br />00255<br />00256<br />00257<br />00258<br />00259<br />00260<br />
00261<br />00262<br />00263<br />00264<br />00265<br />00266<br />00267<br />00268<br />00269<br />00270<br />00271<br />00272<br />00273<br />00274<br />00275<br />00276<br />00277<br />00278<br />00279<br />00280<br />
00281<br />00282<br />00283<br />00284<br />00285<br />00286<br />00287<br />00288<br />00289<br />00290<br />00291<br />00292<br />00293<br />00294<br />00295<br />00296<br />00297<br />00298<br />00299<br />00300<br />
00301<br />00302<br />00303<br />00304<br />00305<br />00306<br />00307<br />00308<br />00309<br />00310<br />00311<br />00312<br />00313<br />00314<br />00315<br />00316<br />00317<br />00318<br />00319<br />00320<br />
00321<br />00322<br />00323<br />00324<br />00325<br />00326<br />00327<br />00328<br />00329<br />00330<br />00331<br />00332<br />00333<br />00334<br />00335<br />00336<br />00337<br />00338<br />00339<br />00340<br />
00341<br />00342<br />00343<br />00344<br />00345<br />00346<br />00347<br />00348<br />00349<br />00350<br />00351<br />00352<br />00353<br />00354<br />00355<br />00356<br />00357<br />00358<br />00359<br />00360<br />
00361<br />00362<br />00363<br />00364<br />00365<br />00366<br />00367<br />00368<br />00369<br />00370<br />00371<br />00372<br />00373<br />00374<br />00375<br />00376<br />00377<br />00378<br />00379<br />00380<br />
00381<br />00382<br />00383<br />00384<br />00385<br />00386<br />00387<br />00388<br />00389<br />00390<br />00391<br />00392<br />00393<br />00394<br />00395<br />00396<br />00397<br />00398<br />00399<br />00400<br />
00401<br />00402<br />00403<br />00404<br />00405<br />00406<br />00407<br />00408<br />00409<br />00410<br />00411<br />00412<br />00413<br />00414<br />00415<br />00416<br />00417<br />00418<br />00419<br />00420<br />
00421<br />00422<br />00423<br />00424<br />00425<br />00426<br />00427<br />00428<br />00429<br />00430<br />00431<br />00432<br />00433<br />00434<br />00435<br />00436<br />00437<br />00438<br />00439<br />00440<br />
00441<br />00442<br />00443<br />00444<br />00445<br />00446<br />00447<br />00448<br />00449<br />00450<br />00451<br />00452<br />00453<br />00454<br />00455<br />00456<br />00457<br />00458<br />00459<br />00460<br />
00461<br />00462<br />00463<br />00464<br />00465<br />00466<br />00467<br />00468<br />00469<br />00470<br />00471<br />00472<br />00473<br />00474<br />00475<br />00476<br />00477<br />00478<br />00479<br />00480<br />
00481<br />00482<br />00483<br />00484<br />00485<br />00486<br />00487<br />00488<br />00489<br />00490<br />00491<br />00492<br />00493<br />00494<br />00495<br />00496<br />00497<br />00498<br />00499<br />00500<br />
00501<br />00502<br />00503<br />00504<br />00505<br />00506<br />00507<br />00508<br />00509<br />00510<br />00511<br />00512<br />00513<br />00514<br />00515<br />00516<br />00517<br />00518<br />00519<br />00520<br />
00521<br />00522<br />00523<br />00524<br />00525<br />00526<br />00527<br />00528<br />00529<br />00530<br />00531<br />00532<br />00533<br />00534<br />00535<br />00536<br />00537<br />00538<br />00539<br />00540<br />
00541<br />00542<br />00543<br />00544<br />00545<br />00546<br />00547<br />00548<br />00549<br />00550<br />00551<br />00552<br />00553<br />00554<br />00555<br />00556<br />00557<br />00558<br />00559<br />00560<br />
00561<br />00562<br />00563<br />00564<br />00565<br />00566<br />00567<br />00568<br />00569<br />00570<br />00571<br />00572<br />00573<br />00574<br />00575<br />00576<br />00577<br />00578<br />00579<br />00580<br />
00581<br />00582<br />00583<br />00584<br />00585<br />00586<br />00587<br />00588<br />00589<br />00590<br />00591<br />00592<br />00593<br />00594<br />00595<br />00596<br />00597<br />00598<br />00599<br />00600<br />
00601<br />00602<br />00603<br />00604<br />00605<br />00606<br />00607<br />00608<br />00609<br />00610<br />00611<br />00612<br />00613<br />00614<br />00615<br />00616<br />00617<br />00618<br />00619<br />00620<br />
00621<br />00622<br />00623<br />00624<br />00625<br />00626<br />00627<br />00628<br />00629<br />00630<br />00631<br />00632<br />00633<br />00634<br />00635<br />00636<br />00637<br />00638<br />00639<br />00640<br />
00641<br />00642<br />00643<br />00644<br />00645<br />00646<br />00647<br />00648<br />00649<br />00650<br />00651<br />00652<br />00653<br />00654<br />00655<br />00656<br />00657<br />00658<br />00659<br />00660<br />
00661<br />00662<br />00663<br />00664<br />00665<br />00666<br />00667<br />00668<br />00669<br />00670<br />00671<br />00672<br />00673<br />00674<br />00675<br />00676<br />00677<br />00678<br />00679<br />00680<br />
00681<br />00682<br />00683<br />00684<br />00685<br />00686<br />00687<br />00688<br />00689<br />00690<br />00691<br />00692<br />00693<br />00694<br />00695<br />00696<br />00697<br />00698<br />00699<br />00700<br />
00701<br />00702<br />00703<br />00704<br />00705<br />00706<br />00707<br />00708<br />00709<br />00710<br />00711<br />00712<br />00713<br />00714<br />00715<br />00716<br />00717<br />00718<br />00719<br />00720<br />
00721<br />00722<br />00723<br />00724<br />00725<br />00726<br />00727<br />00728<br />00729<br />00730<br />00731<br />00732<br />00733<br />00734<br />00735<br />00736<br />00737<br />00738<br />00739<br />00740<br />
00741<br />00742<br />00743<br />00744<br />00745<br />00746<br />00747<br />00748<br />00749<br />00750<br />00751<br />00752<br />00753<br />00754<br />00755<br />00756<br />00757<br />00758<br />00759<br />00760<br />
00761<br />00762<br />00763<br />00764<br />00765<br />00766<br />00767<br />00768<br />00769<br />00770<br />00771<br />00772<br />00773<br />00774<br />00775<br />00776<br />00777<br />00778<br />00779<br />00780<br />
00781<br />00782<br />00783<br />00784<br />00785<br />00786<br />00787<br />00788<br />00789<br />00790<br />00791<br />00792<br />00793<br />00794<br />00795<br />00796<br />00797<br />00798<br />00799<br />00800<br />
00801<br />00802<br />00803<br />00804<br />00805<br />00806<br />00807<br />00808<br />00809<br />00810<br />00811<br />00812<br />00813<br />00814<br />00815<br />00816<br />00817<br />00818<br />00819<br />00820<br />
00821<br />00822<br />00823<br />00824<br />00825<br />00826<br />00827<br />00828<br />00829<br />00830<br />00831<br />00832<br />00833<br />00834<br />00835<br />00836<br />00837<br />00838<br />00839<br />00840<br />
00841<br />00842<br />00843<br />00844<br />00845<br />00846<br />00847<br />00848<br />00849<br />00850<br />00851<br />00852<br />00853<br />00854<br />00855<br />00856<br />00857<br />00858<br />00859<br />00860<br />
00861<br />00862<br />00863<br />00864<br />00865<br />00866<br />00867<br />00868<br />00869<br />00870<br />00871<br />00872<br />00873<br />00874<br />00875<br />00876<br />00877<br />00878<br />00879<br />00880<br />
00881<br />00882<br />00883<br />00884<br />00885<br />00886<br />00887<br />00888<br />00889<br />00890<br />00891<br />00892<br />00893<br />00894<br />00895<br />00896<br />00897<br />00898<br />00899<br />00900<br />
00901<br />00902<br />00903<br />00904<br />00905<br />00906<br />00907<br />00908<br />00909<br />00910<br />00911<br />00912<br />00913<br />00914<br />00915<br />00916<br />00917<br />00918<br />00919<br />00920<br />
00921<br />00922<br />00923<br />00924<br />00925<br />00926<br />00927<br />00928<br />00929<br />00930<br />00931<br />00932<br />00933<br />00934<br />00935<br />00936<br />00937<br />00938<br />00939<br />00940<br />
00941<br />00942<br />00943<br />00944<br />00945<br />00946<br />00947<br />00948<br />00949<br />00950<br />00951<br />00952<br />00953<br />00954<br />00955<br />00956<br />00957<br />00958<br />00959<br />00960<br />
00961<br />00962<br />00963<br />00964<br />00965<br />00966<br />00967<br />00968<br />00969<br />00970<br />00971<br />00972<br />00973<br />00974<br />00975<br />00976<br />00977<br />00978<br />00979<br />00980<br />
00981<br />00982<br />00983<br />00984<br />00985<br />00986<br />00987<br />00988<br />00989<br />00990<br />00991<br />00992<br />00993<br />00994<br />00995<br />00996<br />00997<br />00998<br />00999<br />01000<br />
01001<br />01002<br />01003<br />01004<br />01005<br />01006<br />01007<br />01008<br />01009<br />01010<br />01011<br />01012<br />01013<br />01014<br />01015<br />01016<br />01017<br />01018<br />01019<br />01020<br />
01021<br />01022<br />01023<br />01024<br />01025<br />01026<br />01027<br />01028<br />01029<br />01030<br />01031<br />01032<br />01033<br />01034<br />01035<br />01036<br />01037<br />01038<br />01039<br />01040<br />
01041<br />01042<br />01043<br />01044<br />01045<br />01046<br />01047<br />01048<br />01049<br />01050<br />01051<br />01052<br />01053<br />01054<br />01055<br />01056<br />01057<br />01058<br />01059<br />01060<br />
01061<br />01062<br />01063<br />01064<br />01065<br />01066<br />01067<br />01068<br />01069<br />01070<br />01071<br />01072<br />01073<br />01074<br />01075<br />01076<br />01077<br />01078<br />01079<br />01080<br />
01081<br />01082<br />01083<br />01084<br />01085<br />01086<br />01087<br />01088<br />01089<br />01090<br />01091<br />01092<br />01093<br />01094<br />01095<br />01096<br />01097<br />01098<br />01099<br />01100<br />
01101<br />01102<br />01103<br />01104<br />01105<br />01106<br />01107<br />01108<br />01109<br />01110<br />01111<br />01112<br />01113<br />01114<br />01115<br />01116<br />01117<br />01118<br />01119<br />01120<br />
01121<br />01122<br />01123<br />01124<br />01125<br />01126<br />01127<br />01128<br />01129<br />01130<br />01131<br />01132<br />01133<br />01134<br />01135<br />01136<br />01137<br />01138<br />01139<br />01140<br />
01141<br />01142<br />01143<br />01144<br />01145<br />01146<br />01147<br />01148<br />01149<br />01150<br />01151<br />01152<br />01153<br />01154<br />01155<br />01156<br />01157<br />01158<br />01159<br />01160<br />
01161<br />01162<br />01163<br />01164<br />01165<br />01166<br />01167<br />01168<br />01169<br />01170<br />01171<br />01172<br />01173<br />01174<br />01175<br />01176<br />01177<br />01178<br />01179<br />01180<br />
01181<br />01182<br />01183<br />01184<br />01185<br />01186<br />01187<br />01188<br />01189<br />01190<br />01191<br />01192<br />01193<br />01194<br />01195<br />01196<br />01197<br />01198<br />01199<br />01200<br />
01201<br />01202<br />01203<br />01204<br />01205<br />01206<br />01207<br />01208<br />01209<br />01210<br />01211<br />01212<br />01213<br />01214<br />01215<br />01216<br />01217<br />01218<br />01219<br />01220<br />
01221<br />01222<br />01223<br />01224<br />01225<br />01226<br />01227<br />01228<br />01229<br />01230<br />01231<br />01232<br />01233<br />01234<br />01235<br />01236<br />01237<br />01238<br />01239<br />01240<br />
01241<br />01242<br />01243<br />01244<br />01245<br />01246<br />01247<br />01248<br />01249<br />01250<br />01251<br />01252<br />01253<br />01254<br />01255<br />01256<br />01257<br />01258<br />01259<br />01260<br />
01261<br />01262<br />01263<br />01264<br />01265<br />01266<br />01267<br />01268<br />01269<br />01270<br />01271<br />01272<br />01273<br />01274<br />01275<br />01276<br />01277<br />01278<br />01279<br />01280<br />
01281<br />01282<br />01283<br />01284<br />01285<br />01286<br />01287<br />01288<br />01289<br />01290<br />01291<br />01292<br />01293<br />01294<br />01295<br />01296<br />01297<br />01298<br />01299<br />01300<br />
01301<br />01302<br />01303<br />01304<br />01305<br />01306<br />01307<br />01308<br />01309<br />01310<br />01311<br />01312<br />01313<br />01314<br />01315<br />01316<br />01317<br />01318<br />01319<br />01320<br />
01321<br />01322<br />01323<br />01324<br />01325<br />01326<br />01327<br />01328<br />01329<br />01330<br />01331<br />01332<br />01333<br />01334<br />01335<br />01336<br />01337<br />01338<br />01339<br />01340<br />
01341<br />01342<br />01343<br />01344<br />01345<br />01346<br />01347<br />01348<br />01349<br />01350<br />01351<br />01352<br />01353<br />01354<br />01355<br />01356<br />01357<br />01358<br />01359<br />01360<br />
01361<br />01362<br />01363<br />01364<br />01365<br />01366<br />01367<br />01368<br />01369<br />01370<br />01371<br />01372<br />01373<br />01374<br />01375<br />01376<br />01377<br />01378<br />01379<br />01380<br />
01381<br />01382<br />01383<br />01384<br />01385<br />01386<br />01387<br />01388<br />01389<br />01390<br />01391<br />01392<br />01393<br />01394<br />01395<br />01396<br />01397<br />01398<br />01399<br />01400<br />
01401<br />01402<br />01403<br />01404<br />01405<br />01406<br />01407<br />01408<br />01409<br />01410<br />01411<br />01412<br />01413<br />01414<br />01415<br />01416<br />01417<br />01418<br />01419<br />01420<br />
01421<br />01422<br />01423<br />01424<br />01425<br />01426<br />01427<br />01428<br />01429<br />01430<br />01431<br />01432<br />01433<br />01434<br />01435<br />01436<br />01437<br />01438<br />01439<br />01440<br />
01441<br />01442<br />01443<br />01444<br />01445<br />01446<br />01447<br />01448<br />01449<br />01450<br />01451<br />01452<br />01453<br />01454<br />01455<br />01456<br />01457<br />01458<br />01459<br />01460<br />
01461<br />01462<br />01463<br />01464<br />01465<br />01466<br />01467<br />01468<br />01469<br />01470<br />01471<br />01472<br />01473<br />01474<br />01475<br />01476<br />01477<br />01478<br />01479<br />01480<br />
01481<br />01482<br />01483<br />01484<br />01485<br />01486<br />01487<br />01488<br />01489<br />01490<br />01491<br />01492<br />01493<br />01494<br />01495<br />01496<br />01497<br />01498<br />01499<br />01500<br />
01501<br />01502<br />01503<br />01504<br />01505<br />01506<br />01507<br />01508<br />01509<br />01510<br />01511<br />01512<br />01513<br />01514<br />01515<br />01516<br />01517<br />01518<br />01519<br />01520<br />
01521<br />01522<br />01523<br />01524<br />01525<br />01526<br />01527<br />01528<br />01529<br />01530<br />01531<br />01532<br />01533<br />01534<br />01535<br />01536<br />01537<br />01538<br />01539<br />01540<br />
01541<br />01542<br />01543<br />01544<br />01545<br />01546<br />01547<br />01548<br />01549<br />01550<br />01551<br />01552<br />01553<br />01554<br />01555<br />01556<br />01557<br />01558<br />01559<br />01560<br />
01561<br />01562<br />01563<br />01564<br />01565<br />01566<br />01567<br />01568<br />01569<br />01570<br />01571<br />01572<br />01573<br />01574<br />01575<br />01576<br />01577<br />01578<br />01579<br />01580<br />
01581<br />01582<br />01583<br />01584<br />01585<br />01586<br />01587<br />01588<br />01589<br />01590<br />01591<br />01592<br />01593<br />01594<br />01595<br />01596<br />01597<br />01598<br />01599<br />01600<br />
01601<br />01602<br />01603<br />01604<br />01605<br />01606<br />01607<br />01608<br />01609<br />01610<br />01611<br />01612<br />01613<br />01614<br />01615<br />01616<br />01617<br />01618<br />01619<br />01620<br />
01621<br />01622<br />01623<br />01624<br />01625<br />01626<br />01627<br />01628<br />01629<br />01630<br />01631<br />01632<br />01633<br />01634<br />01635<br />01636<br />01637<br />01638<br />01639<br />01640<br />
01641<br />01642<br />01643<br />01644<br />01645<br />01646<br />01647<br />01648<br />01649<br />01650<br />01651<br />01652<br />01653<br />01654<br />01655<br />01656<br />01657<br />01658<br />01659<br />01660<br />
01661<br />01662<br />01663<br />01664<br />01665<br />01666<br />01667<br />01668<br />01669<br />01670<br />01671<br />01672<br />01673<br />01674<br />01675<br />01676<br />01677<br />01678<br />01679<br />01680<br />
01681<br />01682<br />01683<br />01684<br />01685<br />01686<br />01687<br />01688<br />01689<br />01690<br />01691<br />01692<br />01693<br />01694<br />01695<br />01696<br />01697<br />01698<br />01699<br />01700<br />
01701<br />01702<br />01703<br />01704<br />01705<br />01706<br />01707<br />01708<br />01709<br />01710<br />01711<br />01712<br />01713<br />01714<br />01715<br />01716<br />01717<br />01718<br />01719<br />01720<br />
01721<br />01722<br />01723<br />01724<br />01725<br />01726<br />01727<br />01728<br />01729<br />01730<br />01731<br />01732<br />01733<br />01734<br />01735<br />01736<br />01737<br />01738<br />01739<br />01740<br />
01741<br />01742<br />01743<br />01744<br />01745<br />01746<br />01747<br />01748<br />01749<br />01750<br />01751<br />01752<br />01753<br />01754<br />01755<br />01756<br />01757<br />01758<br />01759<br />01760<br />
01761<br />01762<br />01763<br />01764<br />01765<br />01766<br />01767<br />01768<br />01769<br />01770<br />01771<br />01772<br />01773<br />01774<br />01775<br />01776<br />01777<br />01778<br />01779<br />01780<br />
01781<br />01782<br />01783<br />01784<br />01785<br />01786<br />01787<br />01788<br />01789<br />01790<br />01791<br />01792<br />01793<br />01794<br />01795<br />01796<br />01797<br />01798<br />01799<br />01800<br />
01801<br />01802<br />01803<br />01804<br />01805<br />01806<br />01807<br />01808<br />01809<br />01810<br />01811<br />01812<br />01813<br />01814<br />01815<br />01816<br />01817<br />01818<br />01819<br />01820<br />
01821<br />01822<br />01823<br />01824<br />01825<br />01826<br />01827<br />01828<br />01829<br />01830<br />01831<br />01832<br />01833<br />01834<br />01835<br />01836<br />01837<br />01838<br />01839<br />01840<br />
01841<br />01842<br />01843<br />01844<br />01845<br />01846<br />01847<br />01848<br />01849<br />01850<br />01851<br />01852<br />01853<br />01854<br />01855<br />01856<br />01857<br />01858<br />01859<br />01860<br />
01861<br />01862<br />01863<br />01864<br />01865<br />01866<br />01867<br />01868<br />01869<br />01870<br />01871<br />01872<br />01873<br />01874<br />01875<br />01876<br />01877<br />01878<br />01879<br />01880<br />
01881<br />01882<br />01883<br />01884<br />01885<br />01886<br />01887<br />01888<br />01889<br />01890<br />01891<br />01892<br />01893<br />01894<br />01895<br />01896<br />01897<br />01898<br />01899<br />01900<br />
01901<br />01902<br />01903<br />01904<br />01905<br />01906<br />01907<br />01908<br />01909<br />01910<br />01911<br />01912<br />01913<br />01914<br />01915<br />01916<br />01917<br />01918<br />01919<br />01920<br />
01921<br />01922<br />01923<br />01924<br />01925<br />01926<br />01927<br />01928<br />01929<br />01930<br />01931<br />01932<br />01933<br />01934<br />01935<br />01936<br />01937<br />01938<br />01939<br />01940<br />
01941<br />01942<br />01943<br />01944<br />01945<br />01946<br />01947<br />01948<br />01949<br />01950<br />01951<br />01952<br />01953<br />01954<br />01955<br />01956<br />01957<br />01958<br />01959<br />01960<br />
01961<br />01962<br />01963<br />01964<br />01965<br />01966<br />01967<br />01968<br />01969<br />01970<br />01971<br />01972<br />01973<br />01974<br />01975<br />01976<br />01977<br />01978<br />01979<br />01980<br />
01981<br />01982<br />01983<br />01984<br />01985<br />01986<br />01987<br />01988<br />01989<br />01990<br />01991<br />01992<br />01993<br />01994<br />01995<br />01996<br />01997<br />01998<br />01999<br />02000<br />
02001<br />02002<br />02003<br />02004<br />02005<br />02006<br />02007<br />02008<br />02009<br />02010<br />02011<br />02012<br />02013<br />02014<br />02015<br />02016<br />02017<br />02018<br />02019<br />02020<br />
02021<br />02022<br />02023<br />02024<br />02025<br />02026<br />02027<br />02028<br />02029<br />02030<br />02031<br />02032<br />02033<br />02034<br />02035<br />02036<br />02037<br />02038<br />02039<br />02040<br />
02041<br />02042<br />02043<br />02044<br />02045<br />02046<br />02047<br />02048<br />02049<br />02050<br />02051<br />02052<br />02053<br />02054<br />02055<br />02056<br />02057<br />02058<br />02059<br />02060<br />
02061<br />02062<br />02063<br />02064<br />02065<br />02066<br />02067<br />02068<br />02069<br />02070<br />02071<br />02072<br />02073<br />02074<br />02075<br />02076<br />02077<br />02078<br />02079<br />02080<br />
02081<br />02082<br />02083<br />02084<br />02085<br />02086<br />02087<br />02088<br />02089<br />02090<br />02091<br />02092<br />02093<br />02094<br />02095<br />02096<br />02097<br />02098<br />02099<br />02100<br />
02101<br />02102<br />02103<br />02104<br />02105<br />02106<br />02107<br />02108<br />02109<br />02110<br />02111<br />02112<br />02113<br />02114<br />02115<br />02116<br />02117<br />02118<br />02119<br />02120<br />
02121<br />02122<br />02123<br />02124<br />02125<br />02126<br />02127<br />02128<br />02129<br />02130<br />02131<br />02132<br />02133<br />02134<br />02135<br />02136<br />02137<br />02138<br />02139<br />02140<br />
02141<br />02142<br />02143<br />02144<br />02145<br />02146<br />02147<br />02148<br />02149<br />02150<br />02151<br />02152<br />02153<br />02154<br />02155<br />02156<br />02157<br />02158<br />02159<br />02160<br />
02161<br />02162<br />02163<br />02164<br />02165<br />02166<br />02167<br />02168<br />02169<br />02170<br />02171<br />02172<br />02173<br />02174<br />02175<br />02176<br />02177<br />02178<br />02179<br />02180<br />
02181<br />02182<br />02183<br />02184<br />02185<br />02186<br />02187<br />02188<br />02189<br />02190<br />02191<br />02192<br />02193<br />02194<br />02195<br />02196<br />02197<br />02198<br />02199<br />02200<br />
02201<br />02202<br />02203<br />02204<br />02205<br />02206<br />02207<br />02208<br />02209<br />02210<br />02211<br />02212<br />02213<br />02214<br />02215<br />02216<br />02217<br />02218<br />02219<br />02220<br />
02221<br />02222<br />02223<br />02224<br />02225<br />02226<br />02227<br />02228<br />02229<br />02230<br />02231<br />02232<br />02233<br />02234<br />02235<br />02236<br />02237<br />02238<br />02239<br />02240<br />
02241<br />02242<br />02243<br />02244<br />02245<br />02246<br />02247<br />02248<br />02249<br />02250<br />02251<br />02252<br />02253<br />02254<br />02255<br />02256<br />02257<br />02258<br />02259<br />02260<br />
02261<br />02262<br />02263<br />02264<br />02265<br />02266<br />02267<br />02268<br />02269<br />02270<br />02271<br />02272<br />02273<br />02274<br />02275<br />02276<br />02277<br />02278<br />02279<br />02280<br />
02281<br />02282<br />02283<br />02284<br />02285<br />02286<br />02287<br />02288<br />02289<br />02290<br />02291<br />02292<br />02293<br />02294<br />02295<br />02296<br />02297<br />02298<br />02299<br />02300<br />
02301<br />02302<br />02303<br />02304<br />02305<br />02306<br />02307<br />02308<br />02309<br />02310<br />02311<br />02312<br />02313<br />02314<br />02315<br />02316<br />02317<br />02318<br />02319<br />02320<br />
02321<br />02322<br />02323<br />02324<br />02325<br />02326<br />02327<br />02328<br />02329<br />02330<br />02331<br />02332<br />02333<br />02334<br />02335<br />02336<br />02337<br />02338<br />02339<br />02340<br />
02341<br />02342<br />02343<br />02344<br />02345<br />02346<br />02347<br />02348<br />02349<br />02350<br />02351<br />02352<br />02353<br />02354<br />02355<br />02356<br />02357<br />02358<br />02359<br />02360<br />
02361<br />02362<br />02363<br />02364<br />02365<br />02366<br />02367<br />02368<br />02369<br />02370<br />02371<br />02372<br />02373<br />02374<br />02375<br />02376<br />02377<br />02378<br />02379<br />02380<br />
02381<br />02382<br />02383<br />02384<br />02385<br />02386<br />02387<br />02388<br />02389<br />02390<br />02391<br />02392<br />02393<br />02394<br />02395<br />02396<br />02397<br />02398<br />02399<br />02400<br />
02401<br />02402<br />02403<br />02404<br />02405<br />02406<br />02407<br />02408<br />02409<br />02410<br />02411<br />02412<br />02413<br />02414<br />02415<br />02416<br />02417<br />02418<br />02419<br />02420<br />
02421<br />02422<br />02423<br />02424<br />02425<br />02426<br />02427<br />02428<br />02429<br />02430<br />02431<br />02432<br />02433<br />02434<br />02435<br />02436<br />02437<br />02438<br />02439<br />02440<br />
02441<br />02442<br />02443<br />02444<br />02445<br />02446<br />02447<br />02448<br />02449<br />02450<br />02451<br />02452<br />02453<br />02454<br />02455<br />02456<br />02457<br />02458<br />02459<br />02460<br />
02461<br />02462<br />02463<br />02464<br />02465<br />02466<br />02467<br />02468<br />02469<br />02470<br />02471<br />02472<br />02473<br />02474<br />02475<br />02476<br />02477<br />02478<br />02479<br />02480<br />
02481<br />02482<br />02483<br />02484<br />02485<br />02486<br />02487<br />02488<br />02489<br />02490<br />02491<br />02492<br />02493<br />02494<br />02495<br />02496<br />02497<br />02498<br />02499<br />02500<br />
02501<br />02502<br />02503<br />02504<br />02505<br />02506<br />02507<br />02508<br />02509<br />02510<br />02511<br />02512<br />02513<br />02514<br />02515<br />02516<br />02517<br />02518<br />02519<br />02520<br />
02521<br />02522<br />02523<br />02524<br />02525<br />02526<br />02527<br />02528<br />02529<br />02530<br />02531<br />02532<br />02533<br />02534<br />02535<br />02536<br />02537<br />02538<br />02539<br />02540<br />
02541<br />02542<br />02543<br />02544<br />02545<br />02546<br />02547<br />02548<br />02549<br />02550<br />02551<br />02552<br />02553<br />02554<br />02555<br />02556<br />02557<br />02558<br />02559<br />02560<br />
02561<br />02562<br />02563<br />02564<br />02565<br />02566<br />02567<br />02568<br />02569<br />02570<br />02571<br />02572<br />02573<br />02574<br />02575<br />02576<br />02577<br />02578<br />02579<br />02580<br />
02581<br />02582<br />02583<br />02584<br />02585<br />02586<br />02587<br />02588<br />02589<br />02590<br />02591<br />02592<br />02593<br />02594<br />02595<br />02596<br />02597<br />02598<br />02599<br />02600<br />
02601<br />02602<br />02603<br />02604<br />02605<br />02606<br />02607<br />02608<br />02609<br />02610<br />02611<br />02612<br />02613<br />02614<br />02615<br />02616<br />02617<br />02618<br />02619<br />02620<br />
02621<br />02622<br />02623<br />02624<br />02625<br />02626<br />02627<br />02628<br />02629<br />02630<br />02631<br />02632<br />02633<br />02634<br />02635<br />02636<br />02637<br />02638<br />02639<br />02640<br />
02641<br />02642<br />02643<br />02644<br />02645<br />02646<br />02647<br />02648<br />02649<br />02650<br />02651<br />02652<br />02653<br />02654<br />02655<br />02656<br />02657<br />02658<br />02659<br />02660<br />
02661<br />02662<br />02663<br />02664<br />02665<br />02666<br />02667<br />02668<br />02669<br />02670<br />02671<br />02672<br />02673<br />02674<br />02675<br />02676<br />02677<br />02678<br />02679<br />02680<br />
02681<br />02682<br />02683<br />02684<br />02685<br />02686<br />02687<br />02688<br />02689<br />02690<br />02691<br />02692<br />02693<br />02694<br />02695<br />02696<br />02697<br />02698<br />02699<br />02700<br />
02701<br />02702<br />02703<br />02704<br />02705<br />02706<br />02707<br />02708<br />02709<br />02710<br />02711<br />02712<br />02713<br />02714<br />02715<br />02716<br />02717<br />02718<br />02719<br />02720<br />
02721<br />02722<br />02723<br />02724<br />02725<br />02726<br />02727<br />02728<br />02729<br />02730<br />02731<br />02732<br />02733<br />02734<br />02735<br />02736<br />02737<br />02738<br />02739<br />02740<br />
02741<br />02742<br />02743<br />02744<br />02745<br />02746<br />02747<br />02748<br />02749<br />02750<br />02751<br />02752<br />02753<br />02754<br />02755<br />02756<br />02757<br />02758<br />02759<br />02760<br />
02761<br />02762<br />02763<br />02764<br />02765<br />02766<br />02767<br />02768<br />02769<br />02770<br />02771<br />02772<br />02773<br />02774<br />02775<br />02776<br />02777<br />02778<br />02779<br />02780<br />
02781<br />02782<br />02783<br />02784<br />02785<br />02786<br />02787<br />02788<br />02789<br />02790<br />02791<br />02792<br />02793<br />02794<br />02795<br />02796<br />02797<br />02798<br />02799<br />02800<br />
02801<br />02802<br />02803<br />02804<br />02805<br />02806<br />02807<br />02808<br />02809<br />02810<br />02811<br />02812<br />02813<br />02814<br />02815<br />02816<br />02817<br />02818<br />02819<br />02820<br />
02821<br />02822<br />02823<br />02824<br />02825<br />02826<br />02827<br />02828<br />02829<br />02830<br />02831<br />02832<br />02833<br />02834<br />02835<br />02836<br />02837<br />02838<br />02839<br />02840<br />
02841<br />02842<br />02843<br />02844<br />02845<br />02846<br />02847<br />02848<br />02849<br />02850<br />02851<br />02852<br />02853<br />02854<br />02855<br />02856<br />02857<br />02858<br />02859<br />02860<br />
02861<br />02862<br />02863<br />02864<br />02865<br />02866<br />02867<br />02868<br />02869<br />02870<br />02871<br />02872<br />02873<br />02874<br />02875<br />02876<br />02877<br />02878<br />02879<br />02880<br />
02881<br />02882<br />02883<br />02884<br />02885<br />02886<br />02887<br />02888<br />02889<br />02890<br />02891<br />02892<br />02893<br />02894<br />02895<br />02896<br />02897<br />02898<br />02899<br />02900<br />
02901<br />02902<br />02903<br />02904<br />02905<br />02906<br />02907<br />02908<br />02909<br />02910<br />02911<br />02912<br />02913<br />02914<br />02915<br />02916<br />02917<br />02918<br />02919<br />02920<br />
02921<br />02922<br />02923<br />02924<br />02925<br />02926<br />02927<br />02928<br />02929<br />02930<br />02931<br />02932<br />02933<br />02934<br />02935<br />02936<br />02937<br />02938<br />02939<br />02940<br />
02941<br />02942<br />02943<br />02944<br />02945<br />02946<br />02947<br />02948<br />02949<br />02950<br />02951<br />02952<br />02953<br />02954<br />02955<br />02956<br />02957<br />02958<br />02959<br />02960<br />
02961<br />02962<br />02963<br />02964<br />02965<br />02966<br />02967<br />02968<br />02969<br />02970<br />02971<br />02972<br />02973<br />02974<br />02975<br />02976<br />02977<br />02978<br />02979<br />02980<br />
02981<br />02982<br />02983<br />02984<br />02985<br />02986<br />02987<br />02988<br />02989<br />02990<br />02991<br />02992<br />02993<br />02994<br />02995<br />02996<br />02997<br />02998<br />02999<br />03000<br />
03001<br />03002<br />03003<br />03004<br />03005<br />03006<br />03007<br />03008<br />03009<br />03010<br />03011<br />03012<br />03013<br />03014<br />03015<br />03016<br />03017<br />03018<br />03019<br />03020<br />
03021<br />03022<br />03023<br />03024<br />03025<br />03026<br />03027<br />03028<br />03029<br />03030<br />03031<br />03032<br />03033<br />03034<br />03035<br />03036<br />03037<br />03038<br />03039<br />03040<br />
03041<br />03042<br />03043<br />03044<br />03045<br />03046<br />03047<br />03048<br />03049<br />03050<br />03051<br />03052<br />03053<br />03054<br />03055<br />03056<br />03057<br />03058<br />03059<br />03060<br />
03061<br />03062<br />03063<br />03064<br />03065<br />03066<br />03067<br />03068<br />03069<br />03070<br />03071<br />03072<br />03073<br />03074<br />03075<br />03076<br />03077<br />03078<br />03079<br />03080<br />
03081<br />03082<br />03083<br />03084<br />03085<br />03086<br />03087<br />03088<br />03089<br />03090<br />03091<br />03092<br />03093<br />03094<br />03095<br />03096<br />03097<br />03098<br />03099<br />03100<br />
03101<br />03102<br />03103<br />03104<br />03105<br />03106<br />03107<br />03108<br />03109<br />03110<br />03111<br />03112<br />03113<br />03114<br />03115<br />03116<br />03117<br />03118<br />03119<br />03120<br />
03121<br />03122<br />03123<br />03124<br />03125<br />03126<br />03127<br />03128<br />03129<br />03130<br />03131<br />03132<br />03133<br />03134<br />03135<br />03136<br />03137<br />03138<br />03139<br />03140<br />
03141<br />03142<br />03143<br />03144<br />03145<br />03146<br />03147<br />03148<br />03149<br />03150<br />03151<br />03152<br />03153<br />03154<br />03155<br />03156<br />03157<br />03158<br />03159<br />03160<br />
03161<br />03162<br />03163<br />03164<br />03165<br />03166<br />03167<br />03168<br />03169<br />03170<br />03171<br />03172<br />03173<br />03174<br />03175<br />03176<br />03177<br />03178<br />03179<br />03180<br />
03181<br />03182<br />03183<br />03184<br />03185<br />03186<br />03187<br />03188<br />03189<br />03190<br />03191<br />03192<br />03193<br />03194<br />03195<br />03196<br />03197<br />03198<br />03199<br />03200<br />
03201<br />03202<br />03203<br />03204<br />03205<br />03206<br />03207<br />03208<br />03209<br />03210<br />03211<br />03212<br />03213<br />03214<br />03215<br />03216<br />03217<br />03218<br />03219<br />03220<br />
03221<br />03222<br />03223<br />03224<br />03225<br />03226<br />03227<br />03228<br />03229<br />03230<br />03231<br />03232<br />03233<br />03234<br />03235<br />03236<br />03237<br />03238<br />03239<br />03240<br />
03241<br />03242<br />03243<br />03244<br />03245<br />03246<br />03247<br />03248<br />03249<br />03250<br />03251<br />03252<br />03253<br />03254<br />03255<br />03256<br />03257<br />03258<br />03259<br />03260<br />
03261<br />03262<br />03263<br />03264<br />03265<br />03266<br />03267<br />03268<br />03269<br />03270<br />03271<br />03272<br />03273<br />03274<br />03275<br />03276<br />03277<br />03278<br />03279<br />03280<br />
03281<br />03282<br />03283<br />03284<br />03285<br />03286<br />03287<br />03288<br />03289<br />03290<br />03291<br />03292<br />03293<br />03294<br />03295<br />03296<br />03297<br />03298<br />03299<br />03300<br />
03301<br />03302<br />03303<br />03304<br />03305<br />03306<br />03307<br />03308<br />03309<br />03310<br />03311<br />03312<br />03313<br />03314<br />03315<br />03316<br />03317<br />03318<br />03319<br />03320<br />
03321<br />03322<br />03323<br />03324<br />03325<br />03326<br />03327<br />03328<br />03329<br />03330<br />03331<br />03332<br />03333<br />03334<br />03335<br />03336<br />03337<br />03338<br />03339<br />03340<br />
03341<br />03342<br />03343<br />03344<br />03345<br />03346<br />03347<br />03348<br />03349<br />03350<br />03351<br />03352<br />03353<br />03354<br />03355<br />03356<br />03357<br />03358<br />03359<br />03360<br />
03361<br />03362<br />03363<br />03364<br />03365<br />03366<br />03367<br />03368<br />03369<br />03370<br />03371<br />03372<br />03373<br />03374<br />03375<br />03376<br />03377<br />03378<br />03379<br />03380<br />
03381<br />03382<br />03383<br />03384<br />03385<br />03386<br />03387<br />03388<br />03389<br />03390<br />03391<br />03392<br />03393<br />03394<br />03395<br />03396<br />03397<br />03398<br />03399<br />03400<br />
03401<br />03402<br />03403<br />03404<br />03405<br />03406<br />03407<br />03408<br />03409<br />03410<br />03411<br />03412<br />03413<br />03414<br />03415<br />03416<br />03417<br />03418<br />03419<br />03420<br />
03421<br />03422<br />03423<br />03424<br />03425<br />03426<br />03427<br />03428<br />03429<br />03430<br />03431<br />03432<br />03433<br />03434<br />03435<br />03436<br />03437<br />03438<br />03439<br />03440<br />
03441<br />03442<br />03443<br />03444<br />03445<br />03446<br />03447<br />03448<br />03449<br />03450<br />03451<br />03452<br />03453<br />03454<br />03455<br />03456<br />03457<br />03458<br />03459<br />03460<br />
03461<br />03462<br />03463<br />03464<br />03465<br />03466<br />03467<br />03468<br />03469<br />03470<br />03471<br />03472<br />03473<br />03474<br />03475<br />03476<br />03477<br />03478<br />03479<br />03480<br />
03481<br />03482<br />03483<br />03484<br />03485<br />03486<br />03487<br />03488<br />03489<br />03490<br />03491<br />03492<br />03493<br />03494<br />03495<br />03496<br />03497<br />03498<br />03499<br />03500<br />
03501<br />03502<br />03503<br />03504<br />03505<br />03506<br />03507<br />03508<br />03509<br />03510<br />03511<br />03512<br />03513<br />03514<br />03515<br />03516<br />03517<br />03518<br />03519<br />03520<br />
03521<br />03522<br />03523<br />03524<br />03525<br />03526<br />03527<br />03528<br />03529<br />03530<br />03531<br />03532<br />03533<br />03534<br />03535<br />03536<br />03537<br />03538<br />03539<br />03540<br />
03541<br />03542<br />03543<br />03544<br />03545<br />03546<br />03547<br />03548<br />03549<br />03550<br />03551<br />03552<br />03553<br />03554<br />03555<br />03556<br />03557<br />03558<br />03559<br />03560<br />
03561<br />03562<br />03563<br />03564<br />03565<br />03566<br />03567<br />03568<br />03569<br />03570<br />03571<br />03572<br />03573<br />03574<br />03575<br />03576<br />03577<br />03578<br />03579<br />03580<br />
03581<br />03582<br />03583<br />03584<br />03585<br />03586<br />03587<br />03588<br />03589<br />03590<br />03591<br />03592<br />03593<br />03594<br />03595<br />03596<br />03597<br />03598<br />03599<br />03600<br />
03601<br />03602<br />03603<br />03604<br />03605<br />03606<br />03607<br />03608<br />03609<br />03610<br />03611<br />03612<br />03613<br />03614<br />03615<br />03616<br />03617<br />03618<br />03619<br />03620<br />
03621<br />03622<br />03623<br />03624<br />03625<br />03626<br />03627<br />03628<br />03629<br />03630<br />03631<br />03632<br />03633<br />03634<br />03635<br />03636<br />03637<br />03638<br />03639<br />03640<br />
03641<br />03642<br />03643<br />03644<br />03645<br />03646<br />03647<br />03648<br />03649<br />03650<br />03651<br />03652<br />03653<br />03654<br />03655<br />03656<br />03657<br />03658<br />03659<br />03660<br />
03661<br />03662<br />03663<br />03664<br />03665<br />03666<br />03667<br />03668<br />03669<br />03670<br />03671<br />03672<br />03673<br />03674<br />03675<br />03676<br />03677<br />03678<br />03679<br />03680<br />
03681<br />03682<br />03683<br />03684<br />03685<br />03686<br />03687<br />03688<br />03689<br />03690<br />03691<br />03692<br />03693<br />03694<br />03695<br />03696<br />03697<br />03698<br />03699<br />03700<br />
03701<br />03702<br />03703<br />03704<br />03705<br />03706<br />03707<br />03708<br />03709<br />03710<br />03711<br />03712<br />03713<br />03714<br />03715<br />03716<br />03717<br />03718<br />03719<br />03720<br />
03721<br />03722<br />03723<br />03724<br />03725<br />03726<br />03727<br />03728<br />03729<br />03730<br />03731<br />03732<br />03733<br />03734<br />03735<br />03736<br />03737<br />03738<br />03739<br />03740<br />
03741<br />03742<br />03743<br />03744<br />03745<br />03746<br />03747<br />03748<br />03749<br />03750<br />03751<br />03752<br />03753<br />03754<br />03755<br />03756<br />03757<br />03758<br />03759<br />03760<br />
03761<br />03762<br />03763<br />03764<br />03765<br />03766<br />03767<br />03768<br />03769<br />03770<br />03771<br />03772<br />03773<br />03774<br />03775<br />03776<br />03777<br />03778<br />03779<br />03780<br />
03781<br />03782<br />03783<br />03784<br />03785<br />03786<br />03787<br />03788<br />03789<br />03790<br />03791<br />03792<br />03793<br />03794<br />03795<br />03796<br />03797<br />03798<br />03799<br />03800<br />
03801<br />03802<br />03803<br />03804<br />03805<br />03806<br />03807<br />03808<br />03809<br />03810<br />03811<br />03812<br />03813<br />03814<br />03815<br />03816<br />03817<br />03818<br />03819<br />03820<br />
03821<br />03822<br />03823<br />03824<br />03825<br />03826<br />03827<br />03828<br />03829<br />03830<br />03831<br />03832<br />03833<br />03834<br />03835<br />03836<br />03837<br />03838<br />03839<br />03840<br />
03841<br />03842<br />03843<br />03844<br />03845<br />03846<br />03847<br />03848<br />03849<br />03850<br />03851<br />03852<br />03853<br />03854<br />03855<br />03856<br />03857<br />03858<br />03859<br />03860<br />
03861<br />03862<br />03863<br />03864<br />03865<br />03866<br />03867<br />03868<br />03869<br />03870<br />03871<br />03872<br />03873<br />03874<br />03875<br />03876<br />03877<br />03878<br />03879<br />03880<br />
03881<br />03882<br />03883<br />03884<br />03885<br />03886<br />03887<br />03888<br />03889<br />03890<br />03891<br />03892<br />03893<br />03894<br />03895<br />03896<br />03897<br />03898<br />03899<br />03900<br />
03901<br />03902<br />03903<br />03904<br />03905<br />03906<br />03907<br />03908<br />03909<br />03910<br />03911<br />03912<br />03913<br />03914<br />03915<br />03916<br />03917<br />03918<br />03919<br />03920<br />
03921<br />03922<br />03923<br />03924<br />03925<br />03926<br />03927<br />03928<br />03929<br />03930<br />03931<br />03932<br />03933<br />03934<br />03935<br />03936<br />03937<br />03938<br />03939<br />03940<br />
03941<br />03942<br />03943<br />03944<br />03945<br />03946<br />03947<br />03948<br />03949<br />03950<br />03951<br />03952<br />03953<br />03954<br />03955<br />03956<br />03957<br />03958<br />03959<br />03960<br />
03961<br />03962<br />03963<br />03964<br />03965<br />03966<br />03967<br />03968<br />03969<br />03970<br />03971<br />03972<br />03973<br />03974<br />03975<br />03976<br />03977<br />03978<br />03979<br />03980<br />
03981<br />03982<br />03983<br />03984<br />03985<br />03986<br />03987<br />03988<br />03989<br />03990<br />03991<br />03992<br />03993<br />03994<br />03995<br />03996<br />03997<br />03998<br />03999<br />04000<br />
04001<br />04002<br />04003<br />04004<br />04005<br />04006<br />04007<br />04008<br />04009<br />04010<br />04011<br />04012<br />04013<br />04014<br />04015<br />04016<br />04017<br />04018<br />04019<br />04020<br />
04021<br />04022<br />04023<br />04024<br />04025<br />04026<br />04027<br />04028<br />04029<br />04030<br />04031<br />04032<br />04033<br />04034<br />04035<br />04036<br />04037<br />04038<br />04039<br />04040<br />
04041<br />04042<br />04043<br />04044<br />04045<br />04046<br />04047<br />04048<br />04049<br />04050<br />04051<br />04052<br />04053<br />04054<br />04055<br />04056<br />04057<br />04058<br />04059<br />04060<br />
04061<br />04062<br />04063<br />04064<br />04065<br />04066<br />04067<br />04068<br />04069<br />04070<br />04071<br />04072<br />04073<br />04074<br />04075<br />04076<br />04077<br />04078<br />04079<br />04080<br />
04081<br />04082<br />04083<br />04084<br />04085<br />04086<br />04087<br />04088<br />04089<br />04090<br />04091<br />04092<br />04093<br />04094<br />04095<br />04096<br />04097<br />04098<br />04099<br />04100<br />
04101<br />04102<br />04103<br />04104<br />04105<br />04106<br />04107<br />04108<br />04109<br />04110<br />04111<br />04112<br />04113<br />04114<br />04115<br />04116<br />04117<br />04118<br />04119<br />04120<br />
04121<br />04122<br />04123<br />04124<br />04125<br />04126<br />04127<br />04128<br />04129<br />04130<br />04131<br />04132<br />04133<br />04134<br />04135<br />04136<br />04137<br />04138<br />04139<br />04140<br />
04141<br />04142<br />04143<br />04144<br />04145<br />04146<br />04147<br />04148<br />04149<br />04150<br />04151<br />04152<br />04153<br />04154<br />04155<br />04156<br />04157<br />04158<br />04159<br />04160<br />
04161<br />04162<br />04163<br />04164<br />04165<br />04166<br />04167<br />04168<br />04169<br />04170<br />04171<br />04172<br />04173<br />04174<br />04175<br />04176<br />04177<br />04178<br />04179<br />04180<br />
04181<br />04182<br />04183<br />04184<br />04185<br />04186<br />04187<br />04188<br />04189<br />04190<br />04191<br />04192<br />04193<br />04194<br />04195<br />04196<br />04197<br />04198<br />04199<br />04200<br />
04201<br />04202<br />04203<br />04204<br />04205<br />04206<br />04207<br />04208<br />04209<br />04210<br />04211<br />04212<br />04213<br />04214<br />04215<br />04216<br />04217<br />04218<br />04219<br />04220<br />
04221<br />04222<br />04223<br />04224<br />04225<br />04226<br />04227<br />04228<br />04229<br />04230<br />04231<br />04232<br />04233<br />04234<br />04235<br />04236<br />04237<br />04238<br />04239<br />04240<br />
04241<br />04242<br />04243<br />04244<br />04245<br />04246<br />04247<br />04248<br />04249<br />04250<br />04251<br />04252<br />04253<br />04254<br />04255<br />04256<br />04257<br />04258<br />04259<br />04260<br />
04261<br />04262<br />04263<br />04264<br />04265<br />04266<br />04267<br />04268<br />04269<br />04270<br />04271<br />04272<br />04273<br />04274<br />04275<br />04276<br />04277<br />04278<br />04279<br />04280<br />
04281<br />04282<br />04283<br />04284<br />04285<br />04286<br />04287<br />04288<br />04289<br />04290<br />04291<br />04292<br />04293<br />04294<br />04295<br />04296<br />04297<br />04298<br />04299<br />04300<br />
04301<br />04302<br />04303<br />04304<br />04305<br />04306<br />04307<br />04308<br />04309<br />04310<br />04311<br />04312<br />04313<br />04314<br />04315<br />04316<br />04317<br />04318<br />04319<br />04320<br />
04321<br />04322<br />04323<br />04324<br />04325<br />04326<br />04327<br />04328<br />04329<br />04330<br />04331<br />04332<br />04333<br />04334<br />04335<br />04336<br />04337<br />04338<br />04339<br />04340<br />
04341<br />04342<br />04343<br />04344<br />04345<br />04346<br />04347<br />04348<br />04349<br />04350<br />04351<br />04352<br />04353<br />04354<br />04355<br />04356<br />04357<br />04358<br />04359<br />04360<br />
04361<br />04362<br />04363<br />04364<br />04365<br />04366<br />04367<br />04368<br />04369<br />04370<br />04371<br />04372<br />04373<br />04374<br />04375<br />04376<br />04377<br />04378<br />04379<br />04380<br />
04381<br />04382<br />04383<br />04384<br />04385<br />04386<br />04387<br />04388<br />04389<br />04390<br />04391<br />04392<br />04393<br />04394<br />04395<br />04396<br />04397<br />04398<br />04399<br />04400<br />
04401<br />04402<br />04403<br />04404<br />04405<br />04406<br />04407<br />04408<br />04409<br />04410<br />04411<br />04412<br />04413<br />04414<br />04415<br />04416<br />04417<br />04418<br />04419<br />04420<br />
04421<br />04422<br />04423<br />04424<br />04425<br />04426<br />04427<br />04428<br />04429<br />04430<br />04431<br />04432<br />04433<br />04434<br />04435<br />04436<br />04437<br />04438<br />04439<br />04440<br />
04441<br />04442<br />04443<br />04444<br />04445<br />04446<br />04447<br />04448<br />04449<br />04450<br />04451<br />04452<br />04453<br />04454<br />04455<br />04456<br />04457<br />04458<br />04459<br />04460<br />
04461<br />04462<br />04463<br />04464<br />04465<br />04466<br />04467<br />04468<br />04469<br />04470<br />04471<br />04472<br />04473<br />04474<br />04475<br />04476<br />04477<br />04478<br />04479<br />04480<br />
04481<br />04482<br />04483<br />04484<br />04485<br />04486<br />04487<br />04488<br />04489<br />04490<br />04491<br />04492<br />04493<br />04494<br />04495<br />04496<br />04497<br />04498<br />04499<br />04500<br />
04501<br />04502<br />04503<br />04504<br />04505<br />04506<br />04507<br />04508<br />04509<br />04510<br />04511<br />04512<br />04513<br />04514<br />04515<br />04516<br />04517<br />04518<br />04519<br />04520<br />
04521<br />04522<br />04523<br />04524<br />04525<br />04526<br />04527<br />04528<br />04529<br />04530<br />04531<br />04532<br />04533<br />04534<br />04535<br />04536<br />04537<br />04538<br />04539<br />04540<br />
04541<br />04542<br />04543<br />04544<br />04545<br />04546<br />04547<br />04548<br />04549<br />04550<br />04551<br />04552<br />04553<br />04554<br />04555<br />04556<br />04557<br />04558<br />04559<br />04560<br />
04561<br />04562<br />04563<br />04564<br />04565<br />04566<br />04567<br />04568<br />04569<br />04570<br />04571<br />04572<br />04573<br />04574<br />04575<br />04576<br />04577<br />04578<br />04579<br />04580<br />
04581<br />04582<br />04583<br />04584<br />04585<br />04586<br />04587<br />04588<br />04589<br />04590<br />04591<br />04592<br />04593<br />04594<br />04595<br />04596<br />04597<br />04598<br />04599<br />04600<br />
04601<br />04602<br />04603<br />04604<br />04605<br />04606<br />04607<br />04608<br />04609<br />04610<br />04611<br />04612<br />04613<br />04614<br />04615<br />04616<br />04617<br />04618<br />04619<br />04620<br />
04621<br />04622<br />04623<br />04624<br />04625<br />04626<br />04627<br />04628<br />04629<br />04630<br />04631<br />04632<br />04633<br />04634<br />04635<br />04636<br />04637<br />04638<br />04639<br />04640<br />
04641<br />04642<br />04643<br />04644<br />04645<br />04646<br />04647<br />04648<br />04649<br />04650<br />04651<br />04652<br />04653<br />04654<br />04655<br />04656<br />04657<br />04658<br />04659<br />04660<br />
04661<br />04662<br />04663<br />04664<br />04665<br />04666<br />04667<br />04668<br />04669<br />04670<br />04671<br />04672<br />04673<br />04674<br />04675<br />04676<br />04677<br />04678<br />04679<br />04680<br />
04681<br />04682<br />04683<br />04684<br />04685<br />04686<br />04687<br />04688<br />04689<br />04690<br />04691<br />04692<br />04693<br />04694<br />04695<br />04696<br />04697<br />04698<br />04699<br />04700<br />
04701<br />04702<br />04703<br />04704<br />04705<br />04706<br />04707<br />04708<br />04709<br />04710<br />04711<br />04712<br />04713<br />04714<br />04715<br />04716<br />04717<br />04718<br />04719<br />04720<br />
04721<br />04722<br />04723<br />04724<br />04725<br />04726<br />04727<br />04728<br />04729<br />04730<br />04731<br />04732<br />04733<br />04734<br />04735<br />04736<br />04737<br />04738<br />04739<br />04740<br />
04741<br />04742<br />04743<br />04744<br />04745<br />04746<br />04747<br />04748<br />04749<br />04750<br />04751<br />04752<br />04753<br />04754<br />04755<br />04756<br />04757<br />04758<br />04759<br />04760<br />
04761<br />04762<br />04763<br />04764<br />04765<br />04766<br />04767<br />04768<br />04769<br />04770<br />04771<br />04772<br />04773<br />04774<br />04775<br />04776<br />04777<br />04778<br />04779<br />04780<br />
04781<br />04782<br />04783<br />04784<br />04785<br />04786<br />04787<br />04788<br />04789<br />04790<br />04791<br />04792<br />04793<br />04794<br />04795<br />04796<br />04797<br />04798<br />04799<br />04800<br />
04801<br />04802<br />04803<br />04804<br />04805<br />04806<br />04807<br />04808<br />04809<br />04810<br />04811<br />04812<br />04813<br />04814<br />04815<br />04816<br />04817<br />04818<br />04819<br />04820<br />
04821<br />04822<br />04823<br />04824<br />04825<br />04826<br />04827<br />04828<br />04829<br />04830<br />04831<br />04832<br />04833<br />04834<br />04835<br />04836<br />04837<br />04838<br />04839<br />04840<br />
04841<br />04842<br />04843<br />04844<br />04845<br />04846<br />04847<br />04848<br />04849<br />04850<br />04851<br />04852<br />04853<br />04854<br />04855<br />04856<br />04857<br />04858<br />04859<br />04860<br />
04861<br />04862<br />04863<br />04864<br />04865<br />04866<br />04867<br />04868<br />04869<br />04870<br />04871<br />04872<br />04873<br />04874<br />04875<br />04876<br />04877<br />04878<br />04879<br />04880<br />
04881<br />04882<br />04883<br />04884<br />04885<br />04886<br />04887<br />04888<br />04889<br />04890<br />04891<br />04892<br />04893<br />04894<br />04895<br />04896<br />04897<br />04898<br />04899<br />04900<br />
04901<br />04902<br />04903<br />04904<br />04905<br />04906<br />04907<br />04908<br />04909<br />04910<br />04911<br />04912<br />04913<br />04914<br />04915<br />04916<br />04917<br />04918<br />04919<br />04920<br />
04921<br />04922<br />04923<br />04924<br />04925<br />04926<br />04927<br />04928<br />04929<br />04930<br />04931<br />04932<br />04933<br />04934<br />04935<br />04936<br />04937<br />04938<br />04939<br />04940<br />
04941<br />04942<br />04943<br />04944<br />04945<br />04946<br />04947<br />04948<br />04949<br />04950<br />04951<br />04952<br />04953<br />04954<br />04955<br />04956<br />04957<br />04958<br />04959<br />04960<br />
04961<br />04962<br />04963<br />04964<br />04965<br />04966<br />04967<br />04968<br />04969<br />04970<br />04971<br />04972<br />04973<br />04974<br />04975<br />04976<br />04977<br />04978<br />04979<br />04980<br />
04981<br />04982<br />04983<br />04984<br />04985<br />04986<br />04987<br />04988<br />04989<br />04990<br />04991<br />04992<br />04993<br />04994<br />04995<br />04996<br />04997<br />04998<br />04999<br />05000<br />
05001<br />05002<br />05003<br />05004<br />05005<br />05006<br />05007<br />05008<br />05009<br />05010<br />05011<br />05012<br />05013<br />05014<br />05015<br />05016<br />05017<br />05018<br />05019<br />05020<br />
05021<br />05022<br />05023<br />05024<br />05025<br />05026<br />05027<br />05028<br />05029<br />05030<br />05031<br />05032<br />05033<br />05034<br />05035<br />05036<br />05037<br />05038<br />05039<br />05040<br />
05041<br />05042<br />05043<br />05044<br />05045<br />05046<br />05047<br />05048<br />05049<br />05050<br />05051<br />05052<br />05053<br />05054<br />05055<br />05056<br />05057<br />05058<br />05059<br />05060<br />
05061<br />05062<br />05063<br />05064<br />05065<br />05066<br />05067<br />05068<br />05069<br />05070<br />05071<br />05072<br />05073<br />05074<br />05075<br />05076<br />05077<br />05078<br />05079<br />05080<br />
05081<br />05082<br />05083<br />05084<br />05085<br />05086<br />05087<br />05088<br />05089<br />05090<br />05091<br />05092<br />05093<br />05094<br />05095<br />05096<br />05097<br />05098<br />05099<br />05100<br />
05101<br />05102<br />05103<br />05104<br />05105<br />05106<br />05107<br />05108<br />05109<br />05110<br />05111<br />05112<br />05113<br />05114<br />05115<br />05116<br />05117<br />05118<br />05119<br />05120<br />
05121<br />05122<br />05123<br />05124<br />05125<br />05126<br />05127<br />05128<br />05129<br />05130<br />05131<br />05132<br />05133<br />05134<br />05135<br />05136<br />05137<br />05138<br />05139<br />05140<br />
05141<br />05142<br />05143<br />05144<br />05145<br />05146<br />05147<br />05148<br />05149<br />05150<br />05151<br />05152<br />05153<br />05154<br />05155<br />05156<br />05157<br />05158<br />05159<br />05160<br />
05161<br />05162<br />05163<br />05164<br />05165<br />05166<br />05167<br />05168<br />05169<br />05170<br />05171<br />05172<br />05173<br />05174<br />05175<br />05176<br />05177<br />05178<br />05179<br />05180<br />
05181<br />05182<br />05183<br />05184<br />05185<br />05186<br />05187<br />05188<br />05189<br />05190<br />05191<br />05192<br />05193<br />05194<br />05195<br />05196<br />05197<br />05198<br />05199<br />05200<br />
05201<br />05202<br />05203<br />05204<br />05205<br />05206<br />05207<br />05208<br />05209<br />05210<br />05211<br />05212<br />05213<br />05214<br />05215<br />05216<br />05217<br />05218<br />05219<br />05220<br />
05221<br />05222<br />05223<br />05224<br />05225<br />05226<br />05227<br />05228<br />05229<br />05230<br />05231<br />05232<br />05233<br />05234<br />05235<br />05236<br />05237<br />05238<br />05239<br />05240<br />
05241<br />05242<br />05243<br />05244<br />05245<br />05246<br />05247<br />05248<br />05249<br />05250<br />05251<br />05252<br />05253<br />05254<br />05255<br />05256<br />05257<br />05258<br />05259<br />05260<br />
05261<br />05262<br />05263<br />05264<br />05265<br />05266<br />05267<br />05268<br />05269<br />05270<br />05271<br />05272<br />05273<br />05274<br />05275<br />05276<br />05277<br />05278<br />05279<br />05280<br />
05281<br />05282<br />05283<br />05284<br />05285<br />05286<br />05287<br />05288<br />05289<br />05290<br />05291<br />05292<br />05293<br />05294<br />05295<br />05296<br />05297<br />05298<br />05299<br />05300<br />
05301<br />05302<br />05303<br />05304<br />05305<br />05306<br />05307<br />05308<br />05309<br />05310<br />05311<br />05312<br />05313<br />05314<br />05315<br />05316<br />05317<br />05318<br />05319<br />05320<br />
05321<br />05322<br />05323<br />05324<br />05325<br />05326<br />05327<br />05328<br />05329<br />05330<br />05331<br />05332<br />05333<br />05334<br />05335<br />05336<br />05337<br />05338<br />05339<br />05340<br />
05341<br />05342<br />05343<br />05344<br />05345<br />05346<br />05347<br />05348<br />05349<br />05350<br />05351<br />05352<br />05353<br />05354<br />05355<br />05356<br />05357<br />05358<br />05359<br />05360<br />
05361<br />05362<br />05363<br />05364<br />05365<br />05366<br />05367<br />05368<br />05369<br />05370<br />05371<br />05372<br />05373<br />05374<br />05375<br />05376<br />05377<br />05378<br />05379<br />05380<br />
05381<br />05382<br />05383<br />05384<br />05385<br />05386<br />05387<br />05388<br />05389<br />05390<br />05391<br />05392<br />05393<br />05394<br />05395<br />05396<br />05397<br />05398<br />05399<br />05400<br />
05401<br />05402<br />05403<br />05404<br />05405<br />05406<br />05407<br />05408<br />05409<br />05410<br />05411<br />05412<br />05413<br />05414<br />05415<br />05416<br />05417<br />05418<br />05419<br />05420<br />
05421<br />05422<br />05423<br />05424<br />05425<br />05426<br />05427<br />05428<br />05429<br />05430<br />05431<br />05432<br />05433<br />05434<br />05435<br />05436<br />05437<br />05438<br />05439<br />05440<br />
05441<br />05442<br />05443<br />05444<br />05445<br />05446<br />05447<br />05448<br />05449<br />05450<br />05451<br />05452<br />05453<br />05454<br />05455<br />05456<br />05457<br />05458<br />05459<br />05460<br />
05461<br />05462<br />05463<br />05464<br />05465<br />05466<br />05467<br />05468<br />05469<br />05470<br />05471<br />05472<br />05473<br />05474<br />05475<br />05476<br />05477<br />05478<br />05479<br />05480<br />
05481<br />05482<br />05483<br />05484<br />05485<br />05486<br />05487<br />05488<br />05489<br />05490<br />05491<br />05492<br />05493<br />05494<br />05495<br />05496<br />05497<br />05498<br />05499<br />05500<br />
05501<br />05502<br />05503<br />05504<br />05505<br />05506<br />05507<br />05508<br />05509<br />05510<br />05511<br />05512<br />05513<br />05514<br />05515<br />05516<br />05517<br />05518<br />05519<br />05520<br />
05521<br />05522<br />05523<br />05524<br />05525<br />05526<br />05527<br />05528<br />05529<br />05530<br />05531<br />05532<br />05533<br />05534<br />05535<br />05536<br />05537<br />05538<br />05539<br />05540<br />
05541<br />05542<br />05543<br />05544<br />05545<br />05546<br />05547<br />05548<br />05549<br />05550<br />05551<br />05552<br />05553<br />05554<br />05555<br />05556<br />05557<br />05558<br />05559<br />05560<br />
05561<br />05562<br />05563<br />05564<br />05565<br />05566<br />05567<br />05568<br />05569<br />05570<br />05571<br />05572<br />05573<br />05574<br />05575<br />05576<br />05577<br />05578<br />05579<br />05580<br />
05581<br />05582<br />05583<br />05584<br />05585<br />05586<br />05587<br />05588<br />05589<br />05590<br />05591<br />05592<br />05593<br />05594<br />05595<br />05596<br />05597<br />05598<br />05599<br />05600<br />
05601<br />05602<br />05603<br />05604<br />05605<br />05606<br />05607<br />05608<br />05609<br />05610<br />05611<br />05612<br />05613<br />05614<br />05615<br />05616<br />05617<br />05618<br />05619<br />05620<br />
05621<br />05622<br />05623<br />05624<br />05625<br />05626<br />05627<br />05628<br />05629<br />05630<br />05631<br />05632<br />05633<br />05634<br />05635<br />05636<br />05637<br />05638<br />05639<br />05640<br />
05641<br />05642<br />05643<br />05644<br />05645<br />05646<br />05647<br />05648<br />05649<br />05650<br />05651<br />05652<br />05653<br />05654<br />05655<br />05656<br />05657<br />05658<br />05659<br />05660<br />
05661<br />05662<br />05663<br />05664<br />05665<br />05666<br />05667<br />05668<br />05669<br />05670<br />05671<br />05672<br />05673<br />05674<br />05675<br />05676<br />05677<br />05678<br />05679<br />05680<br />
05681<br />05682<br />05683<br />05684<br />05685<br />05686<br />05687<br />05688<br />05689<br />05690<br />05691<br />05692<br />05693<br />05694<br />05695<br />05696<br />05697<br />05698<br />05699<br />05700<br />
05701<br />05702<br />05703<br />05704<br />05705<br />05706<br />05707<br />05708<br />05709<br />05710<br />05711<br />05712<br />05713<br />05714<br />05715<br />05716<br />05717<br />05718<br />05719<br />05720<br />
05721<br />05722<br />05723<br />05724<br />05725<br />05726<br />05727<br />05728<br />05729<br />05730<br />05731<br />05732<br />05733<br />05734<br />05735<br />05736<br />05737<br />05738<br />05739<br />05740<br />
05741<br />05742<br />05743<br />05744<br />05745<br />05746<br />05747<br />05748<br />05749<br />05750<br />05751<br />05752<br />05753<br />05754<br />05755<br />05756<br />05757<br />05758<br />05759<br />05760<br />
05761<br />05762<br />05763<br />05764<br />05765<br />05766<br />05767<br />05768<br />05769<br />05770<br />05771<br />05772<br />05773<br />05774<br />05775<br />05776<br />05777<br />05778<br />05779<br />05780<br />
05781<br />05782<br />05783<br />05784<br />05785<br />05786<br />05787<br />05788<br />05789<br />05790<br />05791<br />05792<br />05793<br />05794<br />05795<br />05796<br />05797<br />05798<br />05799<br />05800<br />
05801<br />05802<br />05803<br />05804<br />05805<br />05806<br />05807<br />05808<br />05809<br />05810<br />05811<br />05812<br />05813<br />05814<br />05815<br />05816<br />05817<br />05818<br />05819<br />05820<br />
05821<br />05822<br />05823<br />05824<br />05825<br />05826<br />05827<br />05828<br />05829<br />05830<br />05831<br />05832<br />05833<br />05834<br />05835<br />05836<br />05837<br />05838<br />05839<br />05840<br />
05841<br />05842<br />05843<br />05844<br />05845<br />05846<br />05847<br />05848<br />05849<br />05850<br />05851<br />05852<br />05853<br />05854<br />05855<br />05856<br />05857<br />05858<br />05859<br />05860<br />
05861<br />05862<br />05863<br />05864<br />05865<br />05866<br />05867<br />05868<br />05869<br />05870<br />05871<br />05872<br />05873<br />05874<br />05875<br />05876<br />05877<br />05878<br />05879<br />05880<br />
05881<br />05882<br />05883<br />05884<br />05885<br />05886<br />05887<br />05888<br />05889<br />05890<br />05891<br />05892<br />05893<br />05894<br />05895<br />05896<br />05897<br />05898<br />05899<br />05900<br />
05901<br />05902<br />05903<br />05904<br />05905<br />05906<br />05907<br />05908<br />05909<br />05910<br />05911<br />05912<br />05913<br />05914<br />05915<br />05916<br />05917<br />05918<br />05919<br />05920<br />
05921<br />05922<br />05923<br />05924<br />05925<br />05926<br />05927<br />05928<br />05929<br />05930<br />05931<br />05932<br />05933<br />05934<br />05935<br />05936<br />05937<br />05938<br />05939<br />05940<br />
05941<br />05942<br />05943<br />05944<br />05945<br />05946<br />05947<br />05948<br />05949<br />05950<br />05951<br />05952<br />05953<br />05954<br />05955<br />05956<br />05957<br />05958<br />05959<br />05960<br />
05961<br />05962<br />05963<br />05964<br />05965<br />05966<br />05967<br />05968<br />05969<br />05970<br />05971<br />05972<br />05973<br />05974<br />05975<br />05976<br />05977<br />05978<br />05979<br />05980<br />
05981<br />05982<br />05983<br />05984<br />05985<br />05986<br />05987<br />05988<br />05989<br />05990<br />05991<br />05992<br />05993<br />05994<br />05995<br />05996<br />05997<br />05998<br />05999<br />06000<br />
06001<br />06002<br />06003<br />06004<br />06005<br />06006<br />06007<br />06008<br />06009<br />06010<br />06011<br />06012<br />06013<br />06014<br />06015<br />06016<br />06017<br />06018<br />06019<br />06020<br />
06021<br />06022<br />06023<br />06024<br />06025<br />06026<br />06027<br />06028<br />06029<br />06030<br />06031<br />06032<br />06033<br />06034<br />06035<br />06036<br />06037<br />06038<br />06039<br />06040<br />
06041<br />06042<br />06043<br />06044<br />06045<br />06046<br />06047<br />06048<br />06049<br />06050<br />06051<br />06052<br />06053<br />06054<br />06055<br />06056<br />06057<br />06058<br />06059<br />06060<br />
06061<br />06062<br />06063<br />06064<br />06065<br />06066<br />06067<br />06068<br />06069<br />06070<br />06071<br />06072<br />06073<br />06074<br />06075<br />06076<br />06077<br />06078<br />06079<br />06080<br />
06081<br />06082<br />06083<br />06084<br />06085<br />06086<br />06087<br />06088<br />06089<br />06090<br />06091<br />06092<br />06093<br />06094<br />06095<br />06096<br />06097<br />06098<br />06099<br />06100<br />
06101<br />06102<br />06103<br />06104<br />06105<br />06106<br />06107<br />06108<br />06109<br />06110<br />06111<br />06112<br />06113<br />06114<br />06115<br />06116<br />06117<br />06118<br />06119<br />06120<br />
06121<br />06122<br />06123<br />06124<br />06125<br />06126<br />06127<br />06128<br />06129<br />06130<br />06131<br />06132<br />06133<br />06134<br />06135<br />06136<br />06137<br />06138<br />06139<br />06140<br />
06141<br />06142<br />06143<br />06144<br />06145<br />06146<br />06147<br />06148<br />06149<br />06150<br />06151<br />06152<br />06153<br />06154<br />06155<br />06156<br />06157<br />06158<br />06159<br />06160<br />
06161<br />06162<br />06163<br />06164<br />06165<br />06166<br />06167<br />06168<br />06169<br />06170<br />06171<br />06172<br />06173<br />06174<br />06175<br />06176<br />06177<br />06178<br />06179<br />06180<br />
06181<br />06182<br />06183<br />06184<br />06185<br />06186<br />06187<br />06188<br />06189<br />06190<br />06191<br />06192<br />06193<br />06194<br />06195<br />06196<br />06197<br />06198<br />06199<br />06200<br />
06201<br />06202<br />06203<br />06204<br />06205<br />06206<br />06207<br />06208<br />06209<br />06210<br />06211<br />06212<br />06213<br />06214<br />06215<br />06216<br />06217<br />06218<br />06219<br />06220<br />
06221<br />06222<br />06223<br />06224<br />06225<br />06226<br />06227<br />06228<br />06229<br />06230<br />06231<br />06232<br />06233<br />06234<br />06235<br />06236<br />06237<br />06238<br />06239<br />06240<br />
06241<br />06242<br />06243<br />06244<br />06245<br />06246<br />06247<br />06248<br />06249<br />06250<br />06251<br />06252<br />06253<br />06254<br />06255<br />06256<br />06257<br />06258<br />06259<br />06260<br />
06261<br />06262<br />06263<br />06264<br />06265<br />06266<br />06267<br />06268<br />06269<br />06270<br />06271<br />06272<br />06273<br />06274<br />06275<br />06276<br />06277<br />06278<br />06279<br />06280<br />
06281<br />06282<br />06283<br />06284<br />06285<br />06286<br />06287<br />06288<br />06289<br />06290<br />06291<br />06292<br />06293<br />06294<br />06295<br />06296<br />06297<br />06298<br />06299<br />06300<br />
06301<br />06302<br />06303<br />06304<br />06305<br />06306<br />06307<br />06308<br />06309<br />06310<br />06311<br />06312<br />06313<br />06314<br />06315<br />06316<br />06317<br />06318<br />06319<br />06320<br />
06321<br />06322<br />06323<br />06324<br />06325<br />06326<br />06327<br />06328<br />06329<br />06330<br />06331<br />06332<br />06333<br />06334<br />06335<br />06336<br />06337<br />06338<br />06339<br />06340<br />
06341<br />06342<br />06343<br />06344<br />06345<br />06346<br />06347<br />06348<br />06349<br />06350<br />06351<br />06352<br />06353<br />06354<br />06355<br />06356<br />06357<br />06358<br />06359<br />06360<br />
06361<br />06362<br />06363<br />06364<br />06365<br />06366<br />06367<br />06368<br />06369<br />06370<br />06371<br />06372<br />06373<br />06374<br />06375<br />06376<br />06377<br />06378<br />06379<br />06380<br />
06381<br />06382<br />06383<br />06384<br />06385<br />06386<br />06387<br />06388<br />06389<br />06390<br />06391<br />06392<br />06393<br />06394<br />06395<br />06396<br />06397<br />06398<br />06399<br />06400<br />
06401<br />06402<br />06403<br />06404<br />06405<br />06406<br />06407<br />06408<br />06409<br />06410<br />06411<br />06412<br />06413<br />06414<br />06415<br />06416<br />06417<br />06418<br />06419<br />06420<br />
06421<br />06422<br />06423<br />06424<br />06425<br />06426<br />06427<br />06428<br />06429<br />06430<br />06431<br />06432<br />06433<br />06434<br />06435<br />06436<br />06437<br />06438<br />06439<br />06440<br />
06441<br />06442<br />06443<br />06444<br />06445<br />06446<br />06447<br />06448<br />06449<br />06450<br />06451<br />06452<br />06453<br />06454<br />06455<br />06456<br />06457<br />06458<br />06459<br />06460<br />
06461<br />06462<br />06463<br />06464<br />06465<br />06466<br />06467<br />06468<br />06469<br />06470<br />06471<br />06472<br />06473<br />06474<br />06475<br />06476<br />06477<br />06478<br />06479<br />06480<br />
06481<br />06482<br />06483<br />06484<br />06485<br />06486<br />06487<br />06488<br />06489<br />06490<br />06491<br />06492<br />06493<br />06494<br />06495<br />06496<br />06497<br />06498<br />06499<br />06500<br />
06501<br />06502<br />06503<br />06504<br />06505<br />06506<br />06507<br />06508<br />06509<br />06510<br />06511<br />06512<br />06513<br />06514<br />06515<br />06516<br />06517<br />06518<br />06519<br />06520<br />
06521<br />06522<br />06523<br />06524<br />06525<br />06526<br />06527<br />06528<br />06529<br />06530<br />06531<br />06532<br />06533<br />06534<br />06535<br />06536<br />06537<br />06538<br />06539<br />06540<br />
06541<br />06542<br />06543<br />06544<br />06545<br />06546<br />06547<br />06548<br />06549<br />06550<br />06551<br />06552<br />06553<br />06554<br />06555<br />06556<br />06557<br />06558<br />06559<br />06560<br />
06561<br />06562<br />06563<br />06564<br />06565<br />06566<br />06567<br />06568<br />06569<br />06570<br />06571<br />06572<br />06573<br />06574<br />06575<br />06576<br />06577<br />06578<br />06579<br />06580<br />
06581<br />06582<br />06583<br />06584<br />06585<br />06586<br />06587<br />06588<br />06589<br />06590<br />06591<br />06592<br />06593<br />06594<br />06595<br />06596<br />06597<br />06598<br />06599<br />06600<br />
06601<br />06602<br />06603<br />06604<br />06605<br />06606<br />06607<br />06608<br />06609<br />06610<br />06611<br />06612<br />06613<br />06614<br />06615<br />06616<br />06617<br />06618<br />06619<br />06620<br />
06621<br />06622<br />06623<br />06624<br />06625<br />06626<br />06627<br />06628<br />06629<br />06630<br />06631<br />06632<br />06633<br />06634<br />06635<br />06636<br />06637<br />06638<br />06639<br />06640<br />
06641<br />06642<br />06643<br />06644<br />06645<br />06646<br />06647<br />06648<br />06649<br />06650<br />06651<br />06652<br />06653<br />06654<br />06655<br />06656<br />06657<br />06658<br />06659<br />06660<br />
06661<br />06662<br />06663<br />06664<br />06665<br />06666<br />06667<br />06668<br />06669<br />06670<br />06671<br />06672<br />06673<br />06674<br />06675<br />06676<br />06677<br />06678<br />06679<br />06680<br />
06681<br />06682<br />06683<br />06684<br />06685<br />06686<br />06687<br />06688<br />06689<br />06690<br />06691<br />06692<br />06693<br />06694<br />06695<br />06696<br />06697<br />06698<br />06699<br />06700<br />
06701<br />06702<br />06703<br />06704<br />06705<br />06706<br />06707<br />06708<br />06709<br />06710<br />06711<br />06712<br />06713<br />06714<br />06715<br />06716<br />06717<br />06718<br />06719<br />06720<br />
06721<br />06722<br />06723<br />06724<br />06725<br />06726<br />06727<br />06728<br />06729<br />06730<br />06731<br />06732<br />06733<br />06734<br />06735<br />06736<br />06737<br />06738<br />06739<br />06740<br />
06741<br />06742<br />06743<br />06744<br />06745<br />06746<br />06747<br />06748<br />06749<br />06750<br />06751<br />06752<br />06753<br />06754<br />06755<br />06756<br />06757<br />06758<br />06759<br />06760<br />
06761<br />06762<br />06763<br />06764<br />06765<br />06766<br />06767<br />06768<br />06769<br />06770<br />06771<br />06772<br />06773<br />06774<br />06775<br />06776<br />06777<br />06778<br />06779<br />06780<br />
06781<br />06782<br />06783<br />06784<br />06785<br />06786<br />06787<br />06788<br />06789<br />06790<br />06791<br />06792<br />06793<br />06794<br />06795<br />06796<br />06797<br />06798<br />06799<br />06800<br />
06801<br />06802<br />06803<br />06804<br />06805<br />06806<br />06807<br />06808<br />06809<br />06810<br />06811<br />06812<br />06813<br />06814<br />06815<br />06816<br />06817<br />06818<br />06819<br />06820<br />
06821<br />06822<br />06823<br />06824<br />06825<br />06826<br />06827<br />06828<br />06829<br />06830<br />06831<br />06832<br />06833<br />06834<br />06835<br />06836<br />06837<br />06838<br />06839<br />06840<br />
06841<br />06842<br />06843<br />06844<br />06845<br />06846<br />06847<br />06848<br />06849<br />06850<br />06851<br />06852<br />06853<br />06854<br />06855<br />06856<br />06857<br />06858<br />06859<br />06860<br />
06861<br />06862<br />06863<br />06864<br />06865<br />06866<br />06867<br />06868<br />06869<br />06870<br />06871<br />06872<br />06873<br />06874<br />06875<br />06876<br />06877<br />06878<br />06879<br />06880<br />
06881<br />06882<br />06883<br />06884<br />06885<br />06886<br />06887<br />06888<br />06889<br />06890<br />06891<br />06892<br />06893<br />06894<br />06895<br />06896<br />06897<br />06898<br />06899<br />06900<br />
06901<br />06902<br />06903<br />06904<br />06905<br />06906<br />06907<br />06908<br />06909<br />06910<br />06911<br />06912<br />06913<br />06914<br />06915<br />06916<br />06917<br />06918<br />06919<br />06920<br />
06921<br />06922<br />06923<br />06924<br />06925<br />06926<br />06927<br />06928<br />06929<br />06930<br />06931<br />06932<br />06933<br />06934<br />06935<br />06936<br />06937<br />06938<br />06939<br />06940<br />
06941<br />06942<br />06943<br />06944<br />06945<br />06946<br />06947<br />06948<br />06949<br />06950<br />06951<br />06952<br />06953<br />06954<br />06955<br />06956<br />06957<br />06958<br />06959<br />06960<br />
06961<br />06962<br />06963<br />06964<br />06965<br />06966<br />06967<br />06968<br />06969<br />06970<br />06971<br />06972<br />06973<br />06974<br />06975<br />06976<br />06977<br />06978<br />06979<br />06980<br />
06981<br />06982<br />06983<br />06984<br />06985<br />06986<br />06987<br />06988<br />06989<br />06990<br />06991<br />06992<br />06993<br />06994<br />06995<br />06996<br />06997<br />06998<br />06999<br />07000<br />
07001<br />07002<br />07003<br />07004<br />07005<br />07006<br />07007<br />07008<br />07009<br />07010<br />07011<br />07012<br />07013<br />07014<br />07015<br />07016<br />07017<br />07018<br />07019<br />07020<br />
07021<br />07022<br />07023<br />07024<br />07025<br />07026<br />07027<br />07028<br />07029<br />07030<br />07031<br />07032<br />07033<br />07034<br />07035<br />07036<br />07037<br />07038<br />07039<br />07040<br />
07041<br />07042<br />07043<br />07044<br />07045<br />07046<br />07047<br />07048<br />07049<br />07050<br />07051<br />07052<br />07053<br />07054<br />07055<br />07056<br />07057<br />07058<br />07059<br />07060<br />
07061<br />07062<br />07063<br />07064<br />07065<br />07066<br />07067<br />07068<br />07069<br />07070<br />07071<br />07072<br />07073<br />07074<br />07075<br />07076<br />07077<br />07078<br />07079<br />07080<br />
07081<br />07082<br />07083<br />07084<br />07085<br />07086<br />07087<br />07088<br />07089<br />07090<br />07091<br />07092<br />07093<br />07094<br />07095<br />07096<br />07097<br />07098<br />07099<br />07100<br />
07101<br />07102<br />07103<br />07104<br />07105<br />07106<br />07107<br />07108<br />07109<br />07110<br />07111<br />07112<br />07113<br />07114<br />07115<br />07116<br />07117<br />07118<br />07119<br />07120<br />
07121<br />07122<br />07123<br />07124<br />07125<br />07126<br />07127<br />07128<br />07129<br />07130<br />07131<br />07132<br />07133<br />07134<br />07135<br />07136<br />07137<br />07138<br />07139<br />07140<br />
07141<br />07142<br />07143<br />07144<br />07145<br />07146<br />07147<br />07148<br />07149<br />07150<br />07151<br />07152<br />07153<br />07154<br />07155<br />07156<br />07157<br />07158<br />07159<br />07160<br />
07161<br />07162<br />07163<br />07164<br />07165<br />07166<br />07167<br />07168<br />07169<br />07170<br />07171<br />07172<br />07173<br />07174<br />07175<br />07176<br />07177<br />07178<br />07179<br />07180<br />
07181<br />07182<br />07183<br />07184<br />07185<br />07186<br />07187<br />07188<br />07189<br />07190<br />07191<br />07192<br />07193<br />07194<br />07195<br />07196<br />07197<br />07198<br />07199<br />07200<br />
07201<br />07202<br />07203<br />07204<br />07205<br />07206<br />07207<br />07208<br />07209<br />07210<br />07211<br />07212<br />07213<br />07214<br />07215<br />07216<br />07217<br />07218<br />07219<br />07220<br />
07221<br />07222<br />07223<br />07224<br />07225<br />07226<br />07227<br />07228<br />07229<br />07230<br />07231<br />07232<br />07233<br />07234<br />07235<br />07236<br />07237<br />07238<br />07239<br />07240<br />
07241<br />07242<br />07243<br />07244<br />07245<br />07246<br />07247<br />07248<br />07249<br />07250<br />07251<br />07252<br />07253<br />07254<br />07255<br />07256<br />07257<br />07258<br />07259<br />07260<br />
07261<br />07262<br />07263<br />07264<br />07265<br />07266<br />07267<br />07268<br />07269<br />07270<br />07271<br />07272<br />07273<br />07274<br />07275<br />07276<br />07277<br />07278<br />07279<br />07280<br />
07281<br />07282<br />07283<br />07284<br />07285<br />07286<br />07287<br />07288<br />07289<br />07290<br />07291<br />07292<br />07293<br />07294<br />07295<br />07296<br />07297<br />07298<br />07299<br />07300<br />
07301<br />07302<br />07303<br />07304<br />07305<br />07306<br />07307<br />07308<br />07309<br />07310<br />07311<br />07312<br />07313<br />07314<br />07315<br />07316<br />07317<br />07318<br />07319<br />07320<br />
07321<br />07322<br />07323<br />07324<br />07325<br />07326<br />07327<br />07328<br />07329<br />07330<br />07331<br />07332<br />07333<br />07334<br />07335<br />07336<br />07337<br />07338<br />07339<br />07340<br />
07341<br />07342<br />07343<br />07344<br />07345<br />07346<br />07347<br />07348<br />07349<br />07350<br />07351<br />07352<br />07353<br />07354<br />07355<br />07356<br />07357<br />07358<br />07359<br />07360<br />
07361<br />07362<br />07363<br />07364<br />07365<br />07366<br />07367<br />07368<br />07369<br />07370<br />07371<br />07372<br />07373<br />07374<br />07375<br />07376<br />07377<br />07378<br />07379<br />07380<br />
07381<br />07382<br />07383<br />07384<br />07385<br />07386<br />07387<br />07388<br />07389<br />07390<br />07391<br />07392<br />07393<br />07394<br />07395<br />07396<br />07397<br />07398<br />07399<br />07400<br />
07401<br />07402<br />07403<br />07404<br />07405<br />07406<br />07407<br />07408<br />07409<br />07410<br />07411<br />07412<br />07413<br />07414<br />07415<br />07416<br />07417<br />07418<br />07419<br />07420<br />
07421<br />07422<br />07423<br />07424<br />07425<br />07426<br />07427<br />07428<br />07429<br />07430<br />07431<br />07432<br />07433<br />07434<br />07435<br />07436<br />07437<br />07438<br />07439<br />07440<br />
07441<br />07442<br />07443<br />07444<br />07445<br />07446<br />07447<br />07448<br />07449<br />07450<br />07451<br />07452<br />07453<br />07454<br />07455<br />07456<br />07457<br />07458<br />07459<br />07460<br />
07461<br />07462<br />07463<br />07464<br />07465<br />07466<br />07467<br />07468<br />07469<br />07470<br />07471<br />07472<br />07473<br />07474<br />07475<br />07476<br />07477<br />07478<br />07479<br />07480<br />
07481<br />07482<br />07483<br />07484<br />07485<br />07486<br />07487<br />07488<br />07489<br />07490<br />07491<br />07492<br />07493<br />07494<br />07495<br />07496<br />07497<br />07498<br />07499<br />07500<br />
07501<br />07502<br />07503<br />07504<br />07505<br />07506<br />07507<br />07508<br />07509<br />07510<br />07511<br />07512<br />07513<br />07514<br />07515<br />07516<br />07517<br />07518<br />07519<br />07520<br />
07521<br />07522<br />07523<br />07524<br />07525<br />07526<br />07527<br />07528<br />07529<br />07530<br />07531<br />07532<br />07533<br />07534<br />07535<br />07536<br />07537<br />07538<br />07539<br />07540<br />
07541<br />07542<br />07543<br />07544<br />07545<br />07546<br />07547<br />07548<br />07549<br />07550<br />07551<br />07552<br />07553<br />07554<br />07555<br />07556<br />07557<br />07558<br />07559<br />07560<br />
07561<br />07562<br />07563<br />07564<br />07565<br />07566<br />07567</span></td>
<td class="source"><pre class="source"><a name="1"></a><span class="source_comment">//=============================================================================
</span><a name="2"></a><span class="source_comment">// ROPawn
</span><a name="3"></a><span class="source_comment">//=============================================================================
</span><a name="4"></a><span class="source_comment">// Pawn class for Red Orchestra
</span><a name="5"></a><span class="source_comment">//=============================================================================
</span><a name="6"></a><span class="source_comment">// Red Orchestra Source
</span><a name="7"></a><span class="source_comment">// Copyright (C) 2005 John Gibson
</span><a name="8"></a><span class="source_comment">//=============================================================================
</span><a name="9"></a>
<a name="10"></a><span class="source_type">class</span> <span class="source_type"><a href="../roengine/ropawn.html" class="source">ROPawn</a></span> extends <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>
<a name="11"></a>	native
<a name="12"></a>	placeable
<a name="13"></a>	config(<span class="source_type">User</span>)
<a name="14"></a>	exportstructs
<a name="15"></a>	dependsOn(<span class="source_type"><a href="../xgame/xutil.html" class="source">xUtil</a></span>)
<a name="16"></a>	dependsOn(<span class="source_type"><a href="../roengine/ropawnsoundgroup.html" class="source">ROPawnSoundGroup</a></span>);
<a name="17"></a>
<a name="18"></a><span class="source_comment">//#exec OBJ LOAD FILE=Inf_Player.uax
</span><a name="19"></a><span class="source_comment">//#exec OBJ LOAD FILE=Miscsounds.uax
</span><a name="20"></a><span class="source_comment">//#exec OBJ LOAD FILE=Inf_Weapons_Foley.uax
</span><a name="21"></a>
<a name="22"></a><span class="source_comment">// UnrealPawn vars
</span><a name="23"></a>
<a name="24"></a>var	() <span class="source_type">bool</span>		bNoDefaultInventory;	<span class="source_comment">// don't spawn default inventory for this guy
</span><a name="25"></a>var <span class="source_type">bool</span>		bAcceptAllInventory;	<span class="source_comment">// can pick up anything
</span><a name="26"></a>var(AI) <span class="source_type">bool</span>	bIsSquadLeader;			<span class="source_comment">// only used as startup property
</span><a name="27"></a>var <span class="source_type">bool</span>		bSoakDebug;				<span class="source_comment">// use less verbose version of debug display
</span><a name="28"></a>var <span class="source_type">bool</span>		bKeepTaunting;
<a name="29"></a>var config <span class="source_type">bool</span> bPlayOwnFootsteps;
<a name="30"></a>var <span class="source_type">byte</span>		LoadOut;
<a name="31"></a>
<a name="32"></a>var		<span class="source_type">float</span>	AttackSuitability;		<span class="source_comment">// range 0 to 1, 0 = pure defender, 1 = pure attacker
</span><a name="33"></a>var		<span class="source_type">float</span>	LastFootStepTime;
<a name="34"></a>
<a name="35"></a>var <span class="source_type"><a href="../engine/actor.html#EDoubleClickDir" class="source">eDoubleClickDir</a></span> CurrentDir;
<a name="36"></a>var <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>			GameObjOffset;
<a name="37"></a>var <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			GameObjRot;
<a name="38"></a>var(AI) <span class="source_type">name</span>		SquadName;			<span class="source_comment">// only used as startup property
</span><a name="39"></a>
<a name="40"></a><span class="source_comment">// allowed voices
</span><a name="41"></a>var <span class="source_type">string</span> VoiceType;
<a name="42"></a>
<a name="43"></a>var globalconfig <span class="source_type">bool</span> bPlayerShadows;
<a name="44"></a>var globalconfig <span class="source_type">bool</span> bBlobShadow;
<a name="45"></a>
<a name="46"></a>var <span class="source_type">int</span> spree;
<a name="47"></a>
<a name="48"></a><span class="source_comment">// Xpawn vars
</span><a name="49"></a>var <span class="source_type">bool</span> bGibbed;
<a name="50"></a>var <span class="source_type">bool</span> bAlreadySetup;
<a name="51"></a>var <span class="source_type">bool</span> bSpawnDone;
<a name="52"></a>var <span class="source_type">bool</span> bClearWeaponOffsets;		<span class="source_comment">// for certain custom player models
</span><a name="53"></a>
<a name="54"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../xgame/speciestype.html" class="source">SpeciesType</a></span>&gt; Species;
<a name="55"></a>
<a name="56"></a>var <span class="source_type">float</span> DeResTime;
<a name="57"></a>var <span class="source_type">bool</span> bDeRes;
<a name="58"></a>
<a name="59"></a>var(Sounds) <span class="source_type">float</span> GruntVolume;
<a name="60"></a>var(Sounds) <span class="source_type">float</span> FootstepVolume;
<a name="61"></a>
<a name="62"></a>var transient <span class="source_type">int</span>   SimHitFxTicker;
<a name="63"></a>
<a name="64"></a>var <span class="source_type">float</span> MinTimeBetweenPainSounds;
<a name="65"></a>
<a name="66"></a><span class="source_comment">// Common sounds
</span><a name="67"></a>
<a name="68"></a>var(Sounds) <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>   SoundFootsteps[<span class="source_int">20</span>]; <span class="source_comment">// Indexed by ESurfaceTypes (sorry about the literal).
</span><a name="69"></a>var(Sounds) <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/ropawnsoundgroup.html" class="source">ROPawnSoundGroup</a></span>&gt; SoundGroupClass;
<a name="70"></a>
<a name="71"></a>var <span class="source_type"><a href="../roengine/roweaponattachment.html" class="source">ROWeaponAttachment</a></span> <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>;
<a name="72"></a>var <span class="source_type"><a href="../roengine/roweaponattachment.html" class="source">ROWeaponAttachment</a></span> OldWeaponAttachment; <span class="source_comment">// Used by the native code for animations
</span><a name="73"></a>
<a name="74"></a>var	<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> SwapWeapon; <span class="source_comment">// Used to keep track of the weapon being swapped during the PutWeaponAway state.
</span><a name="75"></a>
<a name="76"></a>var <span class="source_type"><a href="../engine/shadowprojector.html" class="source">ShadowProjector</a></span> PlayerShadow;
<a name="77"></a>
<a name="78"></a>var(Karma) <span class="source_type">float</span> RagdollLifeSpan; <span class="source_comment">// MAXIMUM time the ragdoll will be around. De-res's early if it comes to rest.
</span><a name="79"></a>var(Karma) <span class="source_type">float</span> RagInvInertia; <span class="source_comment">// Use to work out how much 'spin' ragdoll gets on death.
</span><a name="80"></a>var(Karma) <span class="source_type">float</span> RagDeathVel; <span class="source_comment">// How fast ragdoll moves upon death
</span><a name="81"></a>var(Karma) <span class="source_type">float</span> RagShootStrength; <span class="source_comment">// How much effect shooting ragdolls has. Be careful!
</span><a name="82"></a>var(Karma) <span class="source_type">float</span> RagSpinScale; <span class="source_comment">// Increase propensity to spin around Z (up).
</span><a name="83"></a>var(Karma) <span class="source_type">float</span> RagMaxSpinAmount; <span class="source_comment">// The max we'll scale up spin amount for locational hit damage
</span><a name="84"></a>var(Karma) <span class="source_type">float</span> RagDeathUpKick; <span class="source_comment">// Amount of upwards kick ragdolls get when they die
</span><a name="85"></a>var(Karma) <span class="source_type">float</span> RagGravScale;
<a name="86"></a>
<a name="87"></a>var(Karma) <span class="source_type"><a href="../engine/material.html" class="source">material</a></span> RagConvulseMaterial;
<a name="88"></a>
<a name="89"></a><span class="source_comment">// Ragdoll impact sounds.
</span><a name="90"></a>var(Karma) <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>			RagImpactSound;
<a name="91"></a>var(Karma) <span class="source_type">float</span>			RagImpactSoundInterval;
<a name="92"></a>var transient <span class="source_type">float</span>			RagLastSoundTime;
<a name="93"></a>
<a name="94"></a>var <span class="source_type">string</span> RagdollOverride;
<a name="95"></a>
<a name="96"></a>var <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> OldController;
<a name="97"></a>
<a name="98"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../unrealgame/teamvoicepack.html" class="source">TeamVoicePack</a></span>&gt; VoiceClass;
<a name="99"></a>
<a name="100"></a>var(AI) globalconfig <span class="source_type">string</span> PlacedCharacterName;
<a name="101"></a>var globalconfig <span class="source_type">string</span> PlacedFemaleCharacterName;
<a name="102"></a>
<a name="103"></a>var <span class="source_type">byte</span> TeamSkin;		<span class="source_comment">// what team's skin is currently set
</span><a name="104"></a>
<a name="105"></a>var <span class="source_type">name</span> FireRootBone;
<a name="106"></a><span class="source_comment">//=============================================================================
</span><a name="107"></a><span class="source_comment">// RO Variables
</span><a name="108"></a><span class="source_comment">//=============================================================================
</span><a name="109"></a>
<a name="110"></a><span class="source_comment">// Damage
</span><a name="111"></a>var					<span class="source_type">byte</span>		DamageList[<span class="source_int">15</span>]; <span class="source_comment">// An array that tracks what areas of the body are damaged. Correlates to Hitpoints Array (-1)
</span><a name="112"></a>var                 <span class="source_type">int</span>         LastHitIndex;
<a name="113"></a>
<a name="114"></a><span class="source_comment">// Gore
</span><a name="115"></a>var	<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span> 	SeveredLeftArm; <span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="116"></a>var	<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span> 	SeveredRightArm;<span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="117"></a>var	<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span> 	SeveredLeftLeg; <span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="118"></a>var	<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span> 	SeveredRightLeg;<span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="119"></a>var	<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span> 	<span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span>;<span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="120"></a>
<a name="121"></a>var	<span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>&gt; SeveredArmAttachClass; <span class="source_comment">// class of the severed arm for this role
</span><a name="122"></a>var	<span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>&gt; SeveredLegAttachClass; <span class="source_comment">// class of the severed arm for this role
</span><a name="123"></a>var	<span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>&gt; SeveredHeadAttachClass; <span class="source_comment">// class of the severed arm for this role
</span><a name="124"></a>
<a name="125"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/robloodspurt.html" class="source">ROBloodSpurt</a></span>&gt;		 BleedingEmitterClass;		<span class="source_comment">// class of the bleeding emitter
</span><a name="126"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/projectilebloodsplat.html" class="source">ProjectileBloodSplat</a></span>&gt; ProjectileBloodSplatClass;	<span class="source_comment">// class of the wall bloodsplat from a projectile's impact
</span><a name="127"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span>&gt;	DetachedArmClass;		<span class="source_comment">// class of detached arm to spawn for this pawn. Modified by the RoleInfo to match the player model
</span><a name="128"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span>&gt;	DetachedLegClass;		<span class="source_comment">// class of detached arm to spawn for this pawn. Modified by the RoleInfo to match the player model
</span><a name="129"></a>var			<span class="source_type">bool</span>				bLeftArmGibbed;			<span class="source_comment">// LeftArm is already blown off
</span><a name="130"></a>var			<span class="source_type">bool</span>				bRightArmGibbed;		<span class="source_comment">// RightArm is already blown off
</span><a name="131"></a>var			<span class="source_type">bool</span>				bLeftLegGibbed;			<span class="source_comment">// LeftLeg is already blown off
</span><a name="132"></a>var			<span class="source_type">bool</span>				bRightLegGibbed;		<span class="source_comment">// RightLeg is already blown off
</span><a name="133"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt;				ObliteratedEffectClass;	<span class="source_comment">// class of detached arm to spawn for this pawn. Modified by the RoleInfo to match the player model
</span><a name="134"></a>
<a name="135"></a>
<a name="136"></a><span class="source_comment">// Collision
</span><a name="137"></a>var		<span class="source_type"><a href="../roengine/robulletwhipattachment.html" class="source">ROBulletWhipAttachment</a></span>  AuxCollisionCylinder;   <span class="source_comment">// Additional collision cylinder for detecting bullets passing by
</span><a name="138"></a>var 				<span class="source_type">bool</span> 		SavedAuxCollision;     	<span class="source_comment">// Saved aux collision cylinder status
</span><a name="139"></a><span class="source_comment">// Used by physics to set the player's distance from the floor.
</span><a name="140"></a>var 				const <span class="source_type">float</span> ROMinFloorDist;
<a name="141"></a>var 				const <span class="source_type">float</span> ROMaxFloorDist;
<a name="142"></a>
<a name="143"></a>const FRONTROTATIONCHECKDIST = <span class="source_int">40.0</span>; 					<span class="source_comment">// How far forward to check when prone to determine the rotation of the floor in front of the player
</span><a name="144"></a>
<a name="145"></a><span class="source_comment">// Stamina
</span><a name="146"></a>var()				<span class="source_type">float</span>		Stamina;                <span class="source_comment">// How many second of stamina the player has
</span><a name="147"></a>var             	<span class="source_type">byte</span> 		SavedBreathSound;     	<span class="source_comment">// Tracks the old breathing sound
</span><a name="148"></a>var()				<span class="source_type">float</span>		JumpStaminaDrain;       <span class="source_comment">// How much stamina is lost by jumping
</span><a name="149"></a>var() 				<span class="source_type">float</span> 		StaminaRecoveryRate; 	<span class="source_comment">// How much stamina to recover normally per second
</span><a name="150"></a>var() 				<span class="source_type">float</span> 		CrouchStaminaRecoveryRate;<span class="source_comment">// How much stamina to recover per second while crouching
</span><a name="151"></a>var() 				<span class="source_type">float</span> 		ProneStaminaRecoveryRate;<span class="source_comment">// How much stamina to recover per second while proning
</span><a name="152"></a>var() 				<span class="source_type">float</span>		SlowStaminaRecoveryRate;<span class="source_comment">// How much stamina to recover per second when moving
</span><a name="153"></a>var					<span class="source_type">bool</span>		bOldSprinting; 			<span class="source_comment">// Helper flag for SetSprinting(). Since we simulate sprinting and stamina on both client and server, this flag is used to keep track of the local sprinting flags.
</span><a name="154"></a>
<a name="155"></a><span class="source_comment">// Momentum
</span><a name="156"></a>var()				<span class="source_type"><a href="../core/object.html#InterpCurve" class="source">InterpCurve</a></span>	MomentumCurve; 			<span class="source_comment">// The amount of momentum to apply based on an input velocity
</span><a name="157"></a>var()				<span class="source_type">float</span>		FrictionScale;			<span class="source_comment">// Used by the native physics to scale the friction when the player is moving. This makes the player feel less like he "sticks" to the the ground
</span><a name="158"></a>
<a name="159"></a>
<a name="160"></a>var()				<span class="source_type">int</span>			PronePitchUpLimit;		<span class="source_comment">// Pitch up limit while prone
</span><a name="161"></a>var()				<span class="source_type">int</span>			PronePitchDownLimit;    <span class="source_comment">// Pitch down limit while prone
</span><a name="162"></a>var()				<span class="source_type">int</span>			CrawlingPitchUpLimit;	<span class="source_comment">// Pitch up limit while crawling forward or back
</span><a name="163"></a>var()				<span class="source_type">int</span>			CrawlingPitchDownLimit; <span class="source_comment">// Pitch down limit while crawling forward or back
</span><a name="164"></a>
<a name="165"></a>var					<span class="source_type">int</span>			CrawlPitchTweenRate;	<span class="source_comment">// Tween to pitch limit speed  = CrawlingPitchDownLimit-PronePitchDownLimit/NumSecondsToTween(0.15)
</span><a name="166"></a>
<a name="167"></a><span class="source_comment">// Animation
</span><a name="168"></a>var 				<span class="source_type">bool</span>		bPlayTypingAnims;		<span class="source_comment">// Whether or not to play a typing animation when the player is typing
</span><a name="169"></a>var(ROAnimations)	<span class="source_type">name</span> 		ProneIdleRestAnim;		<span class="source_comment">// Idling for a long time while prone
</span><a name="170"></a>var(ROAnimations)	<span class="source_type">name</span> 		CrouchIdleRestAnim;     <span class="source_comment">// Idling for a long time while crouched
</span><a name="171"></a>
<a name="172"></a><span class="source_comment">// MG deployed anims
</span><a name="173"></a>var(ROAnimations)	<span class="source_type">name</span> 		IdleProneDeployedAnim;
<a name="174"></a>var(ROAnimations)	<span class="source_type">name</span>        IdleCrouchDeployedAnim;
<a name="175"></a>var(ROAnimations)	<span class="source_type">name</span>        IdleStandingDeployedAnim;
<a name="176"></a>
<a name="177"></a><span class="source_comment">// Prone Anims
</span><a name="178"></a>var(ROAnimations)	<span class="source_type">name</span>		ProneAnims[<span class="source_int">8</span>];
<a name="179"></a>var(ROAnimations) 	<span class="source_type">name</span>		IdleProneAnim;
<a name="180"></a>var(ROAnimations) 	<span class="source_type">name</span>		ProneTurnRightAnim;
<a name="181"></a>var(ROAnimations) 	<span class="source_type">name</span>		ProneTurnLeftAnim;
<a name="182"></a>var(ROAnimations) 	<span class="source_type">name</span>		StandToProneAnim;
<a name="183"></a>var(ROAnimations) 	<span class="source_type">name</span>		ProneToStandAnim;
<a name="184"></a>var(ROAnimations) 	<span class="source_type">name</span>		CrouchToProneAnim;
<a name="185"></a>var(ROAnimations) 	<span class="source_type">name</span>		ProneToCrouchAnim;
<a name="186"></a>var(ROAnimations) 	<span class="source_type">name</span>		DiveToProneStartAnim;
<a name="187"></a>var(ROAnimations) 	<span class="source_type">name</span>		DiveToProneEndAnim;
<a name="188"></a>
<a name="189"></a><span class="source_comment">// Sprint Anims
</span><a name="190"></a>var(ROAnimations) 	<span class="source_type">name</span>		SprintAnims[<span class="source_int">8</span>];
<a name="191"></a>var(ROAnimations) 	<span class="source_type">name</span>		SprintCrouchAnims[<span class="source_int">8</span>];
<a name="192"></a>
<a name="193"></a><span class="source_comment">// Iron Sight Anims
</span><a name="194"></a>var(ROAnimations) 	<span class="source_type">name</span>		WalkIronAnims[<span class="source_int">8</span>];
<a name="195"></a>var(ROAnimations) 	<span class="source_type">name</span>		IdleIronRestAnim;
<a name="196"></a>var(ROAnimations) 	<span class="source_type">name</span>		IdleIronWeaponAnim;
<a name="197"></a>var(ROAnimations) 	<span class="source_type">name</span>		IdleCrouchIronWeaponAnim;
<a name="198"></a>var(ROAnimations) 	<span class="source_type">name</span>		TurnIronRightAnim;
<a name="199"></a>var(ROAnimations) 	<span class="source_type">name</span>		TurnIronLeftAnim;
<a name="200"></a>var(ROAnimations) 	<span class="source_type">name</span>		CrouchTurnIronRightAnim;
<a name="201"></a>var(ROAnimations) 	<span class="source_type">name</span>		CrouchTurnIronLeftAnim;
<a name="202"></a>
<a name="203"></a><span class="source_comment">// Hit Anims
</span><a name="204"></a>var(ROAnimations) 	<span class="source_type">name</span>		HitFAnim;
<a name="205"></a>var(ROAnimations) 	<span class="source_type">name</span>		HitBAnim;
<a name="206"></a>var(ROAnimations) 	<span class="source_type">name</span>		HitLAnim;
<a name="207"></a>var(ROAnimations) 	<span class="source_type">name</span>		HitRAnim;
<a name="208"></a>var(ROAnimations) 	<span class="source_type">name</span>		HitLLegAnim;
<a name="209"></a>var(ROAnimations) 	<span class="source_type">name</span>		HitRLegAnim;
<a name="210"></a>var(ROAnimations) 	<span class="source_type">name</span>		ProneHitAnim;
<a name="211"></a>var(ROAnimations) 	<span class="source_type">name</span>		CrouchHitUpAnim;
<a name="212"></a>var(ROAnimations) 	<span class="source_type">name</span>		CrouchHitDownAnim;
<a name="213"></a>
<a name="214"></a>var(ROAnimations) 	<span class="source_type">name</span>		LimpAnims[<span class="source_int">8</span>];
<a name="215"></a>
<a name="216"></a><span class="source_comment">// General
</span><a name="217"></a>
<a name="218"></a>var				<span class="source_type">float</span>			NextJumpTime;
<a name="219"></a><span class="source_comment">// Ramm: Refactor
</span><a name="220"></a><span class="source_comment">// These two arent being used properly
</span><a name="221"></a>var				<span class="source_type">float</span>			LastLandTime;			<span class="source_comment">// we'll use this for a settling time.  If someone jumps, they'll need a few seconds to settle
</span><a name="222"></a>var				<span class="source_type">float</span>			LandRecoveryTime;		<span class="source_comment">// time it takes to recover from a jump to do whatever action, maybe change when injured
</span><a name="223"></a>
<a name="224"></a><span class="source_comment">// Limping
</span><a name="225"></a>var				<span class="source_type">float</span>			LimpTime; 				<span class="source_comment">// How long the player will limp for
</span><a name="226"></a>
<a name="227"></a><span class="source_comment">// Ramm: Refactor
</span><a name="228"></a><span class="source_comment">// Rather than have an entire actor, or array of actors, how about just using a mesh attachment?
</span><a name="229"></a>var		array&lt;<span class="source_type"><a href="../roengine/roammopouch.html" class="source">ROAmmoPouch</a></span>&gt;		AmmoPouches;
<a name="230"></a>var		<span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/roammopouch.html" class="source">ROAmmoPouch</a></span>&gt;		AmmoPouchClasses[<span class="source_int">3</span>];
<a name="231"></a>
<a name="232"></a>var		<span class="source_type"><a href="../roengine/roheadgear.html" class="source">ROHeadgear</a></span>				Headgear;
<a name="233"></a>var		<span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/roheadgear.html" class="source">ROHeadgear</a></span>&gt;		HeadgearClass;
<a name="234"></a>
<a name="235"></a>var		<span class="source_type"><a href="../roengine/backattachment.html" class="source">BackAttachment</a></span>			AttachedBackItem;		<span class="source_comment">// Weapon attachment on player's back
</span><a name="236"></a>
<a name="237"></a>var				<span class="source_type">bool</span>			bInitializedPlayer;
<a name="238"></a>
<a name="239"></a><span class="source_comment">// Objectives
</span><a name="240"></a>var				<span class="source_type">byte</span>			CurrentCapArea;
<a name="241"></a>var				<span class="source_type">byte</span>			CurrentCapProgress;
<a name="242"></a><span class="source_comment">//var			byte			CurrentCapPlayers;
</span><a name="243"></a>var             <span class="source_type">byte</span>            CurrentCapAxisCappers;
<a name="244"></a>var             <span class="source_type">byte</span>            CurrentCapAlliesCappers;
<a name="245"></a>
<a name="246"></a>enum <span class="source_type"><a href="../roengine/ropawn.html#EWeaponState" class="source">EWeaponState</a></span>
<a name="247"></a>{
<a name="248"></a>	GS_None,
<a name="249"></a>	GS_Ready,
<a name="250"></a>	GS_FireSingle,
<a name="251"></a>	GS_FireLooped,
<a name="252"></a>	GS_PreReload,
<a name="253"></a>	GS_ReloadSingle,
<a name="254"></a>	GS_ReloadLooped,
<a name="255"></a>	GS_BayonetAttach,
<a name="256"></a>	GS_BayonetDetach,
<a name="257"></a>	GS_GrenadePullBack,
<a name="258"></a>	GS_GrenadeHoldBack,
<a name="259"></a>	GS_IgnoreAnimend,
<a name="260"></a>};
<a name="261"></a>
<a name="262"></a>var		<span class="source_type"><a href="../roengine/ropawn.html#EWeaponState" class="source">EWeaponState</a></span>			WeaponState;
<a name="263"></a>
<a name="264"></a><span class="source_comment">// MG resupply
</span><a name="265"></a><span class="source_comment">// TEMP VARIABLE - put here because I didn't know where else to since I'm in a hurry
</span><a name="266"></a><span class="source_comment">// This variable is referenced in ROHud and ROPlayer
</span><a name="267"></a>var				<span class="source_type">bool</span>			bCanResupply;
<a name="268"></a>var				<span class="source_type">bool</span>			bUsedCarriedMGAmmo; 	<span class="source_comment">// have they already resupplied another gunner?
</span><a name="269"></a>
<a name="270"></a>var				<span class="source_type">bool</span>			bWeaponCanBeResupplied;	<span class="source_comment">// True if the weapon the pawn is holding can be resupplied by other players (ie giving an MGer ammo)
</span><a name="271"></a>var				<span class="source_type">bool</span>			bWeaponNeedsResupply;	<span class="source_comment">// True if the weapon the pawn is holding needs to be resupplied
</span><a name="272"></a>
<a name="273"></a>var				<span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span>			SavedBase; 				<span class="source_comment">// Last base this pawn was on
</span><a name="274"></a>
<a name="275"></a>var 			<span class="source_type">float</span>			SprintAccelRate;		<span class="source_comment">// How fast the player accelerates when they are sprinting
</span><a name="276"></a>
<a name="277"></a><span class="source_comment">// Footstep sounds
</span><a name="278"></a>var()			<span class="source_type">float</span> 			FootStepSoundRadius;	<span class="source_comment">// The radius that footstep sounds can be heard
</span><a name="279"></a>var()			<span class="source_type">float</span>			QuietFootStepVolume;	<span class="source_comment">// The amount to scale footstepsounds when the player is walking slowly
</span><a name="280"></a>
<a name="281"></a>var() 			<span class="source_type">float</span>			CrouchEyeHeightMod; 	<span class="source_comment">// Modifier for eyeheight while crouched
</span><a name="282"></a>var() 			<span class="source_type">float</span>			CrouchMoveEyeHeightMod; <span class="source_comment">// Modifier for eyeheight while crouched and moving
</span><a name="283"></a>var() 			<span class="source_type">float</span>			ProneEyeHeight; 		<span class="source_comment">// ProneEyeHeight
</span><a name="284"></a>var()			<span class="source_type">float</span>			ProneEyeDist;			<span class="source_comment">// Distance offset from location to put prone camera.
</span><a name="285"></a>var const 		<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			OldProneRotation;		<span class="source_comment">// Used by phyics to help smooth prone rotation
</span><a name="286"></a>var	const		<span class="source_type">float</span>			DeployedEyeHeight;		<span class="source_comment">// Calculated by physics to determine what the player's eye height should be
</span><a name="287"></a>
<a name="288"></a>var(<span class="source_type"><a href="../engine/camera.html" class="source">Camera</a></span>)     <span class="source_type">name</span> 			CameraBone;				<span class="source_comment">// The bone used for the camera position during certain transitions (prone)
</span><a name="289"></a>
<a name="290"></a><span class="source_comment">// For lean
</span><a name="291"></a>var 			<span class="source_type">float</span> 			LeanMax;
<a name="292"></a>var 			<span class="source_type">float</span> 			LeanFactor;
<a name="293"></a>var 			<span class="source_type">float</span>			LeanAmount;    			<span class="source_comment">// Positive is right, negative is left, zero is center
</span><a name="294"></a>var 			<span class="source_type">bool</span>			bLeaningRight, bLeaningLeft;<span class="source_comment">//Is in the process of leaning or stopping leaning or is actually leaning :P
</span><a name="295"></a>var 			<span class="source_type">bool</span>			bLeanRight, bLeanLeft;	<span class="source_comment">//True if lean is pressed
</span><a name="296"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>			LeanLViewOffset;		<span class="source_comment">// Eyeposition offset for leaning left
</span><a name="297"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>			LeanRViewOffset;		<span class="source_comment">// Eyeposition offset for leaning right
</span><a name="298"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>			LeanLCrouchViewOffset;	<span class="source_comment">// Eyeposition offset for leaning left
</span><a name="299"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>			LeanRCrouchViewOffset;	<span class="source_comment">// Eyeposition offset for leaning right
</span><a name="300"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>			LeanLProneViewOffset;	<span class="source_comment">// Eyeposition offset for leaning left
</span><a name="301"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>			LeanRProneViewOffset;	<span class="source_comment">// Eyeposition offset for leaning right
</span><a name="302"></a>
<a name="303"></a>var()			<span class="source_type">int</span>				AnimPitchUpLimit;			<span class="source_comment">// Pitch up limit for third person torso twist
</span><a name="304"></a>var()			<span class="source_type">int</span>				AnimPitchDownLimit;    		<span class="source_comment">// Pitch down limit for third person torso twist
</span><a name="305"></a>var()			<span class="source_type">int</span>				ProneAnimPitchUpLimit;		<span class="source_comment">// Pitch up limit for third person torso twist while prone
</span><a name="306"></a>var()			<span class="source_type">int</span>				ProneAnimPitchDownLimit;    <span class="source_comment">// Pitch down limit for third person torso twist while prone
</span><a name="307"></a>
<a name="308"></a><span class="source_comment">// Bone settings for the player animation while leaning
</span><a name="309"></a>var(Lean) 		<span class="source_type">name</span>			LeanBones[<span class="source_int">8</span>];
<a name="310"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			LeanLeftStanding[<span class="source_int">8</span>];
<a name="311"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			LeanRightStanding[<span class="source_int">8</span>];
<a name="312"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			LeanLeftCrouch[<span class="source_int">8</span>];
<a name="313"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			LeanRightCrouch[<span class="source_int">8</span>];
<a name="314"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			LeanLeftProne[<span class="source_int">8</span>];
<a name="315"></a>var(Lean)		<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			LeanRightProne[<span class="source_int">8</span>];
<a name="316"></a>var				<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span> 		CurrentRotators[<span class="source_int">8</span>];
<a name="317"></a>
<a name="318"></a><span class="source_comment">// auto tracing
</span><a name="319"></a>var 			<span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span>			AutoTraceActor;			<span class="source_comment">// The actor that this pawn is currently looking at (has selected)
</span><a name="320"></a>
<a name="321"></a><span class="source_comment">// Deployment system
</span><a name="322"></a>var				<span class="source_type">int</span>				OldLookYaw;   			<span class="source_comment">// The last yaw rotation of the player. used for calculating the rotation speed
</span><a name="323"></a>var 			<span class="source_type">float</span> 			CantRestWeapTime;       <span class="source_comment">// The last time we were in a position where the weapon could not be rested
</span><a name="324"></a>var				<span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>			InitialDeployedRotation;<span class="source_comment">// The rotation of the player when the weapon is initially bipod deployed
</span><a name="325"></a>var()			<span class="source_type">int</span>				DeployedPitchUpLimit;	<span class="source_comment">// The pitch limit when bipod deployed
</span><a name="326"></a>var()			<span class="source_type">int</span>				DeployedPitchDownLimit;	<span class="source_comment">// The pitch limit when bipod deployed
</span><a name="327"></a>var()			<span class="source_type">int</span>				DeployedPositiveYawLimit;<span class="source_comment">// The yaw limit when bipod deployed
</span><a name="328"></a>var()			<span class="source_type">int</span>				DeployedNegativeYawLimit;<span class="source_comment">// The yaw limit when bipod deployed
</span><a name="329"></a>var const		<span class="source_type">float</span> 			LastMoveTime;		     <span class="source_comment">// The last time this player moved. Used for calculating crouched eye height
</span><a name="330"></a>
<a name="331"></a><span class="source_comment">// Stance transition sounds
</span><a name="332"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           CrouchToProneSound;
<a name="333"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           CrouchToStandSound;
<a name="334"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           ProneToCrouchSound;
<a name="335"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           ProneToStandSound;
<a name="336"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           StandToCrouchSound;
<a name="337"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           StandToProneSound;
<a name="338"></a>
<a name="339"></a>var             <span class="source_type">bool</span>            bPreventWeaponFire;     <span class="source_comment">// Used to prevent firing the weapon during certain pawn transitions
</span><a name="340"></a>
<a name="341"></a><span class="source_comment">// Breathing sounds
</span><a name="342"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           BreatheLightSound;
<a name="343"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           BreatheMediumSound;
<a name="344"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           BreatheHeavySound;
<a name="345"></a>var             <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           BreatheExhaustedSound;
<a name="346"></a>
<a name="347"></a><span class="source_comment">// Net code
</span><a name="348"></a>var()			<span class="source_type">float</span>			NetSoundRadiusSquared; <span class="source_comment">// The relevant radius for certain pawn sounds to be heard by other net players. If this pawn is doing particular actions (reloading, footstepping, etc) it will be relevant to other pawns within this radius
</span><a name="349"></a>var				<span class="source_type">bool</span>			bInitializedWeaponAttachment;<span class="source_comment">// The weapon attachment has completed initial replication
</span><a name="350"></a>
<a name="351"></a>
<a name="352"></a><span class="source_comment">// Hit detection debugging - Only use when debugging
</span><a name="353"></a><span class="source_comment">/*var vector DrawLocation;
<a name="354"></a>var rotator DrawRotation;
<a name="355"></a>var int DrawIndex;
<a name="356"></a>var vector HitStart;
<a name="357"></a>var vector HitEnd;
<a name="358"></a>var byte HitPointDebugByte;
<a name="359"></a>var byte OldHitPointDebugByte;*/</span>
<a name="360"></a>
<a name="361"></a>var				<span class="source_type">bool</span>			bRecievedInitialLoadout; <span class="source_comment">// Initial weapon loadout has finished replicating
</span><a name="362"></a>
<a name="363"></a><span class="source_comment">//=============================================================================
</span><a name="364"></a><span class="source_comment">// replication
</span><a name="365"></a><span class="source_comment">//=============================================================================
</span><a name="366"></a>
<a name="367"></a>replication
<a name="368"></a>{
<a name="369"></a>	reliable if (bNetDirty && Role == ROLE_Authority)
<a name="370"></a>		bLeanRight, bLeanLeft;
<a name="371"></a>
<a name="372"></a>	reliable if (bNetDirty && Role == ROLE_Authority)
<a name="373"></a>		AmmoPouchClasses, HeadgearClass, DetachedArmClass, DetachedLegClass;
<a name="374"></a>
<a name="375"></a>	reliable if (bNetDirty && bNetOwner && Role == ROLE_Authority)
<a name="376"></a>		CurrentCapArea, CurrentCapProgress, CurrentCapAxisCappers, CurrentCapAlliesCappers,
<a name="377"></a>		bUsedCarriedMGAmmo, bPreventWeaponFire;
<a name="378"></a>
<a name="379"></a>	reliable if (Role == ROLE_Authority)
<a name="380"></a>		ClientUpdateDamageList, ClientForceStaminaUpdate;
<a name="381"></a>
<a name="382"></a>    reliable if ( bNetDirty && !bNetOwner && (Role == ROLE_Authority) )
<a name="383"></a>    	bWeaponCanBeResupplied, bWeaponNeedsResupply;
<a name="384"></a>
<a name="385"></a>    <span class="source_comment">// Hit detection debugging - Only use when debugging
</span><a name="386"></a>    <span class="source_comment">//reliable if (Role == ROLE_Authority)
</span><a name="387"></a>	<span class="source_comment">///	DrawLocation,DrawRotation,DrawIndex,HitPointDebugByte,HitStart,HitEnd;
</span><a name="388"></a>}
<a name="389"></a>
<a name="390"></a><span class="source_comment">/*==========================================
<a name="391"></a>* Natives
<a name="392"></a>*=========================================*/</span>
<a name="393"></a>
<a name="394"></a>simulated native function <span class="source_type">int</span> Get8WayDirection();
<a name="395"></a>
<a name="396"></a>simulated event HandleWhizSound()
<a name="397"></a>{
<a name="398"></a> 	<span class="source_comment">// Don't play whizz sounds for bots, or from other players
</span><a name="399"></a>	if ( IsHumanControlled() && IsLocallyControlled() )
<a name="400"></a>	{
<a name="401"></a>		Spawn(<span class="source_type">class</span><span class="source_name">'ROBulletWhiz'</span>,,, mWhizSoundLocation);
<a name="402"></a>		<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).PlayerWhizzed(VSizeSquared(Location - mWhizSoundLocation));
<a name="403"></a>	}
<a name="404"></a>}
<a name="405"></a>
<a name="406"></a><span class="source_comment">// Blend the upper body back to full body animation.
</span><a name="407"></a><span class="source_comment">// Called by the native code when AnimBlendTime counts down to zero
</span><a name="408"></a>simulated event AnimBlendTimer()
<a name="409"></a>{
<a name="410"></a>	AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="411"></a>	WeaponState = GS_Ready;
<a name="412"></a>}
<a name="413"></a><span class="source_comment">/*==========================================
<a name="414"></a>* ROPawn functions
<a name="415"></a>*=========================================*/</span>
<a name="416"></a>
<a name="417"></a><span class="source_comment">// test execs
</span><a name="418"></a><span class="source_comment">/*
<a name="419"></a>exec function TestEye()
<a name="420"></a>{
<a name="421"></a>	local rotator myrot;
<a name="422"></a>    local Vector X,Y,Z;
<a name="423"></a>
<a name="424"></a>	if( !class'ROEngine.ROLevelInfo'.static.RODebugMode() )
<a name="425"></a>		return;
<a name="426"></a>
<a name="427"></a>
<a name="428"></a>    GetAxes( Controller.rotation, X, Y, Z );
<a name="429"></a>
<a name="430"></a>	myrot = Controller.rotation;
<a name="431"></a>
<a name="432"></a>    ClearStayingDebugLines();
<a name="433"></a>    DrawStayingDebugLine((EyePosition() + Location), (EyePosition() + Location)+500* X, 0,0,255);
<a name="434"></a>    DrawStayingDebugLine((EyePosition() + Location), (EyePosition() + Location)+200* Y, 0,255,0);
<a name="435"></a>}*/</span>
<a name="436"></a>
<a name="437"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="438"></a><span class="source_comment">// Empty
</span><a name="439"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="440"></a>
<a name="441"></a><span class="source_comment">//=============================================================
</span><a name="442"></a><span class="source_comment">// Initialization
</span><a name="443"></a><span class="source_comment">//=============================================================
</span><a name="444"></a>
<a name="445"></a><span class="source_comment">// Precache pawn related content
</span><a name="446"></a>static function StaticPrecache(<span class="source_type"><a href="../engine/levelinfo.html" class="source">LevelInfo</a></span> L)
<a name="447"></a>{
<a name="448"></a> 	default.ProjectileBloodSplatClass.static.PrecacheContent(L);
<a name="449"></a> 	default.SeveredArmAttachClass.static.PrecacheContent(L);
<a name="450"></a> 	default.SeveredLegAttachClass.static.PrecacheContent(L);
<a name="451"></a> 	default.SeveredHeadAttachClass.static.PrecacheContent(L);
<a name="452"></a> 	default.BleedingEmitterClass.static.PrecacheContent(L);
<a name="453"></a> 	<span class="source_comment">// TODO: Precache all the blood emitter's texture's when they are done
</span><a name="454"></a>}
<a name="455"></a>
<a name="456"></a><span class="source_comment">// Little Easter Egg here
</span><a name="457"></a>function PlayDyingSound()
<a name="458"></a>{
<a name="459"></a>    if( <span class="source_type">Level</span>.Netmode == NM_Client )
<a name="460"></a>    {
<a name="461"></a>        return;
<a name="462"></a>    }
<a name="463"></a>
<a name="464"></a>	if ( bGibbed )
<a name="465"></a>	{
<a name="466"></a>        <span class="source_comment">// Do nothing for now
</span><a name="467"></a>		<span class="source_comment">//PlaySound(GibGroupClass.static.GibSound(), SLOT_Pain,3.5*TransientSoundVolume,true,500);
</span><a name="468"></a>		return;
<a name="469"></a>	}
<a name="470"></a>
<a name="471"></a>    if ( HeadVolume.bWaterVolume )
<a name="472"></a>    {
<a name="473"></a>        PlaySound(GetSound(EST_Drown), SLOT_Pain,<span class="source_int">2.5</span>*TransientSoundVolume,true,<span class="source_int">500</span>);
<a name="474"></a>        return;
<a name="475"></a>    }
<a name="476"></a>
<a name="477"></a><span class="source_comment">//    if (FRand() &lt; 0.001)
</span><a name="478"></a><span class="source_comment">//    {
</span><a name="479"></a><span class="source_comment">//          PlaySound(sound'Miscsounds.DeanScream', SLOT_Pain,2.5*TransientSoundVolume, true,500);
</span><a name="480"></a><span class="source_comment">//    }
</span><a name="481"></a><span class="source_comment">//    else
</span><a name="482"></a><span class="source_comment">//    {
</span><a name="483"></a>		PlaySound(SoundGroupClass.static.GetDeathSound(LastHitIndex), SLOT_Pain,<span class="source_int">1.30</span>, true,<span class="source_int">525</span>);
<a name="484"></a><span class="source_comment">//    }
</span><a name="485"></a>}
<a name="486"></a>
<a name="487"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="488"></a><span class="source_comment">// PostBeginPlay
</span><a name="489"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="490"></a>
<a name="491"></a>simulated function PostBeginPlay()
<a name="492"></a>{
<a name="493"></a>	Super.PostBeginPlay();
<a name="494"></a>
<a name="495"></a>    <span class="source_comment">// From UnrealPawn
</span><a name="496"></a>	if ( <span class="source_type">Level</span>.bStartup && !bNoDefaultInventory )
<a name="497"></a>		AddDefaultInventory();
<a name="498"></a>
<a name="499"></a>    AssignInitialPose();
<a name="500"></a>
<a name="501"></a>    UpdateShadow();
<a name="502"></a>
<a name="503"></a>	<span class="source_comment">// end from UnrealPawn
</span><a name="504"></a>
<a name="505"></a>    SavedBreathSound = <span class="source_int">0</span>;
<a name="506"></a>
<a name="507"></a>	if (  AuxCollisionCylinder == none )
<a name="508"></a>	{
<a name="509"></a>		AuxCollisionCylinder = Spawn(<span class="source_type">class</span> <span class="source_name">'ROBulletWhipAttachment'</span>,self);
<a name="510"></a>		AttachToBone(AuxCollisionCylinder, <span class="source_name">'spine'</span>);
<a name="511"></a>	}
<a name="512"></a>	SavedAuxCollision = AuxCollisionCylinder.bCollideActors;
<a name="513"></a>
<a name="514"></a>	LastResupplyTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="515"></a>	bTouchingResupply=false;
<a name="516"></a>}
<a name="517"></a>
<a name="518"></a>simulated function UpdateShadow()
<a name="519"></a>{
<a name="520"></a>    if (bActorShadows && bPlayerShadows && (<span class="source_type">Level</span>.NetMode != NM_DedicatedServer))
<a name="521"></a>    {
<a name="522"></a>        if (PlayerShadow != none)
<a name="523"></a>            PlayerShadow.Destroy();
<a name="524"></a>
<a name="525"></a>        PlayerShadow = Spawn(<span class="source_type">class</span><span class="source_name">'ShadowProjector'</span>,Self,<span class="source_name">''</span>,Location);
<a name="526"></a>        PlayerShadow.ShadowActor = self;
<a name="527"></a>        PlayerShadow.bBlobShadow = bBlobShadow;
<a name="528"></a>        PlayerShadow.LightDirection = Normal(vect(<span class="source_int">1</span>,<span class="source_int">1</span>,<span class="source_int">3</span>));
<a name="529"></a>        PlayerShadow.LightDistance = <span class="source_int">320</span>;
<a name="530"></a>        PlayerShadow.MaxTraceDistance = <span class="source_int">350</span>;
<a name="531"></a>        PlayerShadow.InitShadow();
<a name="532"></a>    }
<a name="533"></a>    else if (PlayerShadow != none && <span class="source_type">Level</span>.NetMode != NM_DedicatedServer)
<a name="534"></a>    {
<a name="535"></a>        PlayerShadow.Destroy();
<a name="536"></a>        PlayerShadow = none;
<a name="537"></a>    }
<a name="538"></a>}
<a name="539"></a>
<a name="540"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="541"></a><span class="source_comment">// PostNetBeginPlay - Create dummy attachments on client
</span><a name="542"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="543"></a>
<a name="544"></a>simulated function PostNetBeginPlay()
<a name="545"></a>{
<a name="546"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="547"></a> 	local <span class="source_type"><a href="../unrealgame/squadai.html" class="source">SquadAI</a></span> <span class="source_type">S</span>;
<a name="548"></a>	local <span class="source_type"><a href="../unrealgame/rosterentry.html" class="source">RosterEntry</a></span> <span class="source_type">R</span>;
<a name="549"></a>
<a name="550"></a>	Super.PostNetBeginPlay();
<a name="551"></a>
<a name="552"></a>
<a name="553"></a>	<span class="source_comment">// From UnrealPawn
</span><a name="554"></a>	if ( (Role == ROLE_Authority) && <span class="source_type">Level</span>.bStartup )
<a name="555"></a>	{
<a name="556"></a>		if ( <span class="source_type"><a href="../unrealgame/unrealmpgameinfo.html" class="source">UnrealMPGameInfo</a></span>(<span class="source_type">Level</span>.Game) == None )
<a name="557"></a>		{
<a name="558"></a>			if ( <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None )
<a name="559"></a>			{
<a name="560"></a>				foreach DynamicActors(<span class="source_type">class</span><span class="source_name">'SquadAI'</span>,<span class="source_type">S</span>,SquadName)
<a name="561"></a>					break;
<a name="562"></a>				if ( <span class="source_type">S</span> == None )
<a name="563"></a>					<span class="source_type">S</span> = spawn(<span class="source_type">class</span><span class="source_name">'SquadAI'</span>);
<a name="564"></a>				<span class="source_type">S</span>.Tag = SquadName;
<a name="565"></a>				if ( bIsSquadLeader || (<span class="source_type">S</span>.SquadLeader == None) )
<a name="566"></a>					<span class="source_type">S</span>.SetLeader(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="567"></a>				<span class="source_type">S</span>.AddBot(<span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>));
<a name="568"></a>			}
<a name="569"></a>		}
<a name="570"></a>		else
<a name="571"></a>		{
<a name="572"></a>			<span class="source_type">R</span> = GetPlacedRoster();
<a name="573"></a>			<span class="source_type"><a href="../unrealgame/unrealmpgameinfo.html" class="source">UnrealMPGameInfo</a></span>(<span class="source_type">Level</span>.Game).InitPlacedBot(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>,<span class="source_type">R</span>);
<a name="574"></a>		}
<a name="575"></a>	}
<a name="576"></a>    <span class="source_comment">// End from UnrealPawn
</span><a name="577"></a>
<a name="578"></a>	<span class="source_comment">// MergeTODO: Maybe refactor this
</span><a name="579"></a>	if (Role &lt; ROLE_Authority)
<a name="580"></a>	{
<a name="581"></a>		if (HeadgearClass != None)
<a name="582"></a>			Headgear = Spawn(HeadgearClass, self);
<a name="583"></a>
<a name="584"></a>		for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; ArrayCount(AmmoPouchClasses); <span class="source_type">i</span>++)
<a name="585"></a>		{
<a name="586"></a>			if (AmmoPouchClasses[<span class="source_type">i</span>] == None)
<a name="587"></a>				break;
<a name="588"></a>
<a name="589"></a>			AmmoPouches[AmmoPouches.Length] = Spawn(AmmoPouchClasses[<span class="source_type">i</span>], self);
<a name="590"></a>		}
<a name="591"></a>	}
<a name="592"></a>}
<a name="593"></a>
<a name="594"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="595"></a><span class="source_comment">// PossessedBy - Figure out what dummy attachments are needed
</span><a name="596"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="597"></a>
<a name="598"></a>function PossessedBy(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> <span class="source_type">C</span>)
<a name="599"></a>{
<a name="600"></a>	local array&lt;<span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/roammopouch.html" class="source">ROAmmoPouch</a></span>&gt; &gt; AmmoClasses;
<a name="601"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>, Prim, Sec, Gren;
<a name="602"></a>
<a name="603"></a>	Super.PossessedBy(<span class="source_type">C</span>);
<a name="604"></a>
<a name="605"></a>	<span class="source_comment">// From XPawn
</span><a name="606"></a>	if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="607"></a>		OldController = <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="608"></a>
<a name="609"></a>	<span class="source_comment">// MergeTODO: Refactor this, I don't think this is the best place to spawn attachments
</span><a name="610"></a>
<a name="611"></a>	<span class="source_comment">// Handle dummy attachments
</span><a name="612"></a>	if (Role == ROLE_Authority)
<a name="613"></a>	{
<a name="614"></a>		ClientForceStaminaUpdate(Stamina);
<a name="615"></a>
<a name="616"></a>		if (<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None)
<a name="617"></a>		{
<a name="618"></a>			Prim = <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).PrimaryWeapon;
<a name="619"></a>			Sec = <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).SecondaryWeapon;
<a name="620"></a>			Gren = <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).GrenadeWeapon;
<a name="621"></a>		}
<a name="622"></a>		else if (<span class="source_type"><a href="../roengine/robot.html" class="source">ROBot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None)
<a name="623"></a>		{
<a name="624"></a>			Prim = <span class="source_type"><a href="../roengine/robot.html" class="source">ROBot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).PrimaryWeapon;
<a name="625"></a>			Sec = <span class="source_type"><a href="../roengine/robot.html" class="source">ROBot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).SecondaryWeapon;
<a name="626"></a>			Gren = <span class="source_type"><a href="../roengine/robot.html" class="source">ROBot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).GrenadeWeapon;
<a name="627"></a>		}
<a name="628"></a>
<a name="629"></a>		HeadgearClass = <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo.GetHeadgear();
<a name="630"></a>		<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo.GetAmmoPouches(AmmoClasses, Prim, Sec, Gren);
<a name="631"></a>
<a name="632"></a>		if( <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none &&
<a name="633"></a>			<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo != none )
<a name="634"></a>		{
<a name="635"></a>			DetachedArmClass = <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo.static.GetArmClass();
<a name="636"></a>			DetachedLegClass = <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo.static.GetLegClass();
<a name="637"></a>		}
<a name="638"></a>		else
<a name="639"></a>		{
<a name="640"></a>			log(<span class="source_string">"Error!!! Possess with no RoleInfo!!!"</span>);
<a name="641"></a>		}
<a name="642"></a>
<a name="643"></a>		for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; AmmoClasses.Length; <span class="source_type">i</span>++)
<a name="644"></a>			AmmoPouchClasses[<span class="source_type">i</span>] = AmmoClasses[<span class="source_type">i</span>];
<a name="645"></a>
<a name="646"></a>		<span class="source_comment">// These don't need to exist on dedicated servers at the moment, though they might if the ammo
</span><a name="647"></a>		<span class="source_comment">// holding functionality of the pouch is put in - Erik
</span><a name="648"></a>		if (<span class="source_type">Level</span>.NetMode != NM_DedicatedServer)
<a name="649"></a>		{
<a name="650"></a>			if (HeadgearClass != None)
<a name="651"></a>				Headgear = Spawn(HeadgearClass, self);
<a name="652"></a>
<a name="653"></a>			for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; ArrayCount(AmmoPouchClasses); <span class="source_type">i</span>++)
<a name="654"></a>			{
<a name="655"></a>				if (AmmoPouchClasses[<span class="source_type">i</span>] == None)
<a name="656"></a>					break;
<a name="657"></a>
<a name="658"></a>				AmmoPouches[AmmoPouches.Length] = Spawn(AmmoPouchClasses[<span class="source_type">i</span>], self);
<a name="659"></a>			}
<a name="660"></a>		}
<a name="661"></a>	}
<a name="662"></a>
<a name="663"></a>	<span class="source_comment">// Send the info to the client now to make sure RoleInfo is replicated quickly
</span><a name="664"></a>	NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="665"></a>}
<a name="666"></a>
<a name="667"></a><span class="source_comment">//=============================================================
</span><a name="668"></a><span class="source_comment">// Setters
</span><a name="669"></a><span class="source_comment">//=============================================================
</span><a name="670"></a>
<a name="671"></a><span class="source_comment">// Setters for extra collision cylinders
</span><a name="672"></a><span class="source_comment">// MergeTODO: Verify we even need these once we have the new native trace support
</span><a name="673"></a>simulated function ToggleAuxCollision(<span class="source_type">bool</span> newbCollision)
<a name="674"></a>{
<a name="675"></a>	if ( !newbCollision )
<a name="676"></a>	{
<a name="677"></a>		SavedAuxCollision = AuxCollisionCylinder.bCollideActors;
<a name="678"></a>
<a name="679"></a>		AuxCollisionCylinder.SetCollision(false);
<a name="680"></a>	}
<a name="681"></a>	else
<a name="682"></a>	{
<a name="683"></a>		AuxCollisionCylinder.SetCollision(SavedAuxCollision);
<a name="684"></a>	}
<a name="685"></a>}
<a name="686"></a>
<a name="687"></a><span class="source_comment">// Set the player to limping for a time
</span><a name="688"></a>function SetLimping(<span class="source_type">float</span> Duration)
<a name="689"></a>{
<a name="690"></a>	bIsLimping = true;
<a name="691"></a>	LimpTime = Duration;
<a name="692"></a>}
<a name="693"></a>
<a name="694"></a><span class="source_comment">// Handle changing Stamina Based breathing sounds - Ramm
</span><a name="695"></a>function SetBreathingSound(<span class="source_type">byte</span> NewSound)
<a name="696"></a>{
<a name="697"></a>	if (NewSound == <span class="source_int">1</span>)
<a name="698"></a>	{
<a name="699"></a>		if (<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> != BreatheExhaustedSound)
<a name="700"></a>			<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = BreatheExhaustedSound;
<a name="701"></a>	}
<a name="702"></a>	else if (NewSound == <span class="source_int">2</span>)
<a name="703"></a>	{
<a name="704"></a>		if (<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> != BreatheHeavySound)
<a name="705"></a>			<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = BreatheHeavySound;
<a name="706"></a>	}
<a name="707"></a>	else if (NewSound == <span class="source_int">3</span>)
<a name="708"></a>	{
<a name="709"></a>		if (<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> != BreatheHeavySound)
<a name="710"></a>			<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = BreatheMediumSound;
<a name="711"></a>	}
<a name="712"></a>	else if (NewSound == <span class="source_int">4</span>)
<a name="713"></a>	{
<a name="714"></a>		<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = BreatheLightSound;
<a name="715"></a>	}
<a name="716"></a>	else if (NewSound == <span class="source_int">5</span> )
<a name="717"></a>	{
<a name="718"></a>		if (<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> != None)
<a name="719"></a>		{
<a name="720"></a>			<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = None;
<a name="721"></a>		}
<a name="722"></a>	}
<a name="723"></a>
<a name="724"></a>	SavedBreathSound = NewSound;
<a name="725"></a>}
<a name="726"></a>
<a name="727"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="728"></a><span class="source_comment">// SetSprinting - Enables and disables sprinting
</span><a name="729"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="730"></a>function SetSprinting(<span class="source_type">bool</span> bNewIsSprinting)
<a name="731"></a>{
<a name="732"></a>	if (bNewIsSprinting != (bIsSprinting || bOldSprinting) )
<a name="733"></a>	{
<a name="734"></a>		if( bNewIsSprinting && (!AllowSprint() || !bCanStartSprint) )
<a name="735"></a>		{
<a name="736"></a>			return;
<a name="737"></a>		}
<a name="738"></a>
<a name="739"></a>		bIsSprinting = bNewIsSprinting;
<a name="740"></a>
<a name="741"></a>		SetWalking(false);
<a name="742"></a>
<a name="743"></a>		if (bIsSprinting)
<a name="744"></a>		{
<a name="745"></a>			StartSprint();
<a name="746"></a>		}
<a name="747"></a>		else
<a name="748"></a>		{
<a name="749"></a>			EndSprint();
<a name="750"></a>		}
<a name="751"></a>
<a name="752"></a>        bOldSprinting = bIsSprinting;
<a name="753"></a>	}
<a name="754"></a>}
<a name="755"></a>
<a name="756"></a>function SetWalking(<span class="source_type">bool</span> bNewIsWalking)
<a name="757"></a>{
<a name="758"></a>	if (bNewIsWalking != bIsWalking)
<a name="759"></a>	{
<a name="760"></a>		bIsWalking = bNewIsWalking;
<a name="761"></a>	}
<a name="762"></a>}
<a name="763"></a>
<a name="764"></a><span class="source_comment">//=============================================================
</span><a name="765"></a><span class="source_comment">// Drawing
</span><a name="766"></a><span class="source_comment">//=============================================================
</span><a name="767"></a>
<a name="768"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="769"></a><span class="source_comment">// CalcDrawOffset - Overriden to prevent the player from disabling bobbing
</span><a name="770"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="771"></a>simulated function <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> CalcDrawOffset(<span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span> Inv)
<a name="772"></a>{
<a name="773"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> DrawOffset;
<a name="774"></a>
<a name="775"></a>	if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == None )
<a name="776"></a>		return (Inv.PlayerViewOffset &gt;&gt; <span class="source_type">Rotation</span>) + BaseEyeHeight * vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>);
<a name="777"></a>
<a name="778"></a>	DrawOffset = ((<span class="source_int">0.9</span>/<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.DisplayFOV * <span class="source_int">100</span> * ModifiedPlayerViewOffset(Inv)) &gt;&gt; GetViewRotation() );
<a name="779"></a>	if ( !IsLocallyControlled() )
<a name="780"></a>		DrawOffset.<span class="source_type">Z</span> += BaseEyeHeight;
<a name="781"></a>	else
<a name="782"></a>	{
<a name="783"></a>		<span class="source_comment">// Added these for proneing and leaning
</span><a name="784"></a>		DrawOffset.<span class="source_type">Z</span> += EyePosition().<span class="source_type">Z</span>;
<a name="785"></a>		DrawOffset.<span class="source_type">X</span> += EyePosition().<span class="source_type">X</span>;
<a name="786"></a>		DrawOffset.<span class="source_type">Y</span> += EyePosition().<span class="source_type">Y</span>;
<a name="787"></a>
<a name="788"></a>	    DrawOffset += WeaponBob(Inv.BobDamping);
<a name="789"></a>        DrawOffset += CameraShake();
<a name="790"></a>	}
<a name="791"></a>	return DrawOffset;
<a name="792"></a>}
<a name="793"></a>
<a name="794"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="795"></a><span class="source_comment">// CheckBob - Overriden to prevent the player from disabling bobbing and
</span><a name="796"></a><span class="source_comment">// to handle playing footstep sounds in other movement states
</span><a name="797"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="798"></a>function CheckBob(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Y</span>)
<a name="799"></a>{
<a name="800"></a>	local <span class="source_type">float</span> Speed2D;
<a name="801"></a>	local <span class="source_type">float</span> OldBobTime;
<a name="802"></a>	local <span class="source_type">int</span> <span class="source_type">m</span>,<span class="source_type">n</span>;
<a name="803"></a>	local <span class="source_type">float</span> BobModifier;
<a name="804"></a>
<a name="805"></a>
<a name="806"></a>	OldBobTime = BobTime;
<a name="807"></a>
<a name="808"></a>	Bob = FClamp(Bob, -<span class="source_int">0.01</span>, <span class="source_int">0.01</span>);
<a name="809"></a>    BobModifier = <span class="source_int">1.0</span>;
<a name="810"></a>
<a name="811"></a>	<span class="source_comment">// Modify the amount of bob based on the movement state
</span><a name="812"></a>	if( bIsSprinting )
<a name="813"></a>	{
<a name="814"></a>		BobModifier = <span class="source_int">1.75</span>;
<a name="815"></a>	}
<a name="816"></a>	else if( bIsCrawling && !bIronSights)
<a name="817"></a>	{
<a name="818"></a>		BobModifier = <span class="source_int">2.5</span>;
<a name="819"></a>	}
<a name="820"></a>	else if( bIsCrouched )
<a name="821"></a>	{
<a name="822"></a>		BobModifier = <span class="source_int">2.5</span>;
<a name="823"></a>	}
<a name="824"></a>
<a name="825"></a>	if (Physics == PHYS_Walking )
<a name="826"></a>	{
<a name="827"></a>		Speed2D = VSize(Velocity);
<a name="828"></a>
<a name="829"></a>		if( bIsCrawling && !bIronSights )
<a name="830"></a>		{
<a name="831"></a>			BobTime += <span class="source_type">DeltaTime</span> * ((<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/(GroundSpeed*PronePct))/<span class="source_int">2</span>);
<a name="832"></a>		}
<a name="833"></a>		else if( bIsSprinting )
<a name="834"></a>		{
<a name="835"></a>			if ( Speed2D &lt; <span class="source_int">10</span> )
<a name="836"></a>				BobTime += <span class="source_int">0.2</span> * <span class="source_type">DeltaTime</span>;
<a name="837"></a>			else
<a name="838"></a>			{
<a name="839"></a>				if ( bIsCrouched )
<a name="840"></a>				{
<a name="841"></a>					BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/((GroundSpeed*CrouchedSprintPct)/<span class="source_int">1.25</span>));
<a name="842"></a>				}
<a name="843"></a>				else
<a name="844"></a>				{
<a name="845"></a>					BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/((GroundSpeed*SprintPct)/<span class="source_int">1.25</span>));
<a name="846"></a>				}
<a name="847"></a>			}
<a name="848"></a>		}
<a name="849"></a>		else
<a name="850"></a>		{
<a name="851"></a>			if ( Speed2D &lt; <span class="source_int">10</span> )
<a name="852"></a>				BobTime += <span class="source_int">0.2</span> * <span class="source_type">DeltaTime</span>;
<a name="853"></a>			else
<a name="854"></a>				BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/GroundSpeed);
<a name="855"></a>		}
<a name="856"></a>		WalkBob = <span class="source_type">Y</span> * (Bob * BobModifier) * Speed2D * sin(<span class="source_int">8</span> * BobTime);
<a name="857"></a>		AppliedBob = AppliedBob * (<span class="source_int">1</span> - FMin(<span class="source_int">1</span>, <span class="source_int">16</span> * <span class="source_type">deltatime</span>));
<a name="858"></a>		WalkBob.<span class="source_type">Z</span> = AppliedBob;
<a name="859"></a>		if ( Speed2D &gt; <span class="source_int">10</span> )
<a name="860"></a>			WalkBob.<span class="source_type">Z</span> = WalkBob.<span class="source_type">Z</span> + <span class="source_int">0.75</span> * (Bob * BobModifier) * Speed2D * sin(<span class="source_int">16</span> * BobTime);
<a name="861"></a>		if ( LandBob &gt; <span class="source_int">0.01</span> )
<a name="862"></a>		{
<a name="863"></a>			AppliedBob += FMin(<span class="source_int">1</span>, <span class="source_int">16</span> * <span class="source_type">deltatime</span>) * LandBob;
<a name="864"></a>			LandBob *= (<span class="source_int">1</span> - <span class="source_int">8</span>*<span class="source_type">Deltatime</span>);
<a name="865"></a>		}
<a name="866"></a>	}
<a name="867"></a>	else if ( Physics == PHYS_Swimming )
<a name="868"></a>	{
<a name="869"></a>		Speed2D = Sqrt(Velocity.<span class="source_type">X</span> * Velocity.<span class="source_type">X</span> + Velocity.<span class="source_type">Y</span> * Velocity.<span class="source_type">Y</span>);
<a name="870"></a>		WalkBob = <span class="source_type">Y</span> * Bob *  <span class="source_int">0.5</span> * Speed2D * sin(<span class="source_int">4.0</span> * <span class="source_type">Level</span>.TimeSeconds);
<a name="871"></a>		WalkBob.<span class="source_type">Z</span> = Bob * <span class="source_int">1.5</span> * Speed2D * sin(<span class="source_int">8.0</span> * <span class="source_type">Level</span>.TimeSeconds);
<a name="872"></a>	}
<a name="873"></a>	else
<a name="874"></a>	{
<a name="875"></a>		BobTime = <span class="source_int">0</span>;
<a name="876"></a>		WalkBob = WalkBob * (<span class="source_int">1</span> - FMin(<span class="source_int">1</span>, <span class="source_int">8</span> * <span class="source_type">deltatime</span>));
<a name="877"></a>	}
<a name="878"></a>
<a name="879"></a>	if ( (Physics != PHYS_Walking) || (VSize(Velocity) &lt; <span class="source_int">10</span>)
<a name="880"></a>		|| ((<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None) && <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bBehindView) )
<a name="881"></a>		return;
<a name="882"></a>
<a name="883"></a>	<span class="source_type">m</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * OldBobTime/Pi);
<a name="884"></a>	<span class="source_type">n</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * BobTime/Pi);
<a name="885"></a>
<a name="886"></a>	if ( (<span class="source_type">m</span> != <span class="source_type">n</span>) && !bIsCrawling)
<a name="887"></a>		FootStepping(<span class="source_int">0</span>);
<a name="888"></a>}
<a name="889"></a>
<a name="890"></a><span class="source_comment">// Footstep sound checking for non local player or non player bots
</span><a name="891"></a><span class="source_comment">// This function is only called on non owned network clients or bots
</span><a name="892"></a>simulated function CheckFootSteps(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="893"></a>{
<a name="894"></a>	local <span class="source_type">float</span> Speed2D;
<a name="895"></a>	local <span class="source_type">float</span> OldBobTime;
<a name="896"></a>	local <span class="source_type">int</span> <span class="source_type">m</span>,<span class="source_type">n</span>;
<a name="897"></a>
<a name="898"></a>	OldBobTime = BobTime;
<a name="899"></a>
<a name="900"></a>	if (Physics == PHYS_Walking )
<a name="901"></a>	{
<a name="902"></a>		Speed2D = VSize(Velocity);
<a name="903"></a>
<a name="904"></a>		if( bIsCrawling && !bIronSights )
<a name="905"></a>		{
<a name="906"></a>			BobTime += <span class="source_type">DeltaTime</span> * ((<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/(GroundSpeed*PronePct))/<span class="source_int">2</span>);
<a name="907"></a>		}
<a name="908"></a>		else if( bIsSprinting )
<a name="909"></a>		{
<a name="910"></a>			if ( Speed2D &lt; <span class="source_int">10</span> )
<a name="911"></a>				BobTime += <span class="source_int">0.2</span> * <span class="source_type">DeltaTime</span>;
<a name="912"></a>			else
<a name="913"></a>			{
<a name="914"></a>				if ( bIsCrouched )
<a name="915"></a>				{
<a name="916"></a>					BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/((GroundSpeed*CrouchedSprintPct)/<span class="source_int">1.25</span>));
<a name="917"></a>				}
<a name="918"></a>				else
<a name="919"></a>				{
<a name="920"></a>					BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/((GroundSpeed*SprintPct)/<span class="source_int">1.25</span>));
<a name="921"></a>				}
<a name="922"></a>			}
<a name="923"></a>		}
<a name="924"></a>		else
<a name="925"></a>		{
<a name="926"></a>			if ( Speed2D &lt; <span class="source_int">10</span> )
<a name="927"></a>				BobTime += <span class="source_int">0.2</span> * <span class="source_type">DeltaTime</span>;
<a name="928"></a>			else
<a name="929"></a>				BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/GroundSpeed);
<a name="930"></a>		}
<a name="931"></a>	}
<a name="932"></a>	else
<a name="933"></a>	{
<a name="934"></a>		BobTime = <span class="source_int">0</span>;
<a name="935"></a>	}
<a name="936"></a>
<a name="937"></a>	if ( (Physics != PHYS_Walking) || (VSize(Velocity) &lt; <span class="source_int">10</span>) )
<a name="938"></a>		return;
<a name="939"></a>
<a name="940"></a>	<span class="source_type">m</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * OldBobTime/Pi);
<a name="941"></a>	<span class="source_type">n</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * BobTime/Pi);
<a name="942"></a>
<a name="943"></a>	if ( (<span class="source_type">m</span> != <span class="source_type">n</span>) && !bIsCrawling)
<a name="944"></a>		FootStepping(<span class="source_int">0</span>);
<a name="945"></a>}
<a name="946"></a>
<a name="947"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="948"></a><span class="source_comment">// DisplayDebug - Used to display important debugging info on the hud
</span><a name="949"></a><span class="source_comment">// - with bullet debugging and functionality from unrealpawn
</span><a name="950"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="951"></a>simulated function DisplayDebug(<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span> <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>, out <span class="source_type">float</span> <span class="source_type">YL</span>, out <span class="source_type">float</span> YPos)
<a name="952"></a>{
<a name="953"></a>	local <span class="source_type">string</span> <span class="source_type">T</span>;
<a name="954"></a>	local <span class="source_type">float</span> XL;
<a name="955"></a>
<a name="956"></a>	local <span class="source_type">int</span>	<span class="source_type">i</span>;
<a name="957"></a>	local <span class="source_type">name</span>  <span class="source_type">Sequence</span>;
<a name="958"></a>	local <span class="source_type">float</span> Frame, Rate;
<a name="959"></a>
<a name="960"></a>
<a name="961"></a>
<a name="962"></a>	<span class="source_comment">// From Unrealpawn
</span><a name="963"></a>	<span class="source_comment">/*
<a name="964"></a>	if ( !bSoakDebug )
<a name="965"></a>	{
<a name="966"></a>		Super.DisplayDebug(Canvas, YL, YPos);
<a name="967"></a>		return;
<a name="968"></a>	}*/</span>
<a name="969"></a>
<a name="970"></a>	Super.DisplayDebug(<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>, <span class="source_type">YL</span>, YPos);
<a name="971"></a>
<a name="972"></a>    if ( bSoakDebug )
<a name="973"></a>	{
<a name="974"></a>
<a name="975"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.Style = <span class="source_type"><a href="../engine/actor.html#ERenderStyle" class="source">ERenderStyle</a></span>.STY_Normal;
<a name="976"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.StrLen(<span class="source_string">"TEST"</span>, XL, <span class="source_type">YL</span>);
<a name="977"></a>		YPos = YPos + <span class="source_int">8</span>*<span class="source_type">YL</span>;
<a name="978"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="979"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetDrawColor(<span class="source_int">255</span>,<span class="source_int">255</span>,<span class="source_int">0</span>);
<a name="980"></a>		<span class="source_type">T</span> = GetDebugName();
<a name="981"></a>		if ( bDeleteMe )
<a name="982"></a>			<span class="source_type">T</span> = <span class="source_type">T</span>$<span class="source_string">" DELETED (bDeleteMe == true)"</span>;
<a name="983"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_type">T</span>, false);
<a name="984"></a>		YPos += <span class="source_int">3</span> * <span class="source_type">YL</span>;
<a name="985"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="986"></a>
<a name="987"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == None )
<a name="988"></a>		{
<a name="989"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetDrawColor(<span class="source_int">255</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="990"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"NO CONTROLLER"</span>);
<a name="991"></a>			YPos += <span class="source_type">YL</span>;
<a name="992"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="993"></a>		}
<a name="994"></a>		else
<a name="995"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.DisplayDebug(<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>,<span class="source_type">YL</span>,YPos);
<a name="996"></a>
<a name="997"></a>		YPos += <span class="source_int">2</span>*<span class="source_type">YL</span>;
<a name="998"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="999"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetDrawColor(<span class="source_int">0</span>,<span class="source_int">255</span>,<span class="source_int">255</span>);
<a name="1000"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"Anchor "</span>$Anchor$<span class="source_string">" Serpentine Dist "</span>$SerpentineDist$<span class="source_string">" Time "</span>$SerpentineTime);
<a name="1001"></a>		YPos += <span class="source_type">YL</span>;
<a name="1002"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="1003"></a>
<a name="1004"></a>		<span class="source_type">T</span> = <span class="source_string">"Floor "</span>$Floor$<span class="source_string">" DesiredSpeed "</span>$DesiredSpeed$<span class="source_string">" Crouched "</span>$bIsCrouched$<span class="source_string">" Try to uncrouch "</span>$UncrouchTime;
<a name="1005"></a>		if ( (OnLadder != None) || (Physics == PHYS_Ladder) )
<a name="1006"></a>			<span class="source_type">T</span>=<span class="source_type">T</span>$<span class="source_string">" on ladder "</span>$OnLadder;
<a name="1007"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_type">T</span>);
<a name="1008"></a>		YPos += <span class="source_type">YL</span>;
<a name="1009"></a>		<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="1010"></a>		<span class="source_comment">// End from Unrealpawn
</span><a name="1011"></a>	}
<a name="1012"></a>
<a name="1013"></a>	<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetDrawColor(<span class="source_int">255</span>,<span class="source_int">255</span>,<span class="source_int">255</span>);
<a name="1014"></a>
<a name="1015"></a>    <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"ROWeapon state is "</span> $GetEnum( enum<span class="source_name">'EWeaponState'</span>, WeaponState));
<a name="1016"></a>    YPos += <span class="source_type">YL</span>;
<a name="1017"></a>    <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="1018"></a>
<a name="1019"></a>	<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"Stamina:"</span>@Stamina);
<a name="1020"></a>	YPos += <span class="source_type">YL</span>;
<a name="1021"></a>	<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="1022"></a>
<a name="1023"></a>	for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; <span class="source_int">16</span>; <span class="source_type">i</span>++ )
<a name="1024"></a>	{
<a name="1025"></a>		if( IsAnimating( <span class="source_type">i</span> ) )
<a name="1026"></a>		{
<a name="1027"></a>			GetAnimParams( <span class="source_type">i</span>, <span class="source_type">Sequence</span>, Frame, Rate );
<a name="1028"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"Anim:: Channel("</span>@<span class="source_type">i</span>@<span class="source_string">") Frame("</span>@Frame@<span class="source_string">") Rate("</span>@Rate@<span class="source_string">") Name("</span>@<span class="source_type">Sequence</span>@<span class="source_string">")"</span>);
<a name="1029"></a>			YPos += <span class="source_type">YL</span>;
<a name="1030"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="1031"></a>		}
<a name="1032"></a>	}
<a name="1033"></a>
<a name="1034"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1035"></a>	{
<a name="1036"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.GetAnimParams( <span class="source_int">0</span>, <span class="source_type">Sequence</span>, Frame, Rate );
<a name="1037"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"WeaponAttachment Anim: Frame("</span>@Frame@<span class="source_string">") Rate("</span>@Rate@<span class="source_string">") Name("</span>@<span class="source_type">Sequence</span>@<span class="source_string">")"</span>);
<a name="1038"></a>			YPos += <span class="source_type">YL</span>;
<a name="1039"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="1040"></a>	}
<a name="1041"></a>
<a name="1042"></a>	if (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None)
<a name="1043"></a>	{
<a name="1044"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.GetAnimParams( <span class="source_int">0</span>, <span class="source_type">Sequence</span>, Frame, Rate );
<a name="1045"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"Weapon Anim: Frame("</span>@Frame@<span class="source_string">") Rate("</span>@Rate@<span class="source_string">") Name("</span>@<span class="source_type">Sequence</span>@<span class="source_string">")"</span>);
<a name="1046"></a>			YPos += <span class="source_type">YL</span>;
<a name="1047"></a>			<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="1048"></a>	}
<a name="1049"></a>
<a name="1050"></a><span class="source_comment">//	Canvas.DrawText("CanBipodDeploy: "@bCanBipodDeploy$" BipodDeployed: "@bBipodDeployed);
</span><a name="1051"></a><span class="source_comment">//	YPos += YL;
</span><a name="1052"></a><span class="source_comment">//	Canvas.SetPos(4,YPos);
</span><a name="1053"></a>
<a name="1054"></a><span class="source_comment">//	Canvas.DrawText("BaseEyeHeight: "$default.BaseEyeHeight$"DeployedEyeHeight: "@DeployedEyeHeight$" ProneEyeHeight: "@ProneEyeHeight$" CrouchEyeHeight: "$(CrouchEyeHeightMod * CrouchHeight)$" CrouchMoveEyeHeight "$(CrouchMoveEyeHeightMod * CrouchHeight));
</span><a name="1055"></a><span class="source_comment">//	YPos += YL;
</span><a name="1056"></a><span class="source_comment">//	Canvas.SetPos(4,YPos);
</span><a name="1057"></a>
<a name="1058"></a>
<a name="1059"></a>
<a name="1060"></a><span class="source_comment">/*	Canvas.DrawText("PrePivot:"@PrePivot);
<a name="1061"></a>	YPos += YL;
<a name="1062"></a>	Canvas.SetPos(4,YPos); */</span>
<a name="1063"></a>
<a name="1064"></a><span class="source_comment">/*	Canvas.DrawText("maxyaw is "@maxyaw@" minyaw is "@minyaw);
<a name="1065"></a>	YPos += YL;
<a name="1066"></a>	Canvas.SetPos(4,YPos);
<a name="1067"></a>
<a name="1068"></a>	Canvas.DrawText("bUsedCarriedMGAmmo is "@bUsedCarriedMGAmmo);
<a name="1069"></a>	YPos += YL;
<a name="1070"></a>	Canvas.SetPos(4,YPos);
<a name="1071"></a>
<a name="1072"></a>
<a name="1073"></a>	Canvas.DrawText("debugPitchUpLimit is "@debugPitchUpLimit@" debugPitchDownLimit is "@debugPitchDownLimit);
<a name="1074"></a>	YPos += YL;
<a name="1075"></a>	Canvas.SetPos(4,YPos);*/</span>
<a name="1076"></a>}
<a name="1077"></a>
<a name="1078"></a><span class="source_comment">//=============================================================
</span><a name="1079"></a><span class="source_comment">// Animation
</span><a name="1080"></a><span class="source_comment">//=============================================================
</span><a name="1081"></a>
<a name="1082"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1083"></a><span class="source_comment">// SetIronSightAnims - Sets the proper player animations for aiming and non-aiming
</span><a name="1084"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1085"></a>function SetIronSightAnims(<span class="source_type">bool</span> bNewIronSights)
<a name="1086"></a>{
<a name="1087"></a>	bIronSights = bNewIronSights;
<a name="1088"></a>}
<a name="1089"></a>
<a name="1090"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1091"></a><span class="source_comment">// SetMeleeHoldAnims - Sets the proper player animations melee attacks
</span><a name="1092"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1093"></a>function SetMeleeHoldAnims(<span class="source_type">bool</span> bNewMeleeHold)
<a name="1094"></a>{
<a name="1095"></a>	bMeleeHolding = bNewMeleeHold;
<a name="1096"></a>}
<a name="1097"></a>
<a name="1098"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1099"></a><span class="source_comment">// SetMeleeHoldAnims - Sets the proper player animations prepping to fire an explosive weapon
</span><a name="1100"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1101"></a>function SetExplosiveHoldAnims(<span class="source_type">bool</span> bNewExplosiveHold)
<a name="1102"></a>{
<a name="1103"></a>	bExplosiveHolding = bNewExplosiveHold;
<a name="1104"></a>}
<a name="1105"></a>
<a name="1106"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1107"></a><span class="source_comment">// SetIronSightAnims - Sets the proper player animations for aiming and non-aiming
</span><a name="1108"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1109"></a>function SetBipodDeployed(<span class="source_type">bool</span> bNewDeployed)
<a name="1110"></a>{
<a name="1111"></a>	if( !bNewDeployed && bBipodDeployed )
<a name="1112"></a>	{
<a name="1113"></a>	 	bBipodDeployed = false;
<a name="1114"></a>	 	InitialDeployedRotation = rot(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="1115"></a>
<a name="1116"></a>	 	if( bIsCrawling )
<a name="1117"></a>	 	{
<a name="1118"></a>		 	BaseEyeHeight = ProneEyeHeight;
<a name="1119"></a>		}
<a name="1120"></a>		else if ( bIsCrouched )
<a name="1121"></a>		{
<a name="1122"></a>  			BaseEyeHeight = CrouchEyeHeightMod * CrouchHeight;
<a name="1123"></a>		}
<a name="1124"></a>		else
<a name="1125"></a>		{
<a name="1126"></a>			BaseEyeHeight = default.BaseEyeHeight;
<a name="1127"></a>		}
<a name="1128"></a>
<a name="1129"></a>	 	if( Role == ROLE_Authority )
<a name="1130"></a>	 	{
<a name="1131"></a>	 		SetAnimAction(<span class="source_name">'DoBipodUnDeploy'</span>);
<a name="1132"></a>	 	}
<a name="1133"></a>	}
<a name="1134"></a>	else if( bNewDeployed )
<a name="1135"></a>	{
<a name="1136"></a>		bBipodDeployed = true;
<a name="1137"></a>		InitialDeployedRotation.Pitch = <span class="source_type">Rotation</span>.Pitch & <span class="source_int">65535</span>;
<a name="1138"></a>		InitialDeployedRotation.Yaw = <span class="source_type">Rotation</span>.Yaw;
<a name="1139"></a>
<a name="1140"></a>		if ( !bIsCrouched && !bIsCrawling && DeployedEyeHeight &lt; <span class="source_int">30</span> )
<a name="1141"></a>		{
<a name="1142"></a>			BaseEyeHeight = DeployedEyeHeight + <span class="source_int">10</span>;
<a name="1143"></a>			<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).Crouch();
<a name="1144"></a>		}
<a name="1145"></a>		else if ( !bIsCrawling )
<a name="1146"></a>		{
<a name="1147"></a>        	BaseEyeHeight = DeployedEyeHeight;
<a name="1148"></a>        }
<a name="1149"></a>
<a name="1150"></a>	 	if( Role == ROLE_Authority )
<a name="1151"></a>	 	{
<a name="1152"></a>	 		SetAnimAction(<span class="source_name">'DoBipodDeploy'</span>);
<a name="1153"></a>	 	}
<a name="1154"></a>	}
<a name="1155"></a>}
<a name="1156"></a>
<a name="1157"></a>
<a name="1158"></a><span class="source_comment">// Returns true if TestAnim is an animation for
</span><a name="1159"></a><span class="source_comment">// drawing a weapon
</span><a name="1160"></a>simulated function <span class="source_type">bool</span> IsDrawAnim(<span class="source_type">name</span> TestAnim)
<a name="1161"></a>{
<a name="1162"></a>	<span class="source_type">switch</span>( TestAnim )
<a name="1163"></a>    {
<a name="1164"></a>        case <span class="source_name">'stand_draw_kar'</span>:
<a name="1165"></a>        case <span class="source_name">'stand_draw_nade'</span>:
<a name="1166"></a>        case <span class="source_name">'stand_nadefromrifle'</span>:
<a name="1167"></a>        case <span class="source_name">'stand_riflefromnade'</span>:
<a name="1168"></a>        case <span class="source_name">'stand_pistolfromrifle'</span>:
<a name="1169"></a>        case <span class="source_name">'stand_riflefrompistol'</span>:
<a name="1170"></a>        case <span class="source_name">'stand_nadefrompistol'</span>:
<a name="1171"></a>        case <span class="source_name">'stand_pistolfromnade'</span>:
<a name="1172"></a>        case <span class="source_name">'prone_draw_kar'</span>:
<a name="1173"></a>        case <span class="source_name">'prone_draw_nade'</span>:
<a name="1174"></a>        case <span class="source_name">'prone_nadefromrifle'</span>:
<a name="1175"></a>        case <span class="source_name">'prone_riflefromnade'</span>:
<a name="1176"></a>        case <span class="source_name">'prone_pistolfromrifle'</span>:
<a name="1177"></a>        case <span class="source_name">'prone_riflefrompistol'</span>:
<a name="1178"></a>        case <span class="source_name">'prone_nadefrompistol'</span>:
<a name="1179"></a>        case <span class="source_name">'prone_pistolfromnade'</span>:
<a name="1180"></a>			return true;
<a name="1181"></a>            break;
<a name="1182"></a>    }
<a name="1183"></a>
<a name="1184"></a>    return false;
<a name="1185"></a>}
<a name="1186"></a>
<a name="1187"></a><span class="source_comment">// Returns true if TestAnim is an animation for
</span><a name="1188"></a><span class="source_comment">// putting away a weapon
</span><a name="1189"></a>simulated function <span class="source_type">bool</span> IsPutAwayAnim(<span class="source_type">name</span> TestAnim)
<a name="1190"></a>{
<a name="1191"></a>	<span class="source_type">switch</span>( TestAnim )
<a name="1192"></a>    {
<a name="1193"></a>        case <span class="source_name">'stand_putaway_kar'</span>:
<a name="1194"></a>        case <span class="source_name">'stand_putaway_nade'</span>:
<a name="1195"></a>        case <span class="source_name">'stand_putaway_pistol'</span>:
<a name="1196"></a>        case <span class="source_name">'prone_putaway_kar'</span>:
<a name="1197"></a>        case <span class="source_name">'prone_putaway_nade'</span>:
<a name="1198"></a>        case <span class="source_name">'prone_putaway_pistol'</span>:
<a name="1199"></a>			return true;
<a name="1200"></a>            break;
<a name="1201"></a>    }
<a name="1202"></a>
<a name="1203"></a>    return false;
<a name="1204"></a>}
<a name="1205"></a>
<a name="1206"></a><span class="source_comment">// This function plays an upper body anim that will blend back to full body
</span><a name="1207"></a><span class="source_comment">// after the animation finishes. Must set the paramaters with an AnimBlendParams()
</span><a name="1208"></a><span class="source_comment">// call before calling this function
</span><a name="1209"></a>simulated function PlayUpperBodyAnim( <span class="source_type">name</span> <span class="source_type">NewAnim</span>, optional <span class="source_type">float</span> InRate, optional <span class="source_type">float</span> TweenTime, optional <span class="source_type">float</span> <span class="source_type">InBlendTime</span> )
<a name="1210"></a>{
<a name="1211"></a>	local <span class="source_type">float</span> Rate;
<a name="1212"></a>	local <span class="source_type">float</span> BlendTime;
<a name="1213"></a>
<a name="1214"></a>	if ( InRate == <span class="source_int">0</span> )
<a name="1215"></a>	{
<a name="1216"></a>		Rate = <span class="source_int">1.0</span>;
<a name="1217"></a>	}
<a name="1218"></a>	else
<a name="1219"></a>	{
<a name="1220"></a>		Rate = InRate;
<a name="1221"></a>	}
<a name="1222"></a>
<a name="1223"></a>	if ( <span class="source_type">InBlendTime</span> == <span class="source_int">0</span> )
<a name="1224"></a>	{
<a name="1225"></a>		BlendTime = GetAnimDuration(<span class="source_type">NewAnim</span>, Rate) + TweenTime;
<a name="1226"></a>	}
<a name="1227"></a>	else
<a name="1228"></a>	{
<a name="1229"></a>		BlendTime = <span class="source_type">InBlendTime</span>;
<a name="1230"></a>	}
<a name="1231"></a>
<a name="1232"></a>    PlayAnim(<span class="source_type">NewAnim</span>,Rate, TweenTime, <span class="source_int">1</span>);
<a name="1233"></a>    AnimBlendTime = BlendTime;
<a name="1234"></a>}
<a name="1235"></a>
<a name="1236"></a><span class="source_comment">// Get the alernate animaction name for a given animaction
</span><a name="1237"></a>simulated function <span class="source_type">name</span> GetAltName(<span class="source_type">name</span> TestName)
<a name="1238"></a>{
<a name="1239"></a>	<span class="source_type">switch</span>( TestName )
<a name="1240"></a>    {
<a name="1241"></a>        case <span class="source_name">'DoStandardReload'</span>:
<a name="1242"></a>        	return <span class="source_name">'DoStandardReloadA'</span>;
<a name="1243"></a>        	break;
<a name="1244"></a>        case <span class="source_name">'DoBoltAction'</span>:
<a name="1245"></a>        	return <span class="source_name">'DoBoltActionA'</span>;
<a name="1246"></a>        	break;
<a name="1247"></a>    }
<a name="1248"></a>
<a name="1249"></a>    return GetAnimActionName(TestName);
<a name="1250"></a>}
<a name="1251"></a>
<a name="1252"></a><span class="source_comment">// Get the standard animaction name for a given alternate animaction
</span><a name="1253"></a>simulated function <span class="source_type">name</span> GetAnimActionName(<span class="source_type">name</span> TestName)
<a name="1254"></a>{
<a name="1255"></a>	<span class="source_type">switch</span>( TestName )
<a name="1256"></a>    {
<a name="1257"></a>        case <span class="source_name">'DoStandardReloadA'</span>:
<a name="1258"></a>        	return <span class="source_name">'DoStandardReload'</span>;
<a name="1259"></a>        	break;
<a name="1260"></a>        case <span class="source_name">'DoBoltActionA'</span>:
<a name="1261"></a>        	return <span class="source_name">'DoBoltAction'</span>;
<a name="1262"></a>        	break;
<a name="1263"></a>    }
<a name="1264"></a>
<a name="1265"></a>    return TestName;
<a name="1266"></a>}
<a name="1267"></a>
<a name="1268"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1269"></a><span class="source_comment">// SetAnimAction - Checks WeaponState (new enum for added anim capabilities) instead of FiringState
</span><a name="1270"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1271"></a><span class="source_comment">// MergeTODO: The way this is done right now is pretty buggy. Lets try and clean this up
</span><a name="1272"></a>simulated event SetAnimAction(<span class="source_type">name</span> NewAction)
<a name="1273"></a>{
<a name="1274"></a>	local <span class="source_type">name</span> UsedAction;
<a name="1275"></a>
<a name="1276"></a>    if (!bWaitForAnim)
<a name="1277"></a>    {
<a name="1278"></a>		<span class="source_comment">// Since you can't call SetAnimAction for the same action twice in a row (it won't get replicated)
</span><a name="1279"></a>		<span class="source_comment">// For animations that need to happen twice in a row (such as working the bolt of a rifle)
</span><a name="1280"></a>		<span class="source_comment">// we alternate animaction names for these actions so they replicate properly
</span><a name="1281"></a>		if( <span class="source_type">Level</span>.Netmode == NM_Client )
<a name="1282"></a>		{
<a name="1283"></a>			UsedAction = GetAnimActionName(NewAction);
<a name="1284"></a>		}
<a name="1285"></a>		else
<a name="1286"></a>		{
<a name="1287"></a>			UsedAction = NewAction;
<a name="1288"></a>
<a name="1289"></a>			if( AnimAction == NewAction )
<a name="1290"></a>			{
<a name="1291"></a>				NewAction = GetAltName(NewAction);
<a name="1292"></a>			}
<a name="1293"></a>		}
<a name="1294"></a>
<a name="1295"></a>
<a name="1296"></a>	    AnimAction = NewAction;
<a name="1297"></a>
<a name="1298"></a>	    <span class="source_comment">// Weapon switching actions
</span><a name="1299"></a>		if ( IsDrawAnim(UsedAction) )
<a name="1300"></a>        {
<a name="1301"></a>            AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="1302"></a>            AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="1303"></a>            PlayUpperBodyAnim( UsedAction, <span class="source_int">1.0</span>, <span class="source_int">0.0</span> );
<a name="1304"></a>         }
<a name="1305"></a>        else if ( IsPutAwayAnim(UsedAction) )
<a name="1306"></a>        {
<a name="1307"></a>            AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="1308"></a>            AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="1309"></a>            WeaponState = GS_IgnoreAnimend;
<a name="1310"></a>            PlayUpperBodyAnim( UsedAction, <span class="source_int">1.0</span>, <span class="source_int">0.1</span>, GetAnimDuration(AnimAction,<span class="source_int">1.0</span>) * <span class="source_int">2</span>);
<a name="1311"></a>
<a name="1312"></a>        }
<a name="1313"></a>		else if ( UsedAction == <span class="source_name">'ClearAnims'</span> )
<a name="1314"></a>		{
<a name="1315"></a>   			AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1316"></a>		}
<a name="1317"></a>		else if ( UsedAction == <span class="source_name">'TossedWeapon'</span> )
<a name="1318"></a>		{
<a name="1319"></a>			SetWeaponAttachment(none);
<a name="1320"></a>		}
<a name="1321"></a>		else if ( UsedAction == <span class="source_name">'DoStandardReload'</span> )
<a name="1322"></a>		{
<a name="1323"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1324"></a>				PlayStandardReload();
<a name="1325"></a>		}
<a name="1326"></a>		else if ( UsedAction == <span class="source_name">'DoBayoAttach'</span> )
<a name="1327"></a>		{
<a name="1328"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1329"></a>				PlayBayonetAttach();
<a name="1330"></a>		}
<a name="1331"></a>		else if ( UsedAction == <span class="source_name">'DoBayoDetach'</span> )
<a name="1332"></a>		{
<a name="1333"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1334"></a>				PlayBayonetDetach();
<a name="1335"></a>		}
<a name="1336"></a>		else if ( UsedAction == <span class="source_name">'DoBipodDeploy'</span> )
<a name="1337"></a>		{
<a name="1338"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1339"></a>				PlayBipodDeploy();
<a name="1340"></a>		}
<a name="1341"></a>		else if ( UsedAction == <span class="source_name">'DoBipodUnDeploy'</span> )
<a name="1342"></a>		{
<a name="1343"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1344"></a>				PlayBipodUnDeploy();
<a name="1345"></a>		}
<a name="1346"></a>		else if ( UsedAction == <span class="source_name">'DoBoltAction'</span> )
<a name="1347"></a>		{
<a name="1348"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1349"></a>				PlayBoltAction();
<a name="1350"></a>		}
<a name="1351"></a>		else if ( UsedAction == <span class="source_name">'DoLoopingReload'</span> )
<a name="1352"></a>		{
<a name="1353"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1354"></a>				PlayStartReloading();
<a name="1355"></a>		}
<a name="1356"></a>		else if ( UsedAction == <span class="source_name">'DoReloadEnd'</span> )
<a name="1357"></a>		{
<a name="1358"></a>			if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="1359"></a>				PlayStopReloading();
<a name="1360"></a>		}
<a name="1361"></a>        else if ( UsedAction == <span class="source_name">'StartCrawling'</span>)
<a name="1362"></a>        {
<a name="1363"></a>        	bWaitForAnim = true;
<a name="1364"></a>        	GotoState(<span class="source_name">'StartProning'</span>);
<a name="1365"></a>        }
<a name="1366"></a>        else if ( UsedAction == <span class="source_name">'EndCrawling'</span>)
<a name="1367"></a>        {
<a name="1368"></a>        	bWaitForAnim = true;
<a name="1369"></a>        	GotoState(<span class="source_name">'EndProning'</span>);
<a name="1370"></a>        }
<a name="1371"></a>        else if ( UsedAction == <span class="source_name">'DiveToProne'</span>)
<a name="1372"></a>        {
<a name="1373"></a>        	bWaitForAnim = true;
<a name="1374"></a>        	GotoState(<span class="source_name">'DivingToProne'</span>);
<a name="1375"></a>        }
<a name="1376"></a>        else if ( UsedAction == <span class="source_name">'ProneToCrouch'</span>)
<a name="1377"></a>        {
<a name="1378"></a>        	bWaitForAnim = true;
<a name="1379"></a>        	GotoState(<span class="source_name">'CrouchingFromProne'</span>);
<a name="1380"></a>        }
<a name="1381"></a>        else if ( UsedAction == <span class="source_name">'CrouchToProne'</span>)
<a name="1382"></a>        {
<a name="1383"></a>        	bWaitForAnim = true;
<a name="1384"></a>        	GotoState(<span class="source_name">'ProningFromCrouch'</span>);
<a name="1385"></a>        }
<a name="1386"></a>        else if ( (Physics == PHYS_None)
<a name="1387"></a>			|| ((<span class="source_type">Level</span>.Game != None) && <span class="source_type">Level</span>.Game.IsInState(<span class="source_name">'MatchOver'</span>)) )
<a name="1388"></a>        {
<a name="1389"></a>            PlayAnim(UsedAction,,<span class="source_int">0.1</span>);
<a name="1390"></a>			AnimBlendToAlpha(<span class="source_int">1</span>,<span class="source_int">0.0</span>,<span class="source_int">0.05</span>);
<a name="1391"></a>        }
<a name="1392"></a>        else if ( (Physics == PHYS_Falling) || ((Physics == PHYS_Walking) && (Velocity.<span class="source_type">Z</span> != <span class="source_int">0</span>)) )
<a name="1393"></a>		{
<a name="1394"></a>			if ( CheckTauntValid(UsedAction) )
<a name="1395"></a>			{
<a name="1396"></a>				if (WeaponState == GS_None || WeaponState == GS_Ready)
<a name="1397"></a>				{
<a name="1398"></a>					AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1399"></a>					PlayAnim(UsedAction,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1400"></a>					WeaponState = GS_Ready;
<a name="1401"></a>				}
<a name="1402"></a>			}
<a name="1403"></a>			else if ( PlayAnim(UsedAction) )
<a name="1404"></a>			{
<a name="1405"></a>				if ( Physics != PHYS_None )
<a name="1406"></a>				{
<a name="1407"></a>					bWaitForAnim = true;
<a name="1408"></a>				}
<a name="1409"></a>			}
<a name="1410"></a>			else
<a name="1411"></a>			{
<a name="1412"></a>				AnimAction = <span class="source_name">''</span>;
<a name="1413"></a>			}
<a name="1414"></a>		}
<a name="1415"></a>        else if (bIsIdle && !bIsCrouched && (<span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) == None) ) <span class="source_comment">// standing taunt
</span><a name="1416"></a>        {
<a name="1417"></a>            PlayAnim(UsedAction,,<span class="source_int">0.1</span>);
<a name="1418"></a>			AnimBlendToAlpha(<span class="source_int">1</span>,<span class="source_int">0.0</span>,<span class="source_int">0.05</span>);
<a name="1419"></a>        }
<a name="1420"></a>        else <span class="source_comment">// running taunt
</span><a name="1421"></a>        {
<a name="1422"></a>            if (WeaponState == GS_None || WeaponState == GS_Ready)
<a name="1423"></a>            {
<a name="1424"></a>                AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1425"></a>                PlayAnim(UsedAction,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1426"></a>                WeaponState = GS_Ready;
<a name="1427"></a>            }
<a name="1428"></a>        }
<a name="1429"></a>    }
<a name="1430"></a>}
<a name="1431"></a>
<a name="1432"></a><span class="source_comment">// Called on the server. Sends a message to the client to let them know to play the bayoattach
</span><a name="1433"></a>function HandleBoltAction()
<a name="1434"></a>{
<a name="1435"></a>	SetAnimAction(<span class="source_name">'DoBoltAction'</span>);
<a name="1436"></a>}
<a name="1437"></a>
<a name="1438"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1439"></a><span class="source_comment">// PlayBayonetAttach - Bayonet anims
</span><a name="1440"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1441"></a>
<a name="1442"></a>simulated function PlayBoltAction()
<a name="1443"></a>{
<a name="1444"></a>	local <span class="source_type">name</span> Anim;
<a name="1445"></a>	local <span class="source_type">bool</span> bIsMoving;
<a name="1446"></a>
<a name="1447"></a>	bIsMoving = VSizeSquared(Velocity) &gt; <span class="source_int">25</span>;
<a name="1448"></a>
<a name="1449"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1450"></a>	{
<a name="1451"></a>		if (bIsCrawling)
<a name="1452"></a>		{
<a name="1453"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneBoltActionAnim;
<a name="1454"></a>		}
<a name="1455"></a>		else if( bIsCrouched )
<a name="1456"></a>		{
<a name="1457"></a>			if( bIsMoving || bIronSights )
<a name="1458"></a>			{
<a name="1459"></a>				Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchIronBoltActionAnim;
<a name="1460"></a>			}
<a name="1461"></a>			else
<a name="1462"></a>			{
<a name="1463"></a>				Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchBoltActionAnim;
<a name="1464"></a>			}
<a name="1465"></a>		}
<a name="1466"></a>		else
<a name="1467"></a>		{
<a name="1468"></a>			if( bIronSights )
<a name="1469"></a>			{
<a name="1470"></a>				Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_StandIronBoltActionAnim;
<a name="1471"></a>			}
<a name="1472"></a>			else
<a name="1473"></a>			{
<a name="1474"></a>				Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_StandBoltActionAnim;
<a name="1475"></a>			}
<a name="1476"></a>		}
<a name="1477"></a>
<a name="1478"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="1479"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="1480"></a>
<a name="1481"></a>		PlayAnim(Anim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1482"></a>	<span class="source_comment">// TODO: Plug in the weapons animation
</span><a name="1483"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached)
<a name="1484"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetWorkBolt,, <span class="source_int">0.1</span>);
<a name="1485"></a>		else
<a name="1486"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_WorkBolt,, <span class="source_int">0.1</span>);
<a name="1487"></a>
<a name="1488"></a>		AnimBlendTime = GetAnimDuration(Anim, <span class="source_int">1.0</span>) + <span class="source_int">0.1</span>;
<a name="1489"></a>	}
<a name="1490"></a>}
<a name="1491"></a>
<a name="1492"></a>
<a name="1493"></a><span class="source_comment">// Called on the server. Sends a message to the client to let them know to play the bayoattach
</span><a name="1494"></a>function HandleBayoAttach()
<a name="1495"></a>{
<a name="1496"></a>	SetAnimAction(<span class="source_name">'DoBayoAttach'</span>);
<a name="1497"></a>}
<a name="1498"></a>
<a name="1499"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1500"></a><span class="source_comment">// PlayBayonetAttach - Bayonet anims
</span><a name="1501"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1502"></a>
<a name="1503"></a>simulated function PlayBayonetAttach()
<a name="1504"></a>{
<a name="1505"></a>	local <span class="source_type">name</span> Anim, WeapAnim;
<a name="1506"></a>
<a name="1507"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1508"></a>	{
<a name="1509"></a>		if (bIsCrawling)
<a name="1510"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneBayonetAttachAnim;
<a name="1511"></a>		else
<a name="1512"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_BayonetAttachAnim;
<a name="1513"></a>
<a name="1514"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="1515"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="1516"></a>
<a name="1517"></a>		PlayAnim(Anim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1518"></a>
<a name="1519"></a>		if( bIsCrawling )
<a name="1520"></a>		{
<a name="1521"></a>			WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetAttachProne;
<a name="1522"></a>		}
<a name="1523"></a>		else
<a name="1524"></a>		{
<a name="1525"></a>		   	WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetAttach;
<a name="1526"></a>		}
<a name="1527"></a>
<a name="1528"></a> 		<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(WeapAnim,, <span class="source_int">0.1</span>);
<a name="1529"></a>
<a name="1530"></a>		AnimBlendTime = GetAnimDuration(Anim, <span class="source_int">1.0</span>)+<span class="source_int">0.1</span>;
<a name="1531"></a>	}
<a name="1532"></a>}
<a name="1533"></a>
<a name="1534"></a><span class="source_comment">// Called on the server. Sends a message to the client to let them know to play the bayoattach
</span><a name="1535"></a>function HandleBayoDetach()
<a name="1536"></a>{
<a name="1537"></a>	SetAnimAction(<span class="source_name">'DoBayoDetach'</span>);
<a name="1538"></a>}
<a name="1539"></a>
<a name="1540"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1541"></a><span class="source_comment">// PlayBayonetDetach - Bayonet anims
</span><a name="1542"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1543"></a>
<a name="1544"></a>simulated function PlayBayonetDetach()
<a name="1545"></a>{
<a name="1546"></a>	local <span class="source_type">name</span> Anim, WeapAnim;
<a name="1547"></a>
<a name="1548"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1549"></a>	{
<a name="1550"></a>		if (bIsCrawling)
<a name="1551"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneBayonetDetachAnim;
<a name="1552"></a>		else
<a name="1553"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_BayonetDetachAnim;
<a name="1554"></a>
<a name="1555"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="1556"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="1557"></a>
<a name="1558"></a>		PlayAnim(Anim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1559"></a>		if( bIsCrawling )
<a name="1560"></a>		{
<a name="1561"></a>			WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetDetachProne;
<a name="1562"></a>		}
<a name="1563"></a>		else
<a name="1564"></a>		{
<a name="1565"></a>		   	WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetDetach;
<a name="1566"></a>		}
<a name="1567"></a>
<a name="1568"></a> 		<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(WeapAnim,, <span class="source_int">0.1</span>);
<a name="1569"></a>
<a name="1570"></a>		AnimBlendTime = GetAnimDuration(Anim, <span class="source_int">1.0</span>)+<span class="source_int">0.1</span>;
<a name="1571"></a>	}
<a name="1572"></a>}
<a name="1573"></a>
<a name="1574"></a><span class="source_comment">//------------------------------------------------------------------------------
</span><a name="1575"></a><span class="source_comment">// PlayWeaponDeploy - Plays weapon and player deployment animations
</span><a name="1576"></a><span class="source_comment">//------------------------------------------------------------------------------
</span><a name="1577"></a>simulated function PlayBipodDeploy()
<a name="1578"></a>{
<a name="1579"></a>	local <span class="source_type">name</span> Anim;
<a name="1580"></a>
<a name="1581"></a>	if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none )
<a name="1582"></a>	{
<a name="1583"></a>		if( bIsCrawling )
<a name="1584"></a>		{
<a name="1585"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneWeaponDeployAnim;
<a name="1586"></a>		}
<a name="1587"></a>		else
<a name="1588"></a>		{
<a name="1589"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_StandWeaponDeployAnim;
<a name="1590"></a>		}
<a name="1591"></a>
<a name="1592"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1593"></a>		PlayAnim(Anim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1594"></a>
<a name="1595"></a>		<span class="source_comment">// Replaceme when we get actual transition anims
</span><a name="1596"></a>		AnimBlendTime = <span class="source_int">0.02</span>;<span class="source_comment">//GetAnimDuration(Anim, 1.0)+0.1;
</span><a name="1597"></a>
<a name="1598"></a>		if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.HasAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_WeaponDeploy) )
<a name="1599"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_WeaponDeploy,, <span class="source_int">0.1</span>);
<a name="1600"></a>	}
<a name="1601"></a>}
<a name="1602"></a>
<a name="1603"></a><span class="source_comment">//------------------------------------------------------------------------------
</span><a name="1604"></a><span class="source_comment">// PlayWeaponUnDeploy - Plays weapon and player un-deployment animations
</span><a name="1605"></a><span class="source_comment">//------------------------------------------------------------------------------
</span><a name="1606"></a>simulated function PlayBipodUnDeploy()
<a name="1607"></a>{
<a name="1608"></a>	local <span class="source_type">name</span> Anim;
<a name="1609"></a>
<a name="1610"></a>	if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none )
<a name="1611"></a>	{
<a name="1612"></a>		if( bIsCrawling )
<a name="1613"></a>		{
<a name="1614"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneWeaponUnDeployAnim;
<a name="1615"></a>		}
<a name="1616"></a>		else
<a name="1617"></a>		{
<a name="1618"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_StandWeaponUnDeployAnim;
<a name="1619"></a>		}
<a name="1620"></a>
<a name="1621"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1622"></a>		PlayAnim(Anim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1623"></a>
<a name="1624"></a>		<span class="source_comment">// Replaceme when we get actual transition anims
</span><a name="1625"></a>		AnimBlendTime = <span class="source_int">0.02</span>;<span class="source_comment">//GetAnimDuration(Anim, 1.0)+0.1;
</span><a name="1626"></a>
<a name="1627"></a>		if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.HasAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_WeaponUnDeploy) )
<a name="1628"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_WeaponUnDeploy,, <span class="source_int">0.1</span>);
<a name="1629"></a>	}
<a name="1630"></a>}
<a name="1631"></a>
<a name="1632"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1633"></a><span class="source_comment">// PlayStartCrawling - Plays the anim going into prone
</span><a name="1634"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1635"></a>simulated function PlayStartCrawling()
<a name="1636"></a>{
<a name="1637"></a>	local <span class="source_type">name</span> Anim;
<a name="1638"></a>	local <span class="source_type">float</span> AnimTimer;
<a name="1639"></a>
<a name="1640"></a>	if (bIsCrouched)
<a name="1641"></a>	{
<a name="1642"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1643"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchToProneAnim;
<a name="1644"></a>		else
<a name="1645"></a>			Anim = CrouchToProneAnim;
<a name="1646"></a>
<a name="1647"></a>		PlayOwnedSound(CrouchToProneSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="1648"></a>	}
<a name="1649"></a>	else
<a name="1650"></a>	{
<a name="1651"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1652"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_StandToProneAnim;
<a name="1653"></a>		else
<a name="1654"></a>			Anim = StandToProneAnim;
<a name="1655"></a>
<a name="1656"></a>		PlayOwnedSound(StandToProneSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="1657"></a>	}
<a name="1658"></a>
<a name="1659"></a>    AnimTimer = GetAnimDuration(Anim, <span class="source_int">1.0</span>);
<a name="1660"></a>
<a name="1661"></a>    <span class="source_comment">// Have the server finish the prone transition state slightly before the client (fixes some client/server sync issues)
</span><a name="1662"></a>	if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer || (<span class="source_type">Level</span>.NetMode == NM_ListenServer && !<span class="source_type">Instigator</span>.IsLocallyControlled()))
<a name="1663"></a>		SetTimer(AnimTimer - (AnimTimer * <span class="source_int">0.1</span>),false);
<a name="1664"></a>	else
<a name="1665"></a>		SetTimer(AnimTimer,false);
<a name="1666"></a>
<a name="1667"></a>	if (bIsIdle && !bIsCrouched)
<a name="1668"></a>	{
<a name="1669"></a>		PlayAnim(Anim,<span class="source_int">1.0</span>,<span class="source_int">0.0</span>,<span class="source_int">0</span>);
<a name="1670"></a>	}
<a name="1671"></a>	else
<a name="1672"></a>	{
<a name="1673"></a>		PlayAnim(Anim,<span class="source_int">1.0</span>,<span class="source_int">0.0</span>,<span class="source_int">0</span>);
<a name="1674"></a>		WeaponState = GS_Ready;
<a name="1675"></a>	}
<a name="1676"></a>}
<a name="1677"></a>
<a name="1678"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1679"></a><span class="source_comment">// PlayEndCrawling - Plays the anim going out of prone
</span><a name="1680"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1681"></a>simulated function PlayEndCrawling()
<a name="1682"></a>{
<a name="1683"></a>	local <span class="source_type">name</span> Anim;
<a name="1684"></a>	local <span class="source_type">float</span> AnimTimer;
<a name="1685"></a>
<a name="1686"></a>	if (bIsCrouched)
<a name="1687"></a>	{
<a name="1688"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1689"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneToCrouchAnim;
<a name="1690"></a>		else
<a name="1691"></a>			Anim = ProneToCrouchAnim;
<a name="1692"></a>
<a name="1693"></a>		PlayOwnedSound(ProneToCrouchSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="1694"></a>	}
<a name="1695"></a>	else
<a name="1696"></a>	{
<a name="1697"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1698"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneToStandAnim;
<a name="1699"></a>		else
<a name="1700"></a>			Anim = ProneToStandAnim;
<a name="1701"></a>
<a name="1702"></a>		PlayOwnedSound(ProneToStandSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="1703"></a>	}
<a name="1704"></a>
<a name="1705"></a>    AnimTimer = GetAnimDuration(Anim, <span class="source_int">1.0</span>);
<a name="1706"></a>
<a name="1707"></a>    <span class="source_comment">// Have the server finish the prone transition state slightly before the client (fixes some client/server sync issues)
</span><a name="1708"></a>	if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer || (<span class="source_type">Level</span>.NetMode == NM_ListenServer && !<span class="source_type">Instigator</span>.IsLocallyControlled()))
<a name="1709"></a>		SetTimer(AnimTimer - (AnimTimer * <span class="source_int">0.1</span>),false);
<a name="1710"></a>	else
<a name="1711"></a>		SetTimer(AnimTimer,false);
<a name="1712"></a>
<a name="1713"></a>
<a name="1714"></a>	if (bIsIdle && !bIsCrouched)
<a name="1715"></a>	{
<a name="1716"></a>		PlayAnim(Anim,<span class="source_int">1.0</span>,<span class="source_int">0.0</span>,<span class="source_int">0</span>);
<a name="1717"></a>	}
<a name="1718"></a>        else
<a name="1719"></a>	{
<a name="1720"></a>		PlayAnim(Anim,<span class="source_int">1.0</span>,<span class="source_int">0.0</span>,<span class="source_int">0</span>);
<a name="1721"></a>		WeaponState = GS_Ready;
<a name="1722"></a>	}
<a name="1723"></a>}
<a name="1724"></a>
<a name="1725"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1726"></a><span class="source_comment">// PlayProningFromCrouch - Plays the anim going into prone from crouched
</span><a name="1727"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1728"></a>simulated function PlayProningFromCrouch()
<a name="1729"></a>{
<a name="1730"></a>	local <span class="source_type">name</span> Anim;
<a name="1731"></a>	local <span class="source_type">float</span> AnimTimer;
<a name="1732"></a>
<a name="1733"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1734"></a>		Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchToProneAnim;
<a name="1735"></a>	else
<a name="1736"></a>		Anim = CrouchToProneAnim;
<a name="1737"></a>
<a name="1738"></a>	PlayOwnedSound(CrouchToProneSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="1739"></a>
<a name="1740"></a>    AnimTimer = GetAnimDuration(Anim, <span class="source_int">1.0</span>);
<a name="1741"></a>
<a name="1742"></a>    <span class="source_comment">// Have the server finish the prone transition state slightly before the client (fixes some client/server sync issues)
</span><a name="1743"></a>	if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer || (<span class="source_type">Level</span>.NetMode == NM_ListenServer && !<span class="source_type">Instigator</span>.IsLocallyControlled()))
<a name="1744"></a>		SetTimer(AnimTimer - (AnimTimer * <span class="source_int">0.1</span>),false);
<a name="1745"></a>	else
<a name="1746"></a>		SetTimer(AnimTimer,false);
<a name="1747"></a>	PlayAnim(Anim,<span class="source_int">1.0</span>,<span class="source_int">0.0</span>,<span class="source_int">0</span>);
<a name="1748"></a>}
<a name="1749"></a>
<a name="1750"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1751"></a><span class="source_comment">// PlayCrouchingFromProne - Plays the anim going out of prone to crouch
</span><a name="1752"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1753"></a>simulated function PlayCrouchingFromProne()
<a name="1754"></a>{
<a name="1755"></a>	local <span class="source_type">name</span> Anim;
<a name="1756"></a>	local <span class="source_type">float</span> AnimTimer;
<a name="1757"></a>
<a name="1758"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1759"></a>		Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneToCrouchAnim;
<a name="1760"></a>	else
<a name="1761"></a>		Anim = ProneToCrouchAnim;
<a name="1762"></a>
<a name="1763"></a>	PlayOwnedSound(ProneToCrouchSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="1764"></a>
<a name="1765"></a>	AnimTimer = GetAnimDuration(Anim, <span class="source_int">1.0</span>);
<a name="1766"></a>
<a name="1767"></a>    <span class="source_comment">// Have the server finish the prone transition state slightly before the client (fixes some client/server sync issues)
</span><a name="1768"></a>	if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer || (<span class="source_type">Level</span>.NetMode == NM_ListenServer && !<span class="source_type">Instigator</span>.IsLocallyControlled()))
<a name="1769"></a>		SetTimer(AnimTimer - (AnimTimer * <span class="source_int">0.1</span>),false);
<a name="1770"></a>	else
<a name="1771"></a>		SetTimer(AnimTimer,false);
<a name="1772"></a>	PlayAnim(Anim,<span class="source_int">1.0</span>,<span class="source_int">0.0</span>,<span class="source_int">0</span>);
<a name="1773"></a>}
<a name="1774"></a>
<a name="1775"></a>
<a name="1776"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1777"></a><span class="source_comment">// PlayGrenadeBack
</span><a name="1778"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1779"></a>
<a name="1780"></a>simulated function PlayGrenadeBack()
<a name="1781"></a>{
<a name="1782"></a>	AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1783"></a>
<a name="1784"></a>	if (bIsCrawling)
<a name="1785"></a>		PlayAnim(<span class="source_name">'prone_pullpin_nade'</span>,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1786"></a>	else
<a name="1787"></a>		PlayAnim(<span class="source_name">'stand_pullpin_nade'</span>,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1788"></a>
<a name="1789"></a>	WeaponState = GS_GrenadePullBack;
<a name="1790"></a>}
<a name="1791"></a>
<a name="1792"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1793"></a><span class="source_comment">// SetWeaponAttachment - Update anims to match attachment
</span><a name="1794"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1795"></a>simulated function SetWeaponAttachment(<span class="source_type"><a href="../roengine/roweaponattachment.html" class="source">ROWeaponAttachment</a></span> NewAtt)
<a name="1796"></a>{
<a name="1797"></a>	<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> = NewAtt;
<a name="1798"></a>
<a name="1799"></a>	if (!bInitializedWeaponAttachment && NewAtt != none)
<a name="1800"></a>		bInitializedWeaponAttachment = true;
<a name="1801"></a>
<a name="1802"></a>	if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> == none )
<a name="1803"></a>		return;
<a name="1804"></a>
<a name="1805"></a>	if( <span class="source_type"><a href="../roengine/roprojectileweapon.html" class="source">ROProjectileWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1806"></a>		<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached = <span class="source_type"><a href="../roengine/roprojectileweapon.html" class="source">ROProjectileWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).bBayonetMounted;
<a name="1807"></a>	<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.AnimEnd(<span class="source_int">0</span>);
<a name="1808"></a>}
<a name="1809"></a>
<a name="1810"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1811"></a><span class="source_comment">// CheckWeaponAttachment - Occasionally the packets that tell the
</span><a name="1812"></a><span class="source_comment">// clients when a new weaponattachment should be set arrive out of
</span><a name="1813"></a><span class="source_comment">// order. The destroy function of ROWeaponAttachment called this
</span><a name="1814"></a><span class="source_comment">// function to correct that problem (since a destroyed weapon
</span><a name="1815"></a><span class="source_comment">// attachement should pretty much never be the current weapon
</span><a name="1816"></a><span class="source_comment">// attachement.
</span><a name="1817"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1818"></a>simulated function CheckWeaponAttachment(<span class="source_type"><a href="../roengine/roweaponattachment.html" class="source">ROWeaponAttachment</a></span> TestAtt)
<a name="1819"></a>{
<a name="1820"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="1821"></a>
<a name="1822"></a>	if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> == TestAtt )
<a name="1823"></a>	{
<a name="1824"></a>		<span class="source_comment">// Try and find weapon attachement
</span><a name="1825"></a>	    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++ )
<a name="1826"></a>	    {
<a name="1827"></a>	        if( Attached[<span class="source_type">i</span>].IsA(<span class="source_name">'ROWeaponAttachment'</span>) && Attached[<span class="source_type">i</span>] != TestAtt)
<a name="1828"></a>	        {
<a name="1829"></a>	        	SetWeaponAttachment(<span class="source_type"><a href="../roengine/roweaponattachment.html" class="source">ROWeaponAttachment</a></span>(Attached[<span class="source_type">i</span>]));
<a name="1830"></a>	        	break;
<a name="1831"></a>	        }
<a name="1832"></a>	    }
<a name="1833"></a>    }
<a name="1834"></a>}
<a name="1835"></a>
<a name="1836"></a>
<a name="1837"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1838"></a><span class="source_comment">// AnimEnd - Figure out what to do with the weapon anims
</span><a name="1839"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1840"></a><span class="source_comment">// MergeTODO: This looks like a TERRIBLE way to handle reloads and firing anims. Lets refactor this
</span><a name="1841"></a>simulated event AnimEnd(<span class="source_type">int</span> <span class="source_type">Channel</span>)
<a name="1842"></a>{
<a name="1843"></a>	local <span class="source_type">name</span> WeapAnim, PlayerAnim;
<a name="1844"></a>	local <span class="source_type">bool</span> bIsMoving;
<a name="1845"></a>	local <span class="source_type">name</span> Anim;
<a name="1846"></a>	local <span class="source_type">float</span> frame, rate;
<a name="1847"></a>
<a name="1848"></a>	bIsMoving = VSizeSquared(Velocity) &gt; <span class="source_int">25</span>;
<a name="1849"></a>
<a name="1850"></a>	if( DrivenVehicle != none )
<a name="1851"></a>	{
<a name="1852"></a>		PlayAnim(DrivenVehicle.DriveAnim,<span class="source_int">1.0</span>,, <span class="source_int">1</span>);
<a name="1853"></a>	}
<a name="1854"></a>	else if (<span class="source_type">Channel</span> == <span class="source_int">1</span> && WeaponState != GS_IgnoreAnimend)
<a name="1855"></a>	{
<a name="1856"></a>		if (WeaponState == GS_Ready)
<a name="1857"></a>		{
<a name="1858"></a>			AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1859"></a>			WeaponState = GS_None;
<a name="1860"></a>		}
<a name="1861"></a>		else if (WeaponState == GS_FireSingle || WeaponState == GS_ReloadSingle)
<a name="1862"></a>		{
<a name="1863"></a>		 	<span class="source_comment">// This used to play the idle animation after the firing anim was played
</span><a name="1864"></a>		 	<span class="source_comment">// and then set the weaponstate to GS_Ready, which would handle resetting
</span><a name="1865"></a>		 	<span class="source_comment">// the upperbody blending params when the animation ended. That didn't
</span><a name="1866"></a>		 	<span class="source_comment">// work well for us, so now we do that here - Ramm
</span><a name="1867"></a>
<a name="1868"></a>			<span class="source_comment">// Stop the rapid fire anim from looping
</span><a name="1869"></a>            AnimStopLooping(<span class="source_int">1</span>);
<a name="1870"></a>
<a name="1871"></a>			if( bIsMoving )
<a name="1872"></a>			{
<a name="1873"></a>				AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1874"></a>				WeaponState = GS_None;
<a name="1875"></a>			}
<a name="1876"></a>			else
<a name="1877"></a>			{
<a name="1878"></a>                AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1879"></a>
<a name="1880"></a>				WeaponState = GS_None;
<a name="1881"></a>				IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1882"></a>			}
<a name="1883"></a>
<a name="1884"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none)
<a name="1885"></a>			{
<a name="1886"></a>				<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.GetAnimParams(<span class="source_int">0</span>, Anim, frame, rate);
<a name="1887"></a>
<a name="1888"></a>				if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached)
<a name="1889"></a>				{
<a name="1890"></a>					if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetIdleEmpty != <span class="source_name">''</span> && Anim != <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReloadEmpty)
<a name="1891"></a>						<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.LoopAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetIdleEmpty);
<a name="1892"></a>					else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetIdle != <span class="source_name">''</span>)
<a name="1893"></a>						<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.LoopAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetIdle);
<a name="1894"></a>				}
<a name="1895"></a>				else
<a name="1896"></a>				{
<a name="1897"></a>					if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_IdleEmpty != <span class="source_name">''</span> && Anim != <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ReloadEmpty)
<a name="1898"></a>						<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.LoopAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_IdleEmpty);
<a name="1899"></a>					else
<a name="1900"></a>						<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.LoopAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_Idle);
<a name="1901"></a>				}
<a name="1902"></a>			}
<a name="1903"></a>		}
<a name="1904"></a>		else if (WeaponState == GS_GrenadePullBack)
<a name="1905"></a>		{
<a name="1906"></a>			if (bIsCrawling)
<a name="1907"></a>				LoopAnim(<span class="source_name">'prone_hold_nade'</span>,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1908"></a>			else
<a name="1909"></a>				LoopAnim(<span class="source_name">'stand_hold_nade'</span>,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1910"></a>
<a name="1911"></a>			WeaponState = GS_GrenadeHoldBack;
<a name="1912"></a>			IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1913"></a>		}
<a name="1914"></a>		else if (WeaponState == GS_PreReload && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="1915"></a>		{
<a name="1916"></a>	        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="1917"></a>	        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="1918"></a>
<a name="1919"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo)
<a name="1920"></a>			{
<a name="1921"></a>				if (bIsCrawling)
<a name="1922"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneReloadEmptyAnim;
<a name="1923"></a>				else
<a name="1924"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ReloadEmptyAnim;
<a name="1925"></a>			}
<a name="1926"></a>			else
<a name="1927"></a>			{
<a name="1928"></a>				if (bIsCrawling)
<a name="1929"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneReloadAnim;
<a name="1930"></a>				else
<a name="1931"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ReloadAnim;
<a name="1932"></a>			}
<a name="1933"></a>
<a name="1934"></a>			LoopAnim(PlayerAnim,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1935"></a>			WeaponState = GS_ReloadLooped;
<a name="1936"></a>			IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1937"></a>
<a name="1938"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached)
<a name="1939"></a>			{
<a name="1940"></a>				if( bIsCrawling )
<a name="1941"></a>				{
<a name="1942"></a>					if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReloadEmpty != <span class="source_name">''</span>)
<a name="1943"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReloadEmpty;
<a name="1944"></a>					else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReload != <span class="source_name">''</span>)
<a name="1945"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReload;
<a name="1946"></a>				}
<a name="1947"></a>				else
<a name="1948"></a>				{
<a name="1949"></a>					if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReloadEmpty != <span class="source_name">''</span>)
<a name="1950"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReloadEmpty;
<a name="1951"></a>					else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReload != <span class="source_name">''</span>)
<a name="1952"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReload;
<a name="1953"></a>				}
<a name="1954"></a>			}
<a name="1955"></a>			else
<a name="1956"></a>			{
<a name="1957"></a>				if( bIsCrawling )
<a name="1958"></a>				{
<a name="1959"></a>					if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReloadEmpty != <span class="source_name">''</span>)
<a name="1960"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReloadEmpty;
<a name="1961"></a>					else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReload != <span class="source_name">''</span>)
<a name="1962"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReload;
<a name="1963"></a>				}
<a name="1964"></a>				else
<a name="1965"></a>				{
<a name="1966"></a>					if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ReloadEmpty != <span class="source_name">''</span>)
<a name="1967"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ReloadEmpty;
<a name="1968"></a>					else
<a name="1969"></a>						WeapAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_Reload;
<a name="1970"></a>				}
<a name="1971"></a>			}
<a name="1972"></a>
<a name="1973"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.LoopAnim(WeapAnim);
<a name="1974"></a>		}
<a name="1975"></a>		else if (WeaponState != GS_ReloadLooped && WeaponState != GS_GrenadeHoldBack && WeaponState != GS_FireLooped)
<a name="1976"></a>		{
<a name="1977"></a>			<span class="source_comment">//Level.Game.Broadcast(self, "In the else in AnimEnd()");
</span><a name="1978"></a>			AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1979"></a>		}
<a name="1980"></a>	}
<a name="1981"></a>	else if ( bKeepTaunting && (<span class="source_type">Channel</span> == <span class="source_int">0</span>) )
<a name="1982"></a>		PlayVictoryAnimation();
<a name="1983"></a>}
<a name="1984"></a>
<a name="1985"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1986"></a><span class="source_comment">// PlayHit - Redone again since butto hacked it up - Ramm
</span><a name="1987"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="1988"></a><span class="source_comment">// MergeTODO: Work on the gore part of this to make it better
</span><a name="1989"></a>function PlayHit(<span class="source_type">float</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span>, optional <span class="source_type">int</span> <span class="source_type">HitIndex</span>)
<a name="1990"></a>{
<a name="1991"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitNormal</span>;
<a name="1992"></a>    local <span class="source_type">Name</span> HitBone;
<a name="1993"></a>    local <span class="source_type">float</span> HitBoneDist;
<a name="1994"></a>    local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> <span class="source_type">PC</span>;
<a name="1995"></a>	local <span class="source_type">bool</span> bShowEffects, bRecentHit;
<a name="1996"></a>	local <span class="source_type"><a href="../roeffects/projectilebloodsplat.html" class="source">ProjectileBloodSplat</a></span> BloodHit;
<a name="1997"></a>	local <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span> SplatRot;
<a name="1998"></a>
<a name="1999"></a>	bRecentHit = <span class="source_type">Level</span>.TimeSeconds - LastPainTime &lt; <span class="source_int">0.2</span>;
<a name="2000"></a>
<a name="2001"></a>	<span class="source_comment">// Call the modified version of the original Pawn playhit
</span><a name="2002"></a>	OldPlayHit(<span class="source_type">Damage</span>,InstigatedBy,<span class="source_type">HitLocation</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">Momentum</span>);
<a name="2003"></a>
<a name="2004"></a>	if ( <span class="source_type">Damage</span> &lt;= <span class="source_int">0</span> )
<a name="2005"></a>		return;
<a name="2006"></a>
<a name="2007"></a>    <span class="source_type">PC</span> = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2008"></a>	bShowEffects = ( (<span class="source_type">Level</span>.NetMode != NM_Standalone) || (<span class="source_type">Level</span>.TimeSeconds - LastRenderTime &lt; <span class="source_int">2.5</span>)
<a name="2009"></a>					|| ((InstigatedBy != None) && (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(InstigatedBy.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None))
<a name="2010"></a>					|| (<span class="source_type">PC</span> != None) );
<a name="2011"></a>	if ( !bShowEffects )
<a name="2012"></a>		return;
<a name="2013"></a>
<a name="2014"></a>    if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit )
<a name="2015"></a>    {
<a name="2016"></a>        HitBone = GetHitBoneFromIndex(<span class="source_type">HitIndex</span>);
<a name="2017"></a>        HitBoneDist = <span class="source_int">0.0f</span>;
<a name="2018"></a>    }
<a name="2019"></a>    else
<a name="2020"></a>    {
<a name="2021"></a>        <span class="source_type">HitLocation</span> = Location;
<a name="2022"></a>        HitBone = <span class="source_name">'None'</span>;
<a name="2023"></a>        HitBoneDist = <span class="source_int">0.0f</span>;
<a name="2024"></a>    }
<a name="2025"></a>
<a name="2026"></a>    if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bAlwaysSevers && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bSpecial )
<a name="2027"></a>        HitBone = <span class="source_name">'head'</span>;
<a name="2028"></a>
<a name="2029"></a>	if( InstigatedBy != None )
<a name="2030"></a>		<span class="source_type">HitNormal</span> = Normal( Normal(InstigatedBy.Location-<span class="source_type">HitLocation</span>) + VRand() * <span class="source_int">0.2</span> + vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">2.8</span>) );
<a name="2031"></a>	else
<a name="2032"></a>		<span class="source_type">HitNormal</span> = Normal( Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>) + VRand() * <span class="source_int">0.2</span> + vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">2.8</span>) );
<a name="2033"></a>
<a name="2034"></a>	if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bCausesBlood && (!bRecentHit || (bRecentHit && (FRand() &gt; <span class="source_int">0.8</span>))))
<a name="2035"></a>	{
<a name="2036"></a>		if ( !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.NoBlood() ) <span class="source_comment">//class'GameInfo'.static.UseLowGore()
</span><a name="2037"></a>		{
<a name="2038"></a>        	if ( <span class="source_type">Momentum</span> != vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) )
<a name="2039"></a>				SplatRot = <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(Normal(<span class="source_type">Momentum</span>));
<a name="2040"></a>			else
<a name="2041"></a>			{
<a name="2042"></a>				if ( InstigatedBy != None )
<a name="2043"></a>					SplatRot = <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(Normal(Location - InstigatedBy.Location));
<a name="2044"></a>				else
<a name="2045"></a>					SplatRot = <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(Normal(Location - <span class="source_type">HitLocation</span>));
<a name="2046"></a>			}
<a name="2047"></a>
<a name="2048"></a>		 	BloodHit = Spawn(ProjectileBloodSplatClass,InstigatedBy,, <span class="source_type">HitLocation</span>, SplatRot);
<a name="2049"></a>		}
<a name="2050"></a>	}
<a name="2051"></a>
<a name="2052"></a>	DoDamageFX( HitBone, <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(<span class="source_type">HitNormal</span>) );
<a name="2053"></a>
<a name="2054"></a>	if (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayMaterial != None && <span class="source_type">Damage</span> &gt; <span class="source_int">0</span> ) <span class="source_comment">// additional check in case shield absorbed
</span><a name="2055"></a>				SetOverlayMaterial( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayMaterial, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayTime, false );
<a name="2056"></a>}
<a name="2057"></a>
<a name="2058"></a><span class="source_comment">// Modified version of the original Pawn playhit. Set up because we want our blood puffs to be directional based
</span><a name="2059"></a><span class="source_comment">// On the momentum of the bullet, not out from the center of the player
</span><a name="2060"></a>function OldPlayHit(<span class="source_type">float</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span>, optional <span class="source_type">int</span> <span class="source_type">HitIndex</span>)
<a name="2061"></a>{
<a name="2062"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitNormal</span>;
<a name="2063"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> BloodOffset, <span class="source_type">Mo</span>;
<a name="2064"></a>	local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/effects.html" class="source">Effects</a></span>&gt; DesiredEffect;
<a name="2065"></a>	local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt; DesiredEmitter;
<a name="2066"></a>	local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> Hearer;
<a name="2067"></a>
<a name="2068"></a>	if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> == None )
<a name="2069"></a>		return;
<a name="2070"></a>	if ( (<span class="source_type">Damage</span> &lt;= <span class="source_int">0</span>) && ((<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == None) || !<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.bGodMode) )
<a name="2071"></a>		return;
<a name="2072"></a>
<a name="2073"></a>	if (<span class="source_type">Damage</span> &gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageThreshold) <span class="source_comment">//spawn some blood
</span><a name="2074"></a>	{
<a name="2075"></a>
<a name="2076"></a>		<span class="source_type">HitNormal</span> = Normal(<span class="source_type">HitLocation</span> - Location);
<a name="2077"></a>
<a name="2078"></a>		<span class="source_comment">// Play any set effect
</span><a name="2079"></a>		if ( EffectIsRelevant(Location,true) )
<a name="2080"></a>		{
<a name="2081"></a>			DesiredEffect = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.static.GetPawnDamageEffect(<span class="source_type">HitLocation</span>, <span class="source_type">Damage</span>, <span class="source_type">Momentum</span>, self, (<span class="source_type">Level</span>.bDropDetail || <span class="source_type">Level</span>.DetailMode == DM_Low));
<a name="2082"></a>
<a name="2083"></a>			if ( DesiredEffect != None )
<a name="2084"></a>			{
<a name="2085"></a>				BloodOffset = <span class="source_int">0.2</span> * CollisionRadius * <span class="source_type">HitNormal</span>;
<a name="2086"></a>				BloodOffset.<span class="source_type">Z</span> = BloodOffset.<span class="source_type">Z</span> * <span class="source_int">0.5</span>;
<a name="2087"></a>
<a name="2088"></a>				<span class="source_type">Mo</span> = <span class="source_type">Momentum</span>;
<a name="2089"></a>				if ( <span class="source_type">Mo</span>.<span class="source_type">Z</span> &gt; <span class="source_int">0</span> )
<a name="2090"></a>					<span class="source_type">Mo</span>.<span class="source_type">Z</span> *= <span class="source_int">0.5</span>;
<a name="2091"></a>				spawn(DesiredEffect,self,,<span class="source_type">HitLocation</span> + BloodOffset, <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(<span class="source_type">Mo</span>));
<a name="2092"></a>			}
<a name="2093"></a>
<a name="2094"></a>			<span class="source_comment">// Spawn any preset emitter
</span><a name="2095"></a>
<a name="2096"></a>			DesiredEmitter = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Static.GetPawnDamageEmitter(<span class="source_type">HitLocation</span>, <span class="source_type">Damage</span>, <span class="source_type">Momentum</span>, self, (<span class="source_type">Level</span>.bDropDetail || <span class="source_type">Level</span>.DetailMode == DM_Low));
<a name="2097"></a>			if (DesiredEmitter != None)
<a name="2098"></a>			{
<a name="2099"></a>			    if( InstigatedBy != none )
<a name="2100"></a>			        <span class="source_type">HitNormal</span> = Normal((InstigatedBy.Location+(vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>)*InstigatedBy.EyeHeight))-<span class="source_type">HitLocation</span>);
<a name="2101"></a>
<a name="2102"></a>				spawn(DesiredEmitter,,,<span class="source_type">HitLocation</span>+<span class="source_type">HitNormal</span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(<span class="source_type">HitNormal</span>));
<a name="2103"></a>			}
<a name="2104"></a>		}
<a name="2105"></a>	}
<a name="2106"></a>	if ( Health &lt;= <span class="source_int">0</span> )
<a name="2107"></a>	{
<a name="2108"></a>		if ( <span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.bDestructive && (<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.ExitActor != None) )
<a name="2109"></a>			Spawn(<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.ExitActor);
<a name="2110"></a>		return;
<a name="2111"></a>	}
<a name="2112"></a>
<a name="2113"></a>	if ( <span class="source_type">Level</span>.TimeSeconds - LastPainTime &gt; <span class="source_int">0.1</span> )
<a name="2114"></a>	{
<a name="2115"></a>		if ( InstigatedBy != None && (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None) && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bDirectDamage )
<a name="2116"></a>			Hearer = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(InstigatedBy.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2117"></a>		if ( Hearer != None )
<a name="2118"></a>			Hearer.bAcuteHearing = true;
<a name="2119"></a>		PlayTakeHit(<span class="source_type">HitLocation</span>,<span class="source_type">Damage</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>);
<a name="2120"></a>		if ( Hearer != None )
<a name="2121"></a>			Hearer.bAcuteHearing = false;
<a name="2122"></a>		LastPainTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="2123"></a>	}
<a name="2124"></a>}
<a name="2125"></a>
<a name="2126"></a><span class="source_comment">// Returns the bone name for a given hitpoint index
</span><a name="2127"></a>simulated function <span class="source_type">name</span> GetHitBoneFromIndex(<span class="source_type">int</span> <span class="source_type">HitIndex</span>)
<a name="2128"></a>{
<a name="2129"></a>	<span class="source_comment">// Just return the spine if its out of bounds for the array
</span><a name="2130"></a>	if( <span class="source_type">HitIndex</span> &lt; <span class="source_int">1</span> || <span class="source_type">HitIndex</span> &gt; <span class="source_int">15</span> )
<a name="2131"></a>	{
<a name="2132"></a>		return <span class="source_name">'Spine'</span>;
<a name="2133"></a>	}
<a name="2134"></a>	else
<a name="2135"></a>	{
<a name="2136"></a>		return HitPoints[<span class="source_type">HitIndex</span>].PointBone;
<a name="2137"></a>	}
<a name="2138"></a>}
<a name="2139"></a>
<a name="2140"></a>simulated function PlayDirectionalDeath(<span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> HitLoc)
<a name="2141"></a>{
<a name="2142"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>, <span class="source_type">Dir</span>;
<a name="2143"></a>
<a name="2144"></a>	GetAxes(<span class="source_type">Rotation</span>, <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>);
<a name="2145"></a>	HitLoc.<span class="source_type">Z</span> = Location.<span class="source_type">Z</span>;
<a name="2146"></a>
<a name="2147"></a>	<span class="source_comment">// random
</span><a name="2148"></a>	if ( VSize(Velocity) &lt; <span class="source_int">10.0</span> && VSize(Location - HitLoc) &lt; <span class="source_int">1.0</span> )
<a name="2149"></a>	{
<a name="2150"></a>		<span class="source_type">Dir</span> = VRand();
<a name="2151"></a>	}
<a name="2152"></a>	<span class="source_comment">// velocity based
</span><a name="2153"></a>	else if ( VSize(Velocity) &gt; <span class="source_int">0.0</span> )
<a name="2154"></a>	{
<a name="2155"></a>		<span class="source_type">Dir</span> = Normal(Velocity*Vect(<span class="source_int">1</span>,<span class="source_int">1</span>,<span class="source_int">0</span>));
<a name="2156"></a>	}
<a name="2157"></a>	<span class="source_comment">// hit location based
</span><a name="2158"></a>	else
<a name="2159"></a>	{
<a name="2160"></a>		<span class="source_type">Dir</span> = -Normal(Location - HitLoc);
<a name="2161"></a>	}
<a name="2162"></a>
<a name="2163"></a>	<span class="source_comment">// MergeTODO: Need these missing anims
</span><a name="2164"></a>	if ( <span class="source_type">Dir</span> Dot <span class="source_type">X</span> &gt; <span class="source_int">0.7</span> || <span class="source_type">Dir</span> == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>))
<a name="2165"></a>		PlayAnim(<span class="source_name">'DeathB'</span>,, <span class="source_int">0.2</span>);
<a name="2166"></a>	else if ( <span class="source_type">Dir</span> Dot <span class="source_type">X</span> &lt; -<span class="source_int">0.7</span> )
<a name="2167"></a>		 PlayAnim(<span class="source_name">'DeathF'</span>,, <span class="source_int">0.2</span>);
<a name="2168"></a>	else if ( <span class="source_type">Dir</span> Dot <span class="source_type">Y</span> &gt; <span class="source_int">0</span> )
<a name="2169"></a>		PlayAnim(<span class="source_name">'DeathL'</span>,, <span class="source_int">0.2</span>);
<a name="2170"></a>	else
<a name="2171"></a>		PlayAnim(<span class="source_name">'DeathR'</span>,, <span class="source_int">0.2</span>);
<a name="2172"></a>}
<a name="2173"></a>
<a name="2174"></a><span class="source_comment">// MergeTODO: This needs work, it really doesn't work properly for a prone player
</span><a name="2175"></a>simulated function PlayDirectionalHit(<span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> HitLoc)
<a name="2176"></a>{
<a name="2177"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>, <span class="source_type">Dir</span>;
<a name="2178"></a>	local <span class="source_type">bool</span> bLegHit;
<a name="2179"></a>
<a name="2180"></a>	GetAxes(<span class="source_type">Rotation</span>, <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>);
<a name="2181"></a>
<a name="2182"></a>	bLegHit = Location.<span class="source_type">Z</span> - HitLoc.<span class="source_type">Z</span> &lt; CollisionHeight * <span class="source_int">0.7</span>;
<a name="2183"></a>
<a name="2184"></a>	HitLoc.<span class="source_type">Z</span> = Location.<span class="source_type">Z</span>;
<a name="2185"></a>
<a name="2186"></a>	<span class="source_comment">// random
</span><a name="2187"></a>	if ( VSize(Location - HitLoc) &lt; <span class="source_int">1.0</span> )
<a name="2188"></a>	{
<a name="2189"></a>		<span class="source_type">Dir</span> = VRand();
<a name="2190"></a>	}
<a name="2191"></a>	<span class="source_comment">// hit location based
</span><a name="2192"></a>	else
<a name="2193"></a>	{
<a name="2194"></a>		<span class="source_type">Dir</span> = -Normal(Location - HitLoc);
<a name="2195"></a>	}
<a name="2196"></a>
<a name="2197"></a>	if (bIsCrawling)
<a name="2198"></a>	{
<a name="2199"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2200"></a>			PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneHitAnim,, <span class="source_int">0.1</span>);
<a name="2201"></a>		else
<a name="2202"></a>			PlayAnim(ProneHitAnim,, <span class="source_int">0.1</span>);
<a name="2203"></a>
<a name="2204"></a>		return;
<a name="2205"></a>	}
<a name="2206"></a>	else if (bIsCrouched)
<a name="2207"></a>	{
<a name="2208"></a>		if (bLegHit)
<a name="2209"></a>		{
<a name="2210"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2211"></a>				PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchHitUpAnim,, <span class="source_int">0.1</span>);
<a name="2212"></a>			else
<a name="2213"></a>				PlayAnim(CrouchHitUpAnim,, <span class="source_int">0.1</span>);
<a name="2214"></a>		}
<a name="2215"></a>		else
<a name="2216"></a>		{
<a name="2217"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2218"></a>				PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchHitDownAnim,, <span class="source_int">0.1</span>);
<a name="2219"></a>			else
<a name="2220"></a>				PlayAnim(CrouchHitDownAnim,, <span class="source_int">0.1</span>);
<a name="2221"></a>		}
<a name="2222"></a>	}
<a name="2223"></a>
<a name="2224"></a>	if ( <span class="source_type">Dir</span> Dot <span class="source_type">X</span> &gt; <span class="source_int">0.7</span> || <span class="source_type">Dir</span> == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>))
<a name="2225"></a>	{
<a name="2226"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2227"></a>			PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_HitFAnim,, <span class="source_int">0.1</span>);
<a name="2228"></a>		else
<a name="2229"></a>			PlayAnim(HitFAnim,, <span class="source_int">0.1</span>);
<a name="2230"></a>	}
<a name="2231"></a>	else if ( <span class="source_type">Dir</span> Dot <span class="source_type">X</span> &lt; -<span class="source_int">0.7</span> )
<a name="2232"></a>	{
<a name="2233"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2234"></a>			PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_HitBAnim,, <span class="source_int">0.1</span>);
<a name="2235"></a>		else
<a name="2236"></a>			PlayAnim(HitBAnim,, <span class="source_int">0.1</span>);
<a name="2237"></a>	}
<a name="2238"></a>	else if ( <span class="source_type">Dir</span> Dot <span class="source_type">Y</span> &gt; <span class="source_int">0</span> )
<a name="2239"></a>	{
<a name="2240"></a>		if (bLegHit)
<a name="2241"></a>		{
<a name="2242"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2243"></a>				PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_HitRLegAnim,, <span class="source_int">0.1</span>);
<a name="2244"></a>			else
<a name="2245"></a>				PlayAnim(HitRLegAnim,, <span class="source_int">0.1</span>);
<a name="2246"></a>		}
<a name="2247"></a>		else
<a name="2248"></a>		{
<a name="2249"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2250"></a>				PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_HitRAnim,, <span class="source_int">0.1</span>);
<a name="2251"></a>			else
<a name="2252"></a>				PlayAnim(HitRAnim,, <span class="source_int">0.1</span>);
<a name="2253"></a>		}
<a name="2254"></a>	}
<a name="2255"></a>	else
<a name="2256"></a>	{
<a name="2257"></a>		if (bLegHit)
<a name="2258"></a>		{
<a name="2259"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2260"></a>				PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_HitLLegAnim,, <span class="source_int">0.1</span>);
<a name="2261"></a>			else
<a name="2262"></a>				PlayAnim(HitLLegAnim,, <span class="source_int">0.1</span>);
<a name="2263"></a>		}
<a name="2264"></a>		else
<a name="2265"></a>		{
<a name="2266"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2267"></a>				PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_HitLAnim,, <span class="source_int">0.1</span>);
<a name="2268"></a>			else
<a name="2269"></a>				PlayAnim(HitLAnim,, <span class="source_int">0.1</span>);
<a name="2270"></a>		}
<a name="2271"></a>	}
<a name="2272"></a>}
<a name="2273"></a>
<a name="2274"></a><span class="source_comment">//=============================================================
</span><a name="2275"></a><span class="source_comment">// Weapons/Inventory
</span><a name="2276"></a><span class="source_comment">//=============================================================
</span><a name="2277"></a>
<a name="2278"></a><span class="source_comment">// Overriden to set the weapon attachment to none when the weapon
</span><a name="2279"></a><span class="source_comment">// is thrown out. This will cause the correct animations to played
</span><a name="2280"></a><span class="source_comment">// by the physics system.
</span><a name="2281"></a>function DeleteInventory( <span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span> <span class="source_type">Item</span> )
<a name="2282"></a>{
<a name="2283"></a>	super.DeleteInventory( <span class="source_type">Item</span> );
<a name="2284"></a>
<a name="2285"></a>	<span class="source_comment">// Don't set the weaponattachment to none because we've already switched to another weapon
</span><a name="2286"></a>	if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none && <span class="source_type">Item</span>.AttachmentClass != <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.<span class="source_type">Class</span> )
<a name="2287"></a>	{
<a name="2288"></a>		return;
<a name="2289"></a>	}
<a name="2290"></a>
<a name="2291"></a>	if( <span class="source_type">Item</span>.IsA(<span class="source_name">'Weapon'</span>))
<a name="2292"></a>	{
<a name="2293"></a>		SetAnimAction(<span class="source_name">'TossedWeapon'</span>);
<a name="2294"></a>	}
<a name="2295"></a>}
<a name="2296"></a>
<a name="2297"></a>
<a name="2298"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2299"></a><span class="source_comment">// AddDefaultInventory - Add inventory based on role and weapons choices
</span><a name="2300"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2301"></a><span class="source_comment">// MergeTODO: This doesn't seem too bad, except we need to turn nades back on for bots at some point
</span><a name="2302"></a>function AddDefaultInventory()
<a name="2303"></a>{
<a name="2304"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="2305"></a>	local <span class="source_type">string</span> <span class="source_type">S</span>;
<a name="2306"></a>	local <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span> <span class="source_type">P</span>;
<a name="2307"></a>	local <span class="source_type"><a href="../roengine/robot.html" class="source">ROBot</a></span> <span class="source_type">B</span>;
<a name="2308"></a>	local <span class="source_type"><a href="../roengine/roroleinfo.html" class="source">RORoleInfo</a></span> RI;
<a name="2309"></a>
<a name="2310"></a>	if (<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == None)
<a name="2311"></a>		return;
<a name="2312"></a>
<a name="2313"></a>	<span class="source_type">P</span> = <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2314"></a>	<span class="source_type">B</span> = <span class="source_type"><a href="../roengine/robot.html" class="source">ROBot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2315"></a>
<a name="2316"></a>	if (IsLocallyControlled())
<a name="2317"></a>	{
<a name="2318"></a>		if (<span class="source_type">P</span> != None)
<a name="2319"></a>		{
<a name="2320"></a>			<span class="source_type">S</span> = <span class="source_type">P</span>.GetPrimaryWeapon();
<a name="2321"></a>
<a name="2322"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2323"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2324"></a>
<a name="2325"></a>			<span class="source_type">S</span> = <span class="source_type">P</span>.GetSecondaryWeapon();
<a name="2326"></a>
<a name="2327"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2328"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2329"></a>
<a name="2330"></a>			<span class="source_type">S</span> = <span class="source_type">P</span>.GetGrenadeWeapon();
<a name="2331"></a>
<a name="2332"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2333"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2334"></a>
<a name="2335"></a>			RI = <span class="source_type">P</span>.GetRoleInfo();
<a name="2336"></a>
<a name="2337"></a>			if (RI != None)
<a name="2338"></a>			{
<a name="2339"></a>				for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; RI.GivenItems.Length; <span class="source_type">i</span>++)
<a name="2340"></a>					CreateInventory(RI.GivenItems[<span class="source_type">i</span>]);
<a name="2341"></a>			}
<a name="2342"></a>		}
<a name="2343"></a>		else if (<span class="source_type">B</span> != None)
<a name="2344"></a>		{
<a name="2345"></a>			<span class="source_type">S</span> = <span class="source_type">B</span>.GetPrimaryWeapon();
<a name="2346"></a>
<a name="2347"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2348"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2349"></a>
<a name="2350"></a>			<span class="source_type">S</span> = <span class="source_type">B</span>.GetSecondaryWeapon();
<a name="2351"></a>
<a name="2352"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2353"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2354"></a>
<a name="2355"></a>            <span class="source_comment">// Not letting bots have nades till we get code in so bots can use them well - Ramm
</span><a name="2356"></a><span class="source_comment">/*			S = B.GetGrenadeWeapon();
<a name="2357"></a>
<a name="2358"></a>			if (S != "")
<a name="2359"></a>				CreateInventory(S); */</span>
<a name="2360"></a>
<a name="2361"></a>			RI = <span class="source_type">B</span>.GetRoleInfo();
<a name="2362"></a>
<a name="2363"></a>			if (RI != None)
<a name="2364"></a>			{
<a name="2365"></a>				for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; RI.GivenItems.Length; <span class="source_type">i</span>++)
<a name="2366"></a>					CreateInventory(RI.GivenItems[<span class="source_type">i</span>]);
<a name="2367"></a>			}
<a name="2368"></a>		}
<a name="2369"></a>
<a name="2370"></a>		<span class="source_type">Level</span>.Game.AddGameSpecificInventory(self);
<a name="2371"></a>	}
<a name="2372"></a>	else
<a name="2373"></a>	{
<a name="2374"></a>		<span class="source_type">Level</span>.Game.AddGameSpecificInventory(self);
<a name="2375"></a>
<a name="2376"></a>		if (<span class="source_type">P</span> != None)
<a name="2377"></a>		{
<a name="2378"></a>			RI = <span class="source_type">P</span>.GetRoleInfo();
<a name="2379"></a>
<a name="2380"></a>			if (RI != None)
<a name="2381"></a>			{
<a name="2382"></a>				for (<span class="source_type">i</span> = RI.GivenItems.Length - <span class="source_int">1</span>; <span class="source_type">i</span> &gt;= <span class="source_int">0</span>; <span class="source_type">i</span>--)
<a name="2383"></a>					CreateInventory(RI.GivenItems[<span class="source_type">i</span>]);
<a name="2384"></a>			}
<a name="2385"></a>
<a name="2386"></a>			<span class="source_type">S</span> = <span class="source_type">P</span>.GetGrenadeWeapon();
<a name="2387"></a>
<a name="2388"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2389"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2390"></a>
<a name="2391"></a>			<span class="source_type">S</span> = <span class="source_type">P</span>.GetSecondaryWeapon();
<a name="2392"></a>
<a name="2393"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2394"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2395"></a>
<a name="2396"></a>			<span class="source_type">S</span> = <span class="source_type">P</span>.GetPrimaryWeapon();
<a name="2397"></a>
<a name="2398"></a>			if (<span class="source_type">S</span> != <span class="source_string">""</span>)
<a name="2399"></a>				CreateInventory(<span class="source_type">S</span>);
<a name="2400"></a>		}
<a name="2401"></a>	}
<a name="2402"></a>
<a name="2403"></a>    NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="2404"></a>
<a name="2405"></a>	<span class="source_comment">// HACK FIXME
</span><a name="2406"></a>	if (<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> != None)
<a name="2407"></a>		<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.OwnerEvent(<span class="source_name">'LoadOut'</span>);
<a name="2408"></a>
<a name="2409"></a>	if( <span class="source_type">Level</span>.Netmode == NM_Standalone || <span class="source_type">Level</span>.Netmode == NM_ListenServer && IsLocallyControlled())
<a name="2410"></a>	{
<a name="2411"></a>		bRecievedInitialLoadout = true;
<a name="2412"></a>		<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.ClientSwitchToBestWeapon();
<a name="2413"></a>	}
<a name="2414"></a>}
<a name="2415"></a>
<a name="2416"></a><span class="source_comment">// Hacked in so ammo supply volumes give explosive weapons as well
</span><a name="2417"></a>function <span class="source_type">bool</span> ResupplyExplosiveWeapons()
<a name="2418"></a>{
<a name="2419"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="2420"></a>	local <span class="source_type">string</span> <span class="source_type">S</span>;
<a name="2421"></a>	local <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span> <span class="source_type">P</span>;
<a name="2422"></a>	local <span class="source_type"><a href="../roengine/roroleinfo.html" class="source">RORoleInfo</a></span> RI;
<a name="2423"></a>	local <span class="source_type">bool</span> bDidResupply;
<a name="2424"></a>	local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>&gt; InventoryClass;
<a name="2425"></a>
<a name="2426"></a>	if (<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == None)
<a name="2427"></a>		return false;
<a name="2428"></a>
<a name="2429"></a>	<span class="source_type">P</span> = <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2430"></a>
<a name="2431"></a>	<span class="source_comment">// For now we don't give bots nades until they know how to use them
</span><a name="2432"></a>	if( <span class="source_type">P</span> == none )
<a name="2433"></a>		return false;
<a name="2434"></a>
<a name="2435"></a>	<span class="source_type">S</span> = <span class="source_type">P</span>.GetGrenadeWeapon();
<a name="2436"></a>
<a name="2437"></a>	if( <span class="source_type">S</span> != <span class="source_string">""</span> )
<a name="2438"></a>		InventoryClass = <span class="source_type">Level</span>.Game.BaseMutator.GetInventoryClass(<span class="source_type">S</span>);
<a name="2439"></a>
<a name="2440"></a>	if( (InventoryClass!=None) && (FindInventoryType(InventoryClass)==None) )
<a name="2441"></a>	{
<a name="2442"></a>		CreateInventory(<span class="source_type">S</span>);
<a name="2443"></a>		bDidResupply=true;
<a name="2444"></a>	}
<a name="2445"></a>
<a name="2446"></a>	RI = <span class="source_type">P</span>.GetRoleInfo();
<a name="2447"></a>
<a name="2448"></a>	if (RI != None)
<a name="2449"></a>	{
<a name="2450"></a>		for (<span class="source_type">i</span> = RI.GivenItems.Length - <span class="source_int">1</span>; <span class="source_type">i</span> &gt;= <span class="source_int">0</span>; <span class="source_type">i</span>--)
<a name="2451"></a>		{
<a name="2452"></a>			InventoryClass = none;
<a name="2453"></a>			InventoryClass = <span class="source_type">Level</span>.Game.BaseMutator.GetInventoryClass(RI.GivenItems[<span class="source_type">i</span>]);
<a name="2454"></a>
<a name="2455"></a>			if(	(InventoryClass!=None) && (FindInventoryType(InventoryClass)==None)  )
<a name="2456"></a>			{
<a name="2457"></a>				CreateInventory(RI.GivenItems[<span class="source_type">i</span>]);
<a name="2458"></a>				bDidResupply=true;
<a name="2459"></a>			}
<a name="2460"></a>		}
<a name="2461"></a>	}
<a name="2462"></a>
<a name="2463"></a>	return bDidResupply;
<a name="2464"></a>}
<a name="2465"></a>
<a name="2466"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2467"></a><span class="source_comment">// CanSwitchWeapon
</span><a name="2468"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2469"></a>simulated function <span class="source_type">bool</span> CanSwitchWeapon()
<a name="2470"></a>{
<a name="2471"></a>	if( IsInState(<span class="source_name">'StartProning'</span>) || IsInState(<span class="source_name">'EndProning'</span>) || IsInState(<span class="source_name">'DiveToProne'</span>) )
<a name="2472"></a>		return false;
<a name="2473"></a>
<a name="2474"></a>	if (bIsCrawling && Acceleration != vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>))
<a name="2475"></a>		return false;
<a name="2476"></a>
<a name="2477"></a>    <span class="source_comment">// If the weapon is busy, don't allow a switch
</span><a name="2478"></a>	if (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None && !<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.WeaponCanSwitch())
<a name="2479"></a>		return false;
<a name="2480"></a>
<a name="2481"></a>	return true;
<a name="2482"></a>}
<a name="2483"></a>
<a name="2484"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2485"></a><span class="source_comment">// CanBusySwitchWeapon - The weapon can be switched even though the player
</span><a name="2486"></a><span class="source_comment">// or the weapon is busy (Needed for certain cases like nades - don't want to
</span><a name="2487"></a><span class="source_comment">// prevent someone from finishing throwing thier nade and cause them to
</span><a name="2488"></a><span class="source_comment">// explode :)
</span><a name="2489"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2490"></a>simulated function <span class="source_type">bool</span> CanBusySwitchWeapon()
<a name="2491"></a>{
<a name="2492"></a>    <span class="source_comment">// if the weapon is busy, don't allow a switch
</span><a name="2493"></a>	if (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None && !<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.WeaponCanBusySwitch())
<a name="2494"></a>		return false;
<a name="2495"></a>
<a name="2496"></a>	return true;
<a name="2497"></a>}
<a name="2498"></a>
<a name="2499"></a><span class="source_comment">// toss out a weapon
</span><a name="2500"></a>function TossWeapon(<span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> TossVel)
<a name="2501"></a>{
<a name="2502"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>;
<a name="2503"></a>
<a name="2504"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == none )
<a name="2505"></a>		return;
<a name="2506"></a>
<a name="2507"></a>	<span class="source_comment">// Undeploy the weapon if they are deployed
</span><a name="2508"></a> 	if( bBipodDeployed )
<a name="2509"></a>	 	SetBipodDeployed(false);
<a name="2510"></a>
<a name="2511"></a>	<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.Velocity = TossVel;
<a name="2512"></a>	GetAxes(<span class="source_type">Rotation</span>,<span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>);
<a name="2513"></a>	<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.DropFrom(Location + <span class="source_int">0.8</span> * CollisionRadius * <span class="source_type">X</span> - <span class="source_int">0.5</span> * CollisionRadius * <span class="source_type">Y</span>);
<a name="2514"></a>}
<a name="2515"></a>
<a name="2516"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2517"></a><span class="source_comment">// TossMGAmmo(RO) - toss out MG ammo all players carry
</span><a name="2518"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2519"></a>function TossMGAmmo( <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> <span class="source_type">Gunner</span>)
<a name="2520"></a>{
<a name="2521"></a>	local <span class="source_type">bool</span> bResupplySuccessful;
<a name="2522"></a>
<a name="2523"></a>	if( bUsedCarriedMGAmmo )
<a name="2524"></a>		return;
<a name="2525"></a>
<a name="2526"></a>	if( <span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none && <span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ResupplyAmmo())
<a name="2527"></a>	{
<a name="2528"></a>		bResupplySuccessful=true;
<a name="2529"></a>	}
<a name="2530"></a>
<a name="2531"></a>	bUsedCarriedMGAmmo = bResupplySuccessful;
<a name="2532"></a>	if( bResupplySuccessful )
<a name="2533"></a>	{
<a name="2534"></a>		if( (<span class="source_type"><a href="../roengine/roteamgame.html" class="source">ROTeamGame</a></span>(<span class="source_type">Level</span>.Game) != none) && (<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != none)
<a name="2535"></a>			&& (<span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != none) )
<a name="2536"></a>		{
<a name="2537"></a>		    <span class="source_comment">// Send notification message to gunner & remove resupply request
</span><a name="2538"></a>		    if (<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none)
<a name="2539"></a>		    {
<a name="2540"></a>		        <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ReceiveLocalizedMessage(
<a name="2541"></a>                    <span class="source_type">class</span><span class="source_name">'ROResupplyMessage'</span>, <span class="source_int">1</span>, <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="2542"></a>                if (<span class="source_type"><a href="../roengine/rogamereplicationinfo.html" class="source">ROGameReplicationInfo</a></span>(<span class="source_type"><a href="../roengine/roteamgame.html" class="source">ROTeamGame</a></span>(<span class="source_type">Level</span>.Game).<span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>) != none)
<a name="2543"></a>                    <span class="source_type"><a href="../roengine/rogamereplicationinfo.html" class="source">ROGameReplicationInfo</a></span>(<span class="source_type"><a href="../roengine/roteamgame.html" class="source">ROTeamGame</a></span>(<span class="source_type">Level</span>.Game).<span class="source_type"><a href="../engine/gamereplicationinfo.html" class="source">GameReplicationInfo</a></span>)
<a name="2544"></a>                        .RemoveMGResupplyRequestFor(<span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="2545"></a>            }
<a name="2546"></a>
<a name="2547"></a>            <span class="source_comment">// Send notification message to supplier
</span><a name="2548"></a>            if (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none)
<a name="2549"></a>            {
<a name="2550"></a>                <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ReceiveLocalizedMessage(
<a name="2551"></a>                    <span class="source_type">class</span><span class="source_name">'ROResupplyMessage'</span>, <span class="source_int">0</span>, <span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="2552"></a>		    }
<a name="2553"></a>
<a name="2554"></a>		    <span class="source_comment">// Score point
</span><a name="2555"></a>			<span class="source_type"><a href="../roengine/roteamgame.html" class="source">ROTeamGame</a></span>(<span class="source_type">Level</span>.Game).ScoreMGResupply(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>, <span class="source_type">Gunner</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2556"></a>		}
<a name="2557"></a>
<a name="2558"></a>    	<span class="source_comment">//PlayOwnedSound(sound'Inf_Weapons_Foley.ammogive', SLOT_Interact, 1.75,, 10);
</span><a name="2559"></a>	}
<a name="2560"></a>}
<a name="2561"></a>
<a name="2562"></a><span class="source_comment">/* PrevWeapon()
<a name="2563"></a>- switch to previous inventory group weapon
<a name="2564"></a>*/</span>
<a name="2565"></a>simulated function PrevWeapon()
<a name="2566"></a>{
<a name="2567"></a>    if ( <span class="source_type">Level</span>.Pauser != None )
<a name="2568"></a>        return;
<a name="2569"></a>
<a name="2570"></a> 	if( !bRecievedInitialLoadout )
<a name="2571"></a> 	{
<a name="2572"></a> 		return;
<a name="2573"></a> 	}
<a name="2574"></a>
<a name="2575"></a>    if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == None && <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="2576"></a>    {
<a name="2577"></a>        <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.SwitchToBestWeapon();
<a name="2578"></a>        return;
<a name="2579"></a>    }
<a name="2580"></a>    if ( PendingWeapon != None )
<a name="2581"></a>    {
<a name="2582"></a>        if ( PendingWeapon.bForceSwitch )
<a name="2583"></a>            return;
<a name="2584"></a>        PendingWeapon = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.PrevWeapon(None, PendingWeapon);
<a name="2585"></a>    }
<a name="2586"></a>    else
<a name="2587"></a>        PendingWeapon = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.PrevWeapon(None, <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>);
<a name="2588"></a>
<a name="2589"></a>    if ( (PendingWeapon != none) && (PendingWeapon != <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) )
<a name="2590"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="2591"></a>}
<a name="2592"></a>
<a name="2593"></a><span class="source_comment">/* NextWeapon()
<a name="2594"></a>- switch to next inventory group weapon
<a name="2595"></a>*/</span>
<a name="2596"></a>simulated function NextWeapon()
<a name="2597"></a>{
<a name="2598"></a>    if ( <span class="source_type">Level</span>.Pauser != None )
<a name="2599"></a>        return;
<a name="2600"></a>
<a name="2601"></a> 	if( !bRecievedInitialLoadout )
<a name="2602"></a> 	{
<a name="2603"></a> 		return;
<a name="2604"></a> 	}
<a name="2605"></a>
<a name="2606"></a>    if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == None && <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="2607"></a>    {
<a name="2608"></a>        <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.SwitchToBestWeapon();
<a name="2609"></a>        return;
<a name="2610"></a>    }
<a name="2611"></a>    if ( PendingWeapon != None )
<a name="2612"></a>    {
<a name="2613"></a>		if ( PendingWeapon.bForceSwitch )
<a name="2614"></a>            return;
<a name="2615"></a>        PendingWeapon = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.NextWeapon(None, PendingWeapon);
<a name="2616"></a>    }
<a name="2617"></a>    else
<a name="2618"></a>    {
<a name="2619"></a>	    PendingWeapon = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.NextWeapon(None, <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>);
<a name="2620"></a>    }
<a name="2621"></a>
<a name="2622"></a>    if ( (PendingWeapon != none) && (PendingWeapon != <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) )
<a name="2623"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="2624"></a>}
<a name="2625"></a>
<a name="2626"></a><span class="source_comment">// The player wants to switch to weapon group number F. Overriden to fix "no weapon" issues when switching weapons right after spawning
</span><a name="2627"></a>simulated function SwitchWeapon(<span class="source_type">byte</span> <span class="source_type">F</span>)
<a name="2628"></a>{
<a name="2629"></a>    local <span class="source_type"><a href="../engine/weapon.html" class="source">weapon</a></span> newWeapon;
<a name="2630"></a>
<a name="2631"></a> 	if( !bRecievedInitialLoadout )
<a name="2632"></a> 	{
<a name="2633"></a> 		return;
<a name="2634"></a> 	}
<a name="2635"></a>
<a name="2636"></a>    if ( (<span class="source_type">Level</span>.Pauser!=None) || (<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> == None) )
<a name="2637"></a>        return;
<a name="2638"></a>    if ( (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None) && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> != None) )
<a name="2639"></a>        newWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.WeaponChange(<span class="source_type">F</span>, false);
<a name="2640"></a>    else
<a name="2641"></a>        newWeapon = None;
<a name="2642"></a>    if ( newWeapon == None )
<a name="2643"></a>        newWeapon = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.WeaponChange(<span class="source_type">F</span>, true);
<a name="2644"></a>
<a name="2645"></a>    if ( newWeapon == None )
<a name="2646"></a>	{
<a name="2647"></a>		if ( <span class="source_type">F</span> == <span class="source_int">10</span> )
<a name="2648"></a>			ServerNoTranslocator();
<a name="2649"></a>
<a name="2650"></a>		return;
<a name="2651"></a>	}
<a name="2652"></a>
<a name="2653"></a>    if ( PendingWeapon != None && PendingWeapon.bForceSwitch )
<a name="2654"></a>        return;
<a name="2655"></a>
<a name="2656"></a>    if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == None )
<a name="2657"></a>    {
<a name="2658"></a>        PendingWeapon = newWeapon;
<a name="2659"></a>        ChangedWeapon();
<a name="2660"></a>    }
<a name="2661"></a>    else if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != newWeapon || PendingWeapon != None )
<a name="2662"></a>    {
<a name="2663"></a>        PendingWeapon = newWeapon;
<a name="2664"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="2665"></a>    }
<a name="2666"></a>    else if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == newWeapon )
<a name="2667"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.Reselect(); <span class="source_comment">// sjs
</span><a name="2668"></a>}
<a name="2669"></a>
<a name="2670"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2671"></a><span class="source_comment">// GetWeaponBoneFor - Determines proper bone for inventory
</span><a name="2672"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2673"></a><span class="source_comment">// MergeTODO: These are going to change. Also, rather than hard coding it maybe a variable would be better
</span><a name="2674"></a>function <span class="source_type">name</span> GetWeaponBoneFor(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>)
<a name="2675"></a>{
<a name="2676"></a>    if (<span class="source_type">I</span>.IsA(<span class="source_name">'ROGrenadeWeapon'</span>) || <span class="source_type">I</span>.IsA(<span class="source_name">'ROPistolWeapon'</span>) || <span class="source_type">I</span>.IsA(<span class="source_name">'ROSatchelChargeWeapon'</span>))
<a name="2677"></a>		return <span class="source_name">'weapon_rhand'</span>;<span class="source_comment">//'righthand';
</span><a name="2678"></a>	else if (<span class="source_type">I</span>.IsA(<span class="source_name">'Weapon'</span>))
<a name="2679"></a>		return <span class="source_name">'weapon_rhand'</span>;<span class="source_comment">//'FlagHand';
</span><a name="2680"></a>}
<a name="2681"></a>
<a name="2682"></a><span class="source_comment">// Same as GetWeaponBoneFor, but statically and works on a class&lt;Inventory&gt; instead of instance
</span><a name="2683"></a><span class="source_comment">// Used by ROGUISelection to get weapon attachment bone
</span><a name="2684"></a>static function <span class="source_type">name</span> StaticGetWeaponBoneFor(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>&gt; <span class="source_type">I</span>)
<a name="2685"></a>{
<a name="2686"></a>    <span class="source_comment">// Not sure how to implement this, but seems righthand is what's always being used :)
</span><a name="2687"></a>    return <span class="source_name">'weapon_rhand'</span>;
<a name="2688"></a>}
<a name="2689"></a>
<a name="2690"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2691"></a><span class="source_comment">// StartFiring
</span><a name="2692"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2693"></a>
<a name="2694"></a>simulated function StartFiring(<span class="source_type">bool</span> bAltFire, <span class="source_type">bool</span> bRapid)
<a name="2695"></a>{
<a name="2696"></a>	local <span class="source_type">name</span> FireAnim;
<a name="2697"></a>	local <span class="source_type">bool</span> bIsMoving;
<a name="2698"></a>
<a name="2699"></a>	if (Physics == PHYS_Swimming || <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> == None)
<a name="2700"></a>		return;
<a name="2701"></a>
<a name="2702"></a>	bIsMoving = VSizeSquared(Velocity) &gt; <span class="source_int">25</span>;
<a name="2703"></a>
<a name="2704"></a>	if (bAltFire)
<a name="2705"></a>	{
<a name="2706"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached)
<a name="2707"></a>		{
<a name="2708"></a>			if (bIsCrawling)
<a name="2709"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneBayonetAltFire;
<a name="2710"></a>			else if (bIsCrouched)
<a name="2711"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchBayonetAltFire;
<a name="2712"></a>			else
<a name="2713"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_BayonetAltFire;
<a name="2714"></a>		}
<a name="2715"></a>		else
<a name="2716"></a>		{
<a name="2717"></a>			if (bIsCrawling)
<a name="2718"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneAltFire;
<a name="2719"></a>			else if (bIsCrouched)
<a name="2720"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchAltFire;
<a name="2721"></a>			else if( bBipodDeployed )
<a name="2722"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_DeployedAltFire;
<a name="2723"></a>			else
<a name="2724"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_AltFire;
<a name="2725"></a>		}
<a name="2726"></a>	}
<a name="2727"></a>	<span class="source_comment">// regular fire
</span><a name="2728"></a>	else
<a name="2729"></a>	{
<a name="2730"></a>		if( bBipodDeployed )
<a name="2731"></a>		{
<a name="2732"></a>			if (bIsCrouched)
<a name="2733"></a>			{
<a name="2734"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchDeployedFire;
<a name="2735"></a>			}
<a name="2736"></a>			else if ( bIsCrawling )
<a name="2737"></a>			{
<a name="2738"></a>			    FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneDeployedFire;
<a name="2739"></a>			}
<a name="2740"></a>			else
<a name="2741"></a>			{
<a name="2742"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_DeployedFire;
<a name="2743"></a>			}
<a name="2744"></a>		}
<a name="2745"></a>		else if (bIsCrawling)
<a name="2746"></a>			FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneFire;
<a name="2747"></a>		else if (bIsCrouched)
<a name="2748"></a>		{
<a name="2749"></a>			if( bIsMoving )
<a name="2750"></a>			{
<a name="2751"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_MoveCrouchFire[Get8WayDirection()];
<a name="2752"></a>			}
<a name="2753"></a>			else
<a name="2754"></a>			{
<a name="2755"></a>			 	if (bIronSights)
<a name="2756"></a>			 	{
<a name="2757"></a>				 	FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchIronFire;
<a name="2758"></a>				}
<a name="2759"></a>				else
<a name="2760"></a>				{
<a name="2761"></a>				 	FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_CrouchFire;
<a name="2762"></a>				}
<a name="2763"></a>			}
<a name="2764"></a>		}
<a name="2765"></a>		else if (bIronSights)
<a name="2766"></a>		{
<a name="2767"></a>			if( bIsMoving )
<a name="2768"></a>			{
<a name="2769"></a>				FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_MoveStandIronFire[Get8WayDirection()];
<a name="2770"></a>			}
<a name="2771"></a>			else
<a name="2772"></a>			{
<a name="2773"></a>			 	FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_IronFire;
<a name="2774"></a>			}
<a name="2775"></a>		}
<a name="2776"></a>		else
<a name="2777"></a>		{
<a name="2778"></a>			if( bIsMoving )
<a name="2779"></a>			{
<a name="2780"></a>				if(bIsWalking)
<a name="2781"></a>				{
<a name="2782"></a>					FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_MoveWalkFire[Get8WayDirection()];
<a name="2783"></a>				}
<a name="2784"></a>				else
<a name="2785"></a>				{
<a name="2786"></a>				 	FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_MoveStandFire[Get8WayDirection()];
<a name="2787"></a>				}
<a name="2788"></a>			}
<a name="2789"></a>			else
<a name="2790"></a>			{
<a name="2791"></a>			 	FireAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_Fire;
<a name="2792"></a>			}
<a name="2793"></a>		}
<a name="2794"></a>	}
<a name="2795"></a>
<a name="2796"></a>	<span class="source_comment">// blend the fire animation a bit so the standard player movement animations still play
</span><a name="2797"></a>	AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">0.25</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2798"></a>
<a name="2799"></a>	if (bRapid)
<a name="2800"></a>	{
<a name="2801"></a>		if (WeaponState != GS_FireLooped)
<a name="2802"></a>		{
<a name="2803"></a>			LoopAnim(FireAnim,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="2804"></a>			WeaponState = GS_FireLooped;
<a name="2805"></a>
<a name="2806"></a>			if (!bAltFire)
<a name="2807"></a>			{
<a name="2808"></a>				if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached)
<a name="2809"></a>					<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.LoopAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetFire);
<a name="2810"></a>				else
<a name="2811"></a>					<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.LoopAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_Fire);
<a name="2812"></a>			}
<a name="2813"></a>		}
<a name="2814"></a>	}
<a name="2815"></a>	else
<a name="2816"></a>	{
<a name="2817"></a>		PlayAnim(FireAnim,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="2818"></a>		WeaponState = GS_FireSingle;
<a name="2819"></a>
<a name="2820"></a>		if (!bAltFire)
<a name="2821"></a>		{
<a name="2822"></a>			if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached)
<a name="2823"></a>				<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetFire);
<a name="2824"></a>			else
<a name="2825"></a>				<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_Fire);
<a name="2826"></a>		}
<a name="2827"></a>	}
<a name="2828"></a>
<a name="2829"></a>	IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="2830"></a>}
<a name="2831"></a>
<a name="2832"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2833"></a><span class="source_comment">// StopFiring
</span><a name="2834"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2835"></a>
<a name="2836"></a>simulated function StopFiring()
<a name="2837"></a>{
<a name="2838"></a>	if (WeaponState == GS_FireLooped)
<a name="2839"></a>	{
<a name="2840"></a>		WeaponState = GS_FireSingle;
<a name="2841"></a>	}
<a name="2842"></a>
<a name="2843"></a>	IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="2844"></a>}
<a name="2845"></a>
<a name="2846"></a><span class="source_comment">// Called on the server. Sends a message to the client to let them know to play a the reload
</span><a name="2847"></a>function HandleStandardReload()
<a name="2848"></a>{
<a name="2849"></a>	local <span class="source_type">name</span> PlayerAnim;
<a name="2850"></a>	local <span class="source_type">bool</span> bEmpty;
<a name="2851"></a>
<a name="2852"></a>	<span class="source_comment">// Set the anim blend time so the server will make this player relevant for third person reload sounds to be heard
</span><a name="2853"></a>	if( <span class="source_type">Level</span>.NetMode != NM_StandAlone )
<a name="2854"></a>	{
<a name="2855"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2856"></a>		{
<a name="2857"></a>	     	bEmpty = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo;
<a name="2858"></a>
<a name="2859"></a>			if (bEmpty)
<a name="2860"></a>			{
<a name="2861"></a>				if (bIsCrawling)
<a name="2862"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneReloadEmptyAnim;
<a name="2863"></a>				else
<a name="2864"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ReloadEmptyAnim;
<a name="2865"></a>			}
<a name="2866"></a>			else
<a name="2867"></a>			{
<a name="2868"></a>				if (bIsCrawling)
<a name="2869"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneReloadAnim;
<a name="2870"></a>				else
<a name="2871"></a>					PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ReloadAnim;
<a name="2872"></a>			}
<a name="2873"></a>
<a name="2874"></a>			AnimBlendTime = GetAnimDuration(PlayerAnim, <span class="source_int">1.0</span>)+<span class="source_int">0.1</span>;
<a name="2875"></a>		}
<a name="2876"></a>	}
<a name="2877"></a>
<a name="2878"></a>	SetAnimAction(<span class="source_name">'DoStandardReload'</span>);
<a name="2879"></a>}
<a name="2880"></a>
<a name="2881"></a><span class="source_comment">// Called on the server. Sends a message to the client to let them know to start a looping reload
</span><a name="2882"></a>function StartReload()
<a name="2883"></a>{
<a name="2884"></a>	SetAnimAction(<span class="source_name">'DoLoopingReload'</span>);
<a name="2885"></a>}
<a name="2886"></a>
<a name="2887"></a><span class="source_comment">// Called on the server. Sends a message to the client to let them know to play a the reload
</span><a name="2888"></a>function StopReload()
<a name="2889"></a>{
<a name="2890"></a>	SetAnimAction(<span class="source_name">'DoReloadEnd'</span>);
<a name="2891"></a>}
<a name="2892"></a>
<a name="2893"></a><span class="source_comment">// Play a standard reload on the client
</span><a name="2894"></a>simulated function PlayStandardReload()
<a name="2895"></a>{
<a name="2896"></a>	local <span class="source_type">name</span> PlayerAnim;
<a name="2897"></a>	local <span class="source_type">name</span> WeaponAnim;
<a name="2898"></a>	local <span class="source_type">bool</span> bEmpty;
<a name="2899"></a>
<a name="2900"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2901"></a>	{
<a name="2902"></a>     	bEmpty = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo;
<a name="2903"></a>
<a name="2904"></a>		if (bEmpty)
<a name="2905"></a>		{
<a name="2906"></a>			if (bIsCrawling)
<a name="2907"></a>				PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneReloadEmptyAnim;
<a name="2908"></a>			else
<a name="2909"></a>				PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ReloadEmptyAnim;
<a name="2910"></a>		}
<a name="2911"></a>		else
<a name="2912"></a>		{
<a name="2913"></a>			if (bIsCrawling)
<a name="2914"></a>				PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ProneReloadAnim;
<a name="2915"></a>			else
<a name="2916"></a>				PlayerAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_ReloadAnim;
<a name="2917"></a>		}
<a name="2918"></a>
<a name="2919"></a>
<a name="2920"></a>
<a name="2921"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached)
<a name="2922"></a>		{
<a name="2923"></a>			if( bIsCrawling )
<a name="2924"></a>			{
<a name="2925"></a>				if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReloadEmpty != <span class="source_name">''</span>)
<a name="2926"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReloadEmpty;
<a name="2927"></a>				else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReload != <span class="source_name">''</span>)
<a name="2928"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetProneReload;
<a name="2929"></a>			}
<a name="2930"></a>			else
<a name="2931"></a>			{
<a name="2932"></a>				if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReloadEmpty != <span class="source_name">''</span>)
<a name="2933"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReloadEmpty;
<a name="2934"></a>				else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReload != <span class="source_name">''</span>)
<a name="2935"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetReload;
<a name="2936"></a>			}
<a name="2937"></a>		}
<a name="2938"></a>		else
<a name="2939"></a>		{
<a name="2940"></a>			if( bIsCrawling )
<a name="2941"></a>			{
<a name="2942"></a>				if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReloadEmpty != <span class="source_name">''</span>)
<a name="2943"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReloadEmpty;
<a name="2944"></a>				else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReload != <span class="source_name">''</span>)
<a name="2945"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ProneReload;
<a name="2946"></a>			}
<a name="2947"></a>			else
<a name="2948"></a>			{
<a name="2949"></a>				if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bOutOfAmmo && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ReloadEmpty != <span class="source_name">''</span>)
<a name="2950"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_ReloadEmpty;
<a name="2951"></a>				else
<a name="2952"></a>					WeaponAnim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_Reload;
<a name="2953"></a>			}
<a name="2954"></a>		}
<a name="2955"></a>
<a name="2956"></a>        if( bIsCrawling )
<a name="2957"></a>		{
<a name="2958"></a>	        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2959"></a>        }
<a name="2960"></a>        else
<a name="2961"></a>        {
<a name="2962"></a>			AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="2963"></a>	        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="2964"></a>        }
<a name="2965"></a>		PlayAnim(PlayerAnim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="2966"></a>		<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(WeaponAnim,, <span class="source_int">0.1</span>);
<a name="2967"></a>
<a name="2968"></a>		AnimBlendTime = GetAnimDuration(PlayerAnim, <span class="source_int">1.0</span>)+<span class="source_int">0.1</span>;
<a name="2969"></a>
<a name="2970"></a>		WeaponState = GS_ReloadSingle;
<a name="2971"></a>	}
<a name="2972"></a>}
<a name="2973"></a>
<a name="2974"></a>
<a name="2975"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2976"></a><span class="source_comment">// StartReloading - Play reloading anims
</span><a name="2977"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="2978"></a>
<a name="2979"></a>simulated function PlayStartReloading()
<a name="2980"></a>{
<a name="2981"></a>	if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="2982"></a>	{
<a name="2983"></a>		<span class="source_comment">// Play the pre-reload anim and then return if looping
</span><a name="2984"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span> , <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone1);
<a name="2985"></a>        AnimBlendParams(<span class="source_int">1</span>,<span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, SpineBone2);
<a name="2986"></a>
<a name="2987"></a>		if (bIsCrawling)
<a name="2988"></a>			PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_PronePreReloadAnim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="2989"></a>		else
<a name="2990"></a>			PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_PreReloadAnim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="2991"></a>
<a name="2992"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetPreReload != <span class="source_name">''</span>)
<a name="2993"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetPreReload,, <span class="source_int">0.1</span>);
<a name="2994"></a>		else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_PreReload != <span class="source_name">''</span>)
<a name="2995"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_PreReload,, <span class="source_int">0.1</span>);
<a name="2996"></a>
<a name="2997"></a>		WeaponState = GS_PreReload;
<a name="2998"></a>	}
<a name="2999"></a>}
<a name="3000"></a>
<a name="3001"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3002"></a><span class="source_comment">// StopReloading - Stop reloading anims if looping
</span><a name="3003"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3004"></a>
<a name="3005"></a>simulated function PlayStopReloading()
<a name="3006"></a>{
<a name="3007"></a>	if ((WeaponState == GS_ReloadLooped || WeaponState == GS_PreReload) && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="3008"></a>	{
<a name="3009"></a>		AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="3010"></a>
<a name="3011"></a>		if (bIsCrawling)
<a name="3012"></a>			PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_PronePostReloadAnim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="3013"></a>		else
<a name="3014"></a>			PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_PostReloadAnim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="3015"></a>
<a name="3016"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.bBayonetAttached && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetPostReload != <span class="source_name">''</span>)
<a name="3017"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_BayonetPostReload,, <span class="source_int">0.1</span>);
<a name="3018"></a>		else if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_PostReload != <span class="source_name">''</span>)
<a name="3019"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayAnim(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.WA_PostReload,, <span class="source_int">0.1</span>);
<a name="3020"></a>
<a name="3021"></a>		WeaponState = GS_ReloadSingle;
<a name="3022"></a>	}
<a name="3023"></a>
<a name="3024"></a>	IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="3025"></a>}
<a name="3026"></a>
<a name="3027"></a><span class="source_comment">//=============================================================
</span><a name="3028"></a><span class="source_comment">// Movement
</span><a name="3029"></a><span class="source_comment">//=============================================================
</span><a name="3030"></a>
<a name="3031"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3032"></a><span class="source_comment">// StartSprint
</span><a name="3033"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3034"></a>
<a name="3035"></a>function StartSprint()
<a name="3036"></a>{
<a name="3037"></a>	if (<span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != None)
<a name="3038"></a>		<span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).SetSprinting(true);
<a name="3039"></a>}
<a name="3040"></a>
<a name="3041"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3042"></a><span class="source_comment">// EndSprint
</span><a name="3043"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3044"></a>
<a name="3045"></a>function EndSprint()
<a name="3046"></a>{
<a name="3047"></a>	if (<span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != None)
<a name="3048"></a>		<span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).SetSprinting(false);
<a name="3049"></a>}
<a name="3050"></a>
<a name="3051"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3052"></a><span class="source_comment">// BaseChange - Took out pawn damage, and added momentum from vehicle
</span><a name="3053"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3054"></a>singular event BaseChange()
<a name="3055"></a>{
<a name="3056"></a>	local <span class="source_type">float</span> decorMass;
<a name="3057"></a>
<a name="3058"></a>	if ( bInterpolating )
<a name="3059"></a>		return;
<a name="3060"></a>
<a name="3061"></a>	<span class="source_comment">// If someone jumps off a moving vehicle, give them the vehicles momentum
</span><a name="3062"></a>	if ( base == none && <span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span>(SavedBase) != none && (VSize(<span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span>(SavedBase).Velocity) &gt; <span class="source_int">25</span>))
<a name="3063"></a>	{
<a name="3064"></a>		Velocity += <span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span>(SavedBase).Velocity;
<a name="3065"></a>		Velocity.<span class="source_type">Z</span> += <span class="source_int">5</span>;
<a name="3066"></a>	}
<a name="3067"></a>	SavedBase = base;
<a name="3068"></a>
<a name="3069"></a>	if ( (base == None) && (Physics == PHYS_None) )
<a name="3070"></a>		SetPhysics(PHYS_Falling);
<a name="3071"></a>	<span class="source_comment">// Pawns can only set base to non-pawns, or pawns which specifically allow it.
</span><a name="3072"></a>	<span class="source_comment">// Otherwise jump off.
</span><a name="3073"></a>     else if ( <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(Base) != None )
<a name="3074"></a>	{
<a name="3075"></a>		if ( !<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(Base).bCanBeBaseForPawns && <span class="source_type"><a href="../roengine/ropawn.html" class="source">ROPawn</a></span>(Base) == none || <span class="source_type"><a href="../roengine/ropawn.html" class="source">ROPawn</a></span>(Base) != none && VSize(Base.Velocity) &gt; <span class="source_int">1</span>)
<a name="3076"></a>		{
<a name="3077"></a>			JumpOffPawn();
<a name="3078"></a>		}
<a name="3079"></a>	}
<a name="3080"></a>	else if ( (<span class="source_type"><a href="../engine/decoration.html" class="source">Decoration</a></span>(Base) != None) && (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">400</span>) )
<a name="3081"></a>	{
<a name="3082"></a>		decorMass = FMax(<span class="source_type"><a href="../engine/decoration.html" class="source">Decoration</a></span>(Base).Mass, <span class="source_int">1</span>);
<a name="3083"></a>		Base.TakeDamage((-<span class="source_int">2</span>* Mass/decorMass * Velocity.<span class="source_type">Z</span>/<span class="source_int">400</span>), Self, Location, <span class="source_int">0.5</span> * Velocity, <span class="source_type">class</span><span class="source_name">'Crushed'</span>);
<a name="3084"></a>	}
<a name="3085"></a>}
<a name="3086"></a>
<a name="3087"></a><span class="source_comment">// Don't telefrag players when they are near someone going to/from prone or crouch
</span><a name="3088"></a>event EncroachedBy(<span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> <span class="source_type">Other</span>)
<a name="3089"></a>{
<a name="3090"></a>	<span class="source_comment">// Allow encroachment by Vehicles so they can push the pawn out of the way
</span><a name="3091"></a>	if ( <span class="source_type"><a href="../roengine/ropawn.html" class="source">ROPawn</a></span>(<span class="source_type">Other</span>) == None && <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>) != None && <span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span>(<span class="source_type">Other</span>) == None)
<a name="3092"></a>		gibbedBy(<span class="source_type">Other</span>);
<a name="3093"></a>}
<a name="3094"></a>
<a name="3095"></a><span class="source_comment">// LimitYaw - limits player's yaw or turning amount
</span><a name="3096"></a>function LimitYaw(out <span class="source_type">int</span> yaw)
<a name="3097"></a>{
<a name="3098"></a>	local	<span class="source_type">int</span> MaxBipodYaw;
<a name="3099"></a>	local	<span class="source_type">int</span> MinBipodYaw;
<a name="3100"></a>
<a name="3101"></a>	if( bBipodDeployed )
<a name="3102"></a>	{
<a name="3103"></a>    	MaxBipodYaw = InitialDeployedRotation.Yaw + DeployedPositiveYawLimit;
<a name="3104"></a>    	MinBipodYaw = InitialDeployedRotation.Yaw + DeployedNegativeYawLimit;
<a name="3105"></a>
<a name="3106"></a>    	if( yaw &gt; MaxBipodYaw )
<a name="3107"></a>    	{
<a name="3108"></a>    		yaw = MaxBipodYaw;
<a name="3109"></a>    		return;
<a name="3110"></a>    	}
<a name="3111"></a>    	else if( yaw &lt; MinBipodYaw )
<a name="3112"></a>    	{
<a name="3113"></a>    		yaw = MinBipodYaw;
<a name="3114"></a>    		return;
<a name="3115"></a>    	}
<a name="3116"></a>	}
<a name="3117"></a>}
<a name="3118"></a>
<a name="3119"></a> <span class="source_comment">/*
<a name="3120"></a> 	 PitchUpLimit=18000
<a name="3121"></a>	 PitchDownLimit=49153
<a name="3122"></a> */</span>
<a name="3123"></a>function <span class="source_type">int</span> LimitPitch(<span class="source_type">int</span> pitch, optional <span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="3124"></a>{
<a name="3125"></a>	local	<span class="source_type">int</span> MaxBipodPitch;
<a name="3126"></a>	local	<span class="source_type">int</span> MinBipodPitch;
<a name="3127"></a>
<a name="3128"></a>    pitch = pitch & <span class="source_int">65535</span>;
<a name="3129"></a>
<a name="3130"></a>	if( bBipodDeployed )
<a name="3131"></a>	{
<a name="3132"></a>
<a name="3133"></a>    	MaxBipodPitch = InitialDeployedRotation.Pitch + DeployedPitchUpLimit;
<a name="3134"></a>		MinBipodPitch = InitialDeployedRotation.Pitch + DeployedPitchDownLimit;
<a name="3135"></a>
<a name="3136"></a>		if( MaxBipodPitch &gt; <span class="source_int">65535</span> )
<a name="3137"></a>			MaxBipodPitch -= <span class="source_int">65535</span>;
<a name="3138"></a>
<a name="3139"></a>		if( MinBipodPitch &lt; <span class="source_int">0</span> )
<a name="3140"></a>			MinBipodPitch += <span class="source_int">65535</span>;
<a name="3141"></a>
<a name="3142"></a>		if( (MaxBipodPitch &gt; PitchUpLimit) && (MaxBipodPitch &lt; PitchDownLimit) )
<a name="3143"></a>			MaxBipodPitch = PitchUpLimit;
<a name="3144"></a>
<a name="3145"></a>		if( (MinBipodPitch &lt; PitchDownLimit) && (MinBipodPitch &gt; PitchUpLimit) )
<a name="3146"></a>			MinBipodPitch = PitchDownLimit;
<a name="3147"></a>
<a name="3148"></a>		<span class="source_comment">// handles areas where newPitchUpLimit is less than newPitchDownLimit
</span><a name="3149"></a>    	if( (pitch &gt; MaxBipodPitch) && (pitch &lt; MinBipodPitch) )
<a name="3150"></a>    	{
<a name="3151"></a>        	if( (pitch - MaxBipodPitch) &lt; (MinBipodPitch - pitch) )
<a name="3152"></a>            	pitch = MaxBipodPitch;
<a name="3153"></a>        	else
<a name="3154"></a>            	pitch = MinBipodPitch;
<a name="3155"></a>    	}
<a name="3156"></a>    	<span class="source_comment">// following 2 if's handle when newPitchUpLimit is greater than newPitchDownLimit
</span><a name="3157"></a>    	else if( (pitch &gt; MaxBipodPitch) && (MaxBipodPitch &gt; MinBipodPitch) )
<a name="3158"></a>    	{
<a name="3159"></a>			pitch = MaxBipodPitch;
<a name="3160"></a>    	}
<a name="3161"></a>    	else if( (pitch &lt; MinBipodPitch) && (MaxBipodPitch &gt; MinBipodPitch) )
<a name="3162"></a>    	{
<a name="3163"></a>    		pitch = MinBipodPitch;
<a name="3164"></a>    	}
<a name="3165"></a>	}
<a name="3166"></a>	else
<a name="3167"></a>	{
<a name="3168"></a>		if( bIsCrawling )
<a name="3169"></a>		{
<a name="3170"></a>			<span class="source_comment">// Smoothly rotate the player to the pitch limit when you start crawling.
</span><a name="3171"></a>			<span class="source_comment">// This prevents the jarring "pop" when the pitch limit kicks in to
</span><a name="3172"></a>			<span class="source_comment">// prevent you from looking through your arms
</span><a name="3173"></a>			if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none && <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsCrawling() )
<a name="3174"></a>			{
<a name="3175"></a>				if (pitch &gt; CrawlingPitchUpLimit && pitch &lt; CrawlingPitchDownLimit)
<a name="3176"></a>		    	{
<a name="3177"></a>		        	if (pitch - CrawlingPitchUpLimit &lt; CrawlingPitchDownLimit - pitch)
<a name="3178"></a>		        	{
<a name="3179"></a>						if( <span class="source_type">Level</span>.TimeSeconds - <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.LastStartCrawlingTime &lt; <span class="source_int">0.15</span> )
<a name="3180"></a>						{
<a name="3181"></a>							pitch -= CrawlPitchTweenRate * <span class="source_type">deltatime</span>;
<a name="3182"></a>						}
<a name="3183"></a>						else
<a name="3184"></a>						{
<a name="3185"></a>							pitch = CrawlingPitchUpLimit;
<a name="3186"></a>						}
<a name="3187"></a>		            }
<a name="3188"></a>		        	else
<a name="3189"></a>		        	{
<a name="3190"></a>						if( <span class="source_type">Level</span>.TimeSeconds - <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.LastStartCrawlingTime &lt; <span class="source_int">0.15</span> )
<a name="3191"></a>						{
<a name="3192"></a>							pitch += CrawlPitchTweenRate * <span class="source_type">deltatime</span>;
<a name="3193"></a>						}
<a name="3194"></a>						else
<a name="3195"></a>						{
<a name="3196"></a>							pitch = CrawlingPitchDownLimit;
<a name="3197"></a>						}
<a name="3198"></a>		            }
<a name="3199"></a>		    	}
<a name="3200"></a>			}
<a name="3201"></a>			else
<a name="3202"></a>			{
<a name="3203"></a>				if (pitch &gt; PronePitchUpLimit && pitch &lt; PronePitchDownLimit)
<a name="3204"></a>		    	{
<a name="3205"></a>		        	if (pitch - PronePitchUpLimit &lt; PronePitchDownLimit - pitch)
<a name="3206"></a>		            	pitch = PronePitchUpLimit;
<a name="3207"></a>		        	else
<a name="3208"></a>		            	pitch = PronePitchDownLimit;
<a name="3209"></a>		    	}
<a name="3210"></a>	    	}
<a name="3211"></a>		}
<a name="3212"></a>        else if (pitch &gt; PitchUpLimit && pitch &lt; PitchDownLimit)
<a name="3213"></a>    	{
<a name="3214"></a>        	if (pitch - PitchUpLimit &lt; PitchDownLimit - pitch)
<a name="3215"></a>            	pitch = PitchUpLimit;
<a name="3216"></a>        	else
<a name="3217"></a>            	pitch = PitchDownLimit;
<a name="3218"></a>    	}
<a name="3219"></a>    }
<a name="3220"></a>
<a name="3221"></a>    return pitch;
<a name="3222"></a>}
<a name="3223"></a>
<a name="3224"></a>simulated function <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> EyePosition()
<a name="3225"></a>{
<a name="3226"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> res, <span class="source_type">x</span>, <span class="source_type">y</span>, <span class="source_type">z</span>;
<a name="3227"></a>	local <span class="source_type">float</span> Lean;
<a name="3228"></a>	local <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">HitActor</span>;
<a name="3229"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">HitNormal</span>, TraceStart, TraceEnd;
<a name="3230"></a>
<a name="3231"></a>	GetAxes(<span class="source_type">Rotation</span>, <span class="source_type">x</span>, <span class="source_type">y</span>, <span class="source_type">z</span>);
<a name="3232"></a>
<a name="3233"></a>	if (IsInState(<span class="source_name">'StartProning'</span>) || IsInState(<span class="source_name">'EndProning'</span>))
<a name="3234"></a>	{
<a name="3235"></a>		TraceStart = Location + ((GetBoneCoords(CameraBone).Origin - Location) * vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>));
<a name="3236"></a>		TraceEnd = GetBoneCoords(CameraBone).Origin;
<a name="3237"></a>		<span class="source_type">HitActor</span> = Trace( <span class="source_type">HitLocation</span>, <span class="source_type">HitNormal</span>, TraceEnd, TraceStart, true, vect(<span class="source_int">10</span>,<span class="source_int">10</span>,<span class="source_int">10</span>));
<a name="3238"></a>
<a name="3239"></a>		if( <span class="source_type">HitActor</span> != none )
<a name="3240"></a>		{
<a name="3241"></a>			res = (<span class="source_type">HitLocation</span> - Location) + WalkBob;
<a name="3242"></a>		}
<a name="3243"></a>		else
<a name="3244"></a>		{
<a name="3245"></a>        	res = (GetBoneCoords(CameraBone).Origin - Location) + WalkBob;
<a name="3246"></a>        }
<a name="3247"></a>	}
<a name="3248"></a>	else if ( bIsCrawling && !IsInState(<span class="source_name">'DivingToProne'</span>))
<a name="3249"></a>		res = EyeHeight * vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>) + WalkBob + ((( Location + ProneEyeDist * Normal(<span class="source_type">x</span>) ) - Location) * vect(<span class="source_int">1</span>,<span class="source_int">1</span>,<span class="source_int">0</span>)) ;
<a name="3250"></a>    else
<a name="3251"></a>		res = EyeHeight * vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>) + WalkBob;
<a name="3252"></a>
<a name="3253"></a>   	if( LeanAmount != <span class="source_int">0</span> )
<a name="3254"></a>   	{
<a name="3255"></a>   	 	Lean = Abs(LeanAmount / LeanMax);
<a name="3256"></a>
<a name="3257"></a>   		if( bIsCrawling )
<a name="3258"></a>   		{
<a name="3259"></a>   			if( LeanAmount &lt; <span class="source_int">0</span> )
<a name="3260"></a>   				res += Lean * (<span class="source_type">X</span> * LeanLProneViewOffset.<span class="source_type">X</span> + <span class="source_type">Y</span> * LeanLProneViewOffset.<span class="source_type">Y</span> +  <span class="source_type">Z</span> * LeanLProneViewOffset.<span class="source_type">Z</span>);
<a name="3261"></a>   			else
<a name="3262"></a>   				res += Lean * (<span class="source_type">X</span> * LeanRProneViewOffset.<span class="source_type">X</span> + <span class="source_type">Y</span> * LeanRProneViewOffset.<span class="source_type">Y</span> +  <span class="source_type">Z</span> * LeanRProneViewOffset.<span class="source_type">Z</span>);
<a name="3263"></a>   		}
<a name="3264"></a>   		else if( bIsCrouched )
<a name="3265"></a>   		{
<a name="3266"></a>   			if( LeanAmount &lt; <span class="source_int">0</span> )
<a name="3267"></a>   				res += Lean * (<span class="source_type">X</span> * LeanLCrouchViewOffset.<span class="source_type">X</span> + <span class="source_type">Y</span> * LeanLCrouchViewOffset.<span class="source_type">Y</span> +  <span class="source_type">Z</span> * LeanLCrouchViewOffset.<span class="source_type">Z</span>);
<a name="3268"></a>   			else
<a name="3269"></a>   				res += Lean * (<span class="source_type">X</span> * LeanRCrouchViewOffset.<span class="source_type">X</span> + <span class="source_type">Y</span> * LeanRCrouchViewOffset.<span class="source_type">Y</span> +  <span class="source_type">Z</span> * LeanRCrouchViewOffset.<span class="source_type">Z</span>);
<a name="3270"></a>   		}
<a name="3271"></a>   		else
<a name="3272"></a>   		{
<a name="3273"></a>   			if( LeanAmount &lt; <span class="source_int">0</span> )
<a name="3274"></a>   				res += Lean * (<span class="source_type">X</span> * LeanLViewOffset.<span class="source_type">X</span> + <span class="source_type">Y</span> * LeanLViewOffset.<span class="source_type">Y</span> +  <span class="source_type">Z</span> * LeanLViewOffset.<span class="source_type">Z</span>);
<a name="3275"></a>   			else
<a name="3276"></a>   				res += Lean * (<span class="source_type">X</span> * LeanRViewOffset.<span class="source_type">X</span> + <span class="source_type">Y</span> * LeanRViewOffset.<span class="source_type">Y</span> +  <span class="source_type">Z</span> * LeanRViewOffset.<span class="source_type">Z</span>);
<a name="3277"></a>   		}
<a name="3278"></a>   	}
<a name="3279"></a>
<a name="3280"></a>	return res;
<a name="3281"></a>}
<a name="3282"></a>
<a name="3283"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3284"></a><span class="source_comment">// Landed - Added land sound and prevented anim for prone landing
</span><a name="3285"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3286"></a>event Landed(<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitNormal</span>)
<a name="3287"></a>{
<a name="3288"></a>	ImpactVelocity = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="3289"></a>	TakeFallingDamage();
<a name="3290"></a>	if ( Health &gt; <span class="source_int">0</span> && !bIsCrawling)
<a name="3291"></a>		PlayLanded(Velocity.<span class="source_type">Z</span>);
<a name="3292"></a>	if ( (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">200</span>) && (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None) )
<a name="3293"></a>		bJustLanded = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bLandingShake;
<a name="3294"></a>	LastHitBy = None;
<a name="3295"></a>
<a name="3296"></a>	if (Health &gt; <span class="source_int">0</span>)
<a name="3297"></a>	{
<a name="3298"></a>		if( bIsCrawling )
<a name="3299"></a>		    PlayOwnedSound(GetSound(EST_DiveLand), SLOT_Interact, FMin(<span class="source_int">2</span>,Abs(Velocity.<span class="source_type">Z</span>)/MaxFallSpeed),, <span class="source_int">10</span>);
<a name="3300"></a>        else
<a name="3301"></a>            PlayOwnedSound(GetSound(EST_Land), SLOT_Interact, FMin(<span class="source_int">1</span>,-<span class="source_int">0.3</span> * Velocity.<span class="source_type">Z</span>/JumpZ),, <span class="source_int">10</span>);
<a name="3302"></a>	}
<a name="3303"></a>}
<a name="3304"></a>
<a name="3305"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3306"></a><span class="source_comment">// TakeFallingDamage - Increased damage once over safe fall threshold
</span><a name="3307"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3308"></a><span class="source_comment">// MergeTODO: Players complain that the fall distance is too short before getting hurt. Investigate
</span><a name="3309"></a>function TakeFallingDamage()
<a name="3310"></a>{
<a name="3311"></a>	local <span class="source_type">float</span> Shake, EffectiveSpeed;
<a name="3312"></a>
<a name="3313"></a>	if (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">0.5</span> * MaxFallSpeed)
<a name="3314"></a>	{
<a name="3315"></a>		if ( Role == ROLE_Authority )
<a name="3316"></a>		{
<a name="3317"></a>		    MakeNoise(<span class="source_int">1.0</span>);
<a name="3318"></a>		    if (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">1</span> * MaxFallSpeed)
<a name="3319"></a>		    {
<a name="3320"></a>				EffectiveSpeed = Velocity.<span class="source_type">Z</span>;
<a name="3321"></a>				if ( TouchingWaterVolume() )
<a name="3322"></a>					EffectiveSpeed = FMin(<span class="source_int">0</span>, EffectiveSpeed + <span class="source_int">100</span>);
<a name="3323"></a>				if ( EffectiveSpeed &lt; -<span class="source_int">1</span> * MaxFallSpeed )
<a name="3324"></a>				{
<a name="3325"></a>					TakeDamage(-<span class="source_int">100</span> * (<span class="source_int">1.5</span> * EffectiveSpeed + MaxFallSpeed)/MaxFallSpeed, None, Location, vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>), <span class="source_type">class</span><span class="source_name">'Fell'</span>);
<a name="3326"></a>					<span class="source_comment">// Damaged the legs
</span><a name="3327"></a>					UpdateDamageList(<span class="source_int">254</span>);
<a name="3328"></a>
<a name="3329"></a>				}
<a name="3330"></a>		    }
<a name="3331"></a>		}
<a name="3332"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="3333"></a>		{
<a name="3334"></a>			Shake = FMin(<span class="source_int">1</span>, -<span class="source_int">1</span> * Velocity.<span class="source_type">Z</span>/MaxFallSpeed);
<a name="3335"></a>            <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.DamageShake(Shake);
<a name="3336"></a>		}
<a name="3337"></a>	}
<a name="3338"></a>	else if (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">1.4</span> * JumpZ)
<a name="3339"></a>		MakeNoise(<span class="source_int">0.5</span>);
<a name="3340"></a>}
<a name="3341"></a>
<a name="3342"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3343"></a><span class="source_comment">// FootStepping - overriden to support custom footstep volumes
</span><a name="3344"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3345"></a>simulated function FootStepping(<span class="source_type">int</span> Side)
<a name="3346"></a>{
<a name="3347"></a>    local <span class="source_type">int</span> SurfaceTypeID, <span class="source_type">i</span>;
<a name="3348"></a>	local <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">A</span>;
<a name="3349"></a>	local <span class="source_type"><a href="../engine/material.html" class="source">material</a></span> FloorMat;
<a name="3350"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HL,HN,Start,End,<span class="source_type">HitLocation</span>,<span class="source_type">HitNormal</span>;
<a name="3351"></a>	local <span class="source_type">float</span> FootVolumeMod;
<a name="3352"></a>
<a name="3353"></a>    SurfaceTypeID = <span class="source_int">0</span>;
<a name="3354"></a>    FootVolumeMod = <span class="source_int">1.0</span>;
<a name="3355"></a>
<a name="3356"></a>    for ( <span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;Touching.Length; <span class="source_type">i</span>++ )
<a name="3357"></a>		if ( ((<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>(Touching[<span class="source_type">i</span>]) != None) && <span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>(Touching[<span class="source_type">i</span>]).bWaterVolume)
<a name="3358"></a>			|| (<span class="source_type"><a href="../engine/fluidsurfaceinfo.html" class="source">FluidSurfaceInfo</a></span>(Touching[<span class="source_type">i</span>]) != None) )
<a name="3359"></a>		{
<a name="3360"></a>			<span class="source_comment">//PlaySound(sound'Inf_Player.FootStepWaterDeep', SLOT_Interact, FootstepVolume * 2,, FootStepSoundRadius);
</span><a name="3361"></a>
<a name="3362"></a>			<span class="source_comment">// Play a water ring effect as you walk through the water
</span><a name="3363"></a> 			if ( !<span class="source_type">Level</span>.bDropDetail && (<span class="source_type">Level</span>.DetailMode != DM_Low) && (<span class="source_type">Level</span>.NetMode != NM_DedicatedServer)
<a name="3364"></a>				&& !Touching[<span class="source_type">i</span>].TraceThisActor(<span class="source_type">HitLocation</span>, <span class="source_type">HitNormal</span>,Location - CollisionHeight*vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1.1</span>), Location) )
<a name="3365"></a>			{
<a name="3366"></a>					Spawn(<span class="source_type">class</span><span class="source_name">'WaterRingEmitter'</span>,,,<span class="source_type">HitLocation</span>,rot(<span class="source_int">16384</span>,<span class="source_int">0</span>,<span class="source_int">0</span>));
<a name="3367"></a>			}
<a name="3368"></a>
<a name="3369"></a>			return;
<a name="3370"></a>		}
<a name="3371"></a>
<a name="3372"></a>	<span class="source_comment">// Lets still play the sounds when walking slow, just play them quieter
</span><a name="3373"></a>	if ( bIsCrawling )
<a name="3374"></a>	{
<a name="3375"></a>		return;
<a name="3376"></a>	}
<a name="3377"></a>	else if ( bIsCrouched || bIsWalking )
<a name="3378"></a>	{
<a name="3379"></a>        FootVolumeMod = QuietFootStepVolume;
<a name="3380"></a>	}
<a name="3381"></a>
<a name="3382"></a>	if ( (Base!=None) && (!Base.IsA(<span class="source_name">'LevelInfo'</span>)) && (Base.SurfaceType!=<span class="source_int">0</span>) )
<a name="3383"></a>	{
<a name="3384"></a>		SurfaceTypeID = Base.SurfaceType;
<a name="3385"></a>	}
<a name="3386"></a>	else
<a name="3387"></a>	{
<a name="3388"></a>		Start = Location - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>)*CollisionHeight;
<a name="3389"></a>		End = Start - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">16</span>);
<a name="3390"></a>		<span class="source_type">A</span> = Trace(hl,hn,End,Start,false,,FloorMat);
<a name="3391"></a>		if (FloorMat !=None)
<a name="3392"></a>			SurfaceTypeID = FloorMat.SurfaceType;
<a name="3393"></a>	}
<a name="3394"></a>	<span class="source_comment">//PlaySound(SoundFootsteps[SurfaceTypeID], SLOT_Interact, (FootstepVolume * FootVolumeMod),,(FootStepSoundRadius * FootVolumeMod));
</span><a name="3395"></a>}
<a name="3396"></a>
<a name="3397"></a><span class="source_comment">// Returns true if you can jump in this movement state
</span><a name="3398"></a>simulated function <span class="source_type">bool</span> CanJump()
<a name="3399"></a>{
<a name="3400"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none && <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsMounted() )
<a name="3401"></a>		return false;
<a name="3402"></a>
<a name="3403"></a>	if ( bIsLimping || bIsCrouched || bWantsToCrouch || bIsCrawling || bWantsToProne )
<a name="3404"></a>		return false;
<a name="3405"></a>
<a name="3406"></a>	return true;
<a name="3407"></a>}
<a name="3408"></a>
<a name="3409"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3410"></a><span class="source_comment">// DoJump - overriden to support a wait time between jumps
</span><a name="3411"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3412"></a>function <span class="source_type">bool</span> DoJump( <span class="source_type">bool</span> <span class="source_type">bUpdating</span> )
<a name="3413"></a>{
<a name="3414"></a>	<span class="source_comment">// No jumping if stamina is too low
</span><a name="3415"></a>	if ((Stamina &lt; JumpStaminaDrain) || (<span class="source_type">Level</span>.TimeSeconds &lt; NextJumpTime) )
<a name="3416"></a>	{
<a name="3417"></a>		if(CanJump() && !<span class="source_type">bUpdating</span>)
<a name="3418"></a>		{
<a name="3419"></a>			PlayOwnedSound(GetSound(EST_TiredJump), SLOT_Pain, GruntVolume,,<span class="source_int">80</span>);
<a name="3420"></a>		}
<a name="3421"></a>		return false;
<a name="3422"></a>	}
<a name="3423"></a>
<a name="3424"></a>	if ( CanJump() && ((Physics == PHYS_Walking) || (Physics == PHYS_Ladder) || (Physics == PHYS_Spider)))
<a name="3425"></a>	{
<a name="3426"></a>		<span class="source_comment">// Take stamina away with each jump
</span><a name="3427"></a>		Stamina = FMax(Stamina - JumpStaminaDrain, <span class="source_int">0.0</span>);
<a name="3428"></a>
<a name="3429"></a>		if ( Role == ROLE_Authority )
<a name="3430"></a>		{
<a name="3431"></a>			if ( (<span class="source_type">Level</span>.Game != None) && (<span class="source_type">Level</span>.Game.GameDifficulty &gt; <span class="source_int">2</span>) )
<a name="3432"></a>				MakeNoise(<span class="source_int">0.1</span> * <span class="source_type">Level</span>.Game.GameDifficulty);
<a name="3433"></a>			if ( bCountJumps && (<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> != None) )
<a name="3434"></a>				<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.OwnerEvent(<span class="source_name">'Jumped'</span>);
<a name="3435"></a>		}
<a name="3436"></a>
<a name="3437"></a>		<span class="source_comment">// For playing jumping anims, etc
</span><a name="3438"></a>		if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="3439"></a>		{
<a name="3440"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyOwnerJumped();
<a name="3441"></a>		}
<a name="3442"></a>
<a name="3443"></a>		if (!<span class="source_type">bUpdating</span>)
<a name="3444"></a>			PlayOwnedSound(GetSound(EST_Jump), SLOT_Pain, GruntVolume,,<span class="source_int">80</span>);
<a name="3445"></a>
<a name="3446"></a>		NextJumpTime = <span class="source_type">Level</span>.TimeSeconds + <span class="source_int">2.0</span>;
<a name="3447"></a>
<a name="3448"></a>		if ( Physics == PHYS_Spider )
<a name="3449"></a>			Velocity = JumpZ * Floor;
<a name="3450"></a>		else if ( Physics == PHYS_Ladder )
<a name="3451"></a>			Velocity.<span class="source_type">Z</span> = <span class="source_int">0</span>;
<a name="3452"></a>		else if ( bIsWalking )
<a name="3453"></a>			Velocity.<span class="source_type">Z</span> = Default.JumpZ;
<a name="3454"></a>		else
<a name="3455"></a>			Velocity.<span class="source_type">Z</span> = JumpZ;
<a name="3456"></a>		if ( (Base != None) && !Base.bWorldGeometry )
<a name="3457"></a>			Velocity.<span class="source_type">Z</span> += Base.Velocity.<span class="source_type">Z</span>;
<a name="3458"></a>		SetPhysics(PHYS_Falling);
<a name="3459"></a>
<a name="3460"></a>		return true;
<a name="3461"></a>	}
<a name="3462"></a>
<a name="3463"></a>	return false;
<a name="3464"></a>}
<a name="3465"></a>
<a name="3466"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3467"></a><span class="source_comment">// Proning functions
</span><a name="3468"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3469"></a>
<a name="3470"></a><span class="source_comment">// Returns true if the player can switch the prone state. Only valid on the client
</span><a name="3471"></a>simulated function <span class="source_type">bool</span> CanProneTransition()
<a name="3472"></a>{
<a name="3473"></a>	if( Physics == PHYS_Walking && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == none || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.WeaponAllowProneChange()) )
<a name="3474"></a>	{
<a name="3475"></a>		return true;
<a name="3476"></a>	}
<a name="3477"></a>
<a name="3478"></a>	return false;
<a name="3479"></a>}
<a name="3480"></a>
<a name="3481"></a><span class="source_comment">// Returns true if the player can switch the crouch state.
</span><a name="3482"></a>simulated function <span class="source_type">bool</span> CanCrouchTransition()
<a name="3483"></a>{
<a name="3484"></a>	if( IsTransitioningToProne() )
<a name="3485"></a>	{
<a name="3486"></a>		return false;
<a name="3487"></a>	}
<a name="3488"></a>
<a name="3489"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == none || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.WeaponAllowCrouchChange() )
<a name="3490"></a>	{
<a name="3491"></a>		return true;
<a name="3492"></a>	}
<a name="3493"></a>
<a name="3494"></a>	return false;
<a name="3495"></a>}
<a name="3496"></a>
<a name="3497"></a><span class="source_comment">// Stub events called when physics actually allows prone to begin or end
</span><a name="3498"></a><span class="source_comment">// use these for changing the animation (if script controlled)
</span><a name="3499"></a>event EndProne(<span class="source_type">float</span> HeightAdjust)
<a name="3500"></a>{
<a name="3501"></a>	<span class="source_comment">// Take the weapon out of iron sights
</span><a name="3502"></a>	<span class="source_comment">// TODO: Give this its own notify, instead of piggybacking the notify owner jumped one
</span><a name="3503"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="3504"></a>	{
<a name="3505"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyOwnerJumped();
<a name="3506"></a>	}
<a name="3507"></a>
<a name="3508"></a>  	SetAnimAction(<span class="source_name">'EndCrawling'</span>);
<a name="3509"></a>
<a name="3510"></a>	if( bBipodDeployed && <span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="3511"></a>	{
<a name="3512"></a>		<span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ForceUndeploy();
<a name="3513"></a>	}
<a name="3514"></a>
<a name="3515"></a>	EyeHeight -= HeightAdjust;
<a name="3516"></a>	OldZ += HeightAdjust;
<a name="3517"></a>	BaseEyeHeight = Default.BaseEyeHeight;
<a name="3518"></a>}
<a name="3519"></a>
<a name="3520"></a>event StartProne(<span class="source_type">float</span> HeightAdjust)
<a name="3521"></a>{
<a name="3522"></a>	SetWalking(false);
<a name="3523"></a>	ShouldCrouch(false);
<a name="3524"></a>
<a name="3525"></a>	if( bBipodDeployed && <span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="3526"></a>	{
<a name="3527"></a>		<span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ForceUndeploy();
<a name="3528"></a>	}
<a name="3529"></a>
<a name="3530"></a>	if ( <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none)
<a name="3531"></a>	{
<a name="3532"></a>		<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ResetSwayValues();
<a name="3533"></a>	}
<a name="3534"></a>
<a name="3535"></a>	<span class="source_comment">// Take the weapon out of iron sights
</span><a name="3536"></a>	<span class="source_comment">// TODO: Give this its own notify, instead of piggybacking the notify owner jumped one
</span><a name="3537"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="3538"></a>	{
<a name="3539"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyOwnerJumped();
<a name="3540"></a>	}
<a name="3541"></a>
<a name="3542"></a>  	SetAnimAction(<span class="source_name">'StartCrawling'</span>);
<a name="3543"></a>
<a name="3544"></a>	EyeHeight += HeightAdjust;
<a name="3545"></a>	OldZ -= HeightAdjust;
<a name="3546"></a>	BaseEyeHeight = ProneEyeHeight;
<a name="3547"></a>}
<a name="3548"></a>
<a name="3549"></a>event CrouchToProne(<span class="source_type">float</span> HeightAdjust)
<a name="3550"></a>{
<a name="3551"></a>	SetWalking(false);
<a name="3552"></a>	ShouldCrouch(false);
<a name="3553"></a>
<a name="3554"></a>	if( bBipodDeployed && <span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="3555"></a>	{
<a name="3556"></a>		<span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ForceUndeploy();
<a name="3557"></a>	}
<a name="3558"></a>
<a name="3559"></a>	if ( <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none)
<a name="3560"></a>	{
<a name="3561"></a>		<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ResetSwayValues();
<a name="3562"></a>	}
<a name="3563"></a>
<a name="3564"></a>	<span class="source_comment">// Take the weapon out of iron sights
</span><a name="3565"></a>	<span class="source_comment">// TODO: Give this its own notify, instead of piggybacking the notify owner jumped one
</span><a name="3566"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="3567"></a>	{
<a name="3568"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyOwnerJumped();
<a name="3569"></a>	}
<a name="3570"></a>
<a name="3571"></a>	<span class="source_comment">// Send the weapon to the crawling state if we are moving
</span><a name="3572"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>!= none && VSizeSquared(Velocity) &gt; <span class="source_int">1.0</span> )
<a name="3573"></a>	{
<a name="3574"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyCrawlMoving();
<a name="3575"></a>	}
<a name="3576"></a>
<a name="3577"></a>    SetAnimAction(<span class="source_name">'CrouchToProne'</span>);
<a name="3578"></a>
<a name="3579"></a>	EyeHeight += HeightAdjust;
<a name="3580"></a>	OldZ -= HeightAdjust;
<a name="3581"></a>	BaseEyeHeight = ProneEyeHeight;
<a name="3582"></a>}
<a name="3583"></a>
<a name="3584"></a>event ProneToCrouch(<span class="source_type">float</span> HeightAdjust)
<a name="3585"></a>{
<a name="3586"></a>	EyeHeight += HeightAdjust;
<a name="3587"></a>	OldZ -= HeightAdjust;
<a name="3588"></a>
<a name="3589"></a>	ShouldProne(false);
<a name="3590"></a>
<a name="3591"></a>	if( bBipodDeployed && <span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="3592"></a>	{
<a name="3593"></a>		<span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ForceUndeploy();
<a name="3594"></a>	}
<a name="3595"></a>
<a name="3596"></a>	<span class="source_comment">// Take the weapon out of iron sights
</span><a name="3597"></a>	<span class="source_comment">// TODO: Give this its own notify, instead of piggybacking the notify owner jumped one
</span><a name="3598"></a>	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="3599"></a>	{
<a name="3600"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyOwnerJumped();
<a name="3601"></a>	}
<a name="3602"></a>
<a name="3603"></a>    SetAnimAction(<span class="source_name">'ProneToCrouch'</span>);
<a name="3604"></a>
<a name="3605"></a>    if( VSizeSquared(Velocity) &gt; <span class="source_int">25</span> )
<a name="3606"></a>    {
<a name="3607"></a>    	BaseEyeHeight = CrouchMoveEyeHeightMod * CrouchHeight;
<a name="3608"></a>    }
<a name="3609"></a>    else
<a name="3610"></a>    {
<a name="3611"></a>    	BaseEyeHeight = CrouchEyeHeightMod * CrouchHeight;
<a name="3612"></a>    }
<a name="3613"></a>}
<a name="3614"></a>
<a name="3615"></a>event StartProneDive(<span class="source_type">float</span> HeightAdjust)
<a name="3616"></a>{
<a name="3617"></a>	SetWalking(false);
<a name="3618"></a>	ShouldCrouch(false);
<a name="3619"></a>
<a name="3620"></a>  	SetAnimAction(<span class="source_name">'DiveToProne'</span>);
<a name="3621"></a>
<a name="3622"></a>	EyeHeight += HeightAdjust;
<a name="3623"></a>	OldZ -= HeightAdjust;
<a name="3624"></a>	BaseEyeHeight = ProneEyeHeight;
<a name="3625"></a>}
<a name="3626"></a>
<a name="3627"></a><span class="source_comment">// Player is prone
</span><a name="3628"></a>simulated <span class="source_type">state</span> Crawling
<a name="3629"></a>{
<a name="3630"></a>	simulated function BeginState()
<a name="3631"></a>	{
<a name="3632"></a>		if( !bBipodDeployed && <span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none && <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.bUsingSights )
<a name="3633"></a>		{
<a name="3634"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyOwnerJumped();
<a name="3635"></a>		}
<a name="3636"></a>
<a name="3637"></a>		SetSprinting(false);
<a name="3638"></a>	}
<a name="3639"></a>
<a name="3640"></a>	simulated function EndState()
<a name="3641"></a>	{
<a name="3642"></a>		if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="3643"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyStopCrawlMoving();
<a name="3644"></a>	}
<a name="3645"></a>}
<a name="3646"></a>
<a name="3647"></a>simulated <span class="source_type">state</span> ProningFromCrouch
<a name="3648"></a>{
<a name="3649"></a>	simulated function <span class="source_type">bool</span> CanProneTransition(){return false;}
<a name="3650"></a>    simulated event <span class="source_type">bool</span> IsTransitioningToProne(){return true;}
<a name="3651"></a>	simulated event <span class="source_type">bool</span> IsProneTransitioning(){return true;}
<a name="3652"></a>
<a name="3653"></a>    simulated function Timer()
<a name="3654"></a>	{
<a name="3655"></a>		GotoState(<span class="source_name">'Crawling'</span>);
<a name="3656"></a>	}
<a name="3657"></a>
<a name="3658"></a>	simulated function BeginState()
<a name="3659"></a>	{
<a name="3660"></a>		AnimBlendTimer();
<a name="3661"></a>
<a name="3662"></a>		<span class="source_comment">// Cancel any anims playing on the weapon since we do the same for the player
</span><a name="3663"></a>		if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none )
<a name="3664"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayIdle();
<a name="3665"></a>
<a name="3666"></a>		PlayProningFromCrouch();
<a name="3667"></a>
<a name="3668"></a>		if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>!= none && VSizeSquared(Velocity) &gt; <span class="source_int">1.0</span> )
<a name="3669"></a>		{
<a name="3670"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyCrawlMoving();
<a name="3671"></a>		}
<a name="3672"></a>
<a name="3673"></a>	}
<a name="3674"></a>}
<a name="3675"></a>
<a name="3676"></a>simulated <span class="source_type">state</span> CrouchingFromProne
<a name="3677"></a>{
<a name="3678"></a>	simulated event <span class="source_type">bool</span> IsProneTransitioning(){return true;}
<a name="3679"></a>
<a name="3680"></a>    simulated function Timer()
<a name="3681"></a>	{
<a name="3682"></a>		GotoState(<span class="source_name">''</span>);
<a name="3683"></a>	}
<a name="3684"></a>
<a name="3685"></a>	simulated function BeginState()
<a name="3686"></a>	{
<a name="3687"></a>		AnimBlendTimer();
<a name="3688"></a>
<a name="3689"></a>		<span class="source_comment">// Cancel any anims playing on the weapon since we do the same for the player
</span><a name="3690"></a>		if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none )
<a name="3691"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayIdle();
<a name="3692"></a>
<a name="3693"></a>		PlayCrouchingFromProne();
<a name="3694"></a>	}
<a name="3695"></a>}
<a name="3696"></a>
<a name="3697"></a>simulated <span class="source_type">state</span> StartProning
<a name="3698"></a>{
<a name="3699"></a>	simulated function <span class="source_type">bool</span> CanProneTransition(){return false;}
<a name="3700"></a>    simulated event <span class="source_type">bool</span> IsTransitioningToProne(){return true;}
<a name="3701"></a>	simulated event <span class="source_type">bool</span> IsProneTransitioning(){return true;}
<a name="3702"></a>
<a name="3703"></a>    simulated function Timer()
<a name="3704"></a>	{
<a name="3705"></a>		GotoState(<span class="source_name">'Crawling'</span>);
<a name="3706"></a>	}
<a name="3707"></a>
<a name="3708"></a>	simulated function BeginState()
<a name="3709"></a>	{
<a name="3710"></a>		if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>!= none && VSizeSquared(Velocity) &gt; <span class="source_int">1.0</span> )
<a name="3711"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyCrawlMoving();
<a name="3712"></a>
<a name="3713"></a>		AnimBlendTimer();
<a name="3714"></a>
<a name="3715"></a>		<span class="source_comment">// Cancel any anims playing on the weapon since we do the same for the player
</span><a name="3716"></a>		if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none )
<a name="3717"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayIdle();
<a name="3718"></a>
<a name="3719"></a>		PlayStartCrawling();
<a name="3720"></a>	}
<a name="3721"></a>}
<a name="3722"></a>
<a name="3723"></a>simulated <span class="source_type">state</span> EndProning
<a name="3724"></a>{
<a name="3725"></a>	simulated function <span class="source_type">bool</span> CanProneTransition(){return false;}
<a name="3726"></a>	simulated event <span class="source_type">bool</span> IsProneTransitioning(){return true;}
<a name="3727"></a>
<a name="3728"></a>    simulated function Timer()
<a name="3729"></a>	{
<a name="3730"></a>		GotoState(<span class="source_name">''</span>);
<a name="3731"></a>	}
<a name="3732"></a>
<a name="3733"></a>	simulated function BeginState()
<a name="3734"></a>	{
<a name="3735"></a>		AnimBlendTimer();
<a name="3736"></a>
<a name="3737"></a>		<span class="source_comment">// Cancel any anims playing on the weapon since we do the same for the player
</span><a name="3738"></a>		if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none )
<a name="3739"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayIdle();
<a name="3740"></a>
<a name="3741"></a>		PlayEndCrawling();
<a name="3742"></a>	}
<a name="3743"></a>}
<a name="3744"></a>
<a name="3745"></a><span class="source_comment">// This is a little tricky. Animend isn't reliable enough to count on
</span><a name="3746"></a><span class="source_comment">// serverside to change the pre-pivot value so we use a timer. But
</span><a name="3747"></a><span class="source_comment">// The timer causes the anim to pop client side so we have to
</span><a name="3748"></a><span class="source_comment">// use animend client side to switch the pre-pivot value.
</span><a name="3749"></a>simulated <span class="source_type">state</span> DivingToProne
<a name="3750"></a>{
<a name="3751"></a>	simulated function <span class="source_type">bool</span> CanProneTransition(){return false;}
<a name="3752"></a>	simulated event <span class="source_type">bool</span> IsTransitioningToProne(){return true;}
<a name="3753"></a>
<a name="3754"></a>    simulated function Timer()
<a name="3755"></a>	{
<a name="3756"></a>		GotoState(<span class="source_name">'Crawling'</span>);
<a name="3757"></a>	}
<a name="3758"></a>
<a name="3759"></a>	simulated event AnimEnd(<span class="source_type">int</span> <span class="source_type">Channel</span>)
<a name="3760"></a>	{
<a name="3761"></a>		Global.AnimEnd(<span class="source_type">Channel</span>);
<a name="3762"></a>
<a name="3763"></a>		if( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="3764"></a>			GotoState(<span class="source_name">'Crawling'</span>);
<a name="3765"></a>	}
<a name="3766"></a>
<a name="3767"></a>	simulated function BeginState()
<a name="3768"></a>	{
<a name="3769"></a>		local <span class="source_type">name</span> Anim;
<a name="3770"></a>
<a name="3771"></a>		<span class="source_comment">// Merge TODO, replace this with the animation length when we get an animation - Ramm
</span><a name="3772"></a>		if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer )
<a name="3773"></a>			SetTimer(<span class="source_int">0.26</span>,false);
<a name="3774"></a>
<a name="3775"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="3776"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_DiveToProneStartAnim;
<a name="3777"></a>		else
<a name="3778"></a>			Anim = DiveToProneStartAnim;
<a name="3779"></a>
<a name="3780"></a>        AnimBlendTimer();
<a name="3781"></a>
<a name="3782"></a> 		<span class="source_comment">// Cancel any anims playing on the weapon since we do the same for the player
</span><a name="3783"></a>		if( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != none )
<a name="3784"></a>			<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PlayIdle();
<a name="3785"></a>
<a name="3786"></a>		PlayAnim(Anim, <span class="source_int">1.0</span>, <span class="source_int">0.25</span>, <span class="source_int">0</span>);
<a name="3787"></a>
<a name="3788"></a>		if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>!= none )
<a name="3789"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyCrawlMoving();
<a name="3790"></a>	}
<a name="3791"></a>
<a name="3792"></a>	simulated function EndState()
<a name="3793"></a>	{
<a name="3794"></a>		local <span class="source_type">float</span> NewHeight;
<a name="3795"></a>		local <span class="source_type">name</span> Anim;
<a name="3796"></a>
<a name="3797"></a>        NewHeight = default.CollisionHeight - ProneHeight;
<a name="3798"></a>
<a name="3799"></a>		if (<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None)
<a name="3800"></a>			Anim = <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.PA_DiveToProneEndAnim;
<a name="3801"></a>		else
<a name="3802"></a>			Anim = DiveToProneEndAnim;
<a name="3803"></a>
<a name="3804"></a>		PlayAnim(DiveToProneEndAnim, <span class="source_int">0.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0</span>);
<a name="3805"></a>        PrePivot = default.PrePivot + (NewHeight * vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>));
<a name="3806"></a>	}
<a name="3807"></a>}
<a name="3808"></a>
<a name="3809"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3810"></a><span class="source_comment">// EndCrouch
</span><a name="3811"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3812"></a>event EndCrouch(<span class="source_type">float</span> HeightAdjust)
<a name="3813"></a>{
<a name="3814"></a>	EyeHeight -= HeightAdjust;
<a name="3815"></a>	OldZ += HeightAdjust;
<a name="3816"></a>	BaseEyeHeight = Default.BaseEyeHeight;
<a name="3817"></a>
<a name="3818"></a>	if( bBipodDeployed && <span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="3819"></a>	{
<a name="3820"></a>		<span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ForceUndeploy();
<a name="3821"></a>	}
<a name="3822"></a>
<a name="3823"></a>	PlayOwnedSound(CrouchToStandSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="3824"></a>}
<a name="3825"></a>
<a name="3826"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3827"></a><span class="source_comment">// StartCrouch - Changed crouch eye height
</span><a name="3828"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3829"></a>event StartCrouch(<span class="source_type">float</span> HeightAdjust)
<a name="3830"></a>{
<a name="3831"></a>	EyeHeight += HeightAdjust;
<a name="3832"></a>	OldZ -= HeightAdjust;
<a name="3833"></a>
<a name="3834"></a>	if( bBipodDeployed && <span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="3835"></a>	{
<a name="3836"></a>		<span class="source_type"><a href="../roengine/robipodweapon.html" class="source">ROBipodWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ForceUndeploy();
<a name="3837"></a>	}
<a name="3838"></a>
<a name="3839"></a>	if ( <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none)
<a name="3840"></a>	{
<a name="3841"></a>		<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ResetSwayValues();
<a name="3842"></a>	}
<a name="3843"></a>
<a name="3844"></a>	ShouldProne(false);
<a name="3845"></a>
<a name="3846"></a>    PlayOwnedSound(StandToCrouchSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="3847"></a>
<a name="3848"></a>    if( VSizeSquared(Velocity) &gt; <span class="source_int">25</span> )
<a name="3849"></a>    {
<a name="3850"></a>    	BaseEyeHeight = CrouchMoveEyeHeightMod * CrouchHeight;
<a name="3851"></a>    }
<a name="3852"></a>    else
<a name="3853"></a>    {
<a name="3854"></a>    	BaseEyeHeight = CrouchEyeHeightMod * CrouchHeight;
<a name="3855"></a>    }
<a name="3856"></a>}
<a name="3857"></a>
<a name="3858"></a><span class="source_comment">// Crouch when trying to deploy
</span><a name="3859"></a>event DeployedStartCrouch()
<a name="3860"></a>{
<a name="3861"></a>	if ( <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none)
<a name="3862"></a>	{
<a name="3863"></a>		<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ResetSwayValues();
<a name="3864"></a>	}
<a name="3865"></a>
<a name="3866"></a>	ShouldProne(false);
<a name="3867"></a>
<a name="3868"></a>    PlayOwnedSound(StandToCrouchSound, SLOT_Interact, <span class="source_int">1.0</span>,, <span class="source_int">10</span>);
<a name="3869"></a>}
<a name="3870"></a>
<a name="3871"></a><span class="source_comment">//=============================================================
</span><a name="3872"></a><span class="source_comment">// Death/Damage
</span><a name="3873"></a><span class="source_comment">//=============================================================
</span><a name="3874"></a>
<a name="3875"></a><span class="source_comment">// Sometimes we need to damage only the highest damage hitpoint, this will return that hitpoint index
</span><a name="3876"></a>function <span class="source_type">int</span> GetHighestDamageHitIndex( array&lt;<span class="source_type">int</span>&gt; <span class="source_type">PointsHit</span> )
<a name="3877"></a>{
<a name="3878"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>, besthit, bestdamage;
<a name="3879"></a>
<a name="3880"></a>	if( <span class="source_type">PointsHit</span>.Length == <span class="source_int">1</span> )
<a name="3881"></a>	{
<a name="3882"></a>		return <span class="source_int">0</span>;
<a name="3883"></a>	}
<a name="3884"></a>
<a name="3885"></a>	for(<span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;<span class="source_type">PointsHit</span>.Length; <span class="source_type">i</span>++)
<a name="3886"></a>	{
<a name="3887"></a>		if( Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].DamageMultiplier &gt; bestdamage )
<a name="3888"></a>		{
<a name="3889"></a>			besthit = <span class="source_type">i</span>;
<a name="3890"></a>			bestdamage = Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].DamageMultiplier;
<a name="3891"></a>		}
<a name="3892"></a>	}
<a name="3893"></a>
<a name="3894"></a>	return besthit;
<a name="3895"></a>}
<a name="3896"></a>
<a name="3897"></a><span class="source_comment">// Process a precision hit
</span><a name="3898"></a>function ProcessLocationalDamage(<span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> instigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">hitlocation</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">momentum</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, array&lt;<span class="source_type">int</span>&gt; <span class="source_type">PointsHit</span>)
<a name="3899"></a>{
<a name="3900"></a>	local <span class="source_type">int</span> actualDamage, originalDamage, cumulativeDamage, totalDamage, <span class="source_type">i</span>;
<a name="3901"></a>	local <span class="source_type">int</span> HighestDamagePoint, HighestDamageAmount;
<a name="3902"></a>	<span class="source_comment">// Hit detection debugging
</span><a name="3903"></a>    <span class="source_comment">/*local coords CO;
<a name="3904"></a>	local vector HeadLoc;
<a name="3905"></a>	local bool bFirstHit;*/</span>
<a name="3906"></a>
<a name="3907"></a>    originalDamage = <span class="source_type">damage</span>;
<a name="3908"></a>
<a name="3909"></a>	<span class="source_comment">// If someone else has killed this player , return
</span><a name="3910"></a>	if( bDeleteMe || <span class="source_type">PointsHit</span>.Length &lt; <span class="source_int">1</span> || Health &lt;= <span class="source_int">0</span> )
<a name="3911"></a>		return;
<a name="3912"></a>
<a name="3913"></a>	for(<span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;<span class="source_type">PointsHit</span>.Length; <span class="source_type">i</span>++)
<a name="3914"></a>	{
<a name="3915"></a>		<span class="source_comment">// If someone else has killed this player , return
</span><a name="3916"></a>		if( bDeleteMe || Health &lt;= <span class="source_int">0</span> )
<a name="3917"></a>			return;
<a name="3918"></a>
<a name="3919"></a>		actualDamage = originalDamage;
<a name="3920"></a>
<a name="3921"></a>		actualDamage *= Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].DamageMultiplier;
<a name="3922"></a>		totalDamage += actualDamage;
<a name="3923"></a>		actualDamage = <span class="source_type">Level</span>.Game.ReduceDamage(<span class="source_type">Damage</span>, self, instigatedBy, <span class="source_type">HitLocation</span>, <span class="source_type">Momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>);
<a name="3924"></a>		cumulativeDamage += actualDamage;
<a name="3925"></a>
<a name="3926"></a>		if( actualDamage &gt; HighestDamageAmount )
<a name="3927"></a>		{
<a name="3928"></a>			HighestDamageAmount = actualDamage;
<a name="3929"></a>			HighestDamagePoint = <span class="source_type">PointsHit</span>[<span class="source_type">i</span>];
<a name="3930"></a>		}
<a name="3931"></a>
<a name="3932"></a>		<span class="source_comment">//log("We hit "$GetEnum(enum'EPawnHitPointType',Hitpoints[PointsHit[i]].HitPointType));
</span><a name="3933"></a>
<a name="3934"></a>        <span class="source_comment">// Hit detection debugging
</span><a name="3935"></a>		<span class="source_comment">/*if( PointsHit[i] != 0 && !bFirstHit )
<a name="3936"></a>		{
<a name="3937"></a>	        CO = GetBoneCoords(Hitpoints[PointsHit[i]].PointBone);
<a name="3938"></a>			HeadLoc = CO.Origin;
<a name="3939"></a>			HeadLoc = HeadLoc + (Hitpoints[PointsHit[i]].PointOffset &gt;&gt; GetBoneRotation(Hitpoints[PointsHit[i]].PointBone));
<a name="3940"></a>
<a name="3941"></a>			DrawLocation = HeadLoc;
<a name="3942"></a>			DrawRotation = GetBoneRotation(Hitpoints[PointsHit[i]].PointBone);
<a name="3943"></a>			DrawIndex = PointsHit[i];
<a name="3944"></a>			HitPointDebugByte++;
<a name="3945"></a>			bFirstHit = true;
<a name="3946"></a>		}*/</span>
<a name="3947"></a>
<a name="3948"></a>		if (Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].HitPointType == PHP_Leg || Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].HitPointType ==PHP_Foot)
<a name="3949"></a>		{
<a name="3950"></a>	        if (ActualDamage &gt; <span class="source_int">0</span> )
<a name="3951"></a>				SetLimping(FMin(ActualDamage / <span class="source_int">5.0</span>, <span class="source_int">10.0</span>));
<a name="3952"></a>		}
<a name="3953"></a>		else if (Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].HitPointType == PHP_Hand)
<a name="3954"></a>		{
<a name="3955"></a>            if( (<span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none) && (<span class="source_type"><a href="../roengine/roteamgame.html" class="source">ROTeamGame</a></span>(<span class="source_type">Level</span>.Game).FriendlyFireScale &gt; <span class="source_int">0.0</span>) && !InGodMode())
<a name="3956"></a>            {
<a name="3957"></a>	            <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ThrowWeapon();
<a name="3958"></a>	            <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ReceiveLocalizedMessage(<span class="source_type">class</span><span class="source_name">'ROWeaponLostMessage'</span>);
<a name="3959"></a>            }
<a name="3960"></a>		}
<a name="3961"></a>
<a name="3962"></a>		<span class="source_comment">// Update the locational damage list
</span><a name="3963"></a>		<span class="source_comment">//UpdateDamageList(Hitpoints[PointsHit[i]].HitPointType);
</span><a name="3964"></a>		UpdateDamageList(<span class="source_type">PointsHit</span>[<span class="source_type">i</span>] - <span class="source_int">1</span>);
<a name="3965"></a>
<a name="3966"></a>		<span class="source_comment">// Lets exit out if one of the shots killed the player
</span><a name="3967"></a>		if ( cumulativeDamage &gt;=  Health )
<a name="3968"></a>		{
<a name="3969"></a>			TakeDamage(totalDamage, instigatedBy, <span class="source_type">hitlocation</span>, <span class="source_type">momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, HighestDamagePoint);
<a name="3970"></a>		}
<a name="3971"></a>	}
<a name="3972"></a>
<a name="3973"></a>	if( totalDamage &gt; <span class="source_int">0</span> )
<a name="3974"></a>	{
<a name="3975"></a>		<span class="source_comment">// If someone else has killed this player , return
</span><a name="3976"></a>		if( bDeleteMe || Health &lt;= <span class="source_int">0</span> )
<a name="3977"></a>			return;
<a name="3978"></a>
<a name="3979"></a>		TakeDamage(totalDamage, instigatedBy, <span class="source_type">hitlocation</span>, <span class="source_type">momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, HighestDamagePoint);
<a name="3980"></a>	}
<a name="3981"></a>}
<a name="3982"></a>
<a name="3983"></a><span class="source_comment">// Update the list of damaged areas for the pawn
</span><a name="3984"></a><span class="source_comment">// 255 = All areas, 254 = Just the legs
</span><a name="3985"></a>function UpdateDamageList(<span class="source_type">byte</span> NewDamagePoint)
<a name="3986"></a>{
<a name="3987"></a>	if( Role == ROLE_Authority )
<a name="3988"></a>	{
<a name="3989"></a>		if( NewDamagePoint == <span class="source_int">254</span> )
<a name="3990"></a>		{
<a name="3991"></a>			DamageList[<span class="source_int">3</span>] = <span class="source_int">1</span>;
<a name="3992"></a>			DamageList[<span class="source_int">4</span>] = <span class="source_int">1</span>;
<a name="3993"></a>			DamageList[<span class="source_int">7</span>] = <span class="source_int">1</span>;
<a name="3994"></a>			DamageList[<span class="source_int">8</span>] = <span class="source_int">1</span>;
<a name="3995"></a>			DamageList[<span class="source_int">13</span>] = <span class="source_int">1</span>;
<a name="3996"></a>			DamageList[<span class="source_int">14</span>] = <span class="source_int">1</span>;
<a name="3997"></a>
<a name="3998"></a>			ClientUpdateDamageList(NewDamagePoint);
<a name="3999"></a>		}
<a name="4000"></a>		else if( DamageList[NewDamagePoint] == <span class="source_int">0</span> )
<a name="4001"></a>		{
<a name="4002"></a>			DamageList[NewDamagePoint] = <span class="source_int">1</span>;
<a name="4003"></a>
<a name="4004"></a>			ClientUpdateDamageList(NewDamagePoint);
<a name="4005"></a>		}
<a name="4006"></a>	}
<a name="4007"></a>}
<a name="4008"></a>
<a name="4009"></a><span class="source_comment">// Replicated from server to client to set the clients
</span><a name="4010"></a><span class="source_comment">// Damage areas
</span><a name="4011"></a>simulated function ClientUpdateDamageList(<span class="source_type">byte</span> NewDamagePoint)
<a name="4012"></a>{
<a name="4013"></a>	local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> <span class="source_type">PC</span>;
<a name="4014"></a>
<a name="4015"></a>	<span class="source_type">PC</span> = <span class="source_type">Level</span>.GetLocalPlayerController();
<a name="4016"></a>
<a name="4017"></a>	if( NewDamagePoint == <span class="source_int">254</span> )
<a name="4018"></a>	{
<a name="4019"></a>		DamageList[<span class="source_int">3</span>] = <span class="source_int">1</span>;
<a name="4020"></a>		DamageList[<span class="source_int">4</span>] = <span class="source_int">1</span>;
<a name="4021"></a>		DamageList[<span class="source_int">7</span>] = <span class="source_int">1</span>;
<a name="4022"></a>		DamageList[<span class="source_int">8</span>] = <span class="source_int">1</span>;
<a name="4023"></a>		DamageList[<span class="source_int">13</span>] = <span class="source_int">1</span>;
<a name="4024"></a>		DamageList[<span class="source_int">14</span>] = <span class="source_int">1</span>;
<a name="4025"></a>	}
<a name="4026"></a>	else
<a name="4027"></a>	{
<a name="4028"></a>		DamageList[NewDamagePoint] = <span class="source_int">1</span>;
<a name="4029"></a>	}
<a name="4030"></a>}
<a name="4031"></a>
<a name="4032"></a><span class="source_comment">// Hit detection debugging - Only use when debugging
</span><a name="4033"></a><span class="source_comment">/*
<a name="4034"></a>simulated function DrawBoneLocation()
<a name="4035"></a>{
<a name="4036"></a>    local vector X, Y, Z;
<a name="4037"></a>
<a name="4038"></a>    GetAxes(DrawRotation, X,Y,Z);
<a name="4039"></a>    ClearStayingDebugLines();
<a name="4040"></a>
<a name="4041"></a>	DrawStayingDebugLine(HitStart, HitEnd, 0,255,0);
<a name="4042"></a>	Spawn(class 'ROEngine.RODebugTracer',self,,HitStart,Rotator(Normal(HitEnd-HitStart)));
<a name="4043"></a>
<a name="4044"></a>	DrawDebugCylinder(DrawLocation,Z,Y,X,Hitpoints[DrawIndex].PointRadius * Hitpoints[DrawIndex].PointScale,Hitpoints[DrawIndex].PointHeight * Hitpoints[DrawIndex].PointScale,10,0, 255, 0);
<a name="4045"></a>}
<a name="4046"></a>
<a name="4047"></a>simulated function DrawDebugCylinder(vector Base,vector X, vector Y,vector Z, FLOAT Radius,float HalfHeight,int NumSides, byte R, byte G, byte B)
<a name="4048"></a>{
<a name="4049"></a>	local float AngleDelta;
<a name="4050"></a>	local vector LastVertex, Vertex;
<a name="4051"></a>	local int SideIndex;
<a name="4052"></a>
<a name="4053"></a>	AngleDelta = 2.0f * PI / NumSides;
<a name="4054"></a>	LastVertex = Base + X * Radius;
<a name="4055"></a>
<a name="4056"></a>	for(SideIndex = 0;SideIndex &lt; NumSides;SideIndex++)
<a name="4057"></a>	{
<a name="4058"></a>		Vertex = Base + (X * Cos(AngleDelta * (SideIndex + 1)) + Y * Sin(AngleDelta * (SideIndex + 1))) * Radius;
<a name="4059"></a>
<a name="4060"></a>        DrawStayingDebugLine( LastVertex - Z * HalfHeight,Vertex - Z * HalfHeight,R,G,B);
<a name="4061"></a>        DrawStayingDebugLine( LastVertex + Z * HalfHeight,Vertex + Z * HalfHeight,R,G,B);
<a name="4062"></a>        DrawStayingDebugLine( LastVertex - Z * HalfHeight,LastVertex + Z * HalfHeight,R,G,B);
<a name="4063"></a>
<a name="4064"></a>		LastVertex = Vertex;
<a name="4065"></a>	}
<a name="4066"></a>}*/</span>
<a name="4067"></a>
<a name="4068"></a><span class="source_comment">//returns how exposed this player is to another actor
</span><a name="4069"></a>function <span class="source_type">float</span> GetExposureTo(<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> TestLocation)
<a name="4070"></a>{
<a name="4071"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="4072"></a>	local <span class="source_type">float</span> PercentExposed;
<a name="4073"></a>
<a name="4074"></a>	for(<span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;Hitpoints.Length; <span class="source_type">i</span>++)
<a name="4075"></a>	{
<a name="4076"></a>		if( <span class="source_type">i</span> == <span class="source_int">0</span> )
<a name="4077"></a>		{
<a name="4078"></a>			if( FastTrace(GetBoneCoords(Hitpoints[<span class="source_type">i</span>].PointBone).Origin,TestLocation))
<a name="4079"></a>			{
<a name="4080"></a>				PercentExposed += <span class="source_int">0.4</span>;
<a name="4081"></a>			}
<a name="4082"></a>		}
<a name="4083"></a>		else if ( <span class="source_type">i</span> == <span class="source_int">1</span>)
<a name="4084"></a>		{
<a name="4085"></a>			if( FastTrace(GetBoneCoords(Hitpoints[<span class="source_type">i</span>].PointBone).Origin,TestLocation))
<a name="4086"></a>			{
<a name="4087"></a>				PercentExposed += <span class="source_int">0.3</span>;
<a name="4088"></a>			}
<a name="4089"></a>		}
<a name="4090"></a>		else if ( <span class="source_type">i</span> == <span class="source_int">13</span>)
<a name="4091"></a>		{
<a name="4092"></a>			if( FastTrace(GetBoneCoords(Hitpoints[<span class="source_type">i</span>].PointBone).Origin,TestLocation))
<a name="4093"></a>			{
<a name="4094"></a>				PercentExposed += <span class="source_int">0.15</span>;
<a name="4095"></a>			}
<a name="4096"></a>		}
<a name="4097"></a>		else if ( <span class="source_type">i</span> == <span class="source_int">14</span>)
<a name="4098"></a>		{
<a name="4099"></a>			if( FastTrace(GetBoneCoords(Hitpoints[<span class="source_type">i</span>].PointBone).Origin,TestLocation))
<a name="4100"></a>			{
<a name="4101"></a>				PercentExposed += <span class="source_int">0.15</span>;
<a name="4102"></a>			}
<a name="4103"></a>		}
<a name="4104"></a>	}
<a name="4105"></a>
<a name="4106"></a>	return PercentExposed;
<a name="4107"></a>}
<a name="4108"></a>
<a name="4109"></a>
<a name="4110"></a><span class="source_comment">// Overriden so pawns don't go to the falling state every time they are shot
</span><a name="4111"></a>function AddVelocity( <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> NewVelocity)
<a name="4112"></a>{
<a name="4113"></a>	if ( bIgnoreForces || (NewVelocity == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>)) )
<a name="4114"></a>		return;
<a name="4115"></a>	if ( (Physics == PHYS_Falling) && (<span class="source_type"><a href="../engine/aicontroller.html" class="source">AIController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None) )
<a name="4116"></a>		ImpactVelocity += NewVelocity;
<a name="4117"></a>	if ( (Physics == PHYS_Walking && (NewVelocity.<span class="source_type">Z</span> &gt; (Default.JumpZ/<span class="source_int">2</span>)))
<a name="4118"></a>		|| (((Physics == PHYS_Ladder) || (Physics == PHYS_Spider)) && (NewVelocity.<span class="source_type">Z</span> &gt; Default.JumpZ)) )
<a name="4119"></a>		SetPhysics(PHYS_Falling);
<a name="4120"></a>	if ( (Velocity.<span class="source_type">Z</span> &gt; <span class="source_int">380</span>) && (NewVelocity.<span class="source_type">Z</span> &gt; <span class="source_int">0</span>) )
<a name="4121"></a>		NewVelocity.<span class="source_type">Z</span> *= <span class="source_int">0.5</span>;
<a name="4122"></a>	Velocity += NewVelocity;
<a name="4123"></a>}
<a name="4124"></a>
<a name="4125"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4126"></a><span class="source_comment">// TakeDamage - Handle locational damage
</span><a name="4127"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4128"></a><span class="source_comment">// MergeTODO: This function needs some work
</span><a name="4129"></a>function TakeDamage(<span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, optional <span class="source_type">int</span> <span class="source_type">HitIndex</span>)
<a name="4130"></a>{
<a name="4131"></a>	local <span class="source_type">int</span> actualDamage;
<a name="4132"></a>	local <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> Killer;
<a name="4133"></a>
<a name="4134"></a>	if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">damagetype</a></span> == None )
<a name="4135"></a>	{
<a name="4136"></a>		if ( InstigatedBy != None )
<a name="4137"></a>			warn(<span class="source_string">"No damagetype for damage by "</span>$instigatedby$<span class="source_string">" with weapon "</span>$InstigatedBy.<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>);
<a name="4138"></a>		<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> = <span class="source_type">class</span><span class="source_name">'DamageType'</span>;
<a name="4139"></a>	}
<a name="4140"></a>
<a name="4141"></a>	if ( Role &lt; ROLE_Authority )
<a name="4142"></a>	{
<a name="4143"></a>		<span class="source_comment">//log(self$" client damage type "$damageType$" by "$instigatedBy);
</span><a name="4144"></a>		return;
<a name="4145"></a>	}
<a name="4146"></a>
<a name="4147"></a>	if ( Health &lt;= <span class="source_int">0</span> )
<a name="4148"></a>		return;
<a name="4149"></a>
<a name="4150"></a>	if ((instigatedBy == None || instigatedBy.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == None) && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bDelayedDamage && DelayedDamageInstigatorController != None)
<a name="4151"></a>		instigatedBy = DelayedDamageInstigatorController.<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>;
<a name="4152"></a>
<a name="4153"></a>	if ( (Physics == PHYS_None) && (DrivenVehicle == None) )
<a name="4154"></a>		SetMovementPhysics();
<a name="4155"></a>	if (Physics == PHYS_Walking && <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>.default.bExtraMomentumZ)
<a name="4156"></a>		<span class="source_type">momentum</span>.<span class="source_type">Z</span> = FMax(<span class="source_type">momentum</span>.<span class="source_type">Z</span>, <span class="source_int">0.4</span> * VSize(<span class="source_type">momentum</span>));
<a name="4157"></a>	if ( instigatedBy == self )
<a name="4158"></a>		<span class="source_type">momentum</span> *= <span class="source_int">0.6</span>;
<a name="4159"></a>	<span class="source_type">momentum</span> = <span class="source_type">momentum</span>/Mass;
<a name="4160"></a>
<a name="4161"></a>	if (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None)
<a name="4162"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.AdjustPlayerDamage( <span class="source_type">Damage</span>, InstigatedBy, <span class="source_type">HitLocation</span>, <span class="source_type">Momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> );
<a name="4163"></a>
<a name="4164"></a>	if (DrivenVehicle != None)
<a name="4165"></a>        	DrivenVehicle.AdjustDriverDamage( <span class="source_type">Damage</span>, InstigatedBy, <span class="source_type">HitLocation</span>, <span class="source_type">Momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> );
<a name="4166"></a>
<a name="4167"></a>	ActualDamage = <span class="source_type">Level</span>.Game.ReduceDamage(<span class="source_type">Damage</span>, self, instigatedBy, <span class="source_type">HitLocation</span>, <span class="source_type">Momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>);
<a name="4168"></a>
<a name="4169"></a>	if (ActualDamage &gt; <span class="source_int">0</span> && (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.<span class="source_type">Name</span> == <span class="source_name">'Fell'</span>))
<a name="4170"></a>		SetLimping(FMin(ActualDamage / <span class="source_int">5.0</span>, <span class="source_int">10.0</span>));
<a name="4171"></a>
<a name="4172"></a>	<span class="source_comment">//ClientMessage("Hit area:" @ HitBone @ "Damage:" @ ActualDamage);
</span><a name="4173"></a>
<a name="4174"></a>	Health -= actualDamage;
<a name="4175"></a>	if ( <span class="source_type">HitLocation</span> == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) )
<a name="4176"></a>		<span class="source_type">HitLocation</span> = Location;
<a name="4177"></a>
<a name="4178"></a>	LastHitIndex = <span class="source_type">HitIndex</span>;
<a name="4179"></a>
<a name="4180"></a>	PlayHit(actualDamage,InstigatedBy, <span class="source_type">hitLocation</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type">Momentum</span>, <span class="source_type">HitIndex</span>);
<a name="4181"></a>	if ( Health &lt;= <span class="source_int">0</span> )
<a name="4182"></a>	{
<a name="4183"></a>		<span class="source_comment">// pawn died
</span><a name="4184"></a>		if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bCausedByWorld && (instigatedBy == None || instigatedBy == self) && LastHitBy != None )
<a name="4185"></a>			Killer = LastHitBy;
<a name="4186"></a>		else if ( instigatedBy != None )
<a name="4187"></a>			Killer = instigatedBy.GetKillerController();
<a name="4188"></a>		if ( Killer == None && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bDelayedDamage )
<a name="4189"></a>			Killer = DelayedDamageInstigatorController;
<a name="4190"></a>		if ( bPhysicsAnimUpdate )
<a name="4191"></a>			SetTearOffMomemtum(<span class="source_type">momentum</span>);
<a name="4192"></a>		Died(Killer, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type">HitLocation</span>);
<a name="4193"></a>	}
<a name="4194"></a>	else
<a name="4195"></a>	{
<a name="4196"></a>		AddVelocity( <span class="source_type">momentum</span> );
<a name="4197"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="4198"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.NotifyTakeHit(instigatedBy, <span class="source_type">HitLocation</span>, actualDamage, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type">Momentum</span>);
<a name="4199"></a>
<a name="4200"></a>		if ( instigatedBy != None && instigatedBy != self )
<a name="4201"></a>			LastHitBy = instigatedBy.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="4202"></a>	}
<a name="4203"></a>	MakeNoise(<span class="source_int">1.0</span>);
<a name="4204"></a>}
<a name="4205"></a>
<a name="4206"></a><span class="source_comment">/**
<a name="4207"></a>  * When player dies this method is called to find and drop
<a name="4208"></a>  * all other weapons in their inventory
<a name="4209"></a>  */</span>
<a name="4210"></a><span class="source_comment">// MergeTODO: This function was probably crashing due to the bDeleteMe flag problem. Search unprog for the fix
</span><a name="4211"></a>function DropWeaponInventory(<span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> TossVel)
<a name="4212"></a>{
<a name="4213"></a>	local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> Inv;
<a name="4214"></a>	local <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> invWeapon;
<a name="4215"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>;
<a name="4216"></a>	local <span class="source_type">int</span> count, <span class="source_type">i</span>;
<a name="4217"></a>	local array&lt;<span class="source_type">class</span>&gt; DroppedClasses;
<a name="4218"></a>	local <span class="source_type">bool</span> bAlreadyUsedClass;
<a name="4219"></a>
<a name="4220"></a>	GetAxes(<span class="source_type">Rotation</span>,<span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>);
<a name="4221"></a>
<a name="4222"></a>	count=<span class="source_int">0</span>;
<a name="4223"></a>	Inv=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>;
<a name="4224"></a>
<a name="4225"></a>	<span class="source_comment">// consider doing a check on count to make sure it doesn't get too high
</span><a name="4226"></a>	<span class="source_comment">// and force Unreal to crash with a run away loop
</span><a name="4227"></a>    while((Inv != none) && (count &lt; <span class="source_int">15</span>))<span class="source_comment">// 500
</span><a name="4228"></a>    {
<a name="4229"></a>        count++;
<a name="4230"></a>        if(Inv.IsA(<span class="source_name">'Weapon'</span>))
<a name="4231"></a>        {
<a name="4232"></a>            invWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(Inv);
<a name="4233"></a>
<a name="4234"></a>            if(invWeapon != none && invWeapon.bCanThrow)
<a name="4235"></a>            {
<a name="4236"></a>                for ( <span class="source_type">i</span>=<span class="source_int">0</span>;<span class="source_type">i</span>&lt;DroppedClasses.Length;<span class="source_type">i</span>++ )
<a name="4237"></a>                {
<a name="4238"></a>                    <span class="source_comment">//log("Dropped classes "$i$" = "$DroppedClasses[i]);
</span><a name="4239"></a>                    if( invWeapon.<span class="source_type">Class</span> == DroppedClasses[<span class="source_type">i</span>] )
<a name="4240"></a>                    {
<a name="4241"></a>                        bAlreadyUsedClass = true;
<a name="4242"></a>                        break;
<a name="4243"></a>                    }
<a name="4244"></a>                }
<a name="4245"></a>
<a name="4246"></a>                if( !bAlreadyUsedClass )
<a name="4247"></a>                {
<a name="4248"></a>                    <span class="source_comment">// because the weapon is destroyed from inventory need to start over again
</span><a name="4249"></a>                    <span class="source_comment">// and search through the inventory from the beginning.
</span><a name="4250"></a>                    DroppedClasses[DroppedClasses.Length] = invWeapon.<span class="source_type">Class</span>;
<a name="4251"></a>                    invWeapon.DropFrom(Location + <span class="source_int">0.8</span> * CollisionRadius * <span class="source_type">X</span> - <span class="source_int">0.5</span> * CollisionRadius * <span class="source_type">Y</span>);
<a name="4252"></a>                    Inv = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>;
<a name="4253"></a>                }
<a name="4254"></a>                else
<a name="4255"></a>                {
<a name="4256"></a>                    <span class="source_comment">//log("Trying to drop the same weapon: "$invWeapon.Class$" twice - possible lag bug cause");
</span><a name="4257"></a>                    Inv=Inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>;
<a name="4258"></a>                }
<a name="4259"></a>            }
<a name="4260"></a>            else
<a name="4261"></a>            {
<a name="4262"></a>                Inv=Inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>;
<a name="4263"></a>            }
<a name="4264"></a>        }
<a name="4265"></a>        else
<a name="4266"></a>        {
<a name="4267"></a>            Inv=Inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>;
<a name="4268"></a>        }
<a name="4269"></a>
<a name="4270"></a>        bAlreadyUsedClass=false;
<a name="4271"></a>    }
<a name="4272"></a>}
<a name="4273"></a>
<a name="4274"></a><span class="source_comment">// Clean up weapon inventory before level change since certain weapons
</span><a name="4275"></a><span class="source_comment">// (sniper scopes with 3d scopes) won't get properly garbage collected
</span><a name="4276"></a><span class="source_comment">// otherwise. This lead to the webadmin and memory leak issues - Ramm
</span><a name="4277"></a>simulated function PreTravelCleanUp()
<a name="4278"></a>{
<a name="4279"></a>	local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> Inv;
<a name="4280"></a>	local <span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span> invWeapon;
<a name="4281"></a>	local <span class="source_type">int</span> count;
<a name="4282"></a>
<a name="4283"></a>	count=<span class="source_int">0</span>;
<a name="4284"></a>
<a name="4285"></a>	<span class="source_comment">// consider doing a check on count to make sure it doesn't get too high
</span><a name="4286"></a>	<span class="source_comment">// and force Unreal to crash with a run away loop
</span><a name="4287"></a>	for ( Inv=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; Inv!=None; Inv=Inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="4288"></a>	{
<a name="4289"></a>		invWeapon = <span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(Inv);
<a name="4290"></a>		if ( invWeapon != None )
<a name="4291"></a>		{
<a name="4292"></a>			invWeapon.PreTravelCleanUp();
<a name="4293"></a>		}
<a name="4294"></a>
<a name="4295"></a>		count++;
<a name="4296"></a>
<a name="4297"></a>		if( count &gt; <span class="source_int">500</span> )
<a name="4298"></a>			break;
<a name="4299"></a>	}
<a name="4300"></a>}
<a name="4301"></a>
<a name="4302"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4303"></a><span class="source_comment">// Died - A few minor additions
</span><a name="4304"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4305"></a>
<a name="4306"></a>function Died(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> Killer, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>)
<a name="4307"></a>{
<a name="4308"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span>			TossVel;
<a name="4309"></a>	local <span class="source_type"><a href="../engine/trigger.html" class="source">Trigger</a></span>			<span class="source_type">T</span>;
<a name="4310"></a>	local <span class="source_type"><a href="../engine/navigationpoint.html" class="source">NavigationPoint</a></span>	<span class="source_type">N</span>;
<a name="4311"></a>	local <span class="source_type">float</span>	DamageBeyondZero;
<a name="4312"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HitDirection;
<a name="4313"></a>
<a name="4314"></a>	if ( bDeleteMe || <span class="source_type">Level</span>.bLevelChange || <span class="source_type">Level</span>.Game == None )
<a name="4315"></a>		return; <span class="source_comment">// already destroyed, or level is being cleaned up
</span><a name="4316"></a>
<a name="4317"></a>	if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bCausedByWorld && (Killer == None || Killer == <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) && LastHitBy != None )
<a name="4318"></a>		Killer = LastHitBy;
<a name="4319"></a>
<a name="4320"></a>	<span class="source_comment">// mutator hook to prevent deaths
</span><a name="4321"></a>	<span class="source_comment">// WARNING - don't prevent bot suicides - they suicide when really needed
</span><a name="4322"></a>	if ( <span class="source_type">Level</span>.Game.PreventDeath(self, Killer, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type">HitLocation</span>) )
<a name="4323"></a>	{
<a name="4324"></a>		Health = <span class="source_type">max</span>(Health, <span class="source_int">1</span>); <span class="source_comment">//mutator should set this higher
</span><a name="4325"></a>		return;
<a name="4326"></a>	}
<a name="4327"></a>
<a name="4328"></a>	<span class="source_comment">// Turn off the auxilary collision when the player dies
</span><a name="4329"></a>	if (  AuxCollisionCylinder != none )
<a name="4330"></a>	{
<a name="4331"></a>	    AuxCollisionCylinder.SetCollision(false,false,false);
<a name="4332"></a>	}
<a name="4333"></a>
<a name="4334"></a>    DamageBeyondZero = Health;
<a name="4335"></a>
<a name="4336"></a>	Health = Min(<span class="source_int">0</span>, Health);
<a name="4337"></a>
<a name="4338"></a>	<span class="source_comment">// Fix for suicide death messages
</span><a name="4339"></a>    if (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> == <span class="source_type">class</span><span class="source_name">'Suicided'</span>)
<a name="4340"></a>	    <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> = <span class="source_type">class</span><span class="source_name">'ROSuicided'</span>;
<a name="4341"></a>
<a name="4342"></a>    if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None && (DrivenVehicle == None || DrivenVehicle.bAllowWeaponToss) )
<a name="4343"></a>    {
<a name="4344"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="4345"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.LastPawnWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type">Class</span>;
<a name="4346"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.HolderDied();
<a name="4347"></a>        TossVel = <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span>(GetViewRotation());
<a name="4348"></a>        TossVel = TossVel * ((Velocity Dot TossVel) + <span class="source_int">50</span>) + Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">200</span>);
<a name="4349"></a>        TossWeapon(TossVel);
<a name="4350"></a>    }
<a name="4351"></a>
<a name="4352"></a>	DropWeaponInventory(TossVel);		<span class="source_comment">// drops all weapons in inventory
</span><a name="4353"></a>
<a name="4354"></a>	if ( DrivenVehicle != None )
<a name="4355"></a>	{
<a name="4356"></a>		Velocity = DrivenVehicle.Velocity;
<a name="4357"></a>		DrivenVehicle.DriverDied();
<a name="4358"></a>	}
<a name="4359"></a>
<a name="4360"></a>	if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="4361"></a>	{
<a name="4362"></a>		<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.WasKilledBy(Killer);
<a name="4363"></a>		<span class="source_type">Level</span>.Game.<span class="source_type">Killed</span>(Killer, <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>, self, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>);
<a name="4364"></a>	}
<a name="4365"></a>	else
<a name="4366"></a>		<span class="source_type">Level</span>.Game.<span class="source_type">Killed</span>(Killer, <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>(<span class="source_type">Owner</span>), self, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>);
<a name="4367"></a>
<a name="4368"></a>	DrivenVehicle = None;
<a name="4369"></a>
<a name="4370"></a>	if ( Killer != None )
<a name="4371"></a>		TriggerEvent(Event, self, Killer.<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>);
<a name="4372"></a>	else
<a name="4373"></a>		TriggerEvent(Event, self, None);
<a name="4374"></a>
<a name="4375"></a>	<span class="source_comment">// make sure to untrigger any triggers requiring player touch
</span><a name="4376"></a>	if ( IsPlayerPawn() || WasPlayerPawn() )
<a name="4377"></a>	{
<a name="4378"></a>		<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.PlayerPawnDiedInVolume(self);
<a name="4379"></a>		ForEach TouchingActors(<span class="source_type">class</span><span class="source_name">'Trigger'</span>,<span class="source_type">T</span>)
<a name="4380"></a>			<span class="source_type">T</span>.PlayerToucherDied(self);
<a name="4381"></a>
<a name="4382"></a>		<span class="source_comment">// event for HoldObjectives
</span><a name="4383"></a>		foreach TouchingActors(<span class="source_type">class</span><span class="source_name">'NavigationPoint'</span>, <span class="source_type">N</span>)
<a name="4384"></a>			if ( <span class="source_type">N</span>.bReceivePlayerToucherDiedNotify )
<a name="4385"></a>				<span class="source_type">N</span>.PlayerToucherDied( Self );
<a name="4386"></a>	}
<a name="4387"></a>
<a name="4388"></a>	<span class="source_comment">// remove powerup effects, etc.
</span><a name="4389"></a>	RemovePowerups();
<a name="4390"></a>
<a name="4391"></a>	Velocity.<span class="source_type">Z</span> *= <span class="source_int">1.3</span>;
<a name="4392"></a>	if ( IsHumanControlled() )
<a name="4393"></a>		<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ForceDeathUpdate();
<a name="4394"></a>	if ( <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none
<a name="4395"></a>         && <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/roweapondamagetype.html" class="source">ROWeaponDamageType</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>) != none
<a name="4396"></a>         && <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/roweapondamagetype.html" class="source">ROWeaponDamageType</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>).default.bCauseViewJarring == true )
<a name="4397"></a>	{
<a name="4398"></a>        HitDirection = Location - <span class="source_type">HitLocation</span>;
<a name="4399"></a>        HitDirection.<span class="source_type">Z</span> = <span class="source_int">0.0f</span>;
<a name="4400"></a>        HitDirection = normal(HitDirection);
<a name="4401"></a>
<a name="4402"></a>	    <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).PlayerJarred(HitDirection,<span class="source_int">3.0f</span>);
<a name="4403"></a>	}
<a name="4404"></a>    if ( (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None) && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bAlwaysGibs && !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore())
<a name="4405"></a>    {
<a name="4406"></a>        if ( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer )
<a name="4407"></a>           DoDamageFX(<span class="source_name">'obliterate'</span>,<span class="source_int">1010</span>,<span class="source_type">class</span><span class="source_name">'RODiedInTankDamType'</span>, <span class="source_type">Rotation</span>);
<a name="4408"></a>        ChunkUp( <span class="source_type">Rotation</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.<span class="source_type">GibPerterbation</span> );
<a name="4409"></a>	}
<a name="4410"></a>	else if (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != none && (Abs(DamageBeyondZero) + default.Health) &gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.HumanObliterationThreshhold &&
<a name="4411"></a>		!<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore())
<a name="4412"></a>	{
<a name="4413"></a>	    if ( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer )
<a name="4414"></a>	       DoDamageFX(<span class="source_name">'obliterate'</span>,<span class="source_int">1010</span>,<span class="source_type">class</span><span class="source_name">'RODiedInTankDamType'</span>, <span class="source_type">Rotation</span>);
<a name="4415"></a>        ChunkUp( <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(GetTearOffMomemtum()), <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.<span class="source_type">GibPerterbation</span> );
<a name="4416"></a>	}
<a name="4417"></a>	else
<a name="4418"></a>	{
<a name="4419"></a>		NetUpdateFrequency = Default.NetUpdateFrequency;
<a name="4420"></a>		PlayDying(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type">HitLocation</span>);
<a name="4421"></a>		if ( <span class="source_type">Level</span>.Game.bGameEnded )
<a name="4422"></a>			return;
<a name="4423"></a>		if ( !bPhysicsAnimUpdate && !IsLocallyControlled() )
<a name="4424"></a>			ClientDying(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type">HitLocation</span>);
<a name="4425"></a>	}
<a name="4426"></a>}
<a name="4427"></a>
<a name="4428"></a><span class="source_comment">// Overridden to support some Xpawn functionality we wanted
</span><a name="4429"></a>simulated function PlayDying(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HitLoc)
<a name="4430"></a>{
<a name="4431"></a>	WeaponState = GS_None;
<a name="4432"></a>	if( <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none )
<a name="4433"></a>		<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bFreeCamera = false;
<a name="4434"></a>
<a name="4435"></a>	<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = None;
<a name="4436"></a>    bCanTeleport = false; <span class="source_comment">// sjs - fix karma going crazy when corpses land on teleporters
</span><a name="4437"></a>    bReplicateMovement = false;
<a name="4438"></a>    bTearOff = true;
<a name="4439"></a>    bPlayedDeath = true;
<a name="4440"></a>
<a name="4441"></a>	HitDamageType = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>; <span class="source_comment">// these are replicated to other clients
</span><a name="4442"></a>    TakeHitLocation = HitLoc;
<a name="4443"></a>
<a name="4444"></a>    if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None )
<a name="4445"></a>    {
<a name="4446"></a>		if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DeathOverlayMaterial != None && !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="4447"></a>			SetOverlayMaterial(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DeathOverlayMaterial, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DeathOverlayTime, true);
<a name="4448"></a>		else if ( (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageOverlayMaterial != None) && (<span class="source_type">Level</span>.DetailMode != DM_Low) && !<span class="source_type">Level</span>.bDropDetail )
<a name="4449"></a>			SetOverlayMaterial(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageOverlayMaterial, <span class="source_int">2</span>*<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayTime, true);
<a name="4450"></a>	}
<a name="4451"></a>
<a name="4452"></a>    <span class="source_comment">// stop shooting
</span><a name="4453"></a>    AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">0.0</span>);
<a name="4454"></a>	LifeSpan = RagdollLifeSpan;
<a name="4455"></a>
<a name="4456"></a>    GotoState(<span class="source_name">'Dying'</span>);
<a name="4457"></a>
<a name="4458"></a>	PlayDyingAnimation(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, HitLoc);
<a name="4459"></a>}
<a name="4460"></a>
<a name="4461"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4462"></a><span class="source_comment">// KilledBy - Changed damage type - butto 9/14/03
</span><a name="4463"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4464"></a>function KilledBy( <span class="source_type"><a href="../engine/pawn.html" class="source">pawn</a></span> <span class="source_type">EventInstigator</span> )
<a name="4465"></a>{
<a name="4466"></a>	local <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> Killer;
<a name="4467"></a>
<a name="4468"></a>	Health = <span class="source_int">0</span>;
<a name="4469"></a>	if ( <span class="source_type">EventInstigator</span> != None )
<a name="4470"></a>		Killer = <span class="source_type">EventInstigator</span>.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="4471"></a>	Died( Killer, <span class="source_type">class</span><span class="source_name">'ROSuicided'</span>, Location );
<a name="4472"></a>}
<a name="4473"></a>
<a name="4474"></a><span class="source_comment">// Killed yourself (like with a grenade that you let go off in your hand)
</span><a name="4475"></a>function KilledSelf( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span> )
<a name="4476"></a>{
<a name="4477"></a>	local <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> Killer;
<a name="4478"></a>
<a name="4479"></a>	Health = <span class="source_int">0</span>;
<a name="4480"></a>
<a name="4481"></a>	Killer = <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="4482"></a>	Died( Killer, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, Location );
<a name="4483"></a>}
<a name="4484"></a>
<a name="4485"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4486"></a><span class="source_comment">// DoDamageFX
</span><a name="4487"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4488"></a><span class="source_comment">// TODO: This is where are gib stuff will go
</span><a name="4489"></a>function DoDamageFX( <span class="source_type">Name</span> boneName, <span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">r</span> )
<a name="4490"></a>{
<a name="4491"></a>	local <span class="source_type">float</span> DismemberProbability;
<a name="4492"></a>    local <span class="source_type">int</span> RandBone;
<a name="4493"></a>    local <span class="source_type">bool</span> bDidSever;
<a name="4494"></a>
<a name="4495"></a>    if (  FRand() &gt; <span class="source_int">0.3f</span> || <span class="source_type">Damage</span> &gt; <span class="source_int">30</span> || Health &lt;= <span class="source_int">0</span> )
<a name="4496"></a>    {
<a name="4497"></a>        HitFX[HitFxTicker].damtype = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>;
<a name="4498"></a>
<a name="4499"></a>        if( Health &lt;= <span class="source_int">0</span> )
<a name="4500"></a>        {
<a name="4501"></a>            <span class="source_type">switch</span>( boneName )
<a name="4502"></a>            {
<a name="4503"></a>                case <span class="source_name">'lfoot'</span>:
<a name="4504"></a>                case <span class="source_name">'lthigh'</span>:
<a name="4505"></a>                case <span class="source_name">'lupperthigh'</span>:
<a name="4506"></a>                    boneName = <span class="source_name">'lthigh'</span>;
<a name="4507"></a>                    break;
<a name="4508"></a>
<a name="4509"></a>                case <span class="source_name">'rfoot'</span>:
<a name="4510"></a>                case <span class="source_name">'rthigh'</span>:
<a name="4511"></a>                case <span class="source_name">'rupperthigh'</span>:
<a name="4512"></a>                    boneName = <span class="source_name">'rthigh'</span>;
<a name="4513"></a>                    break;
<a name="4514"></a>
<a name="4515"></a>                case <span class="source_name">'lhand'</span>:
<a name="4516"></a>                case <span class="source_name">'lfarm'</span>:
<a name="4517"></a>                case <span class="source_name">'lupperarm'</span>:
<a name="4518"></a>                case <span class="source_name">'lshoulder'</span>:
<a name="4519"></a>                    boneName = <span class="source_name">'lfarm'</span>;
<a name="4520"></a>                    break;
<a name="4521"></a>
<a name="4522"></a>                case <span class="source_name">'rhand'</span>:
<a name="4523"></a>                case <span class="source_name">'rfarm'</span>:
<a name="4524"></a>                case <span class="source_name">'rupperarm'</span>:
<a name="4525"></a>                case <span class="source_name">'rshoulder'</span>:
<a name="4526"></a>                    boneName = <span class="source_name">'rfarm'</span>;
<a name="4527"></a>                    break;
<a name="4528"></a>
<a name="4529"></a>                case <span class="source_name">'None'</span>:
<a name="4530"></a>                    boneName = <span class="source_name">'Spine'</span>;
<a name="4531"></a>                    break;
<a name="4532"></a>            }
<a name="4533"></a>
<a name="4534"></a><span class="source_comment">//	        if( !DamageType.default.bLocationalHit && (boneName == 'None' || boneName == 'Upperspine' ||
</span><a name="4535"></a><span class="source_comment">//				boneName == 'Spine' ))
</span><a name="4536"></a><span class="source_comment">//	        {
</span><a name="4537"></a><span class="source_comment">//	        	RandBone = Rand(4);
</span><a name="4538"></a><span class="source_comment">//
</span><a name="4539"></a><span class="source_comment">//				switch( RandBone )
</span><a name="4540"></a><span class="source_comment">//	            {
</span><a name="4541"></a><span class="source_comment">//	                case 0:
</span><a name="4542"></a><span class="source_comment">//						boneName = 'lthigh';
</span><a name="4543"></a><span class="source_comment">//						break;
</span><a name="4544"></a><span class="source_comment">//	                case 1:
</span><a name="4545"></a><span class="source_comment">//						boneName = 'rthigh';
</span><a name="4546"></a><span class="source_comment">//						break;
</span><a name="4547"></a><span class="source_comment">//	                case 2:
</span><a name="4548"></a><span class="source_comment">//						boneName = 'lfarm';
</span><a name="4549"></a><span class="source_comment">//	                    break;
</span><a name="4550"></a><span class="source_comment">//	                case 3:
</span><a name="4551"></a><span class="source_comment">//						boneName = 'rfarm';
</span><a name="4552"></a><span class="source_comment">//	                    break;
</span><a name="4553"></a><span class="source_comment">//	                case 4:
</span><a name="4554"></a><span class="source_comment">//						boneName = 'head';
</span><a name="4555"></a><span class="source_comment">//	                    break;
</span><a name="4556"></a><span class="source_comment">//	                default:
</span><a name="4557"></a><span class="source_comment">//	                	boneName = 'lthigh';
</span><a name="4558"></a><span class="source_comment">//	            }
</span><a name="4559"></a><span class="source_comment">//	        }
</span><a name="4560"></a>
<a name="4561"></a>			if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bAlwaysSevers || (<span class="source_type">Damage</span> == <span class="source_int">1000</span>) )
<a name="4562"></a>			{
<a name="4563"></a>                HitFX[HitFxTicker].bSever = true;
<a name="4564"></a>                bDidSever = true;
<a name="4565"></a>                if ( boneName == <span class="source_name">'None'</span> )
<a name="4566"></a>                {
<a name="4567"></a>					boneName = <span class="source_name">'spine'</span>;
<a name="4568"></a>				}
<a name="4569"></a>			}
<a name="4570"></a>            else if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.GibModifier &gt; <span class="source_int">0.0</span> )
<a name="4571"></a>            {
<a name="4572"></a>	            DismemberProbability = Abs( (Health - <span class="source_type">Damage</span>*<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.GibModifier) / <span class="source_int">130.0f</span> );
<a name="4573"></a><span class="source_comment">/*				switch( boneName )
<a name="4574"></a>                {
<a name="4575"></a>                    case 'lfoot':
<a name="4576"></a>                    case 'rfoot':
<a name="4577"></a>	                case 'lthigh':
<a name="4578"></a>                    case 'rthigh':
<a name="4579"></a>                    case 'lhand':
<a name="4580"></a>                    case 'rhand':
<a name="4581"></a>                    case 'rfarm':
<a name="4582"></a>                    case 'lfarm':
<a name="4583"></a>                    case 'head':
<a name="4584"></a>                        if( FRand() &lt; DismemberProbability )
<a name="4585"></a>                            HitFX[HitFxTicker].bSever = true;
<a name="4586"></a>                        break;
<a name="4587"></a>
<a name="4588"></a>                    case 'None':
<a name="4589"></a> 						boneName = 'spine';
<a name="4590"></a>                     case 'spine':
<a name="4591"></a>                        if( FRand() &lt; DismemberProbability * 0.3 )
<a name="4592"></a>                        {
<a name="4593"></a>                            HitFX[HitFxTicker].bSever = true;
<a name="4594"></a>                            if ( FRand() &lt; 0.65 )
<a name="4595"></a>								bExtraGib = true;
<a name="4596"></a>						}
<a name="4597"></a>                        break;
<a name="4598"></a>                }*/</span>
<a name="4599"></a>
<a name="4600"></a>                if( FRand() &lt; DismemberProbability )
<a name="4601"></a>                {
<a name="4602"></a>                	HitFX[HitFxTicker].bSever = true;
<a name="4603"></a>                	bDidSever = true;
<a name="4604"></a>                }
<a name="4605"></a>            }
<a name="4606"></a>        }
<a name="4607"></a>
<a name="4608"></a>        if ( <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="4609"></a>        {
<a name="4610"></a>			HitFX[HitFxTicker].bSever = false;
<a name="4611"></a>			bDidSever = false;
<a name="4612"></a>		}
<a name="4613"></a>
<a name="4614"></a>
<a name="4615"></a>        if ( HitFX[HitFxTicker].bSever )
<a name="4616"></a>        {
<a name="4617"></a>	        if( !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit && (boneName == <span class="source_name">'None'</span> || boneName == <span class="source_name">'Upperspine'</span> ||
<a name="4618"></a>				boneName == <span class="source_name">'Spine'</span> ))
<a name="4619"></a>	        {
<a name="4620"></a>	        	RandBone = Rand(<span class="source_int">4</span>);
<a name="4621"></a>
<a name="4622"></a>				<span class="source_type">switch</span>( RandBone )
<a name="4623"></a>	            {
<a name="4624"></a>	                case <span class="source_int">0</span>:
<a name="4625"></a>						boneName = <span class="source_name">'lthigh'</span>;
<a name="4626"></a>						break;
<a name="4627"></a>	                case <span class="source_int">1</span>:
<a name="4628"></a>						boneName = <span class="source_name">'rthigh'</span>;
<a name="4629"></a>						break;
<a name="4630"></a>	                case <span class="source_int">2</span>:
<a name="4631"></a>						boneName = <span class="source_name">'lfarm'</span>;
<a name="4632"></a>	                    break;
<a name="4633"></a>	                case <span class="source_int">3</span>:
<a name="4634"></a>						boneName = <span class="source_name">'rfarm'</span>;
<a name="4635"></a>	                    break;
<a name="4636"></a>	                case <span class="source_int">4</span>:
<a name="4637"></a>						boneName = <span class="source_name">'head'</span>;
<a name="4638"></a>	                    break;
<a name="4639"></a>	                default:
<a name="4640"></a>	                	boneName = <span class="source_name">'lthigh'</span>;
<a name="4641"></a>	            }
<a name="4642"></a>	        }
<a name="4643"></a>        }
<a name="4644"></a>
<a name="4645"></a>		if( Health &lt; <span class="source_int">0</span> && <span class="source_type">Damage</span> &gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.HumanObliterationThreshhold && <span class="source_type">Damage</span> != <span class="source_int">1000</span> )
<a name="4646"></a>		{
<a name="4647"></a>			boneName = <span class="source_name">'obliterate'</span>;
<a name="4648"></a>		}
<a name="4649"></a>
<a name="4650"></a>       	HitFX[HitFxTicker].bone = boneName;
<a name="4651"></a>        HitFX[HitFxTicker].rotDir = <span class="source_type">r</span>;
<a name="4652"></a>        HitFxTicker = HitFxTicker + <span class="source_int">1</span>;
<a name="4653"></a>        if( HitFxTicker &gt; ArrayCount(HitFX)-<span class="source_int">1</span> )
<a name="4654"></a>            HitFxTicker = <span class="source_int">0</span>;
<a name="4655"></a>
<a name="4656"></a>        <span class="source_comment">// If this was a really hardcore damage from an explosion, randomly spawn some arms and legs
</span><a name="4657"></a>        if ( bDidSever && !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit && <span class="source_type">Damage</span> &gt; <span class="source_int">200</span> && <span class="source_type">Damage</span> != <span class="source_int">1000</span> )
<a name="4658"></a>        {
<a name="4659"></a>			if ((<span class="source_type">Damage</span> &gt; <span class="source_int">400</span> && FRand() &lt; <span class="source_int">0.3</span>) || FRand() &lt; <span class="source_int">0.1</span> )
<a name="4660"></a>			{
<a name="4661"></a>				DoDamageFX(<span class="source_name">'head'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4662"></a>				DoDamageFX(<span class="source_name">'lthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4663"></a>				DoDamageFX(<span class="source_name">'rthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4664"></a>				DoDamageFX(<span class="source_name">'lfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4665"></a>				DoDamageFX(<span class="source_name">'rfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4666"></a>			}
<a name="4667"></a>			if ( FRand() &lt; <span class="source_int">0.25</span> )
<a name="4668"></a>			{
<a name="4669"></a>				DoDamageFX(<span class="source_name">'lthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4670"></a>				DoDamageFX(<span class="source_name">'rthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4671"></a>				if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="4672"></a>				{
<a name="4673"></a>					DoDamageFX(<span class="source_name">'lfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4674"></a>				}
<a name="4675"></a>				else
<a name="4676"></a>				{
<a name="4677"></a>					DoDamageFX(<span class="source_name">'rfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4678"></a>				}
<a name="4679"></a>			}
<a name="4680"></a>			else if ( FRand() &lt; <span class="source_int">0.35</span> )
<a name="4681"></a>				DoDamageFX(<span class="source_name">'lthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4682"></a>			else if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="4683"></a>				DoDamageFX(<span class="source_name">'rthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4684"></a>			else if ( FRand() &lt; <span class="source_int">0.75</span> )
<a name="4685"></a>			{
<a name="4686"></a>				if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="4687"></a>				{
<a name="4688"></a>					DoDamageFX(<span class="source_name">'lfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4689"></a>				}
<a name="4690"></a>				else
<a name="4691"></a>				{
<a name="4692"></a>					DoDamageFX(<span class="source_name">'rfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="4693"></a>				}
<a name="4694"></a>			}
<a name="4695"></a>		}
<a name="4696"></a>    }
<a name="4697"></a>}
<a name="4698"></a>
<a name="4699"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4700"></a><span class="source_comment">// ProcessHitFX
</span><a name="4701"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4702"></a> <span class="source_comment">// MergeTODO: Replace this with realistic gibbing
</span><a name="4703"></a>simulated function ProcessHitFX()
<a name="4704"></a>{
<a name="4705"></a>    local <span class="source_type"><a href="../core/object.html#Coords" class="source">Coords</a></span> boneCoords;
<a name="4706"></a>    <span class="source_comment">//local class&lt;xEmitter&gt; HitEffects[4];
</span><a name="4707"></a>    local <span class="source_type">int</span> j;<span class="source_comment">//i,j;
</span><a name="4708"></a>    local <span class="source_type">float</span> <span class="source_type">GibPerterbation</span>;
<a name="4709"></a>
<a name="4710"></a>    if( (<span class="source_type">Level</span>.NetMode == NM_DedicatedServer) )
<a name="4711"></a>    {
<a name="4712"></a>		SimHitFxTicker = HitFxTicker;
<a name="4713"></a>        return;
<a name="4714"></a>    }
<a name="4715"></a>
<a name="4716"></a>    for ( SimHitFxTicker = SimHitFxTicker; SimHitFxTicker != HitFxTicker; SimHitFxTicker = (SimHitFxTicker + <span class="source_int">1</span>) % ArrayCount(HitFX) )
<a name="4717"></a>    {
<a name="4718"></a>		j++;
<a name="4719"></a>		if ( j &gt; <span class="source_int">30</span> )
<a name="4720"></a>		{
<a name="4721"></a>			SimHitFxTicker = HitFxTicker;
<a name="4722"></a>			return;
<a name="4723"></a>		}
<a name="4724"></a>
<a name="4725"></a>        if( (HitFX[SimHitFxTicker].damtype == None) || (<span class="source_type">Level</span>.bDropDetail && (<span class="source_type">Level</span>.TimeSeconds - LastRenderTime &gt; <span class="source_int">3</span>) && !IsHumanControlled()) )
<a name="4726"></a>            continue;
<a name="4727"></a>
<a name="4728"></a>		<span class="source_comment">//log("Processing effects for damtype "$HitFX[SimHitFxTicker].damtype);
</span><a name="4729"></a>
<a name="4730"></a>		if( HitFX[SimHitFxTicker].bone == <span class="source_name">'obliterate'</span> && !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore())
<a name="4731"></a>		{
<a name="4732"></a>			SpawnGibs( HitFX[SimHitFxTicker].rotDir, <span class="source_int">0</span>);
<a name="4733"></a>			bGibbed = true;
<a name="4734"></a>			Destroy();
<a name="4735"></a>			return;
<a name="4736"></a>		}
<a name="4737"></a>
<a name="4738"></a>        boneCoords = GetBoneCoords( HitFX[SimHitFxTicker].bone );
<a name="4739"></a>
<a name="4740"></a>        if ( !<span class="source_type">Level</span>.bDropDetail && !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.NoBlood())
<a name="4741"></a>        {
<a name="4742"></a>			AttachEffect( BleedingEmitterClass, HitFX[SimHitFxTicker].bone, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir );
<a name="4743"></a>
<a name="4744"></a><span class="source_comment">//			HitFX[SimHitFxTicker].damtype.static.GetHitEffects( HitEffects, Health );
</span><a name="4745"></a><span class="source_comment">//
</span><a name="4746"></a><span class="source_comment">//			if( !PhysicsVolume.bWaterVolume ) // don't attach effects under water
</span><a name="4747"></a><span class="source_comment">//			{
</span><a name="4748"></a><span class="source_comment">//				for( i = 0; i &lt; ArrayCount(HitEffects); i++ )
</span><a name="4749"></a><span class="source_comment">//				{
</span><a name="4750"></a><span class="source_comment">//					if( HitEffects[i] == none )
</span><a name="4751"></a><span class="source_comment">//						continue;
</span><a name="4752"></a><span class="source_comment">//
</span><a name="4753"></a><span class="source_comment">//					AttachEffect( HitEffects[i], HitFX[SimHitFxTicker].bone, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir );
</span><a name="4754"></a><span class="source_comment">//				}
</span><a name="4755"></a><span class="source_comment">//			}
</span><a name="4756"></a>		}
<a name="4757"></a>        if ( <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="4758"></a>			HitFX[SimHitFxTicker].bSever = false;
<a name="4759"></a>
<a name="4760"></a>        if( HitFX[SimHitFxTicker].bSever )
<a name="4761"></a>        {
<a name="4762"></a>            <span class="source_type">GibPerterbation</span> = HitFX[SimHitFxTicker].damtype.default.<span class="source_type">GibPerterbation</span>;
<a name="4763"></a>
<a name="4764"></a>            <span class="source_type">switch</span>( HitFX[SimHitFxTicker].bone )
<a name="4765"></a>            {
<a name="4766"></a>                case <span class="source_name">'obliterate'</span>:
<a name="4767"></a>                    break;
<a name="4768"></a>
<a name="4769"></a>				case <span class="source_name">'lthigh'</span>:
<a name="4770"></a>                case <span class="source_name">'lupperthigh'</span>:
<a name="4771"></a>                	if( !bLeftLegGibbed )
<a name="4772"></a>					{
<a name="4773"></a>	                    SpawnGiblet( DetachedLegClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="4774"></a>	                    bLeftLegGibbed=true;
<a name="4775"></a>                    }
<a name="4776"></a>                    break;
<a name="4777"></a>
<a name="4778"></a>                case <span class="source_name">'rthigh'</span>:
<a name="4779"></a>                case <span class="source_name">'rupperthigh'</span>:
<a name="4780"></a>                	if( !bRightLegGibbed )
<a name="4781"></a>					{
<a name="4782"></a>	                    SpawnGiblet( DetachedLegClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="4783"></a>	                    bRightLegGibbed=true;
<a name="4784"></a>                    }
<a name="4785"></a>                    break;
<a name="4786"></a>
<a name="4787"></a>                case <span class="source_name">'lfarm'</span>:
<a name="4788"></a>                case <span class="source_name">'lupperarm'</span>:
<a name="4789"></a>                	if( !bLeftArmGibbed )
<a name="4790"></a>					{
<a name="4791"></a>	                    SpawnGiblet( DetachedArmClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="4792"></a>	                    bLeftArmGibbed=true;
<a name="4793"></a>                    }
<a name="4794"></a>                    break;
<a name="4795"></a>
<a name="4796"></a>                case <span class="source_name">'rfarm'</span>:
<a name="4797"></a>                case <span class="source_name">'rupperarm'</span>:
<a name="4798"></a>                	if( !bRightArmGibbed )
<a name="4799"></a>					{
<a name="4800"></a>	                    SpawnGiblet( DetachedArmClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="4801"></a>	                    bRightArmGibbed=true;
<a name="4802"></a>                    }
<a name="4803"></a>                    break;
<a name="4804"></a>
<a name="4805"></a>                case <span class="source_name">'head'</span>:
<a name="4806"></a>                  	HelmetShotOff(HitFX[SimHitFxTicker].rotDir);
<a name="4807"></a>                    break;
<a name="4808"></a>
<a name="4809"></a><span class="source_comment">//                case 'spine':
</span><a name="4810"></a><span class="source_comment">//                case 'Upperspine':
</span><a name="4811"></a><span class="source_comment">//                case 'None':
</span><a name="4812"></a><span class="source_comment">//					  bGibbed = true;
</span><a name="4813"></a><span class="source_comment">//                    break;
</span><a name="4814"></a>            }
<a name="4815"></a>            <span class="source_comment">//never hide the head
</span><a name="4816"></a><span class="source_comment">//            if(HitFX[SimHitFXTicker].bone == 'head')
</span><a name="4817"></a><span class="source_comment">//            {
</span><a name="4818"></a><span class="source_comment">//            	if( Headgear != none )
</span><a name="4819"></a><span class="source_comment">//            	{
</span><a name="4820"></a><span class="source_comment">//            		Headgear.Destroy();
</span><a name="4821"></a><span class="source_comment">//            	}
</span><a name="4822"></a><span class="source_comment">//            }
</span><a name="4823"></a>
<a name="4824"></a>			if( HitFX[SimHitFXTicker].bone != <span class="source_name">'Spine'</span> && HitFX[SimHitFXTicker].bone != <span class="source_name">'UpperSpine'</span> )
<a name="4825"></a>            	HideBone(HitFX[SimHitFxTicker].bone);
<a name="4826"></a>        }
<a name="4827"></a>
<a name="4828"></a>        if(HitFX[SimHitFXTicker].bone == <span class="source_name">'head'</span> && Health &lt; <span class="source_int">0</span>)
<a name="4829"></a>        {
<a name="4830"></a>        	if( Headgear != none )
<a name="4831"></a>        	{
<a name="4832"></a>        		HelmetShotOff(HitFX[SimHitFxTicker].rotDir);
<a name="4833"></a>        	}
<a name="4834"></a>        }
<a name="4835"></a>    }
<a name="4836"></a>}
<a name="4837"></a>
<a name="4838"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4839"></a><span class="source_comment">// HelmetShotOff
</span><a name="4840"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4841"></a>simulated function HelmetShotOff(<span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">Rotation</span>)
<a name="4842"></a>{
<a name="4843"></a><span class="source_comment">/*    local DroppedHeadGear Hat;
<a name="4844"></a>
<a name="4845"></a>    if( HeadGear == none )
<a name="4846"></a>    {
<a name="4847"></a>    	return;
<a name="4848"></a>    }
<a name="4849"></a>
<a name="4850"></a>    Hat = Spawn( class'DroppedHeadGear',,, HeadGear.Location, HeadGear.Rotation );
<a name="4851"></a>    if( Hat == none )
<a name="4852"></a>        return;
<a name="4853"></a>
<a name="4854"></a>    Hat.LinkMesh(HeadGear.Mesh);
<a name="4855"></a>
<a name="4856"></a>    HeadGear.Destroy();
<a name="4857"></a>
<a name="4858"></a>    Hat.Velocity = Velocity + vector(Rotation) * (Hat.MaxSpeed + (Hat.MaxSpeed/2) * FRand());
<a name="4859"></a>    Hat.LifeSpan = Hat.LifeSpan + 2 * FRand() - 1;*/</span>
<a name="4860"></a>}
<a name="4861"></a>
<a name="4862"></a>
<a name="4863"></a>
<a name="4864"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4865"></a><span class="source_comment">// StartDeRes
</span><a name="4866"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4867"></a><span class="source_comment">// MergeTODO: This Deres stuff is crap. Replace with something better
</span><a name="4868"></a>simulated function StartDeRes()
<a name="4869"></a>{
<a name="4870"></a>    if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer )
<a name="4871"></a>        return;
<a name="4872"></a>
<a name="4873"></a>	MaxLights=<span class="source_int">0</span>;
<a name="4874"></a>
<a name="4875"></a>	<span class="source_comment">// Turn off collision when we de-res (avoids rockets etc. hitting corpse!)
</span><a name="4876"></a>	SetCollision(true, false, false);
<a name="4877"></a>
<a name="4878"></a>	<span class="source_comment">// Remove/disallow projectors
</span><a name="4879"></a>	Projectors.Remove(<span class="source_int">0</span>, Projectors.Length);
<a name="4880"></a>	bAcceptsProjectors = false;
<a name="4881"></a>
<a name="4882"></a>	<span class="source_comment">// Remove shadow
</span><a name="4883"></a>	if(PlayerShadow != None)
<a name="4884"></a>		PlayerShadow.bShadowActive = false;
<a name="4885"></a>
<a name="4886"></a>	<span class="source_comment">// Turn off any overlays
</span><a name="4887"></a>	SetOverlayMaterial(None, <span class="source_int">0.0f</span>, true);
<a name="4888"></a>
<a name="4889"></a>}
<a name="4890"></a>
<a name="4891"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4892"></a><span class="source_comment">// Destroyed - Destroy any dummy attachments
</span><a name="4893"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4894"></a>
<a name="4895"></a>simulated event Destroyed()
<a name="4896"></a>{
<a name="4897"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="4898"></a>
<a name="4899"></a>	if( Headgear != none )
<a name="4900"></a>	{
<a name="4901"></a>		Headgear.Destroy();
<a name="4902"></a>	}
<a name="4903"></a>
<a name="4904"></a>	for (<span class="source_type">i</span> = AmmoPouches.Length - <span class="source_int">1</span>; <span class="source_type">i</span> &gt;= <span class="source_int">0</span>; <span class="source_type">i</span>--)
<a name="4905"></a>	{
<a name="4906"></a>		if( AmmoPouches[<span class="source_type">i</span>] != none )
<a name="4907"></a>			AmmoPouches[<span class="source_type">i</span>].Destroy();
<a name="4908"></a>
<a name="4909"></a>		AmmoPouches.Length = AmmoPouches.Length - <span class="source_int">1</span>;
<a name="4910"></a>	}
<a name="4911"></a>
<a name="4912"></a>	if (  AuxCollisionCylinder != none )
<a name="4913"></a>	{
<a name="4914"></a>	    AuxCollisionCylinder.Destroy();
<a name="4915"></a>	}
<a name="4916"></a>
<a name="4917"></a>	<span class="source_comment">// Delete any attached emitters
</span><a name="4918"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++ )
<a name="4919"></a>    {
<a name="4920"></a>        if( Attached[<span class="source_type">i</span>].IsA(<span class="source_name">'Emitter'</span>) && Attached[<span class="source_type">i</span>].bDeleteMe )
<a name="4921"></a>        {
<a name="4922"></a>        	Attached[<span class="source_type">i</span>].Destroy();
<a name="4923"></a>        }
<a name="4924"></a>    }
<a name="4925"></a>
<a name="4926"></a>	<span class="source_comment">// TODO: lets throw out the weapon that was on the player's back
</span><a name="4927"></a>	if( AttachedBackItem != none )
<a name="4928"></a>	{
<a name="4929"></a>		AttachedBackItem.Destroy();
<a name="4930"></a>	}
<a name="4931"></a>
<a name="4932"></a>	if( SeveredLeftArm != none )
<a name="4933"></a>	{
<a name="4934"></a>		SeveredLeftArm.Destroy();
<a name="4935"></a>	}
<a name="4936"></a>
<a name="4937"></a>	if( SeveredRightArm != none )
<a name="4938"></a>	{
<a name="4939"></a>		SeveredRightArm.Destroy();
<a name="4940"></a>	}
<a name="4941"></a>
<a name="4942"></a>	if( SeveredRightLeg != none )
<a name="4943"></a>	{
<a name="4944"></a>		SeveredRightLeg.Destroy();
<a name="4945"></a>	}
<a name="4946"></a>
<a name="4947"></a>	if( SeveredLeftLeg != none )
<a name="4948"></a>	{
<a name="4949"></a>		SeveredLeftLeg.Destroy();
<a name="4950"></a>	}
<a name="4951"></a>
<a name="4952"></a>	if( <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span> != none )
<a name="4953"></a>	{
<a name="4954"></a>		<span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span>.Destroy();
<a name="4955"></a>	}
<a name="4956"></a>
<a name="4957"></a>    if( PlayerShadow != none )
<a name="4958"></a>        PlayerShadow.Destroy();
<a name="4959"></a>
<a name="4960"></a>
<a name="4961"></a>	Super.Destroyed();
<a name="4962"></a>}
<a name="4963"></a>
<a name="4964"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4965"></a><span class="source_comment">// TickFX
</span><a name="4966"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4967"></a>
<a name="4968"></a>simulated function TickFX(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="4969"></a>{
<a name="4970"></a>    if ( SimHitFxTicker != HitFxTicker )
<a name="4971"></a>    {
<a name="4972"></a>		ProcessHitFX();
<a name="4973"></a>    }
<a name="4974"></a>}
<a name="4975"></a>
<a name="4976"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4977"></a><span class="source_comment">// Dying - Improvements to corpse handling
</span><a name="4978"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="4979"></a>
<a name="4980"></a><span class="source_type">state</span> Dying
<a name="4981"></a>{
<a name="4982"></a>	<span class="source_comment">// from UnrealPawn
</span><a name="4983"></a>	function Landed(<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitNormal</span>)
<a name="4984"></a>	{
<a name="4985"></a>		<span class="source_comment">//do nothing
</span><a name="4986"></a><span class="source_comment">/*		if ( Level.NetMode == NM_DedicatedServer )
<a name="4987"></a>			return;
<a name="4988"></a>		if ( Shadow != None )
<a name="4989"></a>			Shadow.Destroy();*/</span>
<a name="4990"></a>	}
<a name="4991"></a>
<a name="4992"></a>	<span class="source_comment">// From Xpawn
</span><a name="4993"></a>	simulated function AnimEnd( <span class="source_type">int</span> <span class="source_type">Channel</span> )
<a name="4994"></a>	{
<a name="4995"></a>	    ReduceCylinder();
<a name="4996"></a>	}
<a name="4997"></a>
<a name="4998"></a>    function LandThump()
<a name="4999"></a>    {
<a name="5000"></a>        <span class="source_comment">// animation notify - play sound if actually landed, and animation also shows it
</span><a name="5001"></a>        if ( Physics == PHYS_None)
<a name="5002"></a>        {
<a name="5003"></a>            bThumped = true;
<a name="5004"></a>            <span class="source_comment">//PlaySound(GetSound(EST_CorpseLanded));
</span><a name="5005"></a>        }
<a name="5006"></a>    }
<a name="5007"></a>    <span class="source_comment">// end from Xpawn
</span><a name="5008"></a>
<a name="5009"></a>	simulated function TakeDamage(<span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, optional <span class="source_type">int</span> <span class="source_type">HitIndex</span>)
<a name="5010"></a>	{
<a name="5011"></a>		local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> SelfToHit, SelfToInstigator, CrossPlaneNormal;
<a name="5012"></a>		local <span class="source_type">float</span> W;
<a name="5013"></a>		local <span class="source_type">float</span> YawDir;
<a name="5014"></a>
<a name="5015"></a>		local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitNormal</span>, shotDir;
<a name="5016"></a>		local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> PushLinVel, PushAngVel;
<a name="5017"></a>		local <span class="source_type">Name</span> HitBone;
<a name="5018"></a>		local <span class="source_type">float</span> HitBoneDist;
<a name="5019"></a>		local <span class="source_type">int</span> MaxCorpseYawRate;
<a name="5020"></a>
<a name="5021"></a>		if (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> == None)
<a name="5022"></a>			return;
<a name="5023"></a>
<a name="5024"></a>		if(Physics == PHYS_KarmaRagdoll)
<a name="5025"></a>		{
<a name="5026"></a>			<span class="source_comment">// Can't shoot corpses during de-res
</span><a name="5027"></a>			if(bDeRes)
<a name="5028"></a>				return;
<a name="5029"></a>
<a name="5030"></a>			<span class="source_comment">//log("HIT RAGDOLL. M:"$Momentum);
</span><a name="5031"></a>			<span class="source_comment">// Throw the body if its a rocket explosion or shock combo
</span><a name="5032"></a>			if(<span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>.<span class="source_type">Name</span> == <span class="source_name">'ROSMineDamType'</span> || <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>.<span class="source_type">Name</span> == <span class="source_name">'ROStielGranateDamType'</span> || <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>.<span class="source_type">Name</span> == <span class="source_name">'ROMineDamType'</span> || <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>.<span class="source_type">Name</span> == <span class="source_name">'ROF1GrenadeDamType'</span>)
<a name="5033"></a>			{
<a name="5034"></a>				shotDir = Normal(<span class="source_type">Momentum</span>);
<a name="5035"></a>				PushLinVel = (RagDeathVel * shotDir) +  vect(<span class="source_int">0</span>, <span class="source_int">0</span>, <span class="source_int">250</span>);
<a name="5036"></a>				PushAngVel = Normal(shotDir Cross vect(<span class="source_int">0</span>, <span class="source_int">0</span>, <span class="source_int">1</span>)) * -<span class="source_int">18000</span>;
<a name="5037"></a>				KSetSkelVel( PushLinVel, PushAngVel );
<a name="5038"></a>			}
<a name="5039"></a>			else if( <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>.Default.bRagdollBullet )
<a name="5040"></a>			{
<a name="5041"></a>				if ( <span class="source_type">Momentum</span> == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) )
<a name="5042"></a>					<span class="source_type">Momentum</span> = <span class="source_type">HitLocation</span> - InstigatedBy.Location;
<a name="5043"></a>				if ( FRand() &lt; <span class="source_int">0.65</span> )
<a name="5044"></a>				{
<a name="5045"></a>					if ( Velocity.<span class="source_type">Z</span> &lt;= <span class="source_int">0</span> )
<a name="5046"></a>						PushLinVel = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">40</span>);
<a name="5047"></a>					PushAngVel = Normal(Normal(<span class="source_type">Momentum</span>) Cross vect(<span class="source_int">0</span>, <span class="source_int">0</span>, <span class="source_int">1</span>)) * -<span class="source_int">8000</span> ;
<a name="5048"></a>					PushAngVel.<span class="source_type">X</span> *= <span class="source_int">0.5</span>;
<a name="5049"></a>					PushAngVel.<span class="source_type">Y</span> *= <span class="source_int">0.5</span>;
<a name="5050"></a>					PushAngVel.<span class="source_type">Z</span> *= <span class="source_int">4</span>;
<a name="5051"></a>					KSetSkelVel( PushLinVel, PushAngVel );
<a name="5052"></a>				}
<a name="5053"></a>                PushLinVel = RagShootStrength*Normal(<span class="source_type">Momentum</span>);
<a name="5054"></a>				KAddImpulse(PushLinVel, <span class="source_type">HitLocation</span>);
<a name="5055"></a>				if ( (LifeSpan &gt; <span class="source_int">0</span>) && (LifeSpan &lt; DeResTime + <span class="source_int">2</span>) )
<a name="5056"></a>					LifeSpan += <span class="source_int">0.2</span>;
<a name="5057"></a>			}
<a name="5058"></a>			else
<a name="5059"></a>			{
<a name="5060"></a>				PushLinVel = RagShootStrength*Normal(<span class="source_type">Momentum</span>);
<a name="5061"></a>				KAddImpulse(PushLinVel, <span class="source_type">HitLocation</span>);
<a name="5062"></a>			}
<a name="5063"></a>			if ( (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageOverlayMaterial != None) && (<span class="source_type">Level</span>.DetailMode != DM_Low) && !<span class="source_type">Level</span>.bDropDetail )
<a name="5064"></a>				SetOverlayMaterial(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageOverlayMaterial, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayTime, true);
<a name="5065"></a>			return;
<a name="5066"></a>		}
<a name="5067"></a>
<a name="5068"></a>		if (<span class="source_type">Damage</span> &gt; <span class="source_int">0</span>)
<a name="5069"></a>		{
<a name="5070"></a>			if ( InstigatedBy != None )
<a name="5071"></a>			{
<a name="5072"></a>
<a name="5073"></a>				<span class="source_comment">// Figure out which direction to spin:
</span><a name="5074"></a>
<a name="5075"></a>				if( InstigatedBy.Location != Location )
<a name="5076"></a>				{
<a name="5077"></a>					SelfToInstigator = InstigatedBy.Location - Location;
<a name="5078"></a>					SelfToHit = <span class="source_type">HitLocation</span> - Location;
<a name="5079"></a>
<a name="5080"></a>					CrossPlaneNormal = Normal( SelfToInstigator cross Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>) );
<a name="5081"></a>					W = CrossPlaneNormal dot Location;
<a name="5082"></a>
<a name="5083"></a>					if( <span class="source_type">HitLocation</span> dot CrossPlaneNormal &lt; W )
<a name="5084"></a>						YawDir = -<span class="source_int">1.0</span>;
<a name="5085"></a>					else
<a name="5086"></a>						YawDir = <span class="source_int">1.0</span>;
<a name="5087"></a>				}
<a name="5088"></a>			}
<a name="5089"></a>			if( VSize(<span class="source_type">Momentum</span>) &lt; <span class="source_int">10</span> )
<a name="5090"></a>			{
<a name="5091"></a>				<span class="source_type">Momentum</span> = - Normal(SelfToInstigator) * <span class="source_type">Damage</span> * <span class="source_int">1000.0</span>;
<a name="5092"></a>				<span class="source_type">Momentum</span>.<span class="source_type">Z</span> = Abs( <span class="source_type">Momentum</span>.<span class="source_type">Z</span> );
<a name="5093"></a>			}
<a name="5094"></a>
<a name="5095"></a>			SetPhysics(PHYS_Falling);
<a name="5096"></a>			<span class="source_type">Momentum</span> = <span class="source_type">Momentum</span> / Mass;
<a name="5097"></a>			AddVelocity( <span class="source_type">Momentum</span> );
<a name="5098"></a>			bBounce = true;
<a name="5099"></a>
<a name="5100"></a>			RotationRate.Pitch = <span class="source_int">0</span>;
<a name="5101"></a>			RotationRate.Yaw += VSize(<span class="source_type">Momentum</span>) * YawDir;
<a name="5102"></a>
<a name="5103"></a>			MaxCorpseYawRate = <span class="source_int">150000</span>;
<a name="5104"></a>			RotationRate.Yaw = Clamp( RotationRate.Yaw, -MaxCorpseYawRate, MaxCorpseYawRate );
<a name="5105"></a>			RotationRate.Roll = <span class="source_int">0</span>;
<a name="5106"></a>
<a name="5107"></a>			bFixedRotationDir = true;
<a name="5108"></a>			bRotateToDesired = false;
<a name="5109"></a>
<a name="5110"></a>			Health -= <span class="source_type">Damage</span>;
<a name="5111"></a>			CalcHitLoc( <span class="source_type">HitLocation</span>, vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>), HitBone, HitBoneDist );
<a name="5112"></a>
<a name="5113"></a>			if( InstigatedBy != None )
<a name="5114"></a>				<span class="source_type">HitNormal</span> = Normal( Normal(InstigatedBy.Location-<span class="source_type">HitLocation</span>) + VRand() * <span class="source_int">0.2</span> + vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">2.8</span>) );
<a name="5115"></a>			else
<a name="5116"></a>				<span class="source_type">HitNormal</span> = Normal( Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>) + VRand() * <span class="source_int">0.2</span> + vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">2.8</span>) );
<a name="5117"></a>
<a name="5118"></a>			DoDamageFX( HitBone, <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(<span class="source_type">HitNormal</span>) );
<a name="5119"></a>		}
<a name="5120"></a>	}
<a name="5121"></a>
<a name="5122"></a>	function BeginState()
<a name="5123"></a>	{
<a name="5124"></a>		local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="5125"></a>
<a name="5126"></a>		SetCollision(true,false,false);
<a name="5127"></a>        if ( bTearOff && (<span class="source_type">Level</span>.NetMode == NM_DedicatedServer) )
<a name="5128"></a>			LifeSpan = <span class="source_int">1.0</span>;
<a name="5129"></a>		else
<a name="5130"></a>			SetTimer(<span class="source_int">2.0</span>, false);
<a name="5131"></a>
<a name="5132"></a>        SetPhysics(PHYS_Falling);
<a name="5133"></a>		bInvulnerableBody = true;
<a name="5134"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="5135"></a>		{
<a name="5136"></a>			if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.bIsPlayer )
<a name="5137"></a>				<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.PawnDied(self);
<a name="5138"></a>			else
<a name="5139"></a>				<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.Destroy();
<a name="5140"></a>		}
<a name="5141"></a>
<a name="5142"></a>		for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++)
<a name="5143"></a>			if (Attached[<span class="source_type">i</span>] != None)
<a name="5144"></a>				Attached[<span class="source_type">i</span>].PawnBaseDied();
<a name="5145"></a>
<a name="5146"></a>		<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = None;
<a name="5147"></a> 	}
<a name="5148"></a>
<a name="5149"></a>	simulated function Timer()
<a name="5150"></a>	{
<a name="5151"></a>		local <span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span> skelParams;
<a name="5152"></a>
<a name="5153"></a>		<span class="source_comment">//log("ROPawn dead viewtarget = "$PlayerController(OldController).ViewTarget);
</span><a name="5154"></a>
<a name="5155"></a>		<span class="source_comment">// Regular PlayerCanSeeMe() check is not good enough, since we don't render the body, but use the karma for first person death
</span><a name="5156"></a>		if ( !PlayerCanSeeMe() && (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(OldController) == None) || ((<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(OldController) != None) && (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(OldController).<span class="source_type">ViewTarget</span> != self)))
<a name="5157"></a>		{
<a name="5158"></a>			StartDeRes();
<a name="5159"></a>			Destroy();
<a name="5160"></a>		}
<a name="5161"></a>		<span class="source_comment">// If we are running out of life, but we still haven't come to rest, force the de-res.
</span><a name="5162"></a>		<span class="source_comment">// unless pawn is the viewtarget of a player who used to own it
</span><a name="5163"></a>		else if ( LifeSpan &lt;= DeResTime && bDeRes == false )
<a name="5164"></a>		{
<a name="5165"></a>			skelParams = <span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span>(KParams);
<a name="5166"></a>
<a name="5167"></a>			<span class="source_comment">// check not viewtarget
</span><a name="5168"></a>			if ( (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(OldController) != None) && (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(OldController).<span class="source_type">ViewTarget</span> == self) )
<a name="5169"></a>			{
<a name="5170"></a>				skelParams.bKImportantRagdoll = true;
<a name="5171"></a>				LifeSpan = FMax(LifeSpan,DeResTime + <span class="source_int">2.0</span>);
<a name="5172"></a>				SetTimer(<span class="source_int">1.0</span>, false);
<a name="5173"></a>				return;
<a name="5174"></a>			}
<a name="5175"></a>			else
<a name="5176"></a>			{
<a name="5177"></a>				skelParams.bKImportantRagdoll = false;
<a name="5178"></a>			}
<a name="5179"></a>
<a name="5180"></a>			<span class="source_comment">// spawn derez
</span><a name="5181"></a>			bDeRes=true;
<a name="5182"></a>		}
<a name="5183"></a>		else
<a name="5184"></a>		{
<a name="5185"></a>			SetTimer(<span class="source_int">1.0</span>, false);
<a name="5186"></a>		}
<a name="5187"></a>	}
<a name="5188"></a>}
<a name="5189"></a>
<a name="5190"></a><span class="source_comment">// Overriden to send the weapon to the idle state when entering a vehicle.
</span><a name="5191"></a><span class="source_comment">// Apparantly calling the super here isn't good enough. Get accessed nones if this
</span><a name="5192"></a><span class="source_comment">// isn't in ROPawn
</span><a name="5193"></a>simulated event StartDriving(<span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span> <span class="source_type">V</span>)
<a name="5194"></a>{
<a name="5195"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="5196"></a>
<a name="5197"></a>	DrivenVehicle = <span class="source_type">V</span>;
<a name="5198"></a>	NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="5199"></a>	<span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = None;
<a name="5200"></a>	StopWeaponFiring();
<a name="5201"></a>	DeactivateSpawnProtection();
<a name="5202"></a>
<a name="5203"></a>	<span class="source_comment">// Move the driver into position, and attach to car.
</span><a name="5204"></a>	ShouldCrouch(false);
<a name="5205"></a>	ShouldProne(false);
<a name="5206"></a>	bIgnoreForces = true;
<a name="5207"></a>	Velocity = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="5208"></a>	Acceleration = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="5209"></a>	bCanTeleport = false;
<a name="5210"></a>
<a name="5211"></a>	if ( !<span class="source_type">V</span>.bRemoteControlled || <span class="source_type">V</span>.bHideRemoteDriver )
<a name="5212"></a>    	{
<a name="5213"></a>		SetCollision( False, False, False);
<a name="5214"></a>		bCollideWorld = false;
<a name="5215"></a>		<span class="source_type">V</span>.AttachDriver( Self );
<a name="5216"></a>		if ( <span class="source_type">V</span>.bDrawDriverinTP )
<a name="5217"></a>			CullDistance = <span class="source_int">5000</span>;
<a name="5218"></a>		else
<a name="5219"></a>		   	bHidden = true;
<a name="5220"></a>    	}
<a name="5221"></a>
<a name="5222"></a>	<span class="source_comment">// set animation
</span><a name="5223"></a>	bPhysicsAnimUpdate = false;
<a name="5224"></a>	bWaitForAnim = false;
<a name="5225"></a>	if ( !<span class="source_type">V</span>.bHideRemoteDriver && <span class="source_type">V</span>.bDrawDriverinTP )
<a name="5226"></a>	{
<a name="5227"></a>		if ( HasAnim(DrivenVehicle.DriveAnim) )
<a name="5228"></a>			LoopAnim(DrivenVehicle.DriveAnim);
<a name="5229"></a>		else
<a name="5230"></a>			LoopAnim(<span class="source_name">'Vehicle_Driving'</span>);
<a name="5231"></a>		SetAnimFrame(<span class="source_int">0.5</span>);
<a name="5232"></a>		SmoothViewYaw = <span class="source_type">Rotation</span>.Yaw;
<a name="5233"></a>		SetTwistLook(<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="5234"></a>	}
<a name="5235"></a>
<a name="5236"></a>	if( PlayerShadow != none )
<a name="5237"></a>		PlayerShadow.bShadowActive = false;
<a name="5238"></a>
<a name="5239"></a>	if ( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None )
<a name="5240"></a>		<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.Hide(true);
<a name="5241"></a>
<a name="5242"></a>	<span class="source_comment">//hack for sticky grenades
</span><a name="5243"></a>	for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.Length; <span class="source_type">i</span>++)
<a name="5244"></a>		if (<span class="source_type"><a href="../engine/projectile.html" class="source">Projectile</a></span>(Attached[<span class="source_type">i</span>]) != None)
<a name="5245"></a>			Attached[<span class="source_type">i</span>].SetBase(None);
<a name="5246"></a>
<a name="5247"></a>    if( <span class="source_type">V</span>.bKeepDriverAuxCollision )
<a name="5248"></a>    {
<a name="5249"></a>	   ToggleAuxCollision(true);
<a name="5250"></a>	}
<a name="5251"></a>	else
<a name="5252"></a>	{
<a name="5253"></a>       ToggleAuxCollision(false);
<a name="5254"></a>    }
<a name="5255"></a>
<a name="5256"></a>	if( <span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>)!=none)
<a name="5257"></a>	{
<a name="5258"></a>	   <span class="source_type"><a href="../roengine/roweapon.html" class="source">ROWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).GotoState(<span class="source_name">'Idle'</span>);
<a name="5259"></a>	}
<a name="5260"></a>
<a name="5261"></a>    if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="5262"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NotifyOwnerJumped();
<a name="5263"></a>}
<a name="5264"></a>
<a name="5265"></a><span class="source_comment">// Overriden to turn the aux collision back on when you leave the vehicle
</span><a name="5266"></a>simulated function StopDriving(<span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span> <span class="source_type">V</span>)
<a name="5267"></a>{
<a name="5268"></a>	Super.StopDriving(<span class="source_type">V</span>);
<a name="5269"></a>
<a name="5270"></a>	if( PlayerShadow != None )
<a name="5271"></a>		PlayerShadow.bShadowActive = true;
<a name="5272"></a>
<a name="5273"></a>	if ( <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> != None )
<a name="5274"></a>		<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>.Hide(false);
<a name="5275"></a>
<a name="5276"></a>	ToggleAuxCollision(true);
<a name="5277"></a>
<a name="5278"></a>	<span class="source_comment">// Clear any upper body animations. for when leaving a vehicle
</span><a name="5279"></a>	SetAnimAction(<span class="source_name">'ClearAnims'</span>);
<a name="5280"></a>}
<a name="5281"></a>
<a name="5282"></a><span class="source_comment">// Helper function for PostNetRecieve. Returns true if it finds a matching
</span><a name="5283"></a><span class="source_comment">// Primary weapon for this player and their role,and the weapon's instigator
</span><a name="5284"></a><span class="source_comment">// has finished replicating
</span><a name="5285"></a>simulated function <span class="source_type">bool</span> VerifyPrimary(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> Inv)
<a name="5286"></a>{
<a name="5287"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="5288"></a>	local <span class="source_type">bool</span> bFoundMatch;
<a name="5289"></a>	local <span class="source_type"><a href="../roengine/roroleinfo.html" class="source">RORoleInfo</a></span> RI;
<a name="5290"></a>	local <span class="source_type">int</span> EmptyCount;
<a name="5291"></a>
<a name="5292"></a>	if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != none && <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none &&
<a name="5293"></a>				<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo != none )
<a name="5294"></a>	{
<a name="5295"></a>		RI = <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo;
<a name="5296"></a>
<a name="5297"></a>		for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; ArrayCount(RI.PrimaryWeapons); <span class="source_type">i</span>++)
<a name="5298"></a>		{
<a name="5299"></a>			if (RI.PrimaryWeapons[<span class="source_type">i</span>].<span class="source_type">Item</span> == None)
<a name="5300"></a>			{
<a name="5301"></a>				EmptyCount++;
<a name="5302"></a>				continue;
<a name="5303"></a>			}
<a name="5304"></a>	        else
<a name="5305"></a>	        {
<a name="5306"></a>	        	if( RI.PrimaryWeapons[<span class="source_type">i</span>].<span class="source_type">Item</span> == Inv.<span class="source_type">Class</span> )
<a name="5307"></a>	        	{
<a name="5308"></a>	        		bFoundMatch = true;
<a name="5309"></a>					break;
<a name="5310"></a>	        	}
<a name="5311"></a>	        }
<a name="5312"></a>		}
<a name="5313"></a>
<a name="5314"></a>		<span class="source_comment">// There were no possible primary weapons
</span><a name="5315"></a>		if( EmptyCount == ArrayCount(RI.PrimaryWeapons) )
<a name="5316"></a>		{
<a name="5317"></a>			return true;
<a name="5318"></a>		}
<a name="5319"></a>	}
<a name="5320"></a>
<a name="5321"></a>	return (bFoundMatch && (Inv.<span class="source_type">Instigator</span> != none));
<a name="5322"></a>}
<a name="5323"></a>
<a name="5324"></a><span class="source_comment">// Helper function for PostNetRecieve. Returns true if it finds a matching
</span><a name="5325"></a><span class="source_comment">// Secondary weapon for this player and their role,and the weapon's instigator
</span><a name="5326"></a><span class="source_comment">// has finished replicating
</span><a name="5327"></a>simulated function <span class="source_type">bool</span> VerifySecondary(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> Inv)
<a name="5328"></a>{
<a name="5329"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="5330"></a>	local <span class="source_type">bool</span> bFoundMatch;
<a name="5331"></a>	local <span class="source_type"><a href="../roengine/roroleinfo.html" class="source">RORoleInfo</a></span> RI;
<a name="5332"></a>	local <span class="source_type">int</span> EmptyCount;
<a name="5333"></a>
<a name="5334"></a>	if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != none && <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none &&
<a name="5335"></a>				<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo != none )
<a name="5336"></a>	{
<a name="5337"></a>		RI = <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo;
<a name="5338"></a>
<a name="5339"></a>			for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; ArrayCount(RI.SecondaryWeapons); <span class="source_type">i</span>++)
<a name="5340"></a>			{
<a name="5341"></a>				if (RI.SecondaryWeapons[<span class="source_type">i</span>].<span class="source_type">Item</span> == None)
<a name="5342"></a>				{
<a name="5343"></a>					EmptyCount++;
<a name="5344"></a>					continue;
<a name="5345"></a>				}
<a name="5346"></a>		        else
<a name="5347"></a>		        {
<a name="5348"></a>		        	if( RI.SecondaryWeapons[<span class="source_type">i</span>].<span class="source_type">Item</span> == Inv.<span class="source_type">Class</span> )
<a name="5349"></a>		        	{
<a name="5350"></a>		        		bFoundMatch = true;
<a name="5351"></a>						break;
<a name="5352"></a>		        	}
<a name="5353"></a>		        }
<a name="5354"></a>			}
<a name="5355"></a>
<a name="5356"></a>
<a name="5357"></a>		if( EmptyCount == ArrayCount(RI.SecondaryWeapons) )
<a name="5358"></a>		{
<a name="5359"></a>			return true;
<a name="5360"></a>		}
<a name="5361"></a>	}
<a name="5362"></a>
<a name="5363"></a>	return (bFoundMatch && (Inv.<span class="source_type">Instigator</span> != none));
<a name="5364"></a>}
<a name="5365"></a>
<a name="5366"></a><span class="source_comment">// Helper function for PostNetRecieve. Returns true if it finds a matching
</span><a name="5367"></a><span class="source_comment">// Nade weapon for this player and their role,and the weapon's instigator
</span><a name="5368"></a><span class="source_comment">// has finished replicating
</span><a name="5369"></a>simulated function <span class="source_type">bool</span> VerifyNades(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> Inv)
<a name="5370"></a>{
<a name="5371"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="5372"></a>	local <span class="source_type">bool</span> bFoundMatch;
<a name="5373"></a>	local <span class="source_type"><a href="../roengine/roroleinfo.html" class="source">RORoleInfo</a></span> RI;
<a name="5374"></a>	local <span class="source_type">int</span> EmptyCount;
<a name="5375"></a>
<a name="5376"></a>	if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != none && <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none &&
<a name="5377"></a>				<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo != none )
<a name="5378"></a>	{
<a name="5379"></a>		RI = <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo;
<a name="5380"></a>
<a name="5381"></a>			for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; ArrayCount(RI.Grenades); <span class="source_type">i</span>++)
<a name="5382"></a>			{
<a name="5383"></a>				if (RI.Grenades[<span class="source_type">i</span>].<span class="source_type">Item</span> == None)
<a name="5384"></a>				{
<a name="5385"></a>					EmptyCount++;
<a name="5386"></a>					continue;
<a name="5387"></a>				}
<a name="5388"></a>		        else
<a name="5389"></a>		        {
<a name="5390"></a>		        	if( RI.Grenades[<span class="source_type">i</span>].<span class="source_type">Item</span> == Inv.<span class="source_type">Class</span> )
<a name="5391"></a>		        	{
<a name="5392"></a>		        		bFoundMatch = true;
<a name="5393"></a>						break;
<a name="5394"></a>		        	}
<a name="5395"></a>		        }
<a name="5396"></a>			}
<a name="5397"></a>
<a name="5398"></a>
<a name="5399"></a>		if( EmptyCount == ArrayCount(RI.Grenades) )
<a name="5400"></a>		{
<a name="5401"></a>			return true;
<a name="5402"></a>		}
<a name="5403"></a>	}
<a name="5404"></a>
<a name="5405"></a>	return (bFoundMatch && (Inv.<span class="source_type">Instigator</span> != none));
<a name="5406"></a>}
<a name="5407"></a>
<a name="5408"></a><span class="source_comment">// Helper function for PostNetRecieve. Returns true if it finds a matching
</span><a name="5409"></a><span class="source_comment">// Given items for this player and their role,and the weapon's instigator
</span><a name="5410"></a><span class="source_comment">// has finished replicating
</span><a name="5411"></a>simulated function <span class="source_type">bool</span> VerifyGivenItems()
<a name="5412"></a>{
<a name="5413"></a>	local <span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span> Inv;
<a name="5414"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>, j, ItemCount;
<a name="5415"></a>	local <span class="source_type"><a href="../roengine/roroleinfo.html" class="source">RORoleInfo</a></span> RI;
<a name="5416"></a>	local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>&gt; InventoryClass;
<a name="5417"></a>
<a name="5418"></a> 	if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != none && <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none &&
<a name="5419"></a>				<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo != none )
<a name="5420"></a>	{
<a name="5421"></a>		RI = <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo;
<a name="5422"></a>
<a name="5423"></a>		for ( Inv=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; Inv!=None; Inv=Inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="5424"></a>		{
<a name="5425"></a>			if ( (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(Inv) != None) )
<a name="5426"></a>			{
<a name="5427"></a>				for (j = <span class="source_int">0</span>; j &lt; RI.GivenItems.Length; j++)
<a name="5428"></a>				{
<a name="5429"></a>                		InventoryClass = <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>&gt;(DynamicLoadObject(RI.GivenItems[j], <span class="source_type">class</span><span class="source_name">'Class'</span>));
<a name="5430"></a>
<a name="5431"></a>			        	if( InventoryClass == Inv.<span class="source_type">Class</span> && Inv.<span class="source_type">Instigator</span> != none)
<a name="5432"></a>			        	{
<a name="5433"></a>			        		ItemCount++;
<a name="5434"></a>							break;
<a name="5435"></a>			        	}
<a name="5436"></a>
<a name="5437"></a>				}
<a name="5438"></a>			}
<a name="5439"></a>			<span class="source_type">i</span>++;
<a name="5440"></a>			if ( <span class="source_type">i</span> &gt; <span class="source_int">500</span> )
<a name="5441"></a>				break;
<a name="5442"></a>		}
<a name="5443"></a>
<a name="5444"></a>		if( ItemCount == RI.GivenItems.Length )
<a name="5445"></a>		{
<a name="5446"></a>			return true;
<a name="5447"></a>		}
<a name="5448"></a>	}
<a name="5449"></a>
<a name="5450"></a>	return false;
<a name="5451"></a>}
<a name="5452"></a>
<a name="5453"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="5454"></a><span class="source_comment">// PostNetReceive - Change player animations appropriately
</span><a name="5455"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="5456"></a><span class="source_comment">// MergeTODO: look into setting bNetNotify to false here like Xpawn does
</span><a name="5457"></a>simulated function PostNetReceive()
<a name="5458"></a>{
<a name="5459"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="5460"></a>	local <span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span> Inv;
<a name="5461"></a>	local <span class="source_type">int</span> j;
<a name="5462"></a>	local <span class="source_type">bool</span> bVerifiedPrimary, bVerifiedSecondary, bVerifiedNades, bVerifiedGivenItems;
<a name="5463"></a>
<a name="5464"></a>    if( !bRecievedInitialLoadout )
<a name="5465"></a>    {
<a name="5466"></a>		for ( Inv=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; Inv!=None; Inv=Inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="5467"></a>		{
<a name="5468"></a>			if ( (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(Inv) != None) )
<a name="5469"></a>			{
<a name="5470"></a>				if( VerifyPrimary(Inv) )
<a name="5471"></a>				{
<a name="5472"></a>					bVerifiedPrimary = true;
<a name="5473"></a>				}
<a name="5474"></a>
<a name="5475"></a>				if( VerifySecondary(Inv) )
<a name="5476"></a>				{
<a name="5477"></a>					bVerifiedSecondary = true;
<a name="5478"></a>				}
<a name="5479"></a>
<a name="5480"></a>				if( VerifyNades(Inv) )
<a name="5481"></a>				{
<a name="5482"></a>					bVerifiedNades = true;
<a name="5483"></a>				}
<a name="5484"></a>			}
<a name="5485"></a>			j++;
<a name="5486"></a>			if ( j &gt; <span class="source_int">500</span> )
<a name="5487"></a>				break;
<a name="5488"></a>		}
<a name="5489"></a>
<a name="5490"></a>		if( VerifyGivenItems() )
<a name="5491"></a>		{
<a name="5492"></a>			bVerifiedGivenItems = true;
<a name="5493"></a>		}
<a name="5494"></a>
<a name="5495"></a>		if( bVerifiedPrimary && bVerifiedSecondary && bVerifiedNades && bVerifiedGivenItems )
<a name="5496"></a>		{
<a name="5497"></a>			bRecievedInitialLoadout = true;
<a name="5498"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.SwitchToBestWeapon();
<a name="5499"></a>			<span class="source_comment">//log("*********** Got Initial Loadout!!!****************");
</span><a name="5500"></a>		}
<a name="5501"></a>	}
<a name="5502"></a>
<a name="5503"></a>	<span class="source_comment">// Hit detection debugging
</span><a name="5504"></a><span class="source_comment">/*	if(	HitPointDebugByte != OldHitPointDebugByte)
<a name="5505"></a>	{
<a name="5506"></a>  		DrawBoneLocation();
<a name="5507"></a>  		OldHitPointDebugByte = HitPointDebugByte;
<a name="5508"></a>	}*/</span>
<a name="5509"></a>
<a name="5510"></a>    if (!bInitializedPlayer)
<a name="5511"></a>	{
<a name="5512"></a>		if ( ForceDefaultCharacter() )
<a name="5513"></a>		{
<a name="5514"></a>			Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(GetDefaultCharacter()));
<a name="5515"></a>			bInitializedPlayer = true;
<a name="5516"></a>		}
<a name="5517"></a>		else if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != none && <span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none &&
<a name="5518"></a>			<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo != none &&
<a name="5519"></a>			<span class="source_type"><a href="../roengine/roplayerreplicationinfo.html" class="source">ROPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).RoleInfo.static.GetModel() == <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName)
<a name="5520"></a>		{
<a name="5521"></a>			Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName));
<a name="5522"></a>			bInitializedPlayer = true;
<a name="5523"></a>		}
<a name="5524"></a>		else if ( (DrivenVehicle != None) && (DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None) )
<a name="5525"></a>		{
<a name="5526"></a>			Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName));
<a name="5527"></a>			bInitializedPlayer = true;
<a name="5528"></a>		}
<a name="5529"></a>	}
<a name="5530"></a>
<a name="5531"></a>	if( !bInitializedWeaponAttachment && <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> == none)
<a name="5532"></a>	{
<a name="5533"></a>		<span class="source_comment">// Try and find weapon attachement
</span><a name="5534"></a>	    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++ )
<a name="5535"></a>	    {
<a name="5536"></a>	        if( Attached[<span class="source_type">i</span>].IsA(<span class="source_name">'ROWeaponAttachment'</span>) )
<a name="5537"></a>	        {
<a name="5538"></a>	        	SetWeaponAttachment(<span class="source_type"><a href="../roengine/roweaponattachment.html" class="source">ROWeaponAttachment</a></span>(Attached[<span class="source_type">i</span>]));
<a name="5539"></a>	        	bInitializedWeaponAttachment = true;
<a name="5540"></a>	        	break;
<a name="5541"></a>	        }
<a name="5542"></a>	    }
<a name="5543"></a>	}
<a name="5544"></a>
<a name="5545"></a>	if( bInitializedPlayer && bInitializedWeaponAttachment && bRecievedInitialLoadout)
<a name="5546"></a>		bNetNotify = false;
<a name="5547"></a>}
<a name="5548"></a>
<a name="5549"></a><span class="source_comment">// MergeTODO: commented out turning off the bNetNotify stuff. However, it should probably be turned
</span><a name="5550"></a><span class="source_comment">// back on when we refactor PostNetRecieve.
</span><a name="5551"></a>simulated function NotifyTeamChanged()
<a name="5552"></a>{
<a name="5553"></a>	<span class="source_comment">// my PRI now has a new team
</span><a name="5554"></a>	if ( ForceDefaultCharacter() )
<a name="5555"></a>	{
<a name="5556"></a>		Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(GetDefaultCharacter()));
<a name="5557"></a>        bNetNotify = false;
<a name="5558"></a>	}
<a name="5559"></a>	else if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None )
<a name="5560"></a>    {
<a name="5561"></a>		Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName));
<a name="5562"></a>        bNetNotify = false;
<a name="5563"></a>    }
<a name="5564"></a>    else if ( (DrivenVehicle != None) && (DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None) )
<a name="5565"></a>    {
<a name="5566"></a>		Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName));
<a name="5567"></a>        bNetNotify = false;
<a name="5568"></a>    }
<a name="5569"></a>}
<a name="5570"></a>
<a name="5571"></a><span class="source_comment">// Can we sprint in this state?
</span><a name="5572"></a>simulated function <span class="source_type">bool</span> AllowSprint()
<a name="5573"></a>{
<a name="5574"></a>	if (!bIsCrawling &&((<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == None || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.WeaponAllowSprint()) && Acceleration != vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>)))
<a name="5575"></a>	{
<a name="5576"></a>		return true;
<a name="5577"></a>	}
<a name="5578"></a>
<a name="5579"></a>	return false;
<a name="5580"></a>}
<a name="5581"></a>
<a name="5582"></a><span class="source_comment">// Force a stamina update on the client
</span><a name="5583"></a>simulated function ClientForceStaminaUpdate(<span class="source_type">float</span> NewStamina)
<a name="5584"></a>{
<a name="5585"></a>	Stamina = NewStamina;
<a name="5586"></a>}
<a name="5587"></a>
<a name="5588"></a><span class="source_comment">// Handles the stamina calculations and sprinting functionality
</span><a name="5589"></a>function HandleStamina(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="5590"></a>{
<a name="5591"></a>	local <span class="source_type">byte</span> NewBreathSound;
<a name="5592"></a>
<a name="5593"></a>	<span class="source_comment">// Prone
</span><a name="5594"></a>	if( bIsCrawling )
<a name="5595"></a>	{
<a name="5596"></a>		if (Stamina &lt; default.Stamina && Acceleration == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>))
<a name="5597"></a>		{
<a name="5598"></a>			Stamina = FMin(default.Stamina, Stamina + (<span class="source_type">DeltaTime</span> * ProneStaminaRecoveryRate));
<a name="5599"></a>		}
<a name="5600"></a>		else
<a name="5601"></a>		{
<a name="5602"></a>		    Stamina = FMin(default.Stamina, Stamina + (<span class="source_type">DeltaTime</span> * SlowStaminaRecoveryRate));
<a name="5603"></a>		}
<a name="5604"></a>	}
<a name="5605"></a>	else
<a name="5606"></a>	{
<a name="5607"></a>		<span class="source_comment">// Walking
</span><a name="5608"></a>		if (bIsSprinting)
<a name="5609"></a>		{
<a name="5610"></a>			<span class="source_comment">// Use more stamina when crouch sprinting
</span><a name="5611"></a>			if ( bIsCrouched )
<a name="5612"></a>			{
<a name="5613"></a>				Stamina = FMax(<span class="source_int">0.0</span>, Stamina - (<span class="source_type">DeltaTime</span> * <span class="source_int">1.25</span>));
<a name="5614"></a>			}
<a name="5615"></a>			else
<a name="5616"></a>			{
<a name="5617"></a>			   	Stamina = FMax(<span class="source_int">0.0</span>, Stamina - <span class="source_type">DeltaTime</span>);
<a name="5618"></a>			}
<a name="5619"></a>		}
<a name="5620"></a>		else
<a name="5621"></a>		{
<a name="5622"></a>			if (Stamina &lt; default.Stamina && !bIsWalking && !bIsCrouched && VSizeSquared(Velocity) &gt; <span class="source_int">0.0</span> )
<a name="5623"></a>			{
<a name="5624"></a>				Stamina = FMin(default.Stamina, Stamina + (<span class="source_type">DeltaTime</span> * SlowStaminaRecoveryRate));
<a name="5625"></a>			}
<a name="5626"></a>			else
<a name="5627"></a>			{
<a name="5628"></a>				if ( bIsCrouched )
<a name="5629"></a>				{
<a name="5630"></a>					Stamina = FMin(default.Stamina, Stamina + (<span class="source_type">DeltaTime</span> * CrouchStaminaRecoveryRate));
<a name="5631"></a>				}
<a name="5632"></a>				else
<a name="5633"></a>				{
<a name="5634"></a>                 	Stamina = FMin(default.Stamina, Stamina + (<span class="source_type">DeltaTime</span> * StaminaRecoveryRate));
<a name="5635"></a>				}
<a name="5636"></a>			}
<a name="5637"></a>		}
<a name="5638"></a>	}
<a name="5639"></a>
<a name="5640"></a>	<span class="source_comment">// Only set this flag on the server
</span><a name="5641"></a>	if ( <span class="source_type">Level</span>.NetMode != NM_Client )
<a name="5642"></a>	{
<a name="5643"></a>		bCanStartSprint = Stamina &gt; <span class="source_int">2.0</span>;
<a name="5644"></a>	}
<a name="5645"></a>
<a name="5646"></a>	if( Stamina == <span class="source_int">0.0</span> || Acceleration == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) )
<a name="5647"></a>	{
<a name="5648"></a>		SetSprinting(false);
<a name="5649"></a>	}
<a name="5650"></a>
<a name="5651"></a>    <span class="source_comment">// Stamina sound handling. Sets the ambient breathing sound based on stamina level
</span><a name="5652"></a>	if ( <span class="source_type">Level</span>.NetMode != NM_Client )
<a name="5653"></a>	{
<a name="5654"></a>		if (Health &gt; <span class="source_int">0</span> && Stamina &lt; <span class="source_int">10.0</span>)
<a name="5655"></a>		{
<a name="5656"></a>		    if ( Stamina &lt;= <span class="source_int">2.0</span> )
<a name="5657"></a>			{
<a name="5658"></a>		    	NewBreathSound = <span class="source_int">1</span>;
<a name="5659"></a>			}
<a name="5660"></a>			else if (Stamina &lt; <span class="source_int">5.0</span> )
<a name="5661"></a>			{
<a name="5662"></a>				NewBreathSound = <span class="source_int">2</span>;
<a name="5663"></a>			}
<a name="5664"></a>			else if ( Stamina &lt; <span class="source_int">7.5</span> )
<a name="5665"></a>			{
<a name="5666"></a>		        NewBreathSound = <span class="source_int">3</span>;
<a name="5667"></a>			}
<a name="5668"></a>			else
<a name="5669"></a>			{
<a name="5670"></a>		        NewBreathSound = <span class="source_int">4</span>;
<a name="5671"></a>			}
<a name="5672"></a>
<a name="5673"></a>		}
<a name="5674"></a>		else
<a name="5675"></a>		{
<a name="5676"></a>		    NewBreathSound = <span class="source_int">5</span>;
<a name="5677"></a>		}
<a name="5678"></a>
<a name="5679"></a>		if( SavedBreathSound != NewBreathSound )
<a name="5680"></a>			SetBreathingSound(NewBreathSound);
<a name="5681"></a>	}
<a name="5682"></a>}
<a name="5683"></a>
<a name="5684"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="5685"></a><span class="source_comment">// Turned this tick back on to do stamina based breathing calculations -Ramm
</span><a name="5686"></a><span class="source_comment">// 08/15/04
</span><a name="5687"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="5688"></a>simulated function Tick(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="5689"></a>{
<a name="5690"></a>	if( Role &gt; ROLE_SimulatedProxy )
<a name="5691"></a>		HandleStamina(<span class="source_type">DeltaTime</span>);
<a name="5692"></a>	<span class="source_comment">// Handle limping
</span><a name="5693"></a>
<a name="5694"></a>	if( Role == ROLE_Authority )
<a name="5695"></a>	{
<a name="5696"></a>	    if( bIsLimping )
<a name="5697"></a>	    {
<a name="5698"></a>	    	if ( LimpTime &lt;= <span class="source_int">0</span> )
<a name="5699"></a>	    	{
<a name="5700"></a>	    		bIsLimping =  false;
<a name="5701"></a>				GroundSpeed=Default.GroundSpeed;
<a name="5702"></a>	    	}
<a name="5703"></a>	    	else
<a name="5704"></a>	    	{
<a name="5705"></a>	    	   	LimpTime -= <span class="source_type">DeltaTime</span>;
<a name="5706"></a>
<a name="5707"></a>				if (LimpTime&gt;<span class="source_int">0</span>)
<a name="5708"></a>				{
<a name="5709"></a>					GroundSpeed=Default.GroundSpeed - LimpTime * <span class="source_int">20</span>;
<a name="5710"></a>					if (GroundSpeed &lt; <span class="source_int">0</span>)
<a name="5711"></a>						GroundSpeed = <span class="source_int">0</span>;
<a name="5712"></a>				}
<a name="5713"></a>	    	}
<a name="5714"></a>	    }
<a name="5715"></a>    }
<a name="5716"></a>
<a name="5717"></a>	if( <span class="source_type">Level</span>.Netmode != NM_DedicatedServer )
<a name="5718"></a>	{
<a name="5719"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="5720"></a>			OldController = <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="5721"></a>
<a name="5722"></a>		<span class="source_comment">// do footsteps for nonlocal pawns and bots
</span><a name="5723"></a>		if( !IsLocallyControlled() || (<span class="source_type">Level</span>.Netmode == NM_Standalone && !IsHumanControlled()))
<a name="5724"></a>		{
<a name="5725"></a>			CheckFootSteps(<span class="source_type">DeltaTime</span>);
<a name="5726"></a>		}
<a name="5727"></a>
<a name="5728"></a>	    TickFX(<span class="source_type">DeltaTime</span>);
<a name="5729"></a>	}
<a name="5730"></a>	TickLean(<span class="source_type">DeltaTime</span>);
<a name="5731"></a>}
<a name="5732"></a>
<a name="5733"></a><span class="source_comment">/*==========================================
<a name="5734"></a>* UnrealPawn functions
<a name="5735"></a>*=========================================*/</span>
<a name="5736"></a>
<a name="5737"></a>function gibbedBy(<span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">Other</span>)
<a name="5738"></a>{
<a name="5739"></a>	if ( Role &lt; ROLE_Authority )
<a name="5740"></a>		return;
<a name="5741"></a>	if ( <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>) != None )
<a name="5742"></a>	{
<a name="5743"></a>		if ( (<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>).<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None) && <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>).<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'Translauncher'</span>) )
<a name="5744"></a>			Died(<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>).<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>).<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.GetDamageType(), Location);
<a name="5745"></a>		else
<a name="5746"></a>			Died(<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>).<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>, <span class="source_type">class</span><span class="source_name">'DamTypeTelefragged'</span>, Location);
<a name="5747"></a>	}
<a name="5748"></a>	else
<a name="5749"></a>		Died(None, <span class="source_type">class</span><span class="source_name">'Gibbed'</span>, Location);
<a name="5750"></a>}
<a name="5751"></a>
<a name="5752"></a>function HoldFlag(<span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> FlagActor)
<a name="5753"></a>{
<a name="5754"></a>	if ( <span class="source_type"><a href="../unrealgame/gameobject.html" class="source">GameObject</a></span>(FlagActor) != None )
<a name="5755"></a>		HoldGameObject(<span class="source_type"><a href="../unrealgame/gameobject.html" class="source">GameObject</a></span>(FlagActor),<span class="source_type"><a href="../unrealgame/gameobject.html" class="source">GameObject</a></span>(FlagActor).GameObjBone);
<a name="5756"></a>}
<a name="5757"></a>
<a name="5758"></a>function HoldGameObject(<span class="source_type"><a href="../unrealgame/gameobject.html" class="source">GameObject</a></span> gameObj, <span class="source_type">name</span> GameObjBone)
<a name="5759"></a>{
<a name="5760"></a>	if ( GameObjBone == <span class="source_name">'None'</span> )
<a name="5761"></a>	{
<a name="5762"></a>		GameObj.SetPhysics(PHYS_Rotating);
<a name="5763"></a>		GameObj.SetLocation(Location);
<a name="5764"></a>		GameObj.SetBase(self);
<a name="5765"></a>		GameObj.SetRelativeLocation(vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>));
<a name="5766"></a>	}
<a name="5767"></a>	else
<a name="5768"></a>	{
<a name="5769"></a>		AttachToBone(gameObj,GameObjBone);
<a name="5770"></a>		gameObj.SetRelativeRotation(GameObjRot + gameObj.GameObjRot);
<a name="5771"></a>		gameObj.SetRelativeLocation(GameObjOffset + gameObj.GameObjOffset );
<a name="5772"></a>	}
<a name="5773"></a>}
<a name="5774"></a>
<a name="5775"></a>function EndJump();	<span class="source_comment">// Called when stop jumping
</span><a name="5776"></a>
<a name="5777"></a>simulated function ShouldUnCrouch();
<a name="5778"></a>
<a name="5779"></a>function <span class="source_type">String</span> GetDebugName()
<a name="5780"></a>{
<a name="5781"></a>	if ( (<span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None) && <span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bSoaking && (<span class="source_type">Level</span>.Pauser != None) )
<a name="5782"></a>		return GetHumanReadableName()@<span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).SoakString;
<a name="5783"></a>	if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None )
<a name="5784"></a>		return <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">PlayerName</span>;
<a name="5785"></a>	return GetItemName(<span class="source_type">string</span>(self));
<a name="5786"></a>}
<a name="5787"></a>
<a name="5788"></a><span class="source_comment">/* IsInLoadout()
<a name="5789"></a>return true if InventoryClass is part of required or optional equipment
<a name="5790"></a>*/</span>
<a name="5791"></a>function <span class="source_type">bool</span> IsInLoadout(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>&gt; InventoryClass)
<a name="5792"></a>{
<a name="5793"></a>	<span class="source_comment">//MergeTODO: Write proper RO specific functionality for this
</span><a name="5794"></a>	return true;
<a name="5795"></a><span class="source_comment">/*	local int i;
<a name="5796"></a>	local string invstring;
<a name="5797"></a>
<a name="5798"></a>	if ( bAcceptAllInventory )
<a name="5799"></a>		return true;
<a name="5800"></a>
<a name="5801"></a>	invstring = string(InventoryClass);
<a name="5802"></a>
<a name="5803"></a>	for ( i=0; i&lt;16; i++ )
<a name="5804"></a>	{
<a name="5805"></a>		if ( RequiredEquipment[i] ~= invstring )
<a name="5806"></a>			return true;
<a name="5807"></a>		else if ( RequiredEquipment[i] == "" )
<a name="5808"></a>			break;
<a name="5809"></a>	}
<a name="5810"></a>
<a name="5811"></a>	for ( i=0; i&lt;16; i++ )
<a name="5812"></a>	{
<a name="5813"></a>		if ( OptionalEquipment[i] ~= invstring )
<a name="5814"></a>			return true;
<a name="5815"></a>		else if ( OptionalEquipment[i] == "" )
<a name="5816"></a>			break;
<a name="5817"></a>	}
<a name="5818"></a>	return false; */</span>
<a name="5819"></a>}
<a name="5820"></a>
<a name="5821"></a>function CreateInventory(<span class="source_type">string</span> InventoryClassName)
<a name="5822"></a>{
<a name="5823"></a>	local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> Inv;
<a name="5824"></a>	local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>&gt; InventoryClass;
<a name="5825"></a>
<a name="5826"></a>	InventoryClass = <span class="source_type">Level</span>.Game.BaseMutator.GetInventoryClass(InventoryClassName);
<a name="5827"></a>	if( (InventoryClass!=None) && (FindInventoryType(InventoryClass)==None) )
<a name="5828"></a>	{
<a name="5829"></a>		Inv = Spawn(InventoryClass);
<a name="5830"></a>		if( Inv != None )
<a name="5831"></a>		{
<a name="5832"></a>			Inv.GiveTo(self);
<a name="5833"></a>			if ( Inv != None )
<a name="5834"></a>				Inv.PickupFunction(self);
<a name="5835"></a>		}
<a name="5836"></a>	}
<a name="5837"></a>}
<a name="5838"></a>
<a name="5839"></a>function SetMovementPhysics()
<a name="5840"></a>{
<a name="5841"></a>	if (Physics == PHYS_Falling)
<a name="5842"></a>		return;
<a name="5843"></a>	if ( <span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.bWaterVolume )
<a name="5844"></a>		SetPhysics(PHYS_Swimming);
<a name="5845"></a>	else
<a name="5846"></a>		SetPhysics(PHYS_Walking);
<a name="5847"></a>}
<a name="5848"></a>
<a name="5849"></a>function TakeDrowningDamage()
<a name="5850"></a>{
<a name="5851"></a>	TakeDamage(<span class="source_int">5</span>, None, Location + CollisionHeight * vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0.5</span>)+ <span class="source_int">0.7</span> * CollisionRadius * <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type">Rotation</span>), vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>), <span class="source_type">class</span><span class="source_name">'Drowned'</span>);
<a name="5852"></a>}
<a name="5853"></a>
<a name="5854"></a>function <span class="source_type">int</span> GetSpree()
<a name="5855"></a>{
<a name="5856"></a>	return spree;
<a name="5857"></a>}
<a name="5858"></a>
<a name="5859"></a>function IncrementSpree()
<a name="5860"></a>{
<a name="5861"></a>	spree++;
<a name="5862"></a>}
<a name="5863"></a>
<a name="5864"></a>simulated function PlayFootStep(<span class="source_type">int</span> Side)
<a name="5865"></a>{
<a name="5866"></a>	if ( (Role==ROLE_SimulatedProxy) || (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) == None) || <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bBehindView )
<a name="5867"></a>	{
<a name="5868"></a>		FootStepping(Side);
<a name="5869"></a>		return;
<a name="5870"></a>	}
<a name="5871"></a>}
<a name="5872"></a>
<a name="5873"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="5874"></a>
<a name="5875"></a><span class="source_comment">/*
<a name="5876"></a>Pawn was killed - detach any controller, and die
<a name="5877"></a>*/</span>
<a name="5878"></a>simulated function ChunkUp( <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> HitRotation, <span class="source_type">float</span> <span class="source_type">ChunkPerterbation</span> )
<a name="5879"></a>{
<a name="5880"></a>	if ( (<span class="source_type">Level</span>.NetMode != NM_Client) && (<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None) )
<a name="5881"></a>	{
<a name="5882"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.bIsPlayer )
<a name="5883"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.PawnDied(self);
<a name="5884"></a>		else
<a name="5885"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.Destroy();
<a name="5886"></a>	}
<a name="5887"></a>
<a name="5888"></a>	bTearOff = true;
<a name="5889"></a>	HitDamageType = <span class="source_type">class</span><span class="source_name">'Gibbed'</span>; <span class="source_comment">// make sure clients gib also
</span><a name="5890"></a>	if ( (<span class="source_type">Level</span>.NetMode == NM_DedicatedServer) || (<span class="source_type">Level</span>.NetMode == NM_ListenServer) )
<a name="5891"></a>		GotoState(<span class="source_name">'TimingOut'</span>);
<a name="5892"></a>	if ( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer )
<a name="5893"></a>		return;
<a name="5894"></a>	if ( <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="5895"></a>	{
<a name="5896"></a>		Destroy();
<a name="5897"></a>		return;
<a name="5898"></a>	}
<a name="5899"></a>	SpawnGibs(HitRotation,<span class="source_type">ChunkPerterbation</span>);
<a name="5900"></a>
<a name="5901"></a>	if ( <span class="source_type">Level</span>.NetMode != NM_ListenServer )
<a name="5902"></a>		Destroy();
<a name="5903"></a>}
<a name="5904"></a>
<a name="5905"></a><span class="source_comment">/* TimingOut - where gibbed pawns go to die (delay so they can get replicated)
<a name="5906"></a>*/</span>
<a name="5907"></a><span class="source_type">state</span> TimingOut
<a name="5908"></a>{
<a name="5909"></a>ignores BaseChange, Landed, AnimEnd, <span class="source_type"><a href="../engine/trigger.html" class="source">Trigger</a></span>, Bump, <span class="source_type">HitWall</span>, HeadVolumeChange, PhysicsVolumeChange, Falling, BreathTimer;
<a name="5910"></a>
<a name="5911"></a>	function TakeDamage( <span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> instigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">hitlocation</span>,
<a name="5912"></a>							<span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">momentum</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, optional <span class="source_type">int</span> <span class="source_type">HitIndex</span>)
<a name="5913"></a>	{
<a name="5914"></a>	}
<a name="5915"></a>
<a name="5916"></a>	function BeginState()
<a name="5917"></a>	{
<a name="5918"></a>		SetPhysics(PHYS_None);
<a name="5919"></a>		SetCollision(false,false,false);
<a name="5920"></a>		LifeSpan = <span class="source_int">1.0</span>;
<a name="5921"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="5922"></a>		{
<a name="5923"></a>			if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.bIsPlayer )
<a name="5924"></a>				<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.PawnDied(self);
<a name="5925"></a>			else
<a name="5926"></a>				<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.Destroy();
<a name="5927"></a>		}
<a name="5928"></a>	}
<a name="5929"></a>}
<a name="5930"></a>
<a name="5931"></a>
<a name="5932"></a><span class="source_comment">/*==========================================
<a name="5933"></a>* Xpawn functions
<a name="5934"></a>*=========================================*/</span>
<a name="5935"></a>simulated function PlayWaiting() {}
<a name="5936"></a>
<a name="5937"></a>function <span class="source_type"><a href="../unrealgame/rosterentry.html" class="source">RosterEntry</a></span> GetPlacedRoster()
<a name="5938"></a>{
<a name="5939"></a>	<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName = PlacedCharacterName;
<a name="5940"></a>	return <span class="source_type">class</span><span class="source_name">'RORosterEntry'</span>.static.CreateRosterEntryCharacter(PlacedCharacterName);
<a name="5941"></a>}
<a name="5942"></a>
<a name="5943"></a><span class="source_comment">// return true if was controlled by a Player (AI or human)
</span><a name="5944"></a>simulated function <span class="source_type">bool</span> WasPlayerPawn()
<a name="5945"></a>{
<a name="5946"></a>	return ( (OldController != None) && OldController.bIsPlayer );
<a name="5947"></a>}
<a name="5948"></a>
<a name="5949"></a><span class="source_comment">// Set up default blending parameters and pose. Ensures the mesh doesn't have only a T-pose whenever it first springs into view.
</span><a name="5950"></a>simulated function AssignInitialPose()
<a name="5951"></a>{
<a name="5952"></a>    if ( DrivenVehicle != None )
<a name="5953"></a>    {
<a name="5954"></a>		if ( HasAnim(DrivenVehicle.DriveAnim) )
<a name="5955"></a>			LoopAnim(DrivenVehicle.DriveAnim,, <span class="source_int">0.1</span>);
<a name="5956"></a>		else
<a name="5957"></a>			LoopAnim(<span class="source_name">'Vehicle_Driving'</span>,, <span class="source_int">0.1</span>);
<a name="5958"></a>	}
<a name="5959"></a>	else
<a name="5960"></a>		TweenAnim(MovementAnims[<span class="source_int">0</span>],<span class="source_int">0.0</span>);
<a name="5961"></a>	AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.2</span>, <span class="source_int">0.2</span>, <span class="source_name">'Bip01_Spine1'</span>);
<a name="5962"></a>    BoneRefresh();
<a name="5963"></a>}
<a name="5964"></a>
<a name="5965"></a>function DeactivateSpawnProtection()
<a name="5966"></a>{
<a name="5967"></a>	if ( bSpawnDone )
<a name="5968"></a>		return;
<a name="5969"></a>	bSpawnDone = true;
<a name="5970"></a>	if ( <span class="source_type">Level</span>.TimeSeconds - SpawnTime &lt; <span class="source_type"><a href="../unrealgame/deathmatch.html" class="source">DeathMatch</a></span>(<span class="source_type">Level</span>.Game).SpawnProtectionTime )
<a name="5971"></a>	{
<a name="5972"></a>		SpawnTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_type"><a href="../unrealgame/deathmatch.html" class="source">DeathMatch</a></span>(<span class="source_type">Level</span>.Game).SpawnProtectionTime - <span class="source_int">1</span>;
<a name="5973"></a>	}
<a name="5974"></a>}
<a name="5975"></a>
<a name="5976"></a>function PlayMoverHitSound()
<a name="5977"></a>{
<a name="5978"></a>	<span class="source_comment">//PlaySound(SoundGroupClass.static.GetHitSound(), SLOT_Interact);
</span><a name="5979"></a>}
<a name="5980"></a>
<a name="5981"></a>function Gasp()
<a name="5982"></a>{
<a name="5983"></a>    if ( Role != ROLE_Authority )
<a name="5984"></a>        return;
<a name="5985"></a>    <span class="source_comment">//if ( BreathTime &lt; 2 )
</span><a name="5986"></a>        <span class="source_comment">//PlaySound(GetSound(EST_Gasp), SLOT_Interact);
</span><a name="5987"></a>    <span class="source_comment">//else
</span><a name="5988"></a>        <span class="source_comment">//PlaySound(GetSound(EST_BreatheAgain), SLOT_Interact);
</span><a name="5989"></a>}
<a name="5990"></a>
<a name="5991"></a>function <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> GetKillerController()
<a name="5992"></a>{
<a name="5993"></a>	if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="5994"></a>		return <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="5995"></a>	if ( OldController != None )
<a name="5996"></a>		return OldController;
<a name="5997"></a>	return None;
<a name="5998"></a>}
<a name="5999"></a>
<a name="6000"></a>simulated function <span class="source_type">int</span> GetTeamNum()
<a name="6001"></a>{
<a name="6002"></a>	if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="6003"></a>		return <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.GetTeamNum();
<a name="6004"></a>	if ( (DrivenVehicle != None) && (DrivenVehicle.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None) )
<a name="6005"></a>		return DrivenVehicle.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.GetTeamNum();
<a name="6006"></a>	if ( OldController != None )
<a name="6007"></a>		return OldController.GetTeamNum();
<a name="6008"></a>	if ( (<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> == None) || (<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span> == None) )
<a name="6009"></a>		return <span class="source_int">255</span>;
<a name="6010"></a>	return <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>.TeamIndex;
<a name="6011"></a>}
<a name="6012"></a>
<a name="6013"></a>function <span class="source_type"><a href="../engine/teaminfo.html" class="source">TeamInfo</a></span> GetTeam()
<a name="6014"></a>{
<a name="6015"></a>	if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None )
<a name="6016"></a>		return <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>;
<a name="6017"></a>	if ( (DrivenVehicle != None) && (DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None) )
<a name="6018"></a>		return DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>;
<a name="6019"></a>	if ( (OldController != None) && (OldController.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None) )
<a name="6020"></a>		return OldController.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Team</span>;
<a name="6021"></a>	return None;
<a name="6022"></a>}
<a name="6023"></a>
<a name="6024"></a>simulated function AttachEffect( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt; EmitterClass, <span class="source_type">Name</span> BoneName, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> Location, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">Rotation</span> )
<a name="6025"></a>{
<a name="6026"></a>    local <span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> <span class="source_type">a</span>;
<a name="6027"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="6028"></a>
<a name="6029"></a>    if( BoneName == <span class="source_name">'None'</span> )
<a name="6030"></a>        return;
<a name="6031"></a>
<a name="6032"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.Length; <span class="source_type">i</span>++ )
<a name="6033"></a>    {
<a name="6034"></a>        if( Attached[<span class="source_type">i</span>] == None )
<a name="6035"></a>            continue;
<a name="6036"></a>
<a name="6037"></a>        if( Attached[<span class="source_type">i</span>].AttachmentBone != BoneName )
<a name="6038"></a>            continue;
<a name="6039"></a>
<a name="6040"></a>        if( ClassIsChildOf( EmitterClass, Attached[<span class="source_type">i</span>].<span class="source_type">Class</span> ) )
<a name="6041"></a>            return;
<a name="6042"></a>    }
<a name="6043"></a>
<a name="6044"></a>    <span class="source_type">a</span> = Spawn( EmitterClass,,, Location, <span class="source_type">Rotation</span> );
<a name="6045"></a>
<a name="6046"></a>    if( !AttachToBone( <span class="source_type">a</span>, BoneName ) )
<a name="6047"></a>    {
<a name="6048"></a>        log( <span class="source_string">"Couldn't attach "</span>$EmitterClass$<span class="source_string">" to "</span>$BoneName, <span class="source_name">'Error'</span> );
<a name="6049"></a>        <span class="source_type">a</span>.Destroy();
<a name="6050"></a>        return;
<a name="6051"></a>    }
<a name="6052"></a>
<a name="6053"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++ )
<a name="6054"></a>    {
<a name="6055"></a>        if( Attached[<span class="source_type">i</span>] == <span class="source_type">a</span> )
<a name="6056"></a>            break;
<a name="6057"></a>    }
<a name="6058"></a>
<a name="6059"></a>    <span class="source_type">a</span>.SetRelativeRotation( <span class="source_type">Rotation</span> );
<a name="6060"></a>}
<a name="6061"></a>
<a name="6062"></a>simulated event SetHeadScale(<span class="source_type">float</span> NewScale)
<a name="6063"></a>{
<a name="6064"></a>	HeadScale = NewScale;
<a name="6065"></a>	SetBoneScale(<span class="source_int">4</span>,HeadScale,<span class="source_name">'head'</span>);
<a name="6066"></a>}
<a name="6067"></a>
<a name="6068"></a>simulated function SpawnGiblet( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span>&gt; GibClass, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> Location, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">Rotation</span>, <span class="source_type">float</span> <span class="source_type">GibPerterbation</span> )
<a name="6069"></a>{
<a name="6070"></a>    local <span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span> Giblet;
<a name="6071"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">Direction</span>, Dummy;
<a name="6072"></a>
<a name="6073"></a>    if( (GibClass == None) || <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="6074"></a>        return;
<a name="6075"></a>
<a name="6076"></a>	<span class="source_type">Instigator</span> = self;
<a name="6077"></a>    Giblet = Spawn( GibClass,,, Location, <span class="source_type">Rotation</span> );
<a name="6078"></a>    if( Giblet == None )
<a name="6079"></a>        return;
<a name="6080"></a>	Giblet.SpawnTrail();
<a name="6081"></a>
<a name="6082"></a>    <span class="source_type">GibPerterbation</span> *= <span class="source_int">32768.0</span>;
<a name="6083"></a>    <span class="source_type">Rotation</span>.Pitch += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="6084"></a>    <span class="source_type">Rotation</span>.Yaw += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="6085"></a>    <span class="source_type">Rotation</span>.Roll += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="6086"></a>
<a name="6087"></a>    GetAxes( <span class="source_type">Rotation</span>, Dummy, Dummy, <span class="source_type">Direction</span> );
<a name="6088"></a>
<a name="6089"></a>    Giblet.Velocity = Velocity + Normal(<span class="source_type">Direction</span>) * (Giblet.MaxSpeed + (Giblet.MaxSpeed/<span class="source_int">2</span>) * FRand());
<a name="6090"></a>    Giblet.LifeSpan = self.RagdollLifeSpan;
<a name="6091"></a>}
<a name="6092"></a>
<a name="6093"></a>simulated function HideBone(<span class="source_type">name</span> boneName)
<a name="6094"></a>{
<a name="6095"></a>	local <span class="source_type">int</span> BoneScaleSlot;
<a name="6096"></a>
<a name="6097"></a>    if( boneName == <span class="source_name">'lthigh'</span> )
<a name="6098"></a>    {
<a name="6099"></a>		boneScaleSlot = <span class="source_int">0</span>;
<a name="6100"></a>		if( SeveredLeftLeg == none )
<a name="6101"></a>		{
<a name="6102"></a>			SeveredLeftLeg = Spawn(SeveredLegAttachClass,self);
<a name="6103"></a>			AttachToBone(SeveredLeftLeg, <span class="source_name">'lupperthigh'</span>);
<a name="6104"></a>		}
<a name="6105"></a>	}
<a name="6106"></a>	else if ( boneName == <span class="source_name">'rthigh'</span> )
<a name="6107"></a>	{
<a name="6108"></a>		boneScaleSlot = <span class="source_int">1</span>;
<a name="6109"></a>		if( SeveredRightLeg == none )
<a name="6110"></a>		{
<a name="6111"></a>			SeveredRightLeg = Spawn(SeveredLegAttachClass,self);
<a name="6112"></a>			AttachToBone(SeveredRightLeg, <span class="source_name">'rupperthigh'</span>);
<a name="6113"></a>		}
<a name="6114"></a>	}
<a name="6115"></a>	else if( boneName == <span class="source_name">'rfarm'</span> )
<a name="6116"></a>	{
<a name="6117"></a>		boneScaleSlot = <span class="source_int">2</span>;
<a name="6118"></a>		if( SeveredRightArm == none )
<a name="6119"></a>		{
<a name="6120"></a>			SeveredRightArm = Spawn(SeveredArmAttachClass,self);
<a name="6121"></a>			AttachToBone(SeveredRightArm, <span class="source_name">'rupperarm'</span>);
<a name="6122"></a>		}
<a name="6123"></a>	}
<a name="6124"></a>	else if ( boneName == <span class="source_name">'lfarm'</span> )
<a name="6125"></a>	{
<a name="6126"></a>		boneScaleSlot = <span class="source_int">3</span>;
<a name="6127"></a>		if( SeveredLeftArm == none )
<a name="6128"></a>		{
<a name="6129"></a>			SeveredLeftArm = Spawn(SeveredArmAttachClass,self);
<a name="6130"></a>			AttachToBone(SeveredLeftArm, <span class="source_name">'lupperarm'</span>);
<a name="6131"></a>		}
<a name="6132"></a>	}
<a name="6133"></a>	else if ( boneName == <span class="source_name">'head'</span> )
<a name="6134"></a>	{
<a name="6135"></a>		boneScaleSlot = <span class="source_int">4</span>;
<a name="6136"></a>		if( <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span> == none )
<a name="6137"></a>		{
<a name="6138"></a>			<span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span> = Spawn(SeveredHeadAttachClass,self);
<a name="6139"></a>			AttachToBone(<span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span>, <span class="source_name">'Bip01_Neck'</span>);
<a name="6140"></a>		}
<a name="6141"></a>	}
<a name="6142"></a>	else if ( boneName == <span class="source_name">'spine'</span> )
<a name="6143"></a>		boneScaleSlot = <span class="source_int">5</span>;
<a name="6144"></a>
<a name="6145"></a>    SetBoneScale(BoneScaleSlot, <span class="source_int">0.0</span>, BoneName);
<a name="6146"></a>}
<a name="6147"></a>
<a name="6148"></a><span class="source_comment">// MergeTODO: This needs to be replaced with our more precise system
</span><a name="6149"></a>function CalcHitLoc( <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> hitLoc, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> hitRay, out <span class="source_type">Name</span> boneName, out <span class="source_type">float</span> <span class="source_type">dist</span> )
<a name="6150"></a>{
<a name="6151"></a>    boneName = GetClosestBone( hitLoc, hitRay, <span class="source_type">dist</span> );
<a name="6152"></a>}
<a name="6153"></a>
<a name="6154"></a>simulated function SetOverlayMaterial( <span class="source_type"><a href="../engine/material.html" class="source">Material</a></span> mat, <span class="source_type">float</span> <span class="source_type"><a href="../core/time.html" class="source">time</a></span>, <span class="source_type">bool</span> <span class="source_type">bOverride</span> )
<a name="6155"></a>{
<a name="6156"></a>	if ( <span class="source_type">Level</span>.bDropDetail || <span class="source_type">Level</span>.DetailMode == DM_Low )
<a name="6157"></a>		<span class="source_type"><a href="../core/time.html" class="source">time</a></span> *= <span class="source_int">0.75</span>;
<a name="6158"></a>	Super.SetOverlayMaterial(mat,<span class="source_type"><a href="../core/time.html" class="source">time</a></span>,<span class="source_type">bOverride</span>);
<a name="6159"></a>}
<a name="6160"></a>
<a name="6161"></a>function <span class="source_type">bool</span> CheckReflect( <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitLocation</span>, out <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> RefNormal, <span class="source_type">int</span> <span class="source_type">Damage</span> )
<a name="6162"></a>{
<a name="6163"></a>    if (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None)
<a name="6164"></a>        return <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.CheckReflect( <span class="source_type">HitLocation</span>, RefNormal, <span class="source_type">Damage</span> );
<a name="6165"></a>    else
<a name="6166"></a>        return false;
<a name="6167"></a>}
<a name="6168"></a>
<a name="6169"></a>function <span class="source_type">name</span> GetOffhandBoneFor(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>)
<a name="6170"></a>{
<a name="6171"></a>     return <span class="source_name">'bip01 l hand'</span>;
<a name="6172"></a>}
<a name="6173"></a>
<a name="6174"></a><span class="source_comment">// ----- animation ----- //
</span><a name="6175"></a>
<a name="6176"></a>simulated function <span class="source_type">name</span> GetAnimSequence()
<a name="6177"></a>{
<a name="6178"></a>    local <span class="source_type">name</span> anim;
<a name="6179"></a>    local <span class="source_type">float</span> frame, rate;
<a name="6180"></a>
<a name="6181"></a>    GetAnimParams(<span class="source_int">0</span>, anim, frame, rate);
<a name="6182"></a>    return anim;
<a name="6183"></a>}
<a name="6184"></a>
<a name="6185"></a>function PlayWeaponSwitch(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> NewWeapon)
<a name="6186"></a>{
<a name="6187"></a>    SetAnimAction(<span class="source_name">'stand_draw_kar'</span>);
<a name="6188"></a>}
<a name="6189"></a>
<a name="6190"></a><span class="source_comment">// Need to override to support weapons on the back
</span><a name="6191"></a>function ServerChangedWeapon(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> OldWeapon, <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> NewWeapon)
<a name="6192"></a>{
<a name="6193"></a>	local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> <span class="source_type">PC</span>;
<a name="6194"></a>
<a name="6195"></a>    <span class="source_type">PC</span> = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="6196"></a>
<a name="6197"></a> 	<span class="source_comment">// New weapon switching code
</span><a name="6198"></a>
<a name="6199"></a>	<span class="source_comment">// For offline or when your running a listen server and your not watching yourself in third person
</span><a name="6200"></a>	<span class="source_comment">// Just switch the attachment, don't worry about playing all the third person player stuff.
</span><a name="6201"></a>	<span class="source_comment">// That was borking up the first person weapon switches
</span><a name="6202"></a>	if( <span class="source_type">PC</span> != none && !<span class="source_type">PC</span>.bBehindView && IsLocallyControlled() && <span class="source_type">Level</span>.Netmode != NM_DedicatedServer )
<a name="6203"></a>	{
<a name="6204"></a>	    <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> = NewWeapon;
<a name="6205"></a>
<a name="6206"></a>	    if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="6207"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.ChangedWeapon();
<a name="6208"></a>
<a name="6209"></a>	    PendingWeapon = None;
<a name="6210"></a>
<a name="6211"></a>		if ( OldWeapon != None )
<a name="6212"></a>		{
<a name="6213"></a>			if( OldWeapon.bCanAttachOnBack )
<a name="6214"></a>			{
<a name="6215"></a>				if( AttachedBackItem != none )
<a name="6216"></a>				{
<a name="6217"></a>					AttachedBackItem.Destroy();
<a name="6218"></a>					AttachedBackItem = None;
<a name="6219"></a>				}
<a name="6220"></a>
<a name="6221"></a>		        AttachedBackItem = Spawn(<span class="source_type">class</span> <span class="source_name">'BackAttachment'</span>,self);
<a name="6222"></a>		        AttachedBackItem.InitFor(OldWeapon);
<a name="6223"></a>		        AttachToBone(AttachedBackItem,AttachedBackItem.AttachmentBone);
<a name="6224"></a>	        }
<a name="6225"></a>
<a name="6226"></a>			OldWeapon.SetDefaultDisplayProperties();
<a name="6227"></a>			OldWeapon.DetachFromPawn(self);
<a name="6228"></a>	        OldWeapon.GotoState(<span class="source_name">'Hidden'</span>);
<a name="6229"></a>	        OldWeapon.NetUpdateFrequency = <span class="source_int">2</span>;
<a name="6230"></a>		}
<a name="6231"></a>
<a name="6232"></a>		if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None )
<a name="6233"></a>		{
<a name="6234"></a>			if( AttachedBackItem != none && AttachedBackItem.InventoryClass == <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type">Class</span>)
<a name="6235"></a>			{
<a name="6236"></a>				AttachedBackItem.Destroy();
<a name="6237"></a>				AttachedBackItem = None;
<a name="6238"></a>			}
<a name="6239"></a>
<a name="6240"></a>		    <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NetUpdateFrequency = <span class="source_int">100</span>;
<a name="6241"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.AttachToPawn(self);
<a name="6242"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.BringUp(OldWeapon);
<a name="6243"></a>	        PlayWeaponSwitch(NewWeapon);
<a name="6244"></a>		}
<a name="6245"></a>
<a name="6246"></a>		if ( <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> != None )
<a name="6247"></a>			<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.OwnerEvent(<span class="source_name">'ChangedWeapon'</span>); <span class="source_comment">// tell inventory that weapon changed (in case any effect was being applied)
</span><a name="6248"></a>	}
<a name="6249"></a>	else
<a name="6250"></a>	{
<a name="6251"></a>		if( OldWeapon != none )
<a name="6252"></a>		{
<a name="6253"></a>			<span class="source_comment">// If we are already in state PutWeaponAway, exit that state and then switch
</span><a name="6254"></a>			<span class="source_comment">// to this new weapon
</span><a name="6255"></a>			if( IsInState(<span class="source_name">'PutWeaponAway'</span>) )
<a name="6256"></a>			{
<a name="6257"></a>				GotoState(<span class="source_name">''</span>);
<a name="6258"></a>
<a name="6259"></a>				PendingWeapon = NewWeapon;
<a name="6260"></a>
<a name="6261"></a>				GotoState(<span class="source_name">'PutWeaponAway'</span>);
<a name="6262"></a>			}
<a name="6263"></a>			else
<a name="6264"></a>			{
<a name="6265"></a>				PendingWeapon = NewWeapon;
<a name="6266"></a>			    GotoState(<span class="source_name">'PutWeaponAway'</span>);
<a name="6267"></a>		    }
<a name="6268"></a>	    }
<a name="6269"></a>	<span class="source_comment">// end new stuff
</span><a name="6270"></a>	    else
<a name="6271"></a>	    {
<a name="6272"></a>		    <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> = NewWeapon;
<a name="6273"></a>
<a name="6274"></a>		    if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="6275"></a>				<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.ChangedWeapon();
<a name="6276"></a>
<a name="6277"></a>		    PendingWeapon = None;
<a name="6278"></a>
<a name="6279"></a>			if ( OldWeapon != None )
<a name="6280"></a>			{
<a name="6281"></a>				OldWeapon.SetDefaultDisplayProperties();
<a name="6282"></a>				OldWeapon.DetachFromPawn(self);
<a name="6283"></a>		        OldWeapon.GotoState(<span class="source_name">'Hidden'</span>);
<a name="6284"></a>		        OldWeapon.NetUpdateFrequency = <span class="source_int">2</span>;
<a name="6285"></a>			}
<a name="6286"></a>
<a name="6287"></a>			if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None )
<a name="6288"></a>			{
<a name="6289"></a>				if( AttachedBackItem != none && AttachedBackItem.InventoryClass == <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type">Class</span>)
<a name="6290"></a>				{
<a name="6291"></a>					AttachedBackItem.Destroy();
<a name="6292"></a>					AttachedBackItem = None;
<a name="6293"></a>				}
<a name="6294"></a>
<a name="6295"></a>			    <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NetUpdateFrequency = <span class="source_int">100</span>;
<a name="6296"></a>				<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.AttachToPawn(self);
<a name="6297"></a>				<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.BringUp(OldWeapon);
<a name="6298"></a>		        PlayWeaponSwitch(NewWeapon);
<a name="6299"></a>			}
<a name="6300"></a>
<a name="6301"></a>			if ( <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> != None )
<a name="6302"></a>				<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.OwnerEvent(<span class="source_name">'ChangedWeapon'</span>); <span class="source_comment">// tell inventory that weapon changed (in case any effect was being applied)
</span><a name="6303"></a>		}
<a name="6304"></a>	}
<a name="6305"></a>}
<a name="6306"></a>
<a name="6307"></a><span class="source_comment">// Not sure if we need this, its the same as the super, but keep here until the weapon switching code is final
</span><a name="6308"></a><span class="source_comment">// Just changed to pendingWeapon
</span><a name="6309"></a>simulated function ChangedWeapon()
<a name="6310"></a>{
<a name="6311"></a>    local <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> OldWeapon;
<a name="6312"></a>
<a name="6313"></a>    ServerChangedWeapon(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>, PendingWeapon);
<a name="6314"></a>    if (Role &lt; ROLE_Authority)
<a name="6315"></a>	{
<a name="6316"></a>       	<span class="source_comment">// When switching weapons, don't let the client attempt to fire until the switch is complete
</span><a name="6317"></a>        if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="6318"></a>		{
<a name="6319"></a>			bPreventWeaponFire = true;
<a name="6320"></a>        }
<a name="6321"></a>
<a name="6322"></a>        OldWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>;
<a name="6323"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> = PendingWeapon;
<a name="6324"></a>		PendingWeapon = None;
<a name="6325"></a>		if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="6326"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.ChangedWeapon();
<a name="6327"></a>
<a name="6328"></a>        if (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None)
<a name="6329"></a>		    <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.BringUp(OldWeapon);
<a name="6330"></a>    }
<a name="6331"></a>}
<a name="6332"></a>
<a name="6333"></a><span class="source_comment">// Handles creating the back attachment if the weapon should go on the back
</span><a name="6334"></a><span class="source_comment">// as well as playing the proper draw/put away anims for the weapons that are being switched
</span><a name="6335"></a><span class="source_type">state</span> PutWeaponAway
<a name="6336"></a>{
<a name="6337"></a>    simulated function Timer()
<a name="6338"></a>	{
<a name="6339"></a>		GotoState(<span class="source_name">''</span>);
<a name="6340"></a>	}
<a name="6341"></a>
<a name="6342"></a>	simulated function BeginState()
<a name="6343"></a>	{
<a name="6344"></a>		local <span class="source_type">name</span> Anim;
<a name="6345"></a>
<a name="6346"></a>		bPreventWeaponFire = true;
<a name="6347"></a>
<a name="6348"></a>		<span class="source_comment">// Put the weapon down on the server as well as the client
</span><a name="6349"></a>		if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer && <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none)
<a name="6350"></a>		{
<a name="6351"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="6352"></a>		}
<a name="6353"></a>
<a name="6354"></a>		<span class="source_comment">// select the proper animation to play based on what the player is holding
</span><a name="6355"></a>		<span class="source_comment">// Weapon could be none because it might have been destroyed before getting here (nades, faust, etc)
</span><a name="6356"></a>    	if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="6357"></a>    	{
<a name="6358"></a>	 		if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'BinocularsItem'</span>) )
<a name="6359"></a>			{
<a name="6360"></a>	    		if( bIsCrawling )
<a name="6361"></a>	    		{
<a name="6362"></a>	    			Anim = <span class="source_name">'prone_putaway_nade'</span>;
<a name="6363"></a>	    		}
<a name="6364"></a>	    		else
<a name="6365"></a>	    		{
<a name="6366"></a>	    			Anim = <span class="source_name">'stand_putaway_nade'</span>;
<a name="6367"></a>	    		}
<a name="6368"></a>			}
<a name="6369"></a>			else if( (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROBoltActionWeapon'</span>) || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROAutoWeapon'</span>) ||
<a name="6370"></a>				<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROSemiAutoWeapon'</span>)))
<a name="6371"></a>			{
<a name="6372"></a>	    		if( bIsCrawling )
<a name="6373"></a>	    		{
<a name="6374"></a>	    			Anim = <span class="source_name">'prone_putaway_kar'</span>;
<a name="6375"></a>	    		}
<a name="6376"></a>	    		else
<a name="6377"></a>	    		{
<a name="6378"></a>	    			Anim = <span class="source_name">'stand_putaway_kar'</span>;
<a name="6379"></a>	    		}
<a name="6380"></a>			}
<a name="6381"></a>			else if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROPistolWeapon'</span>))
<a name="6382"></a>			{
<a name="6383"></a>	    		if( bIsCrawling )
<a name="6384"></a>	    		{
<a name="6385"></a>	    			Anim = <span class="source_name">'prone_putaway_pistol'</span>;
<a name="6386"></a>	    		}
<a name="6387"></a>	    		else
<a name="6388"></a>	    		{
<a name="6389"></a>	    			Anim = <span class="source_name">'stand_putaway_pistol'</span>;
<a name="6390"></a>	    		}
<a name="6391"></a>			}
<a name="6392"></a>			else
<a name="6393"></a>			{
<a name="6394"></a>				<span class="source_comment">// Default in case there is no anim
</span><a name="6395"></a>	    		if( bIsCrawling )
<a name="6396"></a>	    		{
<a name="6397"></a>	    			Anim = <span class="source_name">'prone_putaway_kar'</span>;
<a name="6398"></a>	    		}
<a name="6399"></a>	    		else
<a name="6400"></a>	    		{
<a name="6401"></a>	    			Anim = <span class="source_name">'stand_putaway_kar'</span>;
<a name="6402"></a>	    		}
<a name="6403"></a>			}
<a name="6404"></a>    	}
<a name="6405"></a>    	else
<a name="6406"></a>    	{
<a name="6407"></a>			<span class="source_comment">// TODO: Need a put away empty anim
</span><a name="6408"></a>    		if( bIsCrawling )
<a name="6409"></a>    		{
<a name="6410"></a>    			Anim = <span class="source_name">'prone_putaway_kar'</span>;
<a name="6411"></a>    		}
<a name="6412"></a>    		else
<a name="6413"></a>    		{
<a name="6414"></a>    			Anim = <span class="source_name">'stand_putaway_kar'</span>;
<a name="6415"></a>    		}
<a name="6416"></a>    	}
<a name="6417"></a>
<a name="6418"></a>        <span class="source_comment">// Handle the inventory side of swapping the weapon, not the visual side
</span><a name="6419"></a>		SwapWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>;
<a name="6420"></a>
<a name="6421"></a>    	if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None )
<a name="6422"></a>    	{
<a name="6423"></a>            <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.GotoState(<span class="source_name">'Hidden'</span>);
<a name="6424"></a>            <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NetUpdateFrequency = <span class="source_int">2</span>;
<a name="6425"></a>    	}
<a name="6426"></a>
<a name="6427"></a>		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> = PendingWeapon;
<a name="6428"></a>
<a name="6429"></a>	    if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="6430"></a>			<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.ChangedWeapon();
<a name="6431"></a>
<a name="6432"></a>		PendingWeapon = None;
<a name="6433"></a>
<a name="6434"></a>		if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None )
<a name="6435"></a>		{
<a name="6436"></a>		    <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.NetUpdateFrequency = <span class="source_int">100</span>;
<a name="6437"></a>		    <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.AttachToPawnHidden(self);
<a name="6438"></a>			<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.BringUp(SwapWeapon);
<a name="6439"></a>		}
<a name="6440"></a>
<a name="6441"></a>        if( !<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) )
<a name="6442"></a>        {
<a name="6443"></a>			bPreventWeaponFire = false;
<a name="6444"></a>		}
<a name="6445"></a>
<a name="6446"></a>		if ( <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> != none )
<a name="6447"></a>			<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.OwnerEvent(<span class="source_name">'ChangedWeapon'</span>); <span class="source_comment">// tell inventory that weapon changed (in case any effect was being applied)
</span><a name="6448"></a>
<a name="6449"></a>		SetTimer(GetAnimDuration(Anim, <span class="source_int">1.0</span>) + <span class="source_int">0.1</span>,false);
<a name="6450"></a>
<a name="6451"></a>        SetAnimAction(Anim);
<a name="6452"></a>	}
<a name="6453"></a>
<a name="6454"></a>	simulated function EndState()
<a name="6455"></a>	{
<a name="6456"></a>		local <span class="source_type">name</span> Anim;
<a name="6457"></a>
<a name="6458"></a>    	if ( SwapWeapon != None )
<a name="6459"></a>    	{
<a name="6460"></a>
<a name="6461"></a>    		if( SwapWeapon.bCanAttachOnBack )
<a name="6462"></a>    		{
<a name="6463"></a>    			if( AttachedBackItem != none )
<a name="6464"></a>    			{
<a name="6465"></a>    				AttachedBackItem.Destroy();
<a name="6466"></a>    				AttachedBackItem = None;
<a name="6467"></a>    			}
<a name="6468"></a>
<a name="6469"></a>    	        AttachedBackItem = Spawn(<span class="source_type">class</span> <span class="source_name">'BackAttachment'</span>,self);
<a name="6470"></a>    	        AttachedBackItem.InitFor(SwapWeapon);
<a name="6471"></a>    	        AttachToBone(AttachedBackItem,AttachedBackItem.AttachmentBone);
<a name="6472"></a>            }
<a name="6473"></a>
<a name="6474"></a>			SwapWeapon.SetDefaultDisplayProperties();
<a name="6475"></a>    		SwapWeapon.DetachFromPawn(self);
<a name="6476"></a>    	}
<a name="6477"></a>
<a name="6478"></a>        <span class="source_comment">// select the proper animation to play based on what the player is holding and
</span><a name="6479"></a>        <span class="source_comment">// what weapon they are switching to
</span><a name="6480"></a>
<a name="6481"></a>    	<span class="source_comment">// From grenade or binocs to rifle
</span><a name="6482"></a>    	if( SwapWeapon == none )
<a name="6483"></a>    	{
<a name="6484"></a>    		<span class="source_comment">// TODO: Need a put away empty anim
</span><a name="6485"></a>    		if( bIsCrawling )
<a name="6486"></a>    		{
<a name="6487"></a>    			Anim = <span class="source_name">'prone_draw_kar'</span>;
<a name="6488"></a>    		}
<a name="6489"></a>    		else
<a name="6490"></a>    		{
<a name="6491"></a>    			Anim = <span class="source_name">'stand_draw_kar'</span>;
<a name="6492"></a>    		}
<a name="6493"></a>    	}
<a name="6494"></a>    	else if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> == none )
<a name="6495"></a>    	{
<a name="6496"></a>    		if( bIsCrawling )
<a name="6497"></a>    		{
<a name="6498"></a>    			Anim = <span class="source_name">'prone_nadeFromRifle'</span>;
<a name="6499"></a>    		}
<a name="6500"></a>    		else
<a name="6501"></a>    		{
<a name="6502"></a>    			Anim = <span class="source_name">'stand_nadefromrifle'</span>;
<a name="6503"></a>    		}
<a name="6504"></a>    	}
<a name="6505"></a>    	else if( ( SwapWeapon.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) || SwapWeapon.IsA(<span class="source_name">'BinocularsItem'</span>) )&&
<a name="6506"></a>    		(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROBoltActionWeapon'</span>) || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROAutoWeapon'</span>) ||
<a name="6507"></a>    		 <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROSemiAutoWeapon'</span>)) )
<a name="6508"></a>    	{
<a name="6509"></a>    		if( bIsCrawling )
<a name="6510"></a>    		{
<a name="6511"></a>    			Anim = <span class="source_name">'prone_rifleFromNade'</span>;
<a name="6512"></a>    		}
<a name="6513"></a>    		else
<a name="6514"></a>    		{
<a name="6515"></a>    			Anim = <span class="source_name">'stand_riflefromnade'</span>;
<a name="6516"></a>    		}
<a name="6517"></a>    	}
<a name="6518"></a>    	<span class="source_comment">// from rifle to grenade or binocs
</span><a name="6519"></a>    	else if( (SwapWeapon.IsA(<span class="source_name">'ROBoltActionWeapon'</span>) || SwapWeapon.IsA(<span class="source_name">'ROAutoWeapon'</span>) ||
<a name="6520"></a>    		SwapWeapon.IsA(<span class="source_name">'ROSemiAutoWeapon'</span>)) && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) ||
<a name="6521"></a>    		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'BinocularsItem'</span>)))
<a name="6522"></a>    	{
<a name="6523"></a>    		if( bIsCrawling )
<a name="6524"></a>    		{
<a name="6525"></a>    			Anim = <span class="source_name">'prone_nadeFromRifle'</span>;
<a name="6526"></a>    		}
<a name="6527"></a>    		else
<a name="6528"></a>    		{
<a name="6529"></a>    			Anim = <span class="source_name">'stand_nadefromrifle'</span>;
<a name="6530"></a>    		}
<a name="6531"></a>    	}
<a name="6532"></a>    	<span class="source_comment">// from pistol to rifle
</span><a name="6533"></a>    	else if( SwapWeapon.IsA(<span class="source_name">'ROPistolWeapon'</span>) && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROBoltActionWeapon'</span>) ||
<a name="6534"></a>    		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROAutoWeapon'</span>) || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROSemiAutoWeapon'</span>)))
<a name="6535"></a>    	{
<a name="6536"></a>    		if( bIsCrawling )
<a name="6537"></a>    		{
<a name="6538"></a>    			Anim = <span class="source_name">'prone_riflefrompistol'</span>;
<a name="6539"></a>    		}
<a name="6540"></a>    		else
<a name="6541"></a>    		{
<a name="6542"></a>    			Anim = <span class="source_name">'stand_riflefrompistol'</span>;
<a name="6543"></a>    		}
<a name="6544"></a>    	}
<a name="6545"></a>    	<span class="source_comment">// from rifle to pistol
</span><a name="6546"></a>    	else if( (SwapWeapon.IsA(<span class="source_name">'ROBoltActionWeapon'</span>) || SwapWeapon.IsA(<span class="source_name">'ROAutoWeapon'</span>) ||
<a name="6547"></a>    		SwapWeapon.IsA(<span class="source_name">'ROSemiAutoWeapon'</span>)) && <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROPistolWeapon'</span>))
<a name="6548"></a>    	{
<a name="6549"></a>    		if( bIsCrawling )
<a name="6550"></a>    		{
<a name="6551"></a>    			Anim = <span class="source_name">'prone_pistolfromrifle'</span>;
<a name="6552"></a>    		}
<a name="6553"></a>    		else
<a name="6554"></a>    		{
<a name="6555"></a>    			Anim = <span class="source_name">'stand_pistolfromrifle'</span>;
<a name="6556"></a>    		}
<a name="6557"></a>    	}
<a name="6558"></a>    	<span class="source_comment">// from pistol to grenade or binocs
</span><a name="6559"></a>    	else if( SwapWeapon.IsA(<span class="source_name">'ROPistolWeapon'</span>) && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) ||
<a name="6560"></a>    		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'BinocularsItem'</span>)))
<a name="6561"></a>    	{
<a name="6562"></a>    		if( bIsCrawling )
<a name="6563"></a>    		{
<a name="6564"></a>    			Anim = <span class="source_name">'prone_nadefrompistol'</span>;
<a name="6565"></a>    		}
<a name="6566"></a>    		else
<a name="6567"></a>    		{
<a name="6568"></a>    			Anim = <span class="source_name">'stand_nadefrompistol'</span>;
<a name="6569"></a>    		}
<a name="6570"></a>    	}
<a name="6571"></a>    	<span class="source_comment">// from grenade or binocs to pistol
</span><a name="6572"></a>    	else if( ( SwapWeapon.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) || SwapWeapon.IsA(<span class="source_name">'BinocularsItem'</span>)) &&
<a name="6573"></a>    		<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROPistolWeapon'</span>) )
<a name="6574"></a>    	{
<a name="6575"></a>    		if( bIsCrawling )
<a name="6576"></a>    		{
<a name="6577"></a>    			Anim = <span class="source_name">'prone_pistolfromnade'</span>;
<a name="6578"></a>    		}
<a name="6579"></a>    		else
<a name="6580"></a>    		{
<a name="6581"></a>    			Anim = <span class="source_name">'stand_pistolfromnade'</span>;
<a name="6582"></a>    		}
<a name="6583"></a>    	}
<a name="6584"></a>    	<span class="source_comment">// from grenade or binocs, to grenade or binocs
</span><a name="6585"></a>    	else if( ( SwapWeapon.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) || SwapWeapon.IsA(<span class="source_name">'BinocularsItem'</span>)) &&
<a name="6586"></a>    		(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'ROExplosiveWeapon'</span>) || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'BinocularsItem'</span>) ) )
<a name="6587"></a>    	{
<a name="6588"></a>    		<span class="source_comment">// TODO: Need a real anim here
</span><a name="6589"></a>    		if( bIsCrawling )
<a name="6590"></a>    		{
<a name="6591"></a>    			Anim = <span class="source_name">'prone_draw_nade'</span>;
<a name="6592"></a>    		}
<a name="6593"></a>    		else
<a name="6594"></a>    		{
<a name="6595"></a>    			Anim = <span class="source_name">'stand_draw_nade'</span>;
<a name="6596"></a>    		}
<a name="6597"></a>    	}
<a name="6598"></a>    	else
<a name="6599"></a>    	{
<a name="6600"></a>    		<span class="source_comment">// Default in case there is no anim
</span><a name="6601"></a>    		if( bIsCrawling )
<a name="6602"></a>    		{
<a name="6603"></a>    			Anim = <span class="source_name">'prone_draw_kar'</span>;
<a name="6604"></a>    		}
<a name="6605"></a>    		else
<a name="6606"></a>    		{
<a name="6607"></a>    			Anim = <span class="source_name">'stand_draw_kar'</span>;
<a name="6608"></a>    		}
<a name="6609"></a>    	}
<a name="6610"></a>
<a name="6611"></a>    	SetAnimAction(Anim);
<a name="6612"></a>
<a name="6613"></a>		if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None )
<a name="6614"></a>		{
<a name="6615"></a>			if( AttachedBackItem != none && AttachedBackItem.InventoryClass == <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type">Class</span>)
<a name="6616"></a>			{
<a name="6617"></a>				AttachedBackItem.Destroy();
<a name="6618"></a>				AttachedBackItem = None;
<a name="6619"></a>			}
<a name="6620"></a>
<a name="6621"></a>			<span class="source_comment">//Weapon.AttachToPawn(self);
</span><a name="6622"></a>			<span class="source_comment">// unhide the weapon now
</span><a name="6623"></a>			if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.ThirdPersonActor != none )
<a name="6624"></a>				<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.ThirdPersonActor.bHidden = false;
<a name="6625"></a>			else
<a name="6626"></a>				<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.AttachToPawn(self);
<a name="6627"></a>		}
<a name="6628"></a>
<a name="6629"></a>        SwapWeapon = none;
<a name="6630"></a>
<a name="6631"></a>        bPreventWeaponFire = false;
<a name="6632"></a>	}
<a name="6633"></a>}
<a name="6634"></a>
<a name="6635"></a>simulated final function RandSpin(<span class="source_type">float</span> spinRate)
<a name="6636"></a>{
<a name="6637"></a>    DesiredRotation = RotRand(true);
<a name="6638"></a>    RotationRate.Yaw = spinRate * <span class="source_int">2</span> *FRand() - spinRate;
<a name="6639"></a>    RotationRate.Pitch = spinRate * <span class="source_int">2</span> *FRand() - spinRate;
<a name="6640"></a>    RotationRate.Roll = spinRate * <span class="source_int">2</span> *FRand() - spinRate;
<a name="6641"></a>
<a name="6642"></a>    bFixedRotationDir = true;
<a name="6643"></a>    bRotateToDesired = false;
<a name="6644"></a>}
<a name="6645"></a>
<a name="6646"></a>function PlayDyingAnimation(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HitLoc)
<a name="6647"></a>{
<a name="6648"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> shotDir, hitLocRel, deathAngVel, shotStrength;
<a name="6649"></a>	local <span class="source_type">float</span> maxDim;
<a name="6650"></a>	local <span class="source_type">string</span> RagSkelName;
<a name="6651"></a>	local <span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span> skelParams;
<a name="6652"></a>	local <span class="source_type">bool</span> PlayersRagdoll;
<a name="6653"></a>	local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> <span class="source_type">pc</span>;
<a name="6654"></a>
<a name="6655"></a>	if ( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="6656"></a>	{
<a name="6657"></a>		<span class="source_comment">// Is this the local player's ragdoll?
</span><a name="6658"></a>		if(OldController != None)
<a name="6659"></a>			<span class="source_type">pc</span> = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(OldController);
<a name="6660"></a>		if( <span class="source_type">pc</span> != None && <span class="source_type">pc</span>.<span class="source_type">ViewTarget</span> == self )
<a name="6661"></a>			PlayersRagdoll = true;
<a name="6662"></a>
<a name="6663"></a>		if( FRand() &lt; <span class="source_int">0.3</span> )
<a name="6664"></a>		{
<a name="6665"></a>			HelmetShotOff(<span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(Normal(GetTearOffMomemtum())));
<a name="6666"></a>		}
<a name="6667"></a>
<a name="6668"></a>		<span class="source_comment">// In low physics detail, if we were not just controlling this pawn,
</span><a name="6669"></a>		<span class="source_comment">// and it has not been rendered in 3 seconds, just destroy it.
</span><a name="6670"></a>		if( (<span class="source_type">Level</span>.PhysicsDetailLevel != PDL_High) && !PlayersRagdoll && (<span class="source_type">Level</span>.TimeSeconds - LastRenderTime &gt; <span class="source_int">3</span>) )
<a name="6671"></a>		{
<a name="6672"></a>			Destroy();
<a name="6673"></a>			return;
<a name="6674"></a>		}
<a name="6675"></a>
<a name="6676"></a>		<span class="source_comment">// Try and obtain a rag-doll setup. Use optional 'override' one out of player record first, then use the species one.
</span><a name="6677"></a>		if( RagdollOverride != <span class="source_string">""</span>)
<a name="6678"></a>			RagSkelName = RagdollOverride;
<a name="6679"></a>		else if(Species != None)
<a name="6680"></a>			RagSkelName = Species.static.GetRagSkelName( GetMeshName() );
<a name="6681"></a>		else
<a name="6682"></a>			Log(<span class="source_string">"xPawn.PlayDying: No Species"</span>);
<a name="6683"></a>
<a name="6684"></a>		<span class="source_comment">// If we managed to find a name, try and make a rag-doll slot availbale.
</span><a name="6685"></a>		if( RagSkelName != <span class="source_string">""</span> )
<a name="6686"></a>		{
<a name="6687"></a>			KMakeRagdollAvailable();
<a name="6688"></a>		}
<a name="6689"></a>
<a name="6690"></a>		if( KIsRagdollAvailable() && RagSkelName != <span class="source_string">""</span> )
<a name="6691"></a>		{
<a name="6692"></a>			skelParams = <span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span>(KParams);
<a name="6693"></a>			skelParams.KSkeleton = RagSkelName;
<a name="6694"></a>
<a name="6695"></a>			<span class="source_comment">// Stop animation playing.
</span><a name="6696"></a>			StopAnimating(true);
<a name="6697"></a>
<a name="6698"></a>			if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None )
<a name="6699"></a>			{
<a name="6700"></a>				if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLeaveBodyEffect )
<a name="6701"></a>					TearOffMomentum = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="6702"></a>
<a name="6703"></a>				if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bKUseOwnDeathVel )
<a name="6704"></a>				{
<a name="6705"></a>					RagDeathVel = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeathVel;
<a name="6706"></a>					RagDeathUpKick = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeathUpKick;
<a name="6707"></a>					RagShootStrength = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDamageImpulse;
<a name="6708"></a>				}
<a name="6709"></a>			}
<a name="6710"></a>
<a name="6711"></a>			<span class="source_comment">// Set the dude moving in direction he was shot in general
</span><a name="6712"></a>			shotDir = Normal(GetTearOffMomemtum());
<a name="6713"></a>			shotStrength = RagDeathVel * shotDir;
<a name="6714"></a>
<a name="6715"></a>			<span class="source_comment">// Calculate angular velocity to impart, based on shot location.
</span><a name="6716"></a>			hitLocRel = TakeHitLocation - Location;
<a name="6717"></a>
<a name="6718"></a>
<a name="6719"></a>
<a name="6720"></a>			if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit )
<a name="6721"></a>			{
<a name="6722"></a>				hitLocRel.<span class="source_type">X</span> *= RagSpinScale;
<a name="6723"></a>				hitLocRel.<span class="source_type">Y</span> *= RagSpinScale;
<a name="6724"></a>
<a name="6725"></a>				if( Abs(hitLocRel.<span class="source_type">X</span>)  &gt; RagMaxSpinAmount )
<a name="6726"></a>				{
<a name="6727"></a>					if( hitLocRel.<span class="source_type">X</span> &lt; <span class="source_int">0</span> )
<a name="6728"></a>					{
<a name="6729"></a>						hitLocRel.<span class="source_type">X</span> = FMax((hitLocRel.<span class="source_type">X</span> * RagSpinScale), (RagMaxSpinAmount * -<span class="source_int">1</span>));
<a name="6730"></a>					}
<a name="6731"></a>					else
<a name="6732"></a>					{
<a name="6733"></a>						hitLocRel.<span class="source_type">X</span> = FMin((hitLocRel.<span class="source_type">X</span> * RagSpinScale), RagMaxSpinAmount);
<a name="6734"></a>					}
<a name="6735"></a>				}
<a name="6736"></a>
<a name="6737"></a>				if( Abs(hitLocRel.<span class="source_type">Y</span>)  &gt; RagMaxSpinAmount )
<a name="6738"></a>				{
<a name="6739"></a>					if( hitLocRel.<span class="source_type">Y</span> &lt; <span class="source_int">0</span> )
<a name="6740"></a>					{
<a name="6741"></a>						hitLocRel.<span class="source_type">Y</span> = FMax((hitLocRel.<span class="source_type">Y</span> * RagSpinScale), (RagMaxSpinAmount * -<span class="source_int">1</span>));
<a name="6742"></a>					}
<a name="6743"></a>					else
<a name="6744"></a>					{
<a name="6745"></a>						hitLocRel.<span class="source_type">Y</span> = FMin((hitLocRel.<span class="source_type">Y</span> * RagSpinScale), RagMaxSpinAmount);
<a name="6746"></a>					}
<a name="6747"></a>				}
<a name="6748"></a>
<a name="6749"></a>			}
<a name="6750"></a>			else
<a name="6751"></a>			{
<a name="6752"></a>				<span class="source_comment">// We scale the hit location out sideways a bit, to get more spin around Z.
</span><a name="6753"></a>				hitLocRel.<span class="source_type">X</span> *= RagSpinScale;
<a name="6754"></a>				hitLocRel.<span class="source_type">Y</span> *= RagSpinScale;
<a name="6755"></a>			}
<a name="6756"></a>
<a name="6757"></a>			<span class="source_comment">//log("hitLocRel.X = "$hitLocRel.X$" hitLocRel.Y = "$hitLocRel.Y);
</span><a name="6758"></a>			<span class="source_comment">//log("TearOffMomentum = "$VSize(GetTearOffMomemtum()));
</span><a name="6759"></a>
<a name="6760"></a>			<span class="source_comment">// If the tear off momentum was very small for some reason, make up some angular velocity for the pawn
</span><a name="6761"></a>			if( VSize(GetTearOffMomemtum()) &lt; <span class="source_int">0.01</span> )
<a name="6762"></a>			{
<a name="6763"></a>				<span class="source_comment">//Log("TearOffMomentum magnitude of Zero");
</span><a name="6764"></a>				deathAngVel = VRand() * <span class="source_int">18000.0</span>;
<a name="6765"></a>			}
<a name="6766"></a>			else
<a name="6767"></a>			{
<a name="6768"></a>				deathAngVel = RagInvInertia * (hitLocRel cross shotStrength);
<a name="6769"></a>			}
<a name="6770"></a>
<a name="6771"></a>    		<span class="source_comment">// Set initial angular and linear velocity for ragdoll.
</span><a name="6772"></a>			<span class="source_comment">// Scale horizontal velocity for characters - they run really fast!
</span><a name="6773"></a>			if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery )
<a name="6774"></a>				skelParams.KStartLinVel = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="6775"></a>			if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">Damagetype</a></span>.default.bKUseTearOffMomentum )
<a name="6776"></a>				skelParams.KStartLinVel = GetTearOffMomemtum() + Velocity;
<a name="6777"></a>			else
<a name="6778"></a>			{
<a name="6779"></a>				skelParams.KStartLinVel.<span class="source_type">X</span> = <span class="source_int">0.6</span> * Velocity.<span class="source_type">X</span>;
<a name="6780"></a>				skelParams.KStartLinVel.<span class="source_type">Y</span> = <span class="source_int">0.6</span> * Velocity.<span class="source_type">Y</span>;
<a name="6781"></a>				skelParams.KStartLinVel.<span class="source_type">Z</span> = <span class="source_int">1.0</span> * Velocity.<span class="source_type">Z</span>;
<a name="6782"></a>    				skelParams.KStartLinVel += shotStrength;
<a name="6783"></a>			}
<a name="6784"></a>			<span class="source_comment">// if not moving downwards - give extra upward kick
</span><a name="6785"></a>			if( !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLeaveBodyEffect && !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery && (Velocity.<span class="source_type">Z</span> &gt; -<span class="source_int">10</span>) )
<a name="6786"></a>				skelParams.KStartLinVel.<span class="source_type">Z</span> += RagDeathUpKick;
<a name="6787"></a>
<a name="6788"></a>			if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery )
<a name="6789"></a>			{
<a name="6790"></a>				Velocity = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="6791"></a>    			skelParams.KStartAngVel = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="6792"></a>    		}
<a name="6793"></a>			else
<a name="6794"></a>			{
<a name="6795"></a>    			skelParams.KStartAngVel = deathAngVel;
<a name="6796"></a>
<a name="6797"></a>    			<span class="source_comment">// Set up deferred shot-bone impulse
</span><a name="6798"></a>				maxDim = <span class="source_type">Max</span>(CollisionRadius, CollisionHeight);
<a name="6799"></a>
<a name="6800"></a>    			skelParams.KShotStart = TakeHitLocation - (<span class="source_int">1</span> * shotDir);
<a name="6801"></a>    			skelParams.KShotEnd = TakeHitLocation + (<span class="source_int">2</span>*maxDim*shotDir);
<a name="6802"></a>    			skelParams.KShotStrength = RagShootStrength;
<a name="6803"></a>			}
<a name="6804"></a>
<a name="6805"></a>			<span class="source_comment">//log("RagDeathVel = "$RagDeathVel$" KShotStrength = "$skelParams.KShotStrength$" RagDeathUpKick = "$RagDeathUpKick);
</span><a name="6806"></a>
<a name="6807"></a>    		<span class="source_comment">// If this damage type causes convulsions, turn them on here.
</span><a name="6808"></a>    		if(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != none && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bCauseConvulsions)
<a name="6809"></a>    		{
<a name="6810"></a>    			RagConvulseMaterial=<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayMaterial;
<a name="6811"></a>    			skelParams.bKDoConvulsions = true;
<a name="6812"></a>		    }
<a name="6813"></a>
<a name="6814"></a>    		<span class="source_comment">// Turn on Karma collision for ragdoll.
</span><a name="6815"></a>			KSetBlockKarma(true);
<a name="6816"></a>
<a name="6817"></a>			<span class="source_comment">// Set physics mode to ragdoll.
</span><a name="6818"></a>			<span class="source_comment">// This doesn't actaully start it straight away, it's deferred to the first tick.
</span><a name="6819"></a>			SetPhysics(PHYS_KarmaRagdoll);
<a name="6820"></a>
<a name="6821"></a>			<span class="source_comment">// If viewing this ragdoll, set the flag to indicate that it is 'important'
</span><a name="6822"></a>			if( PlayersRagdoll )
<a name="6823"></a>				skelParams.bKImportantRagdoll = true;
<a name="6824"></a>
<a name="6825"></a>			skelParams.KActorGravScale = RagGravScale;
<a name="6826"></a>
<a name="6827"></a>			return;
<a name="6828"></a>		}
<a name="6829"></a>		<span class="source_comment">// jag
</span><a name="6830"></a>	}
<a name="6831"></a>
<a name="6832"></a>	<span class="source_comment">// non-ragdoll death fallback
</span><a name="6833"></a>	Velocity += GetTearOffMomemtum();
<a name="6834"></a>    BaseEyeHeight = Default.BaseEyeHeight;
<a name="6835"></a>    SetTwistLook(<span class="source_int">0</span>, <span class="source_int">0</span>);
<a name="6836"></a>    <span class="source_comment">// We don't do this - Ramm
</span><a name="6837"></a>    <span class="source_comment">//PlayDirectionalDeath(HitLoc);
</span><a name="6838"></a>    SetPhysics(PHYS_Falling);
<a name="6839"></a>}
<a name="6840"></a>
<a name="6841"></a><span class="source_comment">// Apply karma from client side explosions to a ragdoll for a dead pawn
</span><a name="6842"></a>simulated function DeadExplosionKarma(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span>, <span class="source_type">float</span> Strength)
<a name="6843"></a>{
<a name="6844"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> shotDir;
<a name="6845"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> PushLinVel, PushAngVel;
<a name="6846"></a>
<a name="6847"></a>	if( (RagdollLifeSpan - LifeSpan) &lt; <span class="source_int">1.0</span> )
<a name="6848"></a>	{
<a name="6849"></a>		return;
<a name="6850"></a>	}
<a name="6851"></a>
<a name="6852"></a>	if ( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="6853"></a>	{
<a name="6854"></a>		if ( <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="6855"></a>			return;
<a name="6856"></a>
<a name="6857"></a>		if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != none )
<a name="6858"></a>		{
<a name="6859"></a>			if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bKUseOwnDeathVel )
<a name="6860"></a>			{
<a name="6861"></a>				RagDeathVel = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeathVel;
<a name="6862"></a>				RagDeathUpKick = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeathUpKick;
<a name="6863"></a>				RagShootStrength = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDamageImpulse;
<a name="6864"></a>			}
<a name="6865"></a>		}
<a name="6866"></a>
<a name="6867"></a>
<a name="6868"></a>		shotDir = Normal(<span class="source_type">Momentum</span>);
<a name="6869"></a>	    PushLinVel = (RagDeathVel * shotDir);
<a name="6870"></a>	    PushLinVel.<span class="source_type">Z</span> += RagDeathUpKick*(RagShootStrength*<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeadLinZVelScale);
<a name="6871"></a>
<a name="6872"></a>		PushAngVel = Normal(shotDir cross vect(<span class="source_int">0</span>, <span class="source_int">0</span>, <span class="source_int">1</span>)) * -<span class="source_int">18000</span>;
<a name="6873"></a>		PushAngVel *= RagShootStrength*<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeadAngVelScale;
<a name="6874"></a>
<a name="6875"></a>		PushLinVel *= Strength;
<a name="6876"></a>		PushAngVel *= Strength;
<a name="6877"></a>
<a name="6878"></a>		KSetSkelVel( PushLinVel, PushAngVel );
<a name="6879"></a>
<a name="6880"></a>		if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DeathOverlayMaterial != None )
<a name="6881"></a>			SetOverlayMaterial(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DeathOverlayMaterial, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DeathOverlayTime, true);
<a name="6882"></a>	}
<a name="6883"></a>}
<a name="6884"></a>
<a name="6885"></a><span class="source_comment">// Maybe spawn some chunks when the player gets obliterated
</span><a name="6886"></a>simulated function SpawnGibs(<span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> HitRotation, <span class="source_type">float</span> <span class="source_type">ChunkPerterbation</span>)
<a name="6887"></a>{
<a name="6888"></a>	bGibbed = true;
<a name="6889"></a>	PlayDyingSound();
<a name="6890"></a>
<a name="6891"></a>    if ( <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="6892"></a>		return;
<a name="6893"></a>
<a name="6894"></a>	if( ObliteratedEffectClass != none )
<a name="6895"></a>		Spawn( ObliteratedEffectClass,,, Location, HitRotation );
<a name="6896"></a>
<a name="6897"></a>    if ( FRand() &lt; <span class="source_int">0.1</span> )
<a name="6898"></a>	{
<a name="6899"></a>		SpawnGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6900"></a>		SpawnGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6901"></a>		SpawnGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6902"></a>		SpawnGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6903"></a>	}
<a name="6904"></a>	else if ( FRand() &lt; <span class="source_int">0.25</span> )
<a name="6905"></a>	{
<a name="6906"></a>		SpawnGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6907"></a>		SpawnGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6908"></a>		if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="6909"></a>		{
<a name="6910"></a>			SpawnGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6911"></a>		}
<a name="6912"></a>	}
<a name="6913"></a>	else if ( FRand() &lt; <span class="source_int">0.35</span> )
<a name="6914"></a>		SpawnGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6915"></a>	else if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="6916"></a>	{
<a name="6917"></a>		SpawnGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="6918"></a>	}
<a name="6919"></a>}
<a name="6920"></a>
<a name="6921"></a>function ClientDying(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>){}
<a name="6922"></a>
<a name="6923"></a>function PlayTakeHit(<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>)
<a name="6924"></a>{
<a name="6925"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">direction</span>;
<a name="6926"></a>    local <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span> InvRotation;
<a name="6927"></a>    local <span class="source_type">float</span> jarscale;
<a name="6928"></a>    <span class="source_comment">// This doesn't really fit our system - Ramm
</span><a name="6929"></a>	<span class="source_comment">//PlayDirectionalHit(HitLocation);
</span><a name="6930"></a>
<a name="6931"></a>    if( <span class="source_type">Level</span>.TimeSeconds - LastPainSound &lt; MinTimeBetweenPainSounds )
<a name="6932"></a>        return;
<a name="6933"></a>
<a name="6934"></a>    LastPainSound = <span class="source_type">Level</span>.TimeSeconds;
<a name="6935"></a>
<a name="6936"></a>    if( HeadVolume.bWaterVolume )
<a name="6937"></a>    {
<a name="6938"></a>        <span class="source_comment">//if( DamageType.IsA('Drowned') )
</span><a name="6939"></a>            <span class="source_comment">//PlaySound( GetSound(EST_Drown), SLOT_Pain,1.5*TransientSoundVolume );
</span><a name="6940"></a>        <span class="source_comment">//else
</span><a name="6941"></a>            <span class="source_comment">//PlaySound( GetSound(EST_HitUnderwater), SLOT_Pain,1.5*TransientSoundVolume );
</span><a name="6942"></a>        return;
<a name="6943"></a>    }
<a name="6944"></a>
<a name="6945"></a>    <span class="source_comment">// for standalone and client
</span><a name="6946"></a>    <span class="source_comment">// Cooney
</span><a name="6947"></a>    if ( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="6948"></a>    {
<a name="6949"></a>       if ( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/roweapondamagetype.html" class="source">ROWeaponDamageType</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>) != none )
<a name="6950"></a>       {
<a name="6951"></a>           if (<span class="source_type">class</span>&lt;<span class="source_type"><a href="../roengine/roweapondamagetype.html" class="source">ROWeaponDamageType</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>).default.bCauseViewJarring == true
<a name="6952"></a>              && <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none)
<a name="6953"></a>           {
<a name="6954"></a>               <span class="source_comment">// Get the approximate direction
</span><a name="6955"></a>               <span class="source_comment">// that the hit went into the body
</span><a name="6956"></a>               <span class="source_type">direction</span> = self.Location - <span class="source_type">HitLocation</span>;
<a name="6957"></a>               <span class="source_comment">// No up-down jarring effects since
</span><a name="6958"></a>               <span class="source_comment">// I dont have the barrel valocity
</span><a name="6959"></a>               <span class="source_type">direction</span>.<span class="source_type">Z</span> = <span class="source_int">0.0f</span>;
<a name="6960"></a>               <span class="source_type">direction</span> = normal(<span class="source_type">direction</span>);
<a name="6961"></a>
<a name="6962"></a>               <span class="source_comment">// We need to rotate the jarring direction
</span><a name="6963"></a>               <span class="source_comment">// in screen space so basically the
</span><a name="6964"></a>               <span class="source_comment">// exact opposite of the player's pawn's
</span><a name="6965"></a>               <span class="source_comment">// rotation.
</span><a name="6966"></a>               InvRotation.Yaw = -<span class="source_type">Rotation</span>.Yaw;
<a name="6967"></a>               InvRotation.Roll = -<span class="source_type">Rotation</span>.Roll;
<a name="6968"></a>               InvRotation.Pitch = -<span class="source_type">Rotation</span>.Pitch;
<a name="6969"></a>               <span class="source_type">direction</span> = <span class="source_type">direction</span> &gt;&gt; InvRotation;
<a name="6970"></a>
<a name="6971"></a>               jarscale = <span class="source_int">0.1f</span> + (<span class="source_type">Damage</span>/<span class="source_int">50.0f</span>);
<a name="6972"></a>               if ( jarscale &gt; <span class="source_int">1.0f</span> ) jarscale = <span class="source_int">1.0f</span>;
<a name="6973"></a>
<a name="6974"></a>               <span class="source_type"><a href="../roengine/roplayer.html" class="source">ROPlayer</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).PlayerJarred(<span class="source_type">direction</span>,jarscale);
<a name="6975"></a>           }
<a name="6976"></a>       }
<a name="6977"></a>    }
<a name="6978"></a>
<a name="6979"></a>    PlayOwnedSound(SoundGroupClass.static.GetHitSound(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>), SLOT_Pain,<span class="source_int">3</span>*TransientSoundVolume,,<span class="source_int">200</span>);
<a name="6980"></a>}
<a name="6981"></a>
<a name="6982"></a><span class="source_comment">// jag
</span><a name="6983"></a><span class="source_comment">// Called when in Ragdoll when we hit something over a certain threshold velocity
</span><a name="6984"></a><span class="source_comment">// Used to play impact sounds.
</span><a name="6985"></a>event KImpact(<span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">other</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">pos</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> impactVel, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> impactNorm)
<a name="6986"></a>{
<a name="6987"></a>	local <span class="source_type">float</span> VelocitySquared;
<a name="6988"></a>	local <span class="source_type">float</span> RagHitVolume;
<a name="6989"></a>
<a name="6990"></a>	if(<span class="source_type">Level</span>.TimeSeconds &gt; RagLastSoundTime + RagImpactSoundInterval)
<a name="6991"></a>	{
<a name="6992"></a>    	VelocitySquared = VSizeSquared(impactVel);
<a name="6993"></a>
<a name="6994"></a>		<span class="source_comment">//log("Ragimpact velocity: "$VSize(impactVel)$" VelocitySquared: "$VelocitySquared);
</span><a name="6995"></a>
<a name="6996"></a>		RagHitVolume = FMin(<span class="source_int">2.0</span>,(VelocitySquared/<span class="source_int">40000</span>));
<a name="6997"></a>
<a name="6998"></a>		<span class="source_comment">//log("RagHitVolume = "$RagHitVolume);
</span><a name="6999"></a>
<a name="7000"></a>		<span class="source_comment">//PlaySound(RagImpactSound, SLOT_None, RagHitVolume);
</span><a name="7001"></a>		RagLastSoundTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="7002"></a>	}
<a name="7003"></a>}
<a name="7004"></a><span class="source_comment">//jag
</span><a name="7005"></a>
<a name="7006"></a>simulated function PlayFootStepLeft()
<a name="7007"></a>{
<a name="7008"></a>    PlayFootStep(-<span class="source_int">1</span>);
<a name="7009"></a>}
<a name="7010"></a>
<a name="7011"></a>simulated function PlayFootStepRight()
<a name="7012"></a>{
<a name="7013"></a>    PlayFootStep(<span class="source_int">1</span>);
<a name="7014"></a>}
<a name="7015"></a>
<a name="7016"></a>simulated function ClientRestart()
<a name="7017"></a>{
<a name="7018"></a>	Super.ClientRestart();
<a name="7019"></a>	if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="7020"></a>		OldController = <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="7021"></a>}
<a name="7022"></a>
<a name="7023"></a><span class="source_comment">// MergeTODO: Write some real code for this
</span><a name="7024"></a>simulated function <span class="source_type">bool</span> ForceDefaultCharacter()
<a name="7025"></a>{
<a name="7026"></a>
<a name="7027"></a>	<span class="source_comment">//log("MergeTODO: Write some real code for ForceDefaultCharacter!!!");
</span><a name="7028"></a>
<a name="7029"></a>	return false;
<a name="7030"></a><span class="source_comment">/*	local PlayerController P;
<a name="7031"></a>
<a name="7032"></a>	if ( !class'DeathMatch'.default.bForceDefaultCharacter )
<a name="7033"></a>		return false;
<a name="7034"></a>
<a name="7035"></a>	// validate and use player's model for enemies of same sex
<a name="7036"></a>	P = Level.GetLocalPlayerController();
<a name="7037"></a>	if ( (P != None) && (P.PlayerReplicationInfo != None) )
<a name="7038"></a>	{
<a name="7039"></a>		if ( P.PlayerReplicationInfo.bIsFemale )
<a name="7040"></a>		{
<a name="7041"></a>			PlacedFemaleCharacterName = P.PlayerReplicationInfo.CharacterName;
<a name="7042"></a>			if ( !CheckValidFemaleDefault() )
<a name="7043"></a>			{
<a name="7044"></a>				PlacedFemaleCharacterName = "Tamika";
<a name="7045"></a>				return false;
<a name="7046"></a>			}
<a name="7047"></a>		}
<a name="7048"></a>		else
<a name="7049"></a>		{
<a name="7050"></a>			PlacedCharacterName = P.PlayerReplicationInfo.CharacterName;
<a name="7051"></a>			if ( !CheckValidMaleDefault() )
<a name="7052"></a>			{
<a name="7053"></a>				PlacedCharacterName = "Jakob";
<a name="7054"></a>				return false;
<a name="7055"></a>			}
<a name="7056"></a>		}
<a name="7057"></a>	}
<a name="7058"></a>	return true;  */</span>
<a name="7059"></a>}
<a name="7060"></a>
<a name="7061"></a><span class="source_comment">// MergeTODO: Write some real code for this
</span><a name="7062"></a>simulated function <span class="source_type">string</span> GetDefaultCharacter()
<a name="7063"></a>{
<a name="7064"></a>	<span class="source_comment">//log("MergeTODO: Write some real code for GetDefaultCharacter!!!");
</span><a name="7065"></a>
<a name="7066"></a>    return <span class="source_string">"FixmePlease"</span>;
<a name="7067"></a>
<a name="7068"></a><span class="source_comment">/*	if ( Level.IsDemoBuild() )
<a name="7069"></a>	{
<a name="7070"></a>		PlacedFemaleCharacterName = "Tamika";
<a name="7071"></a>		PlacedCharacterName = "Jakob";
<a name="7072"></a>	}
<a name="7073"></a>	else
<a name="7074"></a>	{
<a name="7075"></a>		// make sure picking from valid default characters
<a name="7076"></a>		if ( !CheckValidFemaleDefault() )
<a name="7077"></a>			PlacedFemaleCharacterName = "Tamika";
<a name="7078"></a>
<a name="7079"></a>		if ( !CheckValidMaleDefault() )
<a name="7080"></a>			PlacedCharacterName = "Jakob";
<a name="7081"></a>	}
<a name="7082"></a>	// return appropriate character based on this pawn's sex
<a name="7083"></a>	if ( (PlayerReplicationInfo != None) && PlayerReplicationInfo.bIsFemale )
<a name="7084"></a>		return PlacedFemaleCharacterName;
<a name="7085"></a>	else
<a name="7086"></a>		return PlacedCharacterName; */</span>
<a name="7087"></a>}
<a name="7088"></a>
<a name="7089"></a><span class="source_comment">// MergeTODO: Replace xUtil with ROUtil
</span><a name="7090"></a>simulated function Setup(<span class="source_type"><a href="../xgame/xutil.html" class="source">xUtil</a></span>.<span class="source_type"><a href="../xgame/xutil.html#PlayerRecord" class="source">PlayerRecord</a></span> rec, optional <span class="source_type">bool</span> bLoadNow)
<a name="7091"></a>{
<a name="7092"></a>	if ( (rec.Species == None) || ForceDefaultCharacter() )
<a name="7093"></a>		rec = <span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(GetDefaultCharacter());
<a name="7094"></a>
<a name="7095"></a>    Species = rec.Species;
<a name="7096"></a>	RagdollOverride = rec.Ragdoll;
<a name="7097"></a>
<a name="7098"></a>	if ( !Species.static.Setup(self,rec) )
<a name="7099"></a>	{
<a name="7100"></a>		rec = <span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(GetDefaultCharacter());
<a name="7101"></a>		if ( !Species.static.Setup(self,rec) )
<a name="7102"></a>			return;
<a name="7103"></a>	}
<a name="7104"></a>	ResetPhysicsBasedAnim();
<a name="7105"></a>}
<a name="7106"></a>
<a name="7107"></a>simulated function ResetPhysicsBasedAnim()
<a name="7108"></a>{
<a name="7109"></a>    bIsIdle = false;
<a name="7110"></a>    bWaitForAnim = false;
<a name="7111"></a>}
<a name="7112"></a>
<a name="7113"></a>function <span class="source_type"><a href="../engine/sound.html" class="source">Sound</a></span> GetSound(<span class="source_type"><a href="../roengine/ropawnsoundgroup.html" class="source">ROPawnSoundGroup</a></span>.<span class="source_type"><a href="../xgame/xpawnsoundgroup.html#ESoundType" class="source">ESoundType</a></span> soundType)
<a name="7114"></a>{
<a name="7115"></a>	local <span class="source_type">int</span> SurfaceTypeID;
<a name="7116"></a>	local <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">A</span>;
<a name="7117"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HL,HN,Start,End;
<a name="7118"></a>	local <span class="source_type"><a href="../engine/material.html" class="source">material</a></span> FloorMat;
<a name="7119"></a>
<a name="7120"></a>    if( soundType == EST_Land || soundType == EST_Jump )
<a name="7121"></a>	{
<a name="7122"></a>		if ( (Base!=None) && (!Base.IsA(<span class="source_name">'LevelInfo'</span>)) && (Base.SurfaceType!=<span class="source_int">0</span>) )
<a name="7123"></a>		{
<a name="7124"></a>			SurfaceTypeID = Base.SurfaceType;
<a name="7125"></a>		}
<a name="7126"></a>		else
<a name="7127"></a>		{
<a name="7128"></a>			Start = Location - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>)*CollisionHeight;
<a name="7129"></a>			End = Start - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">16</span>);
<a name="7130"></a>			<span class="source_type">A</span> = Trace(hl,hn,End,Start,false,,FloorMat);
<a name="7131"></a>			if (FloorMat !=None)
<a name="7132"></a>				SurfaceTypeID = FloorMat.SurfaceType;
<a name="7133"></a>		}
<a name="7134"></a>	}
<a name="7135"></a>
<a name="7136"></a>    return SoundGroupClass.static.GetSound(soundType, SurfaceTypeID);
<a name="7137"></a>}
<a name="7138"></a>
<a name="7139"></a><span class="source_comment">// End Xpawn functions
</span><a name="7140"></a>
<a name="7141"></a><span class="source_comment">//Lean functions
</span><a name="7142"></a>simulated function <span class="source_type">bool</span> TraceWall(<span class="source_type">int</span> <span class="source_type">Direction</span>, <span class="source_type">float</span> CheckDist)
<a name="7143"></a>{
<a name="7144"></a>	local <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">HitActor</span>;
<a name="7145"></a>	local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">HitNormal</span>, TraceStart, TraceEnd;
<a name="7146"></a>	local <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span> Angle;
<a name="7147"></a>
<a name="7148"></a>	Angle.Yaw=<span class="source_type">Direction</span>;
<a name="7149"></a>
<a name="7150"></a>	TraceStart=Location;
<a name="7151"></a>	TraceStart.<span class="source_type">Z</span>+=BaseEyeHeight;
<a name="7152"></a>	TraceEnd=TraceStart+<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span>(<span class="source_type">Rotation</span>+Angle)*CheckDist;
<a name="7153"></a>
<a name="7154"></a>	<span class="source_type">HitActor</span>=Trace(<span class="source_type">HitLocation</span>, <span class="source_type">HitNormal</span>, TraceEnd, TraceStart, true);
<a name="7155"></a>
<a name="7156"></a>	if ( <span class="source_type">HitActor</span> != None )
<a name="7157"></a>		return true;
<a name="7158"></a>
<a name="7159"></a>	return false;
<a name="7160"></a>}
<a name="7161"></a>
<a name="7162"></a>simulated function TickLean(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="7163"></a>{
<a name="7164"></a>    if( Role &gt; ROLE_SimulatedProxy )
<a name="7165"></a>    {
<a name="7166"></a>		<span class="source_comment">//If theres a wall to the side of the lean can't be leaning
</span><a name="7167"></a>		if (bLeanLeft && TraceWall(-<span class="source_int">16384</span>, <span class="source_int">64</span>))
<a name="7168"></a>			bLeanLeft = false;
<a name="7169"></a>
<a name="7170"></a>		if (bLeanRight && TraceWall(<span class="source_int">16384</span>, <span class="source_int">64</span>))
<a name="7171"></a>			bLeanRight = false;
<a name="7172"></a>
<a name="7173"></a>		if ( bIsSprinting )
<a name="7174"></a>		{
<a name="7175"></a>			bLeanLeft = false;
<a name="7176"></a>			bLeanRight = false;
<a name="7177"></a>		}
<a name="7178"></a>	}
<a name="7179"></a>
<a name="7180"></a>	<span class="source_comment">//Return from leaning right to center
</span><a name="7181"></a>	if ( bLeaningRight && !bLeanRight )
<a name="7182"></a>	{
<a name="7183"></a>		LeanAmount -= LeanFactor * <span class="source_type">deltatime</span>;
<a name="7184"></a>		if ( LeanAmount &lt; <span class="source_int">0</span> )
<a name="7185"></a>		{
<a name="7186"></a>			LeanAmount = <span class="source_int">0</span>;
<a name="7187"></a>			bLeaningRight=false;
<a name="7188"></a>		}
<a name="7189"></a>	}
<a name="7190"></a>	<span class="source_comment">//Leaning right
</span><a name="7191"></a>	else if ( bLeanRight )
<a name="7192"></a>	{
<a name="7193"></a>		if ( abs(LeanAmount) &lt; LeanMax )
<a name="7194"></a>			LeanAmount += LeanFactor * <span class="source_type">deltatime</span>;
<a name="7195"></a>		else if ( abs(LeanAmount) &gt;= LeanMax )
<a name="7196"></a>			LeanAmount = LeanMax;
<a name="7197"></a>		bLeaningRight=true;
<a name="7198"></a>	}
<a name="7199"></a>	<span class="source_comment">//Returning from lean left to center
</span><a name="7200"></a>	if (bLeaningLeft && !bLeanLeft)
<a name="7201"></a>	{
<a name="7202"></a>		LeanAmount += LeanFactor * <span class="source_type">deltatime</span>;
<a name="7203"></a>		if ( LeanAmount &gt; <span class="source_int">0</span> )
<a name="7204"></a>		{
<a name="7205"></a>			LeanAmount = <span class="source_int">0</span>;
<a name="7206"></a>			bLeaningLeft=false;
<a name="7207"></a>		}
<a name="7208"></a>	}
<a name="7209"></a>	<span class="source_comment">//Leaning left
</span><a name="7210"></a>	else if (bLeanLeft)
<a name="7211"></a>	{
<a name="7212"></a>		if ( abs(LeanAmount) &lt; LeanMax )
<a name="7213"></a>			LeanAmount -= LeanFactor * <span class="source_type">deltatime</span>;
<a name="7214"></a>		else if ( abs(LeanAmount) &gt;= LeanMax )
<a name="7215"></a>			LeanAmount = -LeanMax;
<a name="7216"></a>		bLeaningLeft=true;
<a name="7217"></a>	}
<a name="7218"></a>}
<a name="7219"></a>
<a name="7220"></a>simulated function LeanRight()
<a name="7221"></a>{
<a name="7222"></a>	if ( TraceWall(<span class="source_int">16384</span>, <span class="source_int">64</span>) || bLeaningLeft || bIsSprinting )
<a name="7223"></a>	{
<a name="7224"></a>		bLeanRight=false;
<a name="7225"></a>		return;
<a name="7226"></a>	}
<a name="7227"></a>
<a name="7228"></a>	if ( !bLeanLeft )
<a name="7229"></a>		bLeanRight=true;
<a name="7230"></a>}
<a name="7231"></a>
<a name="7232"></a>simulated function LeanRightReleased()
<a name="7233"></a>{
<a name="7234"></a>	bLeanRight=false;
<a name="7235"></a>}
<a name="7236"></a>
<a name="7237"></a>simulated function LeanLeft()
<a name="7238"></a>{
<a name="7239"></a>	if ( TraceWall(-<span class="source_int">16384</span>, <span class="source_int">64</span>) || bLeaningRight || bIsSprinting )
<a name="7240"></a>	{
<a name="7241"></a>		bLeanLeft=false;
<a name="7242"></a>		return;
<a name="7243"></a>	}
<a name="7244"></a>
<a name="7245"></a>	if ( !bLeanRight )
<a name="7246"></a>		bLeanLeft=true;
<a name="7247"></a>}
<a name="7248"></a>
<a name="7249"></a>simulated function LeanLeftReleased()
<a name="7250"></a>{
<a name="7251"></a>	bLeanLeft=false;
<a name="7252"></a>}
<a name="7253"></a>
<a name="7254"></a>function <span class="source_type">float</span> ModifyThreat(<span class="source_type">float</span> current, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> Threat)
<a name="7255"></a>{
<a name="7256"></a>	if (<span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span>(Threat) != None)
<a name="7257"></a>		current -= <span class="source_int">2.0</span>;
<a name="7258"></a>	else
<a name="7259"></a>		current += <span class="source_int">0.5</span>;
<a name="7260"></a>	return current;
<a name="7261"></a>}
<a name="7262"></a>
<a name="7263"></a>defaultproperties
<a name="7264"></a>{
<a name="7265"></a>     bNoDefaultInventory=True
<a name="7266"></a>     bAcceptAllInventory=True
<a name="7267"></a>     bPlayOwnFootsteps=True
<a name="7268"></a>     AttackSuitability=<span class="source_int">0.500000</span>
<a name="7269"></a>     SquadName=<span class="source_string">"Squad"</span>
<a name="7270"></a>     VoiceType=<span class="source_string">"ROGame.ROGerman1Voice"</span>
<a name="7271"></a>     bPlayerShadows=True
<a name="7272"></a>     Species=<span class="source_type">Class</span><span class="source_name">'ROEngine.ROSPECIES_Human'</span>
<a name="7273"></a>     DeResTime=<span class="source_int">6.000000</span>
<a name="7274"></a>     GruntVolume=<span class="source_int">0.180000</span>
<a name="7275"></a>     FootstepVolume=<span class="source_int">0.500000</span>
<a name="7276"></a>     MinTimeBetweenPainSounds=<span class="source_int">0.350000</span>
<a name="7277"></a>     SoundGroupClass=<span class="source_type">Class</span><span class="source_name">'ROEngine.ROPawnSoundGroup'</span>
<a name="7278"></a>     RagdollLifeSpan=<span class="source_int">30.000000</span>
<a name="7279"></a>     RagInvInertia=<span class="source_int">4.000000</span>
<a name="7280"></a>     RagDeathVel=<span class="source_int">100.000000</span>
<a name="7281"></a>     RagShootStrength=<span class="source_int">200.000000</span>
<a name="7282"></a>     RagSpinScale=<span class="source_int">7.500000</span>
<a name="7283"></a>     RagMaxSpinAmount=<span class="source_int">100.000000</span>
<a name="7284"></a>     RagGravScale=<span class="source_int">1.000000</span>
<a name="7285"></a>     RagImpactSoundInterval=<span class="source_int">0.250000</span>
<a name="7286"></a>     PlacedCharacterName=<span class="source_string">"Soldier"</span>
<a name="7287"></a>     FireRootBone=<span class="source_string">"Bip01_Spine"</span>
<a name="7288"></a>     SeveredArmAttachClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredArmAttachment'</span>
<a name="7289"></a>     SeveredLegAttachClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredLegAttachment'</span>
<a name="7290"></a>     SeveredHeadAttachClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredHeadAttachment'</span>
<a name="7291"></a>     BleedingEmitterClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.ROBloodSpurt'</span>
<a name="7292"></a>     ProjectileBloodSplatClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.ProjectileBloodSplat'</span>
<a name="7293"></a>     DetachedArmClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredArm'</span>
<a name="7294"></a>     DetachedLegClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredLeg'</span>
<a name="7295"></a>     ObliteratedEffectClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.PlayerObliteratedEmitter'</span>
<a name="7296"></a>     Stamina=<span class="source_int">20.000000</span>
<a name="7297"></a>     JumpStaminaDrain=<span class="source_int">4.000000</span>
<a name="7298"></a>     StaminaRecoveryRate=<span class="source_int">0.650000</span>
<a name="7299"></a>     CrouchStaminaRecoveryRate=<span class="source_int">0.800000</span>
<a name="7300"></a>     ProneStaminaRecoveryRate=<span class="source_int">1.000000</span>
<a name="7301"></a>     SlowStaminaRecoveryRate=<span class="source_int">0.200000</span>
<a name="7302"></a>     MomentumCurve=(Points=((InVal=<span class="source_int">400.000000</span>),(InVal=<span class="source_int">625.000000</span>,OutVal=<span class="source_int">1.250000</span>),(InVal=<span class="source_int">2500.000000</span>,OutVal=<span class="source_int">3.125000</span>),(InVal=<span class="source_int">5625.000000</span>,OutVal=<span class="source_int">6.250000</span>),(InVal=<span class="source_int">1000000000.000000</span>,OutVal=<span class="source_int">6.250000</span>)))
<a name="7303"></a>     FrictionScale=<span class="source_int">0.543750</span>
<a name="7304"></a>     PronePitchUpLimit=<span class="source_int">14000</span>
<a name="7305"></a>     PronePitchDownLimit=<span class="source_int">51000</span>
<a name="7306"></a>     CrawlingPitchUpLimit=<span class="source_int">14000</span>
<a name="7307"></a>     CrawlingPitchDownLimit=<span class="source_int">60000</span>
<a name="7308"></a>     CrawlPitchTweenRate=<span class="source_int">60000</span>
<a name="7309"></a>     ProneIdleRestAnim=<span class="source_string">"prone_idle_nade"</span>
<a name="7310"></a>     CrouchIdleRestAnim=<span class="source_string">"crouch_idle_nade"</span>
<a name="7311"></a>     ProneAnims(<span class="source_int">0</span>)=<span class="source_string">"prone_crawlF_nade"</span>
<a name="7312"></a>     ProneAnims(<span class="source_int">1</span>)=<span class="source_string">"prone_crawlB_nade"</span>
<a name="7313"></a>     ProneAnims(<span class="source_int">2</span>)=<span class="source_string">"prone_crawlL_nade"</span>
<a name="7314"></a>     ProneAnims(<span class="source_int">3</span>)=<span class="source_string">"prone_crawlR_nade"</span>
<a name="7315"></a>     ProneAnims(<span class="source_int">4</span>)=<span class="source_string">"prone_crawlFL_nade"</span>
<a name="7316"></a>     ProneAnims(<span class="source_int">5</span>)=<span class="source_string">"prone_crawlFR_nade"</span>
<a name="7317"></a>     ProneAnims(<span class="source_int">6</span>)=<span class="source_string">"prone_crawlBL_nade"</span>
<a name="7318"></a>     ProneAnims(<span class="source_int">7</span>)=<span class="source_string">"prone_crawlBR_nade"</span>
<a name="7319"></a>     IdleProneAnim=<span class="source_string">"prone_idle_nade"</span>
<a name="7320"></a>     ProneTurnRightAnim=<span class="source_string">"prone_turnR_binoc"</span>
<a name="7321"></a>     ProneTurnLeftAnim=<span class="source_string">"prone_turnL_binoc"</span>
<a name="7322"></a>     StandToProneAnim=<span class="source_string">"StandtoProne_nade"</span>
<a name="7323"></a>     ProneToStandAnim=<span class="source_string">"PronetoStand_nade"</span>
<a name="7324"></a>     CrouchToProneAnim=<span class="source_string">"CrouchtoProne_nade"</span>
<a name="7325"></a>     ProneToCrouchAnim=<span class="source_string">"PronetoCrouch_nade"</span>
<a name="7326"></a>     DiveToProneStartAnim=<span class="source_string">"prone_divef_nade"</span>
<a name="7327"></a>     DiveToProneEndAnim=<span class="source_string">"prone_diveend_nade"</span>
<a name="7328"></a>     SprintAnims(<span class="source_int">0</span>)=<span class="source_string">"stand_sprintF_nade"</span>
<a name="7329"></a>     SprintAnims(<span class="source_int">1</span>)=<span class="source_string">"stand_sprintB_nade"</span>
<a name="7330"></a>     SprintAnims(<span class="source_int">2</span>)=<span class="source_string">"stand_sprintL_nade"</span>
<a name="7331"></a>     SprintAnims(<span class="source_int">3</span>)=<span class="source_string">"stand_sprintR_nade"</span>
<a name="7332"></a>     SprintAnims(<span class="source_int">4</span>)=<span class="source_string">"stand_sprintFL_nade"</span>
<a name="7333"></a>     SprintAnims(<span class="source_int">5</span>)=<span class="source_string">"stand_sprintFR_nade"</span>
<a name="7334"></a>     SprintAnims(<span class="source_int">6</span>)=<span class="source_string">"stand_sprintBL_nade"</span>
<a name="7335"></a>     SprintAnims(<span class="source_int">7</span>)=<span class="source_string">"stand_sprintBR_nade"</span>
<a name="7336"></a>     SprintCrouchAnims(<span class="source_int">0</span>)=<span class="source_string">"crouch_sprintF_nade"</span>
<a name="7337"></a>     SprintCrouchAnims(<span class="source_int">1</span>)=<span class="source_string">"crouch_sprintB_nade"</span>
<a name="7338"></a>     SprintCrouchAnims(<span class="source_int">2</span>)=<span class="source_string">"crouch_sprintL_nade"</span>
<a name="7339"></a>     SprintCrouchAnims(<span class="source_int">3</span>)=<span class="source_string">"crouch_sprintR_nade"</span>
<a name="7340"></a>     SprintCrouchAnims(<span class="source_int">4</span>)=<span class="source_string">"crouch_sprintFL_nade"</span>
<a name="7341"></a>     SprintCrouchAnims(<span class="source_int">5</span>)=<span class="source_string">"crouch_sprintFR_nade"</span>
<a name="7342"></a>     SprintCrouchAnims(<span class="source_int">6</span>)=<span class="source_string">"crouch_sprintBL_nade"</span>
<a name="7343"></a>     SprintCrouchAnims(<span class="source_int">7</span>)=<span class="source_string">"crouch_sprintBR_nade"</span>
<a name="7344"></a>     WalkIronAnims(<span class="source_int">0</span>)=<span class="source_string">"stand_walkFiron_binoc"</span>
<a name="7345"></a>     WalkIronAnims(<span class="source_int">1</span>)=<span class="source_string">"stand_walkBiron_binoc"</span>
<a name="7346"></a>     WalkIronAnims(<span class="source_int">2</span>)=<span class="source_string">"stand_walkLiron_binoc"</span>
<a name="7347"></a>     WalkIronAnims(<span class="source_int">3</span>)=<span class="source_string">"stand_walkRiron_binoc"</span>
<a name="7348"></a>     WalkIronAnims(<span class="source_int">4</span>)=<span class="source_string">"stand_walkFLiron_binoc"</span>
<a name="7349"></a>     WalkIronAnims(<span class="source_int">5</span>)=<span class="source_string">"stand_walkFRiron_binoc"</span>
<a name="7350"></a>     WalkIronAnims(<span class="source_int">6</span>)=<span class="source_string">"stand_walkBLiron_binoc"</span>
<a name="7351"></a>     WalkIronAnims(<span class="source_int">7</span>)=<span class="source_string">"stand_walkBRiron_binoc"</span>
<a name="7352"></a>     IdleIronRestAnim=<span class="source_string">"stand_idleiron_binoc"</span>
<a name="7353"></a>     IdleIronWeaponAnim=<span class="source_string">"stand_idleiron_binoc"</span>
<a name="7354"></a>     IdleCrouchIronWeaponAnim=<span class="source_string">"crouch_idle_nade"</span>
<a name="7355"></a>     TurnIronRightAnim=<span class="source_string">"stand_turnRiron_binoc"</span>
<a name="7356"></a>     TurnIronLeftAnim=<span class="source_string">"stand_turnLiron_binoc"</span>
<a name="7357"></a>     CrouchTurnIronRightAnim=<span class="source_string">"crouch_turnRiron_binoc"</span>
<a name="7358"></a>     CrouchTurnIronLeftAnim=<span class="source_string">"crouch_turnLiron_binoc"</span>
<a name="7359"></a>     LimpAnims(<span class="source_int">0</span>)=<span class="source_string">"stand_limpFhip_binoc"</span>
<a name="7360"></a>     LimpAnims(<span class="source_int">1</span>)=<span class="source_string">"stand_limpBhip_binoc"</span>
<a name="7361"></a>     LimpAnims(<span class="source_int">2</span>)=<span class="source_string">"stand_limpLhip_binoc"</span>
<a name="7362"></a>     LimpAnims(<span class="source_int">3</span>)=<span class="source_string">"stand_limpRhip_binoc"</span>
<a name="7363"></a>     LimpAnims(<span class="source_int">4</span>)=<span class="source_string">"stand_limpFLhip_binoc"</span>
<a name="7364"></a>     LimpAnims(<span class="source_int">5</span>)=<span class="source_string">"stand_limpFRhip_binoc"</span>
<a name="7365"></a>     LimpAnims(<span class="source_int">6</span>)=<span class="source_string">"stand_limpBLhip_binoc"</span>
<a name="7366"></a>     LimpAnims(<span class="source_int">7</span>)=<span class="source_string">"stand_limpBRhip_binoc"</span>
<a name="7367"></a>     LandRecoveryTime=<span class="source_int">1.500000</span>
<a name="7368"></a>     CurrentCapArea=<span class="source_int">255</span>
<a name="7369"></a>     SprintAccelRate=<span class="source_int">350.000000</span>
<a name="7370"></a>     FootStepSoundRadius=<span class="source_int">125.000000</span>
<a name="7371"></a>     QuietFootStepVolume=<span class="source_int">0.450000</span>
<a name="7372"></a>     CrouchEyeHeightMod=<span class="source_int">0.300000</span>
<a name="7373"></a>     CrouchMoveEyeHeightMod=<span class="source_int">0.770000</span>
<a name="7374"></a>     ProneEyeHeight=<span class="source_int">5.000000</span>
<a name="7375"></a>     ProneEyeDist=<span class="source_int">10.000000</span>
<a name="7376"></a>     CameraBone=<span class="source_string">"Camera_Bone"</span>
<a name="7377"></a>     LeanMax=<span class="source_int">3000.000000</span>
<a name="7378"></a>     LeanFactor=<span class="source_int">10000.000000</span>
<a name="7379"></a>     LeanLViewOffset=(<span class="source_type">Y</span>=-<span class="source_int">18.000000</span>,<span class="source_type">Z</span>=-<span class="source_int">8.000000</span>)
<a name="7380"></a>     LeanRViewOffset=(<span class="source_type">Y</span>=<span class="source_int">21.000000</span>,<span class="source_type">Z</span>=-<span class="source_int">14.000000</span>)
<a name="7381"></a>     LeanLCrouchViewOffset=(<span class="source_type">Y</span>=-<span class="source_int">14.000000</span>,<span class="source_type">Z</span>=-<span class="source_int">1.000000</span>)
<a name="7382"></a>     LeanRCrouchViewOffset=(<span class="source_type">Y</span>=<span class="source_int">17.000000</span>,<span class="source_type">Z</span>=-<span class="source_int">8.000000</span>)
<a name="7383"></a>     LeanLProneViewOffset=(<span class="source_type">Y</span>=-<span class="source_int">14.000000</span>,<span class="source_type">Z</span>=<span class="source_int">2.000000</span>)
<a name="7384"></a>     LeanRProneViewOffset=(<span class="source_type">Y</span>=<span class="source_int">17.000000</span>,<span class="source_type">Z</span>=<span class="source_int">1.000000</span>)
<a name="7385"></a>     AnimPitchUpLimit=<span class="source_int">9000</span>
<a name="7386"></a>     AnimPitchDownLimit=-<span class="source_int">14000</span>
<a name="7387"></a>     ProneAnimPitchUpLimit=<span class="source_int">4500</span>
<a name="7388"></a>     ProneAnimPitchDownLimit=-<span class="source_int">2000</span>
<a name="7389"></a>     LeanBones(<span class="source_int">0</span>)=<span class="source_string">"Bip01_Spine"</span>
<a name="7390"></a>     LeanBones(<span class="source_int">1</span>)=<span class="source_string">"Bip01_Spine1"</span>
<a name="7391"></a>     LeanBones(<span class="source_int">2</span>)=<span class="source_string">"Bip01_Spine2"</span>
<a name="7392"></a>     LeanBones(<span class="source_int">3</span>)=<span class="source_string">"Bip01_Spine3"</span>
<a name="7393"></a>     LeanBones(<span class="source_int">4</span>)=<span class="source_string">"Bip01_Neck"</span>
<a name="7394"></a>     LeanBones(<span class="source_int">5</span>)=<span class="source_string">"Bip01_Head"</span>
<a name="7395"></a>     LeanBones(<span class="source_int">6</span>)=<span class="source_string">"ShovelCase01"</span>
<a name="7396"></a>     LeanLeftStanding(<span class="source_int">0</span>)=(Pitch=<span class="source_int">4850</span>)
<a name="7397"></a>     LeanLeftStanding(<span class="source_int">1</span>)=(Pitch=<span class="source_int">4850</span>)
<a name="7398"></a>     LeanLeftStanding(<span class="source_int">6</span>)=(Pitch=-<span class="source_int">3800</span>)
<a name="7399"></a>     LeanRightStanding(<span class="source_int">0</span>)=(Pitch=-<span class="source_int">6500</span>)
<a name="7400"></a>     LeanRightStanding(<span class="source_int">1</span>)=(Pitch=<span class="source_int">350</span>)
<a name="7401"></a>     LeanRightStanding(<span class="source_int">6</span>)=(Pitch=<span class="source_int">3000</span>)
<a name="7402"></a>     LeanLeftCrouch(<span class="source_int">0</span>)=(Pitch=<span class="source_int">6000</span>)
<a name="7403"></a>     LeanLeftCrouch(<span class="source_int">1</span>)=(Pitch=<span class="source_int">4000</span>,Yaw=<span class="source_int">1000</span>)
<a name="7404"></a>     LeanLeftCrouch(<span class="source_int">5</span>)=(Pitch=-<span class="source_int">4000</span>)
<a name="7405"></a>     LeanLeftCrouch(<span class="source_int">6</span>)=(Pitch=-<span class="source_int">7000</span>)
<a name="7406"></a>     LeanRightCrouch(<span class="source_int">0</span>)=(Pitch=-<span class="source_int">3000</span>)
<a name="7407"></a>     LeanRightCrouch(<span class="source_int">1</span>)=(Pitch=-<span class="source_int">2800</span>)
<a name="7408"></a>     LeanRightCrouch(<span class="source_int">5</span>)=(Roll=-<span class="source_int">1000</span>)
<a name="7409"></a>     LeanRightCrouch(<span class="source_int">6</span>)=(Pitch=<span class="source_int">1300</span>)
<a name="7410"></a>     LeanLeftProne(<span class="source_int">0</span>)=(Pitch=<span class="source_int">2500</span>,Yaw=<span class="source_int">6000</span>,Roll=<span class="source_int">2500</span>)
<a name="7411"></a>     LeanLeftProne(<span class="source_int">1</span>)=(Pitch=<span class="source_int">4000</span>,Yaw=-<span class="source_int">3000</span>,Roll=-<span class="source_int">300</span>)
<a name="7412"></a>     LeanLeftProne(<span class="source_int">5</span>)=(Pitch=-<span class="source_int">2000</span>)
<a name="7413"></a>     LeanLeftProne(<span class="source_int">6</span>)=(Pitch=-<span class="source_int">1000</span>,Yaw=-<span class="source_int">5000</span>)
<a name="7414"></a>     LeanRightProne(<span class="source_int">0</span>)=(Pitch=<span class="source_int">2000</span>,Yaw=-<span class="source_int">4500</span>,Roll=<span class="source_int">2000</span>)
<a name="7415"></a>     LeanRightProne(<span class="source_int">1</span>)=(Pitch=-<span class="source_int">7000</span>,Yaw=<span class="source_int">3000</span>,Roll=<span class="source_int">500</span>)
<a name="7416"></a>     LeanRightProne(<span class="source_int">6</span>)=(Pitch=-<span class="source_int">1500</span>,Yaw=<span class="source_int">2000</span>)
<a name="7417"></a>     DeployedPitchUpLimit=<span class="source_int">12000</span>
<a name="7418"></a>     DeployedPitchDownLimit=-<span class="source_int">10000</span>
<a name="7419"></a>     DeployedPositiveYawLimit=<span class="source_int">7300</span>
<a name="7420"></a>     DeployedNegativeYawLimit=-<span class="source_int">7300</span>
<a name="7421"></a>     NetSoundRadiusSquared=<span class="source_int">820000.000000</span>
<a name="7422"></a>     bCanCrouch=True
<a name="7423"></a>     bCanSwim=True
<a name="7424"></a>     bCanClimbLadders=True
<a name="7425"></a>     bCanStrafe=True
<a name="7426"></a>     bCanDoubleJump=False
<a name="7427"></a>     bCanWalkOffLedges=True
<a name="7428"></a>     bNoCoronas=False
<a name="7429"></a>     bCanPickupInventory=True
<a name="7430"></a>     bMuffledHearing=True
<a name="7431"></a>     SightRadius=<span class="source_int">6000.000000</span>
<a name="7432"></a>     MeleeRange=<span class="source_int">20.000000</span>
<a name="7433"></a>     GroundSpeed=<span class="source_int">200.000000</span>
<a name="7434"></a>     WaterSpeed=<span class="source_int">100.000000</span>
<a name="7435"></a>     AirSpeed=<span class="source_int">70.000000</span>
<a name="7436"></a>     LadderSpeed=<span class="source_int">75.000000</span>
<a name="7437"></a>     AccelRate=<span class="source_int">300.000000</span>
<a name="7438"></a>     JumpZ=<span class="source_int">315.000000</span>
<a name="7439"></a>     AirControl=<span class="source_int">0.020000</span>
<a name="7440"></a>     WalkingPct=<span class="source_int">0.350000</span>
<a name="7441"></a>     CrouchedPct=<span class="source_int">0.300000</span>
<a name="7442"></a>     MaxFallSpeed=<span class="source_int">650.000000</span>
<a name="7443"></a>     BaseEyeHeight=<span class="source_int">42.000000</span>
<a name="7444"></a>     EyeHeight=<span class="source_int">42.000000</span>
<a name="7445"></a>     CrouchHeight=<span class="source_int">38.000000</span>
<a name="7446"></a>     CrouchRadius=<span class="source_int">22.000000</span>
<a name="7447"></a>     UnderWaterTime=<span class="source_int">20.000000</span>
<a name="7448"></a>     Bob=<span class="source_int">0.010000</span>
<a name="7449"></a>     ControllerClass=<span class="source_type">Class</span><span class="source_name">'ROEngine.ROBot'</span>
<a name="7450"></a>     bPhysicsAnimUpdate=True
<a name="7451"></a>     bDoTorsoTwist=True
<a name="7452"></a>     MovementAnims(<span class="source_int">0</span>)=<span class="source_string">"stand_jogF_nade"</span>
<a name="7453"></a>     MovementAnims(<span class="source_int">1</span>)=<span class="source_string">"stand_jogB_nade"</span>
<a name="7454"></a>     MovementAnims(<span class="source_int">2</span>)=<span class="source_string">"stand_jogL_nade"</span>
<a name="7455"></a>     MovementAnims(<span class="source_int">3</span>)=<span class="source_string">"stand_jogR_nade"</span>
<a name="7456"></a>     MovementAnims(<span class="source_int">4</span>)=<span class="source_string">"stand_jogFL_nade"</span>
<a name="7457"></a>     MovementAnims(<span class="source_int">5</span>)=<span class="source_string">"stand_jogFR_nade"</span>
<a name="7458"></a>     MovementAnims(<span class="source_int">6</span>)=<span class="source_string">"stand_jogBL_nade"</span>
<a name="7459"></a>     MovementAnims(<span class="source_int">7</span>)=<span class="source_string">"stand_jogBR_nade"</span>
<a name="7460"></a>     TurnLeftAnim=<span class="source_string">"stand_turnLhip_binoc"</span>
<a name="7461"></a>     TurnRightAnim=<span class="source_string">"stand_turnRhip_binoc"</span>
<a name="7462"></a>     SwimAnims(<span class="source_int">0</span>)=<span class="source_string">"stand_jogF_nade"</span>
<a name="7463"></a>     SwimAnims(<span class="source_int">1</span>)=<span class="source_string">"stand_jogB_nade"</span>
<a name="7464"></a>     SwimAnims(<span class="source_int">2</span>)=<span class="source_string">"stand_jogL_nade"</span>
<a name="7465"></a>     SwimAnims(<span class="source_int">3</span>)=<span class="source_string">"stand_jogR_nade"</span>
<a name="7466"></a>     CrouchAnims(<span class="source_int">0</span>)=<span class="source_string">"crouch_walkF_nade"</span>
<a name="7467"></a>     CrouchAnims(<span class="source_int">1</span>)=<span class="source_string">"crouch_walkB_nade"</span>
<a name="7468"></a>     CrouchAnims(<span class="source_int">2</span>)=<span class="source_string">"crouch_walkL_nade"</span>
<a name="7469"></a>     CrouchAnims(<span class="source_int">3</span>)=<span class="source_string">"crouch_walkR_nade"</span>
<a name="7470"></a>     CrouchAnims(<span class="source_int">4</span>)=<span class="source_string">"crouch_walkFL_nade"</span>
<a name="7471"></a>     CrouchAnims(<span class="source_int">5</span>)=<span class="source_string">"crouch_walkFR_nade"</span>
<a name="7472"></a>     CrouchAnims(<span class="source_int">6</span>)=<span class="source_string">"crouch_walkBL_nade"</span>
<a name="7473"></a>     CrouchAnims(<span class="source_int">7</span>)=<span class="source_string">"crouch_walkBR_nade"</span>
<a name="7474"></a>     WalkAnims(<span class="source_int">0</span>)=<span class="source_string">"stand_walkFhip_binoc"</span>
<a name="7475"></a>     WalkAnims(<span class="source_int">1</span>)=<span class="source_string">"stand_walkBhip_binoc"</span>
<a name="7476"></a>     WalkAnims(<span class="source_int">2</span>)=<span class="source_string">"stand_walkLhip_binoc"</span>
<a name="7477"></a>     WalkAnims(<span class="source_int">3</span>)=<span class="source_string">"stand_walkRhip_binoc"</span>
<a name="7478"></a>     WalkAnims(<span class="source_int">4</span>)=<span class="source_string">"stand_walkFLhip_binoc"</span>
<a name="7479"></a>     WalkAnims(<span class="source_int">5</span>)=<span class="source_string">"stand_walkFRhip_binoc"</span>
<a name="7480"></a>     WalkAnims(<span class="source_int">6</span>)=<span class="source_string">"stand_walkBLhip_binoc"</span>
<a name="7481"></a>     WalkAnims(<span class="source_int">7</span>)=<span class="source_string">"stand_walkBRhip_binoc"</span>
<a name="7482"></a>     AirAnims(<span class="source_int">0</span>)=<span class="source_string">"jumpF_mid_binoc"</span>
<a name="7483"></a>     AirAnims(<span class="source_int">1</span>)=<span class="source_string">"jumpB_mid_binoc"</span>
<a name="7484"></a>     AirAnims(<span class="source_int">2</span>)=<span class="source_string">"jumpL_mid_binoc"</span>
<a name="7485"></a>     AirAnims(<span class="source_int">3</span>)=<span class="source_string">"jumpR_mid_binoc"</span>
<a name="7486"></a>     TakeoffAnims(<span class="source_int">0</span>)=<span class="source_string">"jumpF_takeoff_binoc"</span>
<a name="7487"></a>     TakeoffAnims(<span class="source_int">1</span>)=<span class="source_string">"jumpB_takeoff_binoc"</span>
<a name="7488"></a>     TakeoffAnims(<span class="source_int">2</span>)=<span class="source_string">"jumpL_takeoff_binoc"</span>
<a name="7489"></a>     TakeoffAnims(<span class="source_int">3</span>)=<span class="source_string">"jumpR_takeoff_binoc"</span>
<a name="7490"></a>     LandAnims(<span class="source_int">0</span>)=<span class="source_string">"jumpF_land_binoc"</span>
<a name="7491"></a>     LandAnims(<span class="source_int">1</span>)=<span class="source_string">"jumpB_land_binoc"</span>
<a name="7492"></a>     LandAnims(<span class="source_int">2</span>)=<span class="source_string">"jumpL_land_binoc"</span>
<a name="7493"></a>     LandAnims(<span class="source_int">3</span>)=<span class="source_string">"jumpR_land_binoc"</span>
<a name="7494"></a>     DodgeAnims(<span class="source_int">0</span>)=<span class="source_string">"jumpF_mid_binoc"</span>
<a name="7495"></a>     DodgeAnims(<span class="source_int">1</span>)=<span class="source_string">"jumpB_mid_binoc"</span>
<a name="7496"></a>     DodgeAnims(<span class="source_int">2</span>)=<span class="source_string">"jumpL_mid_binoc"</span>
<a name="7497"></a>     DodgeAnims(<span class="source_int">3</span>)=<span class="source_string">"jumpR_mid_binoc"</span>
<a name="7498"></a>     AirStillAnim=<span class="source_string">"jump_mid_binoc"</span>
<a name="7499"></a>     TakeoffStillAnim=<span class="source_string">"jump_takeoff_binoc"</span>
<a name="7500"></a>     CrouchTurnRightAnim=<span class="source_string">"crouch_turnR_nade"</span>
<a name="7501"></a>     CrouchTurnLeftAnim=<span class="source_string">"crouch_turnL_nade"</span>
<a name="7502"></a>     IdleCrouchAnim=<span class="source_string">"crouch_idle_nade"</span>
<a name="7503"></a>     IdleWeaponAnim=<span class="source_string">"stand_idlehip_binoc"</span>
<a name="7504"></a>     IdleRestAnim=<span class="source_string">"stand_idlehip_binoc"</span>
<a name="7505"></a>     IdleChatAnim=<span class="source_string">"Idle_Chat"</span>
<a name="7506"></a>     RootBone=<span class="source_string">"HIP"</span>
<a name="7507"></a>     HeadBone=<span class="source_string">"Bip01_Head"</span>
<a name="7508"></a>     SpineBone1=<span class="source_string">"Bip01_Spine"</span>
<a name="7509"></a>     SpineBone2=<span class="source_string">"Bip01_Spine1"</span>
<a name="7510"></a>     bCanProne=True
<a name="7511"></a>     ProneHeight=<span class="source_int">10.000000</span>
<a name="7512"></a>     HitPoints(<span class="source_int">0</span>)=(PointRadius=<span class="source_int">60.000000</span>,PointHeight=<span class="source_int">75.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"HIP"</span>)
<a name="7513"></a>     HitPoints(<span class="source_int">1</span>)=(PointRadius=<span class="source_int">6.500000</span>,PointHeight=<span class="source_int">8.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"head"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">4.000000</span>,<span class="source_type">Y</span>=-<span class="source_int">2.500000</span>),DamageMultiplier=<span class="source_int">2.000000</span>,HitPointType=PHP_Head)
<a name="7514"></a>     HitPoints(<span class="source_int">2</span>)=(PointRadius=<span class="source_int">11.000000</span>,PointHeight=<span class="source_int">13.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"UpperSpine"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">5.000000</span>),DamageMultiplier=<span class="source_int">1.000000</span>,HitPointType=PHP_Torso)
<a name="7515"></a>     HitPoints(<span class="source_int">3</span>)=(PointRadius=<span class="source_int">10.500000</span>,PointHeight=<span class="source_int">10.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"spine"</span>,PointOffset=(<span class="source_type">X</span>=-<span class="source_int">5.000000</span>),DamageMultiplier=<span class="source_int">1.000000</span>,HitPointType=PHP_Torso)
<a name="7516"></a>     HitPoints(<span class="source_int">4</span>)=(PointRadius=<span class="source_int">6.000000</span>,PointHeight=<span class="source_int">12.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"lupperthigh"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">16.000000</span>,<span class="source_type">Z</span>=<span class="source_int">1.000000</span>),DamageMultiplier=<span class="source_int">0.500000</span>,HitPointType=PHP_Leg)
<a name="7517"></a>     HitPoints(<span class="source_int">5</span>)=(PointRadius=<span class="source_int">6.000000</span>,PointHeight=<span class="source_int">12.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"rupperthigh"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">16.000000</span>,<span class="source_type">Z</span>=-<span class="source_int">1.000000</span>),DamageMultiplier=<span class="source_int">0.500000</span>,HitPointType=PHP_Leg)
<a name="7518"></a>     HitPoints(<span class="source_int">6</span>)=(PointRadius=<span class="source_int">5.000000</span>,PointHeight=<span class="source_int">9.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"lupperarm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">7.000000</span>),DamageMultiplier=<span class="source_int">0.300000</span>,HitPointType=PHP_Arm)
<a name="7519"></a>     HitPoints(<span class="source_int">7</span>)=(PointRadius=<span class="source_int">5.000000</span>,PointHeight=<span class="source_int">9.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"rupperarm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">7.000000</span>),DamageMultiplier=<span class="source_int">0.300000</span>,HitPointType=PHP_Arm)
<a name="7520"></a>     HitPoints(<span class="source_int">8</span>)=(PointRadius=<span class="source_int">5.000000</span>,PointHeight=<span class="source_int">15.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"lthigh"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">15.000000</span>),DamageMultiplier=<span class="source_int">0.400000</span>,HitPointType=PHP_Leg)
<a name="7521"></a>     HitPoints(<span class="source_int">9</span>)=(PointRadius=<span class="source_int">5.000000</span>,PointHeight=<span class="source_int">15.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"rthigh"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">15.000000</span>),DamageMultiplier=<span class="source_int">0.400000</span>,HitPointType=PHP_Leg)
<a name="7522"></a>     HitPoints(<span class="source_int">10</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">10.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"lfarm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">7.000000</span>),DamageMultiplier=<span class="source_int">0.200000</span>,HitPointType=PHP_Arm)
<a name="7523"></a>     HitPoints(<span class="source_int">11</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">10.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"rfarm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">7.000000</span>),DamageMultiplier=<span class="source_int">0.200000</span>,HitPointType=PHP_Arm)
<a name="7524"></a>     HitPoints(<span class="source_int">12</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">5.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"lhand"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">5.000000</span>,<span class="source_type">Y</span>=-<span class="source_int">1.000000</span>,<span class="source_type">Z</span>=-<span class="source_int">1.000000</span>),DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Hand)
<a name="7525"></a>     HitPoints(<span class="source_int">13</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">5.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"rhand"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">5.000000</span>,<span class="source_type">Y</span>=-<span class="source_int">2.000000</span>),DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Hand)
<a name="7526"></a>     HitPoints(<span class="source_int">14</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">7.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"lfoot"</span>,PointOffset=(<span class="source_type">Y</span>=-<span class="source_int">2.000000</span>),DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Foot)
<a name="7527"></a>     HitPoints(<span class="source_int">15</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">7.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"rfoot"</span>,PointOffset=(<span class="source_type">Y</span>=-<span class="source_int">2.000000</span>),DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Foot)
<a name="7528"></a>     LightHue=<span class="source_int">204</span>
<a name="7529"></a>     LightBrightness=<span class="source_int">255.000000</span>
<a name="7530"></a>     LightRadius=<span class="source_int">3.000000</span>
<a name="7531"></a>     bActorShadows=True
<a name="7532"></a>     bDramaticLighting=True
<a name="7533"></a>     bStasis=False
<a name="7534"></a>     LODBias=<span class="source_int">1.800000</span>
<a name="7535"></a>     <span class="source_type"><a href="../engine/texture.html" class="source">Texture</a></span>=None
<a name="7536"></a>     PrePivot=(<span class="source_type">Z</span>=-<span class="source_int">42.000000</span>)
<a name="7537"></a>     AmbientGlow=<span class="source_int">5</span>
<a name="7538"></a>     MaxLights=<span class="source_int">8</span>
<a name="7539"></a>     bForceSkelUpdate=True
<a name="7540"></a>     SoundVolume=<span class="source_int">150</span>
<a name="7541"></a>     SoundRadius=<span class="source_int">75.000000</span>
<a name="7542"></a>     CollisionRadius=<span class="source_int">23.000000</span>
<a name="7543"></a>     CollisionHeight=<span class="source_int">52.000000</span>
<a name="7544"></a>     bUseCylinderCollision=True
<a name="7545"></a>     bNetNotify=True
<a name="7546"></a>     bBlockHitPointTraces=False
<a name="7547"></a>     Buoyancy=<span class="source_int">99.000000</span>
<a name="7548"></a>     RotationRate=(Pitch=<span class="source_int">3072</span>,Roll=<span class="source_int">2048</span>)
<a name="7549"></a>     Begin <span class="source_type"><a href="../core/object.html" class="source">Object</a></span> <span class="source_type">Class</span>=<span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span> <span class="source_type">Name</span>=PawnKParams
<a name="7550"></a>         KConvulseSpacing=(<span class="source_type">Max</span>=<span class="source_int">2.200000</span>)
<a name="7551"></a>         KLinearDamping=<span class="source_int">0.150000</span>
<a name="7552"></a>         KAngularDamping=<span class="source_int">0.050000</span>
<a name="7553"></a>         KBuoyancy=<span class="source_int">1.000000</span>
<a name="7554"></a>         KStartEnabled=True
<a name="7555"></a>         KVelDropBelowThreshold=<span class="source_int">50.000000</span>
<a name="7556"></a>         bHighDetailOnly=False
<a name="7557"></a>         KFriction=<span class="source_int">1.300000</span>
<a name="7558"></a>         KRestitution=<span class="source_int">0.200000</span>
<a name="7559"></a>         KImpactThreshold=<span class="source_int">85.000000</span>
<a name="7560"></a>     End <span class="source_type"><a href="../core/object.html" class="source">Object</a></span>
<a name="7561"></a>     KParams=<span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span><span class="source_name">'ROEngine.ROPawn.PawnKParams'</span>
<a name="7562"></a>
<a name="7563"></a>     ForceType=FT_DragAlong
<a name="7564"></a>     ForceRadius=<span class="source_int">100.000000</span>
<a name="7565"></a>     ForceScale=<span class="source_int">2.500000</span>
<a name="7566"></a>}
<a name="7567"></a></pre></td></tr></table></div>
<hr />
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../roengine/roengine-overview.html">Package</a></td>
	<td class="header"><a href="../roengine/ropawn.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#ROPawn">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_roengine/roobjectivemsg.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_roengine/ropawnsoundgroup.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>

<div class="stats">Class file time: Fri 13-10-2023 03:17:28.000 - Creation time: Fri 13-10-2023 03:19:07.260 - Created with <a href="http://wiki.beyondunreal.com/wiki/UnCodeX" target="_blank">UnCodeX</a></div>

</body>
</html>